{
    "docs": [
        {
            "location": "/", 
            "text": "\u672c\u6559\u7a0b\u4e3b\u8981\u5185\u5bb9\u6765\u81ea\uff1a\nlua\u4e2d\u6587\u624b\u518c\n\n\u90e8\u5206\u5185\u5bb9\u6765\u81ea\uff1a\n\u679c\u51bb\u60f3\u535a\u5ba2\n \n\u5fe7\u90c1\u7684\u52a0\u83f2\u732b\u535a\u5ba2\n \n\u6709\u4efb\u4f55\u95ee\u9898\u90ae\u4ef6\uff1ator9@protonmail.com\n\n\n01 lua \u7b80\u4ecb\u4e0elua\u5f00\u53d1\u73af\u5883\u7684\u642d\u5efa\n\n\n02 lua \u57fa\u672c\u6982\u5ff5\n\n\n03 lua \u8bed\u8a00\u5b9a\u4e49\n\n\n04 lua \u6807\u51c6\u5e93(\u4e0a)\n\n\n05 lua \u6807\u51c6\u5e93(\u4e0b)\n\n\n06 lua \u7f16\u7a0b\u63a5\u53e3(lua\u4e0eC\u4ea4\u4e92)\n\n\n07 lua \u6e90\u7801\u5256\u6790\u4ee5\u53ca lua \u5176\u4ed6\u8d44\u6599\u6574\u7406", 
            "title": "Home"
        }, 
        {
            "location": "/luamd/01/", 
            "text": "\u5173\u4e8e Lua\n\n\nLua \u662f\u4e00\u95e8\u5f3a\u5927\u3001\u5feb\u901f\u3001\u8f7b\u91cf\u7684\n\u5d4c\u5165\u5f0f\u811a\u672c\u8bed\u8a00\u3002\n\u5b83\u7531\u5df4\u897f\u91cc\u7ea6\u70ed\u5185\u5362 Pontifical Catholic \u5927\u5b66\u7684 PUC-Rio \u56e2\u961f \u5f00\u53d1\u3002 Lua \u662f\u4e00\u4e2a\u81ea\u7531\u8f6f\u4ef6\uff0c \u5e7f\u6cdb\u5e94\u7528\u4e8e\u4e16\u754c\u4e0a\u65e0\u6570\u4ea7\u54c1\u548c\u9879\u76ee\u3002Lua \u7684\n\u5b98\u65b9\u7f51\u7ad9\n\u4e0a\u63d0\u4f9b\u4e86\u5173\u4e8e Lua \u7684\u5b8c\u6574\u4fe1\u606f\uff0c \u5305\u62ec\n\u7efc\u5408\u6982\u8981\n\u548c\u6700\u65b0\u7684\n\u6587\u6863\n\u3002\n\n\nLua \u662f\u4e00\u95e8\u6269\u5c55\u5f0f\u7a0b\u5e8f\u8bbe\u8ba1\u8bed\u8a00\n\uff0c\u88ab\u8bbe\u8ba1\u6210\u652f\u6301\u901a\u7528\u8fc7\u7a0b\u5f0f\u7f16\u7a0b\uff0c\u5e76\u6709\u76f8\u5173\u6570\u636e\u63cf\u8ff0\u8bbe\u65bd\u3002 \n\u540c\u65f6\u5bf9\u9762\u5411\u5bf9\u8c61\u7f16\u7a0b\u3001\u51fd\u6570\u5f0f\u7f16\u7a0b\u548c\u6570\u636e\u9a71\u52a8\u5f0f\u7f16\u7a0b\u4e5f\u63d0\u4f9b\u4e86\u826f\u597d\u7684\u652f\u6301\u3002\n \u5b83\u4f5c\u4e3a\u4e00\u4e2a\u5f3a\u5927\u3001\u8f7b\u91cf\u7684\u5d4c\u5165\u5f0f\u811a\u672c\u8bed\u8a00\uff0c\u53ef\u4f9b\u4efb\u4f55\u9700\u8981\u7684\u7a0b\u5e8f\u4f7f\u7528\u3002 Lua \u7531 clean C\uff08\u6807\u51c6 C \u548c C++ \u95f4\u5171\u901a\u7684\u5b50\u96c6\uff09 \u5b9e\u73b0\u6210\u4e00\u4e2a\u5e93\u3002\n\n\n\u4f5c\u4e3a\u4e00\u95e8\u6269\u5c55\u5f0f\u8bed\u8a00\uff0cLua \u6ca1\u6709 \"main\" \u7a0b\u5e8f\u7684\u6982\u5ff5\n\uff1a \u5b83\u53ea\u80fd \u5d4c\u5165 \u4e00\u4e2a\u5bbf\u4e3b\u7a0b\u5e8f\u4e2d\u5de5\u4f5c\uff0c \u8be5\u5bbf\u4e3b\u7a0b\u5e8f\u88ab\u79f0\u4e3a \u88ab\u5d4c\u5165\u7a0b\u5e8f \u6216\u8005\u7b80\u79f0 \u5bbf\u4e3b \u3002 \n\u5bbf\u4e3b\u7a0b\u5e8f\u53ef\u4ee5\u8c03\u7528\u51fd\u6570\u6267\u884c\u4e00\u5c0f\u6bb5 Lua \u4ee3\u7801\uff0c\u53ef\u4ee5\u8bfb\u5199 Lua \u53d8\u91cf\uff0c\u53ef\u4ee5\u6ce8\u518c C \u51fd\u6570\u8ba9 Lua \u4ee3\u7801\u8c03\u7528\u3002\n \u4f9d\u9760 C \u51fd\u6570\uff0cLua \u53ef\u4ee5\u5171\u4eab\u76f8\u540c\u7684\u8bed\u6cd5\u6846\u67b6\u6765\u5b9a\u5236\u7f16\u7a0b\u8bed\u8a00\uff0c\u4ece\u800c\u9002\u7528\u4e0d\u540c\u7684\u9886\u57df\u3002 Lua \u7684\u5b98\u65b9\u53d1\u5e03\u7248\u5305\u542b\u4e00\u4e2a\u53eb\u505a lua \u7684\u5bbf\u4e3b\u7a0b\u5e8f\u793a\u4f8b\uff0c \u5b83\u662f\u4e00\u4e2a\u5229\u7528 Lua \u5e93\u5b9e\u73b0\u7684\u5b8c\u6574\u72ec\u7acb\u7684 Lua \u89e3\u91ca\u5668\uff0c\u53ef\u7528\u4e8e\u4ea4\u4e92\u5f0f\u5e94\u7528\u6216\u6279\u5904\u7406\u3002\n\n\nLua \u662f\u4e00\u4e2a\u81ea\u7531\u8f6f\u4ef6\uff0c\u5176\u4f7f\u7528\u8bb8\u53ef\u8bc1\u51b3\u5b9a\u4e86\u5b83\u7684\u4f7f\u7528\u8fc7\u7a0b\u65e0\u9700\u4efb\u4f55\u62c5\u4fdd\u3002 \u672c\u624b\u518c\u6240\u63cf\u8ff0\u7684\u5b9e\u73b0\u53ef\u4ee5\u5728 Lua \u7684\n\u5b98\u65b9\u7f51\u7ad9\n \u627e\u5230\u3002\n\n\n1.1 \u5b89\u88c5lua\n\n\nLua \u4ee5\n\u6e90\u4ee3\u7801\n\u7684\u5f62\u5f0f\u53d1\u5e03\uff0c\u4f7f\u7528\u4e4b\u524d\uff0c\u4f60\u9700\u8981\u6784\u5efa\u5b83\u3002 \u6784\u5efa Lua \u975e\u5e38\u7b80\u5355\uff0c\u56e0\u4e3a Lua \u662f\u7528\u7eaf\u7cb9\u7684 ANSI C \u5b9e\u73b0\u7684\uff0c\u5728\u6240\u6709\u5177\u5907 ANSI C \u7f16\u8bd1\u5668\u7684\u5e73\u53f0\u90fd\u53ef\u4ee5\u76f4\u63a5\u7f16\u8bd1\u3002 \u540c\u65f6\uff0cLua \u4e5f\u53ef\u4ee5\u76f4\u63a5\u4ee5 C++ \u5f62\u5f0f\u7f16\u8bd1\u3002 \u4e0b\u9762\u4ecb\u7ecd\u4e86\u7c7b Unix \u5e73\u53f0\u4e0a\u7684\u6784\u5efa\u6d41\u7a0b\u3002\n\n\n1.1.1 \u6784\u5efa Lua\n\n\n\u5728\u5927\u591a\u6570\u7c7b Unix \u5e73\u53f0\u4e0a\uff0c\u8f93\u5165 \"make\" \u52a0\u4e0a\u5408\u9002\u7684\u5e73\u53f0\u540d\u5373\u53ef\u3002\u6b65\u9aa4\u5982\u4e0b\uff1a\n\n\n1.\u83b7\u53d6lua\u6e90\u7801\n\n\n2.\u8fd0\u884c \"make\" \u5e76\u67e5\u770b\u4f60\u7684\u5e73\u53f0\u662f\u5426\u5217\u5728\u5176\u4e2d\u3002 \u5f53\u524d\u652f\u6301\u7684\u5e73\u53f0\u6709\uff1a \n\n\n\n\naix bsd c89 freebsd generic linux macosx mingw posix solaris\n\n\n\n\n\u5982\u679c\u4f60\u7684\u5e73\u53f0\u5728\u5176\u4e2d\uff0c\u8fd0\u884c \"make xxx\" \u5373\u53ef\uff0cxxx \u4ee3\u8868\u4f60\u7684\u5e73\u53f0\u540d\u3002\u5982\u679c\u4f60\u7684\u5e73\u53f0\u4e0d\u5728\u5176\u4e2d\uff0c\u5148\u5c1d\u8bd5\u6700\u76f8\u8fd1\u7684\u5e73\u53f0\uff0c\u518d\u6309 posix generic c89 \u987a\u5e8f\u4f9d\u6b21\u5c1d\u8bd5\u3002\n\n\n3.\u7f16\u8bd1\u8fc7\u7a0b\u5f88\u77ed\uff0c\u6700\u7ec8\u5728 src \u76ee\u5f55\u4e0b\u751f\u6210\u4e09\u4e2a\u6587\u4ef6\uff1a lua (\u89e3\u91ca\u5668), luac (\u7f16\u8bd1\u5668)\u548c liblua.a (\u9759\u6001\u5e93) \u3002\n\n\n4.\u6784\u5efa\u5b8c\u6210\u540e\uff0c\u53ef\u4ee5\u8fd0\u884c \"make test\" \u6765\u68c0\u67e5\u662f\u5426\u6210\u529f\u3002 \u5b83\u4f1a\u8fd0\u884c\u89e3\u91ca\u5668\u5e76\u6253\u5370\u7248\u672c\u53f7\u3002\n\n\n\u5982\u679c\u4f60\u662f Linux \u7cfb\u7edf\u5e76\u51fa\u73b0\u4e86\u7f16\u8bd1\u9519\u8bef\uff0c\u8bf7\u786e\u8ba4\u4f60\u662f\u5426\u5b89\u88c5\u4e86 readline \uff08\u4e5f\u53ef\u80fd\u53eb libreadline-dev \u6216\u8005 readline-devel\uff09\u5f00\u53d1\u5305\u3002 \u4e4b\u540e\uff0c\u5982\u679c\u8fd8\u6709\u94fe\u63a5\u9519\u8bef\uff0c\u5c1d\u8bd5 \"make linux MYLIBS=-ltermcap\" \u3002\n\n\n1.1.2 \u5b89\u88c5 Lua\n\n\n\u4e00\u65e6\u4f60\u6784\u5efa\u5b8c\u6bd5\uff0c\u53ef\u80fd\u5e0c\u671b\u628a Lua \u5b89\u88c5\u5230\u7cfb\u7edf\u9ed8\u8ba4\u4f4d\u7f6e\uff0c \u90a3\u4e48\u6267\u884c \"make install\" \u5373\u53ef\u3002 \u7cfb\u7edf\u9ed8\u8ba4\u4f4d\u7f6e\u4ee5\u53ca\u5982\u4f55\u5b89\u88c5\u90fd\u5b9a\u4e49\u5728 Makefile \u4e2d\u3002 \u8fd9\u4e2a\u8fc7\u7a0b\u53ef\u80fd\u9700\u8981\u6709\u76f8\u5173\u7684\u6743\u9650\u3002\n\n\n\u8fd0\u884c \"make xxx install\" \u53ef\u4ee5\u6784\u5efa\u548c\u5b89\u88c5\u4e00\u6b65\u5230\u4f4d\uff0cxxx \u6307\u4f60\u7684\u5e73\u53f0\u540d\u3002\n\n\n1.1.3 ubuntu \u5b89\u88c5 Lua5.3.0\n\n\n1.wget http://www.lua.org/ftp/lua-5.3.0.tar.gz  \n2.tar -xvzf lua-5.3.0.tar.gz    \n3.cd lua-5.3.0/ \n4.sudo apt-get install libreadline6 libreadline6-dev    \n5.make linux    \n6.sudo make install \n7.lua -v\n8.lua\n9.print(\"hello lua\")", 
            "title": "01"
        }, 
        {
            "location": "/luamd/01/#lua", 
            "text": "Lua \u662f\u4e00\u95e8\u5f3a\u5927\u3001\u5feb\u901f\u3001\u8f7b\u91cf\u7684 \u5d4c\u5165\u5f0f\u811a\u672c\u8bed\u8a00\u3002 \u5b83\u7531\u5df4\u897f\u91cc\u7ea6\u70ed\u5185\u5362 Pontifical Catholic \u5927\u5b66\u7684 PUC-Rio \u56e2\u961f \u5f00\u53d1\u3002 Lua \u662f\u4e00\u4e2a\u81ea\u7531\u8f6f\u4ef6\uff0c \u5e7f\u6cdb\u5e94\u7528\u4e8e\u4e16\u754c\u4e0a\u65e0\u6570\u4ea7\u54c1\u548c\u9879\u76ee\u3002Lua \u7684 \u5b98\u65b9\u7f51\u7ad9 \u4e0a\u63d0\u4f9b\u4e86\u5173\u4e8e Lua \u7684\u5b8c\u6574\u4fe1\u606f\uff0c \u5305\u62ec \u7efc\u5408\u6982\u8981 \u548c\u6700\u65b0\u7684 \u6587\u6863 \u3002  Lua \u662f\u4e00\u95e8\u6269\u5c55\u5f0f\u7a0b\u5e8f\u8bbe\u8ba1\u8bed\u8a00 \uff0c\u88ab\u8bbe\u8ba1\u6210\u652f\u6301\u901a\u7528\u8fc7\u7a0b\u5f0f\u7f16\u7a0b\uff0c\u5e76\u6709\u76f8\u5173\u6570\u636e\u63cf\u8ff0\u8bbe\u65bd\u3002  \u540c\u65f6\u5bf9\u9762\u5411\u5bf9\u8c61\u7f16\u7a0b\u3001\u51fd\u6570\u5f0f\u7f16\u7a0b\u548c\u6570\u636e\u9a71\u52a8\u5f0f\u7f16\u7a0b\u4e5f\u63d0\u4f9b\u4e86\u826f\u597d\u7684\u652f\u6301\u3002  \u5b83\u4f5c\u4e3a\u4e00\u4e2a\u5f3a\u5927\u3001\u8f7b\u91cf\u7684\u5d4c\u5165\u5f0f\u811a\u672c\u8bed\u8a00\uff0c\u53ef\u4f9b\u4efb\u4f55\u9700\u8981\u7684\u7a0b\u5e8f\u4f7f\u7528\u3002 Lua \u7531 clean C\uff08\u6807\u51c6 C \u548c C++ \u95f4\u5171\u901a\u7684\u5b50\u96c6\uff09 \u5b9e\u73b0\u6210\u4e00\u4e2a\u5e93\u3002  \u4f5c\u4e3a\u4e00\u95e8\u6269\u5c55\u5f0f\u8bed\u8a00\uff0cLua \u6ca1\u6709 \"main\" \u7a0b\u5e8f\u7684\u6982\u5ff5 \uff1a \u5b83\u53ea\u80fd \u5d4c\u5165 \u4e00\u4e2a\u5bbf\u4e3b\u7a0b\u5e8f\u4e2d\u5de5\u4f5c\uff0c \u8be5\u5bbf\u4e3b\u7a0b\u5e8f\u88ab\u79f0\u4e3a \u88ab\u5d4c\u5165\u7a0b\u5e8f \u6216\u8005\u7b80\u79f0 \u5bbf\u4e3b \u3002  \u5bbf\u4e3b\u7a0b\u5e8f\u53ef\u4ee5\u8c03\u7528\u51fd\u6570\u6267\u884c\u4e00\u5c0f\u6bb5 Lua \u4ee3\u7801\uff0c\u53ef\u4ee5\u8bfb\u5199 Lua \u53d8\u91cf\uff0c\u53ef\u4ee5\u6ce8\u518c C \u51fd\u6570\u8ba9 Lua \u4ee3\u7801\u8c03\u7528\u3002  \u4f9d\u9760 C \u51fd\u6570\uff0cLua \u53ef\u4ee5\u5171\u4eab\u76f8\u540c\u7684\u8bed\u6cd5\u6846\u67b6\u6765\u5b9a\u5236\u7f16\u7a0b\u8bed\u8a00\uff0c\u4ece\u800c\u9002\u7528\u4e0d\u540c\u7684\u9886\u57df\u3002 Lua \u7684\u5b98\u65b9\u53d1\u5e03\u7248\u5305\u542b\u4e00\u4e2a\u53eb\u505a lua \u7684\u5bbf\u4e3b\u7a0b\u5e8f\u793a\u4f8b\uff0c \u5b83\u662f\u4e00\u4e2a\u5229\u7528 Lua \u5e93\u5b9e\u73b0\u7684\u5b8c\u6574\u72ec\u7acb\u7684 Lua \u89e3\u91ca\u5668\uff0c\u53ef\u7528\u4e8e\u4ea4\u4e92\u5f0f\u5e94\u7528\u6216\u6279\u5904\u7406\u3002  Lua \u662f\u4e00\u4e2a\u81ea\u7531\u8f6f\u4ef6\uff0c\u5176\u4f7f\u7528\u8bb8\u53ef\u8bc1\u51b3\u5b9a\u4e86\u5b83\u7684\u4f7f\u7528\u8fc7\u7a0b\u65e0\u9700\u4efb\u4f55\u62c5\u4fdd\u3002 \u672c\u624b\u518c\u6240\u63cf\u8ff0\u7684\u5b9e\u73b0\u53ef\u4ee5\u5728 Lua \u7684 \u5b98\u65b9\u7f51\u7ad9  \u627e\u5230\u3002", 
            "title": "\u5173\u4e8e Lua"
        }, 
        {
            "location": "/luamd/01/#11-lua", 
            "text": "Lua \u4ee5 \u6e90\u4ee3\u7801 \u7684\u5f62\u5f0f\u53d1\u5e03\uff0c\u4f7f\u7528\u4e4b\u524d\uff0c\u4f60\u9700\u8981\u6784\u5efa\u5b83\u3002 \u6784\u5efa Lua \u975e\u5e38\u7b80\u5355\uff0c\u56e0\u4e3a Lua \u662f\u7528\u7eaf\u7cb9\u7684 ANSI C \u5b9e\u73b0\u7684\uff0c\u5728\u6240\u6709\u5177\u5907 ANSI C \u7f16\u8bd1\u5668\u7684\u5e73\u53f0\u90fd\u53ef\u4ee5\u76f4\u63a5\u7f16\u8bd1\u3002 \u540c\u65f6\uff0cLua \u4e5f\u53ef\u4ee5\u76f4\u63a5\u4ee5 C++ \u5f62\u5f0f\u7f16\u8bd1\u3002 \u4e0b\u9762\u4ecb\u7ecd\u4e86\u7c7b Unix \u5e73\u53f0\u4e0a\u7684\u6784\u5efa\u6d41\u7a0b\u3002  1.1.1 \u6784\u5efa Lua  \u5728\u5927\u591a\u6570\u7c7b Unix \u5e73\u53f0\u4e0a\uff0c\u8f93\u5165 \"make\" \u52a0\u4e0a\u5408\u9002\u7684\u5e73\u53f0\u540d\u5373\u53ef\u3002\u6b65\u9aa4\u5982\u4e0b\uff1a  1.\u83b7\u53d6lua\u6e90\u7801  2.\u8fd0\u884c \"make\" \u5e76\u67e5\u770b\u4f60\u7684\u5e73\u53f0\u662f\u5426\u5217\u5728\u5176\u4e2d\u3002 \u5f53\u524d\u652f\u6301\u7684\u5e73\u53f0\u6709\uff1a    aix bsd c89 freebsd generic linux macosx mingw posix solaris   \u5982\u679c\u4f60\u7684\u5e73\u53f0\u5728\u5176\u4e2d\uff0c\u8fd0\u884c \"make xxx\" \u5373\u53ef\uff0cxxx \u4ee3\u8868\u4f60\u7684\u5e73\u53f0\u540d\u3002\u5982\u679c\u4f60\u7684\u5e73\u53f0\u4e0d\u5728\u5176\u4e2d\uff0c\u5148\u5c1d\u8bd5\u6700\u76f8\u8fd1\u7684\u5e73\u53f0\uff0c\u518d\u6309 posix generic c89 \u987a\u5e8f\u4f9d\u6b21\u5c1d\u8bd5\u3002  3.\u7f16\u8bd1\u8fc7\u7a0b\u5f88\u77ed\uff0c\u6700\u7ec8\u5728 src \u76ee\u5f55\u4e0b\u751f\u6210\u4e09\u4e2a\u6587\u4ef6\uff1a lua (\u89e3\u91ca\u5668), luac (\u7f16\u8bd1\u5668)\u548c liblua.a (\u9759\u6001\u5e93) \u3002  4.\u6784\u5efa\u5b8c\u6210\u540e\uff0c\u53ef\u4ee5\u8fd0\u884c \"make test\" \u6765\u68c0\u67e5\u662f\u5426\u6210\u529f\u3002 \u5b83\u4f1a\u8fd0\u884c\u89e3\u91ca\u5668\u5e76\u6253\u5370\u7248\u672c\u53f7\u3002  \u5982\u679c\u4f60\u662f Linux \u7cfb\u7edf\u5e76\u51fa\u73b0\u4e86\u7f16\u8bd1\u9519\u8bef\uff0c\u8bf7\u786e\u8ba4\u4f60\u662f\u5426\u5b89\u88c5\u4e86 readline \uff08\u4e5f\u53ef\u80fd\u53eb libreadline-dev \u6216\u8005 readline-devel\uff09\u5f00\u53d1\u5305\u3002 \u4e4b\u540e\uff0c\u5982\u679c\u8fd8\u6709\u94fe\u63a5\u9519\u8bef\uff0c\u5c1d\u8bd5 \"make linux MYLIBS=-ltermcap\" \u3002  1.1.2 \u5b89\u88c5 Lua  \u4e00\u65e6\u4f60\u6784\u5efa\u5b8c\u6bd5\uff0c\u53ef\u80fd\u5e0c\u671b\u628a Lua \u5b89\u88c5\u5230\u7cfb\u7edf\u9ed8\u8ba4\u4f4d\u7f6e\uff0c \u90a3\u4e48\u6267\u884c \"make install\" \u5373\u53ef\u3002 \u7cfb\u7edf\u9ed8\u8ba4\u4f4d\u7f6e\u4ee5\u53ca\u5982\u4f55\u5b89\u88c5\u90fd\u5b9a\u4e49\u5728 Makefile \u4e2d\u3002 \u8fd9\u4e2a\u8fc7\u7a0b\u53ef\u80fd\u9700\u8981\u6709\u76f8\u5173\u7684\u6743\u9650\u3002  \u8fd0\u884c \"make xxx install\" \u53ef\u4ee5\u6784\u5efa\u548c\u5b89\u88c5\u4e00\u6b65\u5230\u4f4d\uff0cxxx \u6307\u4f60\u7684\u5e73\u53f0\u540d\u3002  1.1.3 ubuntu \u5b89\u88c5 Lua5.3.0  1.wget http://www.lua.org/ftp/lua-5.3.0.tar.gz  \n2.tar -xvzf lua-5.3.0.tar.gz    \n3.cd lua-5.3.0/ \n4.sudo apt-get install libreadline6 libreadline6-dev    \n5.make linux    \n6.sudo make install \n7.lua -v\n8.lua\n9.print(\"hello lua\")", 
            "title": "1.1 \u5b89\u88c5lua"
        }, 
        {
            "location": "/luamd/02/", 
            "text": "2.1 lua \u503c\u4e0e\u7c7b\u578b\n\n\nLua \u662f\u4e00\u95e8\u52a8\u6001\u7c7b\u578b\u8bed\u8a00\u3002 \u8fd9\u610f\u5473\u7740\u53d8\u91cf\u6ca1\u6709\u7c7b\u578b\uff1b\u53ea\u6709\u503c\u624d\u6709\u7c7b\u578b\u3002\n \u8bed\u8a00\u4e2d\u4e0d\u8bbe\u7c7b\u578b\u5b9a\u4e49\u3002 \u6240\u6709\u7684\u503c\u643a\u5e26\u81ea\u5df1\u7684\u7c7b\u578b\u3002Lua \u4e2d\u6240\u6709\u7684\u503c\u90fd\u662f \u4e00\u7b49\u516c\u6c11\u3002 \u8fd9\u610f\u5473\u7740\u6240\u6709\u7684\u503c\u5747\u53ef\u4fdd\u5b58\u5728\u53d8\u91cf\u4e2d\u3001 \u5f53\u4f5c\u53c2\u6570\u4f20\u9012\u7ed9\u5176\u5b83\u51fd\u6570\u3001\u4ee5\u53ca\u4f5c\u4e3a\u8fd4\u56de\u503c\u3002\n\n\nLua \u4e2d\u6709\u516b\u79cd\u57fa\u672c\u7c7b\u578b\uff1a nil\u3001boolean\u3001number\u3001string\u3001function\u3001userdata\u3001 thread \u548c table\u3002\n\n\n\n\nNil \u662f\u503c nil \u7684\u7c7b\u578b\n\uff0c \u5176\u4e3b\u8981\u7279\u5f81\u5c31\u662f\u548c\u5176\u5b83\u503c\u533a\u522b\u5f00\uff1b\u901a\u5e38\u7528\u6765\u8868\u793a\u4e00\u4e2a\u6709\u610f\u4e49\u7684\u503c\u4e0d\u5b58\u5728\u65f6\u7684\u72b6\u6001\u3002\n\n\nBoolean \u662f false \u4e0e true \u4e24\u4e2a\u503c\u7684\u7c7b\u578b\u3002 nil \u548c false \u90fd\u4f1a\u5bfc\u81f4\u6761\u4ef6\u5224\u65ad\u4e3a\u5047\uff1b \u800c\u5176\u5b83\u4efb\u4f55\u503c\u90fd\u8868\u793a\u4e3a\u771f\u3002\n\n\nNumber \u4ee3\u8868\u4e86\u6574\u6570\u548c\u5b9e\u6570\uff08\u6d6e\u70b9\u6570\uff09\u3002\nnumber \u7c7b\u578b\u6709\u4e24\u79cd\u5185\u90e8\u8868\u73b0\u65b9\u5f0f\uff0c \u6574\u6570 \u548c \u6d6e\u70b9\u6570\u3002 \u5bf9\u4e8e\u4f55\u65f6\u4f7f\u7528\u54ea\u79cd\u5185\u90e8\u5f62\u5f0f\uff0cLua \u6709\u660e\u786e\u7684\u89c4\u5219\uff0c \u4f46\u5b83\u4e5f\u6309\u9700\u4f5c\u81ea\u52a8\u8f6c\u6362\u3002 \u56e0\u6b64\uff0c\u7a0b\u5e8f\u5458\u591a\u6570\u60c5\u51b5\u4e0b\u53ef\u4ee5\u9009\u62e9\u5ffd\u7565\u6574\u6570\u4e0e\u6d6e\u70b9\u6570\u4e4b\u95f4\u7684\u5dee\u5f02\u6216\u8005\u5047\u8bbe\u5b8c\u5168\u63a7\u5236\u6bcf\u4e2a\u6570\u5b57\u7684\u5185\u90e8\u8868\u73b0\u65b9\u5f0f\u3002 \u6807\u51c6 Lua \u4f7f\u7528 64 \u4f4d\u6574\u6570\u548c\u53cc\u7cbe\u5ea6\uff0864 \u4f4d\uff09\u6d6e\u70b9\u6570\uff0c\n\u4f46\u4f60\u4e5f\u53ef\u4ee5\u628a Lua \u7f16\u8bd1\u6210\u4f7f\u7528 32 \u4f4d\u6574\u6570\u548c\u5355\u7cbe\u5ea6\uff0832 \u4f4d\uff09\u6d6e\u70b9\u6570\u3002 \u4ee5 32 \u4f4d\u8868\u793a\u6570\u5b57\u5bf9\u5c0f\u578b\u673a\u5668\u4ee5\u53ca\u5d4c\u5165\u5f0f\u7cfb\u7edf\u7279\u522b\u5408\u9002\u3002 \uff08\u53c2\u89c1 luaconf.h \u6587\u4ef6\u4e2d\u7684\u5b8f LUA_32BITS \u3002\n\n\nString \u8868\u793a\u4e00\u4e2a\u4e0d\u53ef\u53d8\u7684\u5b57\u8282\u5e8f\u5217\u3002\n Lua \u5bf9 8 \u4f4d\u662f\u53cb\u597d\u7684\uff1a \u5b57\u7b26\u4e32\u53ef\u4ee5\u5bb9\u7eb3\u4efb\u610f 8 \u4f4d\u503c(1\u5b57\u8282)\uff0c \u5176\u4e2d\u5305\u542b\u96f6 ('\\0') \u3002 Lua \u7684\u5b57\u7b26\u4e32\u4e0e\u7f16\u7801\u65e0\u5173\uff1b \u5b83\u4e0d\u5173\u5fc3\u5b57\u7b26\u4e32\u4e2d\u5177\u4f53\u5185\u5bb9\u3002\n\n\nLua \u53ef\u4ee5\u8c03\u7528\uff08\u4ee5\u53ca\u64cd\u4f5c\uff09\u7528 Lua \u6216 C \u7f16\u5199\u7684\u51fd\u6570\u3002 \u8fd9\u4e24\u79cd\u51fd\u6570\u6709\u7edf\u4e00\u7c7b\u578b function\u3002\n\n\nuserdata \u7c7b\u578b\u5141\u8bb8\u5c06 C \u4e2d\u7684\u6570\u636e\u4fdd\u5b58\u5728 Lua \u53d8\u91cf\u4e2d\u3002\n \u7528\u6237\u6570\u636e\u7c7b\u578b\u7684\u503c\u662f\u4e00\u4e2a\u5185\u5b58\u5757\uff0c \u6709\u4e24\u79cd\u7528\u6237\u6570\u636e\uff1a \n\u5b8c\u5168\u7528\u6237\u6570\u636e\n \uff0c\u6307\u4e00\u5757\u7531 Lua \u7ba1\u7406\u7684\u5185\u5b58\u5bf9\u5e94\u7684\u5bf9\u8c61\uff1b \n\u8f7b\u91cf\u7528\u6237\u6570\u636e \uff0c\u5219\u6307\u4e00\u4e2a\u7b80\u5355\u7684 C \u6307\u9488\n\u3002 \u7528\u6237\u6570\u636e\u5728 Lua \u4e2d\u9664\u4e86\u8d4b\u503c\u4e0e\u76f8\u7b49\u6027\u5224\u65ad\u4e4b\u5916\u6ca1\u6709\u5176\u4ed6\u9884\u5b9a\u4e49\u7684\u64cd\u4f5c\u3002 \u901a\u8fc7\u4f7f\u7528 \u5143\u8868 \uff0c\u7a0b\u5e8f\u5458\u53ef\u4ee5\u7ed9\u5b8c\u5168\u7528\u6237\u6570\u636e\u5b9a\u4e49\u4e00\u7cfb\u5217\u7684\u64cd\u4f5c\u3002 \u4f60\u53ea\u80fd\u901a\u8fc7 C API \u800c\u65e0\u6cd5\u5728 Lua \u4ee3\u7801\u4e2d\u521b\u5efa\u6216\u8005\u4fee\u6539\u7528\u6237\u6570\u636e\u7684\u503c\uff0c \u8fd9\u4fdd\u8bc1\u4e86\u6570\u636e\u4ec5\u88ab\u5bbf\u4e3b\u7a0b\u5e8f\u6240\u63a7\u5236\u3002\n\n\nthread \u7c7b\u578b\u8868\u793a\u4e86\u4e00\u4e2a\u72ec\u7acb\u7684\u6267\u884c\u5e8f\u5217\uff0c\u88ab\u7528\u4e8e\u5b9e\u73b0\u534f\u7a0b\u3002\n Lua \u7684\u7ebf\u7a0b\u4e0e\u64cd\u4f5c\u7cfb\u7edf\u7684\u7ebf\u7a0b\u6beb\u65e0\u5173\u7cfb\u3002 Lua \u4e3a\u6240\u6709\u7684\u7cfb\u7edf\uff0c\u5305\u62ec\u90a3\u4e9b\u4e0d\u652f\u6301\u539f\u751f\u7ebf\u7a0b\u7684\u7cfb\u7edf\uff0c\u63d0\u4f9b\u4e86\u534f\u7a0b\u652f\u6301\u3002\n\n\ntable \u662f\u4e00\u4e2a\u5173\u8054\u6570\u7ec4\uff0c\n \u4e5f\u5c31\u662f\u8bf4\uff0c\u8fd9\u4e2a\u6570\u7ec4\u4e0d\u4ec5\u4ec5\u4ee5\u6570\u5b57\u505a\u7d22\u5f15\uff0c\n\u9664\u4e86 nil \u548c NaN \u4e4b\u5916\u7684\u6240\u6709 Lua \u503c \u90fd\u53ef\u4ee5\u505a\u7d22\u5f15\u3002\n\uff08Not a Number \u662f\u4e00\u4e2a\u7279\u6b8a\u7684\u6570\u5b57\uff0c\u5b83\u7528\u4e8e\u8868\u793a\u672a\u5b9a\u4e49\u6216\u8868\u793a\u4e0d\u4e86\u7684\u8fd0\u7b97\u7ed3\u679c\uff0c\u6bd4\u5982 0/0\u3002\uff09 \n\u8868\u53ef\u4ee5\u662f \u5f02\u6784 \u7684\n\uff1b \u4e5f\u5c31\u662f\u8bf4\uff0c\u8868\u5185\u53ef\u4ee5\u5305\u542b\u4efb\u4f55\u7c7b\u578b\u7684\u503c\uff08 nil \u9664\u5916\uff09\u3002 \u4efb\u4f55\u952e\u7684\u503c\u82e5\u4e3a nil \u5c31\u4e0d\u4f1a\u88ab\u8bb0\u5165\u8868\u7ed3\u6784\u5185\u90e8\u3002 \u6362\u8a00\u4e4b\uff0c\u5bf9\u4e8e\u8868\u5185\u4e0d\u5b58\u5728\u7684\u952e\uff0c\u90fd\u5bf9\u5e94\u7740\u503c nil \u3002\n\n\n\n\n\u8868\u662f Lua \u4e2d\u552f\u4e00\u7684\u6570\u636e\u7ed3\u6784\uff0c \u5b83\u53ef\u88ab\u7528\u4e8e\u8868\u793a\u666e\u901a\u6570\u7ec4\u3001\u5e8f\u5217\u3001\u7b26\u53f7\u8868\u3001\u96c6\u5408\u3001\u8bb0\u5f55\u3001\u56fe\u3001\u6811\u7b49\u7b49\u3002\n \u5bf9\u4e8e\u8bb0\u5f55\uff0cLua \u4f7f\u7528\u57df\u540d\u4f5c\u4e3a\u7d22\u5f15\u3002 \u8bed\u8a00\u63d0\u4f9b\u4e86 a.name \u8fd9\u6837\u7684\u8bed\u6cd5\u7cd6\u6765\u66ff\u4ee3 a[\"name\"] \u8fd9\u79cd\u5199\u6cd5\u4ee5\u65b9\u4fbf\u8bb0\u5f55\u8fd9\u79cd\u7ed3\u6784\u7684\u4f7f\u7528\u3002 \u5728 Lua \u4e2d\u6709\u591a\u79cd\u4fbf\u5229\u7684\u65b9\u5f0f\u521b\u5efa\u8868\u3002\u6211\u4eec\u4f7f\u7528 \u5e8f\u5217 \u8fd9\u4e2a\u672f\u8bed\u6765\u8868\u793a\u4e00\u4e2a\u7528 \n{1..n}\n \u7684\u6b63\u6574\u6570\u96c6\u505a\u7d22\u5f15\u7684\u8868\u3002 \u8fd9\u91cc\u7684\u975e\u8d1f\u6574\u6570 n \u88ab\u79f0\u4e3a\u8be5\u5e8f\u5217\u7684\u957f\u5ea6\uff09\u3002\n\n\n\u548c\u7d22\u5f15\u4e00\u6837\uff0c\u8868\u4e2d\u6bcf\u4e2a\u57df\u7684\u503c\u4e5f\u53ef\u4ee5\u662f\u4efb\u4f55\u7c7b\u578b\u3002 \u9700\u8981\u7279\u522b\u6307\u51fa\u7684\u662f\uff1a\u65e2\u7136\u51fd\u6570\u662f\u4e00\u7b49\u516c\u6c11\uff0c\u90a3\u4e48\u8868\u7684\u57df\u4e5f\u53ef\u4ee5\u662f\u51fd\u6570\u3002 \u8fd9\u6837\uff0c\u8868\u5c31\u53ef\u4ee5\u643a\u5e26 \u65b9\u6cd5 \u4e86\u3002\n\n\n\u7d22\u5f15\u4e00\u5f20\u8868\u7684\u539f\u5219\u9075\u5faa\u8bed\u8a00\u4e2d\u7684\u76f4\u63a5\u6bd4\u8f83\u89c4\u5219\u3002 \u5f53\u4e14\u4ec5\u5f53 i \u4e0e j\u76f4\u63a5\u6bd4\u8f83\u76f8\u7b49\u65f6 \uff08\u5373\u4e0d\u901a\u8fc7\u5143\u65b9\u6cd5\u7684\u6bd4\u8f83\uff09\uff0c \u8868\u8fbe\u5f0f a[i] \u4e0e a[j] \u8868\u793a\u4e86\u8868\u4e2d\u76f8\u540c\u7684\u5143\u7d20\u3002 \n\u7279\u522b\u6307\u51fa\uff1a\u4e00\u4e2a\u53ef\u4ee5\u5b8c\u5168\u8868\u793a\u4e3a\u6574\u6570\u7684\u6d6e\u70b9\u6570\u548c\u5bf9\u5e94\u7684\u6574\u6570\u76f8\u7b49 \uff08\u4f8b\u5982\uff1a1.0 == 1\uff09\u3002\n \n\u4e3a\u4e86\u6d88\u9664\u6b67\u4e49\uff0c\u5f53\u4e00\u4e2a\u53ef\u4ee5\u5b8c\u5168\u8868\u793a\u4e3a\u6574\u6570\u7684\u6d6e\u70b9\u6570\u505a\u4e3a\u952e\u503c\u65f6\uff0c \u90fd\u4f1a\u88ab\u8f6c\u6362\u4e3a\u5bf9\u5e94\u7684\u6574\u6570\u50a8\u5b58\u3002 \u4f8b\u5982\uff0c\u5f53\u4f60\u5199 a[2.0] = true \u65f6\uff0c \u5b9e\u9645\u88ab\u63d2\u5165\u8868\u4e2d\u7684\u952e\u662f\u6574\u6570 2 \u3002 \uff08\u53e6\u4e00\u65b9\u9762\uff0c2 \u4e0e \"2\" \u662f\u4e24\u4e2a\u4e0d\u540c\u7684 Lua \u503c\uff0c \u6545\u800c\u5b83\u4eec\u53ef\u4ee5\u662f\u540c\u4e00\u5f20\u8868\u4e2d\u7684\u4e0d\u540c\u9879\u3002\uff09\n\n\n\u8868\u3001\u51fd\u6570\u3001\u7ebf\u7a0b\u3001\u4ee5\u53ca\u5b8c\u5168\u7528\u6237\u6570\u636e\u5728 Lua \u4e2d\u88ab\u79f0\u4e3a\n\u5bf9\u8c61\n\uff1a \u53d8\u91cf\u5e76\u4e0d\u771f\u7684\u6301\u6709\u5b83\u4eec\u7684\u503c\uff0c\u800c\u4ec5\u4fdd\u5b58\u4e86\u5bf9\u8fd9\u4e9b\u5bf9\u8c61\u7684\n\u5f15\u7528\n\u3002 \n\u8d4b\u503c\u3001\u53c2\u6570\u4f20\u9012\u3001\u51fd\u6570\u8fd4\u56de\uff0c\u90fd\u662f\u9488\u5bf9\u5f15\u7528\u800c\u4e0d\u662f\u9488\u5bf9\u503c\u7684\u64cd\u4f5c\uff0c \u8fd9\u4e9b\u64cd\u4f5c\u5747\u4e0d\u4f1a\u505a\u4efb\u4f55\u5f62\u5f0f\u7684\u9690\u5f0f\u62f7\u8d1d\u3002\n\u5e93\u51fd\u6570 type \u7528\u4e8e\u4ee5\u5b57\u7b26\u4e32\u5f62\u5f0f\u8fd4\u56de\u7ed9\u5b9a\u503c\u7684\u7c7b\u578b\u3002\n\n\n\u793a\u4f8b\u4ee3\u78011\uff1a\n\n\nprint(type(nil))                    -- \u8f93\u51fa nil\nprint(type(99.7+12*9))              -- \u8f93\u51fa number\nprint(type(true))                   -- \u8f93\u51fa boolean\nprint(type(\"Hello Wikipedia\"))      -- \u8f93\u51fa string\nprint(type(print))                  -- \u8f93\u51fa function\nprint(type{1, 2, test = \"test\"})    -- \u8f93\u51fa table\n\n\n\n\u793a\u4f8b\u4ee3\u78012\uff1a\n\n\nlocal num -- \u4e3a\u8d4b\u503c\u7684\u5bf9\u8c61\u90fd\u662fnil\nlocal lock = false\n\nif(num) then\n    print(\"num true\")\nelse\n    print(\"num false\")\nend\n\nif(lock) then\n    print(\"lock true\")\nelse\n    print(\"lock false\")\nend\n\n\n\n\u793a\u4f8b\u4ee3\u78013\uff1a\n\n\nlocal tb = {}\ntb[2.0] = \"hello\"\ntb[\"string\"] = 23456\ntb[\"2\"] = \"lua\"\n\nfor k ,v in pairs(tb) do \n    print(k..\" -\n \"..v) -- 2.0\u53d8\u62102\u4fdd\u5b58\u4e86\nend\n\nprint(\"---\")\nprint(tb[\"2\"]) -- \u4fdd\u5b58\u4e86\u4e0d\u540c\u7684\u503c\nprint(tb[2.0])\n\n\n\n\u793a\u4f8b\u4ee3\u78014\uff1a\n\n\nlocal tb = {}\ntable.insert(tb, 23)\ntable.insert(tb, \"hello lua\")\ntable.insert(tb, \"omg\")\n\nfor k ,v in pairs(tb) do \n    print(k..\" -\n \"..v)  \nend\n\n\n\n\u8fd0\u884c\u7ed3\u679c\uff1a\n\n\n1 -\n 23 \n2 -\n hello lua\n3 -\n omg\n\n\n\n\u628atable\u5f53\u505alist\u4f7f\u7528\u65f6\uff0c\u9ed8\u8ba4key\u4e3a1, 2, 3...n \n\n\n\u793a\u4f8b\u4ee3\u78015\uff1a\n\n\nfunction test()\n    print(\"hello lua\")\nend\n\nlocal test1 = test  \ntest1()\n\n\n\n2.2 \u9519\u8bef\u5904\u7406\n\n\n\u7531\u4e8e Lua \u662f\u4e00\u95e8\u5d4c\u5165\u5f0f\u6269\u5c55\u8bed\u8a00\uff0c\u5176\u6240\u6709\u884c\u4e3a\u5747\u6e90\u4e8e\u5bbf\u4e3b\u7a0b\u5e8f\u4e2d C \u4ee3\u7801\u5bf9\u67d0\u4e2a Lua \u5e93\u51fd\u6570\u7684\u8c03\u7528\u3002 \uff08\u5355\u72ec\u4f7f\u7528 Lua \u65f6\uff0clua \u7a0b\u5e8f\u5c31\u662f\u5bbf\u4e3b\u7a0b\u5e8f\u3002\uff09 \u6240\u4ee5\uff0c\n\u5728\u7f16\u8bd1\u6216\u8fd0\u884c Lua \u4ee3\u7801\u5757\u7684\u8fc7\u7a0b\u4e2d\uff0c\u65e0\u8bba\u4f55\u65f6\u53d1\u751f\u9519\u8bef\uff0c \u63a7\u5236\u6743\u90fd\u8fd4\u56de\u7ed9\u5bbf\u4e3b\uff0c\u7531\u5bbf\u4e3b\u8d1f\u8d23\u91c7\u53d6\u6070\u5f53\u7684\u63aa\u65bd\uff08\u6bd4\u5982\u6253\u5370\u9519\u8bef\u6d88\u606f\uff09\u3002\n\n\n\u53ef\u4ee5\u5728 Lua \u4ee3\u7801\u4e2d\u8c03\u7528 \nerror\n \u51fd\u6570\u6765\u663e\u5f0f\u5730\u629b\u51fa\u4e00\u4e2a\u9519\u8bef\u3002 \u5982\u679c\u4f60\u9700\u8981\u5728 Lua \u4e2d\u6355\u83b7\u8fd9\u4e9b\u9519\u8bef\uff0c \u53ef\u4ee5\u4f7f\u7528 \npcall \u6216 xpcall \u5728 \u4fdd\u62a4\u6a21\u5f0f \u4e0b\u8c03\u7528\u4e00\u4e2a\u51fd\u6570\u3002\n\n\n\u65e0\u8bba\u4f55\u65f6\u51fa\u73b0\u9519\u8bef\uff0c\u90fd\u4f1a\u629b\u51fa\u4e00\u4e2a\u643a\u5e26\u9519\u8bef\u4fe1\u606f\u7684\u9519\u8bef\u5bf9\u8c61\uff08\u9519\u8bef\u6d88\u606f\uff09\u3002 Lua \u672c\u8eab\u53ea\u4f1a\u4e3a\u9519\u8bef\u751f\u6210\u5b57\u7b26\u4e32\u7c7b\u578b\u7684\u9519\u8bef\u5bf9\u8c61\uff0c \u4f46\u4f60\u7684\u7a0b\u5e8f\u53ef\u4ee5\u4e3a\u9519\u8bef\u751f\u6210\u4efb\u4f55\u7c7b\u578b\u7684\u9519\u8bef\u5bf9\u8c61\uff0c \u8fd9\u5c31\u770b\u4f60\u7684 Lua \u7a0b\u5e8f\u6216\u5bbf\u4e3b\u7a0b\u5e8f\u5982\u4f55\u5904\u7406\u8fd9\u4e9b\u9519\u8bef\u5bf9\u8c61\u3002\n\n\n\u4f7f\u7528 xpcall \u6216 lua_pcall \u65f6\uff0c \u4f60\u5e94\u8be5\u63d0\u4f9b\u4e00\u4e2a \u6d88\u606f\u5904\u7406\u51fd\u6570 \u7528\u4e8e\u9519\u8bef\u629b\u51fa\u65f6\u8c03\u7528\u3002\n \u8be5\u51fd\u6570\u9700\u63a5\u6536\u539f\u59cb\u7684\u9519\u8bef\u6d88\u606f\uff0c\u5e76\u8fd4\u56de\u4e00\u4e2a\u65b0\u7684\u9519\u8bef\u6d88\u606f\u3002 \u5b83\u5728\u9519\u8bef\u53d1\u751f\u540e\u6808\u5c1a\u672a\u5c55\u5f00\u65f6\u8c03\u7528\uff0c \u56e0\u6b64\u53ef\u4ee5\u5229\u7528\u6808\u6765\u6536\u96c6\u66f4\u591a\u7684\u4fe1\u606f\uff0c \u6bd4\u5982\u901a\u8fc7\u63a2\u77e5\u6808\u6765\u521b\u5efa\u4e00\u7ec4\u6808\u56de\u6eaf\u4fe1\u606f\u3002 \u540c\u65f6\uff0c\u8be5\u5904\u7406\u51fd\u6570\u4e5f\u5904\u4e8e\u4fdd\u62a4\u6a21\u5f0f\u4e0b\uff0c\u6240\u4ee5\u8be5\u51fd\u6570\u5185\u53d1\u751f\u7684\u9519\u8bef\u4f1a\u518d\u6b21\u89e6\u53d1\u5b83\uff08\u9012\u5f52\uff09\u3002 \u5982\u679c\u9012\u5f52\u592a\u6df1\uff0cLua \u4f1a\u7ec8\u6b62\u8c03\u7528\u5e76\u8fd4\u56de\u4e00\u4e2a\u5408\u9002\u7684\u6d88\u606f\u3002\n\n\n\u793a\u4f8b\uff1a\n\n\nerror(\"lua error xxx\")\n\n\n\n\u8fd0\u884c\u7ed3\u679c\uff1a\n\n\nlua: ll.lua:1: lua error xxx\nstack traceback:\n        [C]: in function 'error'\n        ll.lua:1: in main chunk\n        [C]: in ?\n\n\n\n2.3 \u5783\u573e\u6536\u96c6\n\n\nLua \u91c7\u7528\u4e86\u81ea\u52a8\u5185\u5b58\u7ba1\u7406\u3002 \u8fd9\u610f\u5473\u7740\u4f60\u4e0d\u7528\u64cd\u5fc3\u65b0\u521b\u5efa\u7684\u5bf9\u8c61\u9700\u8981\u7684\u5185\u5b58\u5982\u4f55\u5206\u914d\u51fa\u6765\uff0c \u4e5f\u4e0d\u7528\u8003\u8651\u5728\u5bf9\u8c61\u4e0d\u518d\u88ab\u4f7f\u7528\u540e\u600e\u6837\u91ca\u653e\u5b83\u4eec\u6240\u5360\u7528\u7684\u5185\u5b58\u3002 Lua \u8fd0\u884c\u4e86\u4e00\u4e2a \n\u5783\u573e\u6536\u96c6\u5668\n \u6765\u6536\u96c6\u6240\u6709 \u6b7b\u5bf9\u8c61 \uff08\u5373\u5728 Lua \u4e2d\u4e0d\u53ef\u80fd\u518d\u8bbf\u95ee\u5230\u7684\u5bf9\u8c61\uff09\u6765\u5b8c\u6210\u81ea\u52a8\u5185\u5b58\u7ba1\u7406\u7684\u5de5\u4f5c\u3002 Lua \u4e2d\u6240\u6709\u7528\u5230\u7684\u5185\u5b58\uff0c\u5982\uff1a\u5b57\u7b26\u4e32\u3001\u8868\u3001\u7528\u6237\u6570\u636e\u3001\u51fd\u6570\u3001\u7ebf\u7a0b\u3001 \u5185\u90e8\u7ed3\u6784\u7b49\uff0c\u90fd\u670d\u4ece\u81ea\u52a8\u7ba1\u7406\u3002\n\n\n2.4 \u5143\u8868\u53ca\u5143\u65b9\u6cd5\n\n\nLua \u4e2d\u7684\u6bcf\u4e2a\u503c\u90fd\u53ef\u4ee5\u6709\u4e00\u4e2a \u5143\u8868\u3002\u8fd9\u4e2a \u5143\u8868 \u5c31\u662f\u4e00\u4e2a\u666e\u901a\u7684 Lua \u8868\uff0c\u5b83\u7528\u4e8e\u5b9a\u4e49\u539f\u59cb\u503c\u5728\u7279\u5b9a\u64cd\u4f5c\u4e0b\u7684\u884c\u4e3a\u3002 \u5982\u679c\u4f60\u60f3\u6539\u53d8\u4e00\u4e2a\u503c\u5728\u7279\u5b9a\u64cd\u4f5c\u4e0b\u7684\u884c\u4e3a\uff0c\u4f60\u53ef\u4ee5\u5728\u5b83\u7684\u5143\u8868\u4e2d\u8bbe\u7f6e\u5bf9\u5e94\u57df\u3002 \u4f8b\u5982\uff0c\u5f53\u4f60\u5bf9\u975e\u6570\u5b57\u503c\u505a\u52a0\u64cd\u4f5c\u65f6\uff0c Lua \u4f1a\u68c0\u67e5\u8be5\u503c\u7684\u5143\u8868\u4e2d\u7684 \"__add\" \u57df\u4e0b\u7684\u51fd\u6570\u3002 \u5982\u679c\u80fd\u627e\u5230\uff0cLua \u5219\u8c03\u7528\u8fd9\u4e2a\u51fd\u6570\u6765\u5b8c\u6210\u52a0\u8fd9\u4e2a\u64cd\u4f5c\u3002\n\n\n\u5143\u8868\u4e2d\u7684\u952e\u5bf9\u5e94\u7740\u4e0d\u540c\u7684 \u4e8b\u4ef6 \u540d\uff1b \u952e\u5173\u8054\u7684\u90a3\u4e9b\u503c\u88ab\u79f0\u4e3a \n\u5143\u65b9\u6cd5\n\u3002 \u5728\u4e0a\u9762\u90a3\u4e2a\u4f8b\u5b50\u4e2d\u5f15\u7528\u7684\u4e8b\u4ef6\u4e3a \"add\" \uff0c \u5b8c\u6210\u52a0\u64cd\u4f5c\u7684\u90a3\u4e2a\u51fd\u6570\u5c31\u662f\u5143\u65b9\u6cd5\u3002\n\n\n\u4f60\u53ef\u4ee5\u7528 \ngetmetatable\n \u51fd\u6570 \u6765\u83b7\u53d6\u4efb\u4f55\u503c\u7684\u5143\u8868\u3002\n\n\n\u4f7f\u7528 setmetatable \u6765\u66ff\u6362\u4e00\u5f20\u8868\u7684\u5143\u8868\u3002\n \u5728 Lua \u4e2d\uff0c\u4f60\u4e0d\u53ef\u4ee5\u6539\u53d8\u8868\u4ee5\u5916\u5176\u5b83\u7c7b\u578b\u7684\u503c\u7684\u5143\u8868 \uff08\u9664\u975e\u4f60\u4f7f\u7528\u8c03\u8bd5\u5e93\uff09\uff1b \u82e5\u60f3\u6539\u53d8\u8fd9\u4e9b\u975e\u8868\u7c7b\u578b\u7684\u503c\u7684\u5143\u8868\uff0c\u8bf7\u4f7f\u7528 C API\u3002\n\n\n\u8868\u548c\u5b8c\u5168\u7528\u6237\u6570\u636e\u6709\u72ec\u7acb\u7684\u5143\u8868 \uff08\u5f53\u7136\uff0c\u591a\u4e2a\u8868\u548c\u7528\u6237\u6570\u636e\u53ef\u4ee5\u5171\u4eab\u540c\u4e00\u4e2a\u5143\u8868\uff09\u3002 \u5176\u5b83\u7c7b\u578b\u7684\u503c\u6309\u7c7b\u578b\u5171\u4eab\u5143\u8868\uff1b \u4e5f\u5c31\u662f\u8bf4\u6240\u6709\u7684\u6570\u5b57\u90fd\u5171\u4eab\u540c\u4e00\u4e2a\u5143\u8868\uff0c \u6240\u6709\u7684\u5b57\u7b26\u4e32\u5171\u4eab\u53e6\u4e00\u4e2a\u5143\u8868\u7b49\u7b49\u3002 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u503c\u662f\u6ca1\u6709\u5143\u8868\u7684\uff0c \u4f46\n\u5b57\u7b26\u4e32\u5e93\u5728\u521d\u59cb\u5316\u7684\u65f6\u5019\u4e3a\u5b57\u7b26\u4e32\u7c7b\u578b\u8bbe\u7f6e\u4e86\u5143\u8868\u3002\n\n\n\u5143\u8868\u51b3\u5b9a\u4e86\u4e00\u4e2a\u5bf9\u8c61\u5728\u6570\u5b66\u8fd0\u7b97\u3001\u4f4d\u8fd0\u7b97\u3001\u6bd4\u8f83\u3001\u8fde\u63a5\u3001 \u53d6\u957f\u5ea6\u3001\u8c03\u7528\u3001\u7d22\u5f15\u65f6\u7684\u884c\u4e3a\u3002 \u5143\u8868\u8fd8\u53ef\u4ee5\u5b9a\u4e49\u4e00\u4e2a\u51fd\u6570\uff0c\u5f53\u8868\u5bf9\u8c61\u6216\u7528\u6237\u6570\u636e\u5bf9\u8c61\u5728\u5783\u573e\u56de\u6536\u65f6\u8c03\u7528\u5b83\u3002\n\n\n\u63a5\u4e0b\u6765\u4f1a\u7ed9\u51fa\u4e00\u5f20\u5143\u8868\u53ef\u4ee5\u63a7\u5236\u7684\u4e8b\u4ef6\u7684\u5b8c\u6574\u5217\u8868\u3002 \u6bcf\u4e2a\u64cd\u4f5c\u90fd\u7528\u5bf9\u5e94\u7684\u4e8b\u4ef6\u540d\u6765\u533a\u5206\u3002 \u6bcf\u4e2a\u4e8b\u4ef6\u7684\u952e\u540d\u7528\u52a0\u6709 \n  \u524d\u7f00\u7684\u5b57\u7b26\u4e32\u6765\u8868\u793a\uff1b \u4f8b\u5982 \"add\" \u64cd\u4f5c\u7684\u952e\u540d\u4e3a\u5b57\u7b26\u4e32 \"\nadd\"\u3002 \u6ce8\u610f\u3001Lua \u4ece\u5143\u8868\u4e2d\u76f4\u63a5\u83b7\u53d6\u5143\u65b9\u6cd5\uff1b \n\u8bbf\u95ee\u5143\u8868\u4e2d\u7684\u5143\u65b9\u6cd5\u6c38\u8fdc\u4e0d\u4f1a\u89e6\u53d1\u53e6\u4e00\u6b21\u5143\u65b9\u6cd5\u3002\n \u4e0b\u9762\u7684\u4ee3\u7801\u6a21\u62df\u4e86 Lua \u4ece\u4e00\u4e2a\u5bf9\u8c61 obj \u4e2d\u83b7\u53d6\u4e00\u4e2a\u5143\u65b9\u6cd5\u7684\u8fc7\u7a0b\uff1a\n\n\n rawget(getmetatable(obj) or {}, \"__\" .. event_name)\n\n\n\n\u5bf9\u4e8e\u4e00\u5143\u64cd\u4f5c\u7b26\uff08\u53d6\u8d1f\u3001\u6c42\u957f\u5ea6\u3001\u4f4d\u53cd\uff09\uff0c \u5143\u65b9\u6cd5\u8c03\u7528\u7684\u65f6\u5019\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u662f\u4e2a\u54d1\u5143\uff0c\u5176\u503c\u7b49\u4e8e\u7b2c\u4e00\u4e2a\u53c2\u6570\u3002 \u8fd9\u6837\u5904\u7406\u4ec5\u4ec5\u662f\u4e3a\u4e86\u7b80\u5316 Lua \u7684\u5185\u90e8\u5b9e\u73b0 \uff08\u8fd9\u6837\u5904\u7406\u53ef\u4ee5\u8ba9\u6240\u6709\u7684\u64cd\u4f5c\u90fd\u548c\u4e8c\u5143\u64cd\u4f5c\u4e00\u81f4\uff09\uff0c \u8fd9\u4e2a\u884c\u4e3a\u6709\u53ef\u80fd\u5728\u5c06\u6765\u7684\u7248\u672c\u4e2d\u79fb\u9664\u3002 \uff08\u4f7f\u7528\u8fd9\u4e2a\u989d\u5916\u53c2\u6570\u7684\u884c\u4e3a\u90fd\u662f\u4e0d\u786e\u5b9a\u7684\u3002\uff09\n\n\n\"add\": + \u64cd\u4f5c\u3002 \u5982\u679c\u4efb\u4f55\u4e0d\u662f\u6570\u5b57\u7684\u503c\uff08\u5305\u62ec\u4e0d\u80fd\u8f6c\u6362\u4e3a\u6570\u5b57\u7684\u5b57\u7b26\u4e32\uff09\u505a\u52a0\u6cd5\uff0c Lua \u5c31\u4f1a\u5c1d\u8bd5\u8c03\u7528\u5143\u65b9\u6cd5\u3002 \u9996\u5148\u3001Lua \u68c0\u67e5\u7b2c\u4e00\u4e2a\u64cd\u4f5c\u6570\uff08\u5373\u4f7f\u5b83\u662f\u5408\u6cd5\u7684\uff09\uff0c \u5982\u679c\u8fd9\u4e2a\u64cd\u4f5c\u6570\u6ca1\u6709\u4e3a __add \u4e8b\u4ef6\u5b9a\u4e49\u5143\u65b9\u6cd5\uff0c Lua \u5c31\u4f1a\u63a5\u7740\u68c0\u67e5\u7b2c\u4e8c\u4e2a\u64cd\u4f5c\u6570\u3002 \u4e00\u65e6 Lua \u627e\u5230\u4e86\u5143\u65b9\u6cd5\uff0c \u5b83\u5c06\u628a\u4e24\u4e2a\u64cd\u4f5c\u6570\u4f5c\u4e3a\u53c2\u6570\u4f20\u5165\u5143\u65b9\u6cd5\uff0c \u5143\u65b9\u6cd5\u7684\u7ed3\u679c\uff08\u8c03\u6574\u4e3a\u5355\u4e2a\u503c\uff09\u4f5c\u4e3a\u8fd9\u4e2a\u64cd\u4f5c\u7684\u7ed3\u679c\u3002 \u5982\u679c\u627e\u4e0d\u5230\u5143\u65b9\u6cd5\uff0c\u5c06\u629b\u51fa\u4e00\u4e2a\u9519\u8bef\u3002\n\n\n\n\n\"sub\": - \u64cd\u4f5c\u3002 \u884c\u4e3a\u548c \"add\" \u64cd\u4f5c\u7c7b\u4f3c\u3002\n\n\n\"mul\": * \u64cd\u4f5c\u3002 \u884c\u4e3a\u548c \"add\" \u64cd\u4f5c\u7c7b\u4f3c\u3002\n\n\n\"div\": / \u64cd\u4f5c\u3002 \u884c\u4e3a\u548c \"add\" \u64cd\u4f5c\u7c7b\u4f3c\u3002\n\n\n\"mod\": % \u64cd\u4f5c\u3002 \u884c\u4e3a\u548c \"add\" \u64cd\u4f5c\u7c7b\u4f3c\u3002\n\n\n\"pow\": ^ \uff08\u6b21\u65b9\uff09\u64cd\u4f5c\u3002 \u884c\u4e3a\u548c \"add\" \u64cd\u4f5c\u7c7b\u4f3c\u3002\n\n\n\"unm\": - \uff08\u53d6\u8d1f\uff09\u64cd\u4f5c\u3002 \u884c\u4e3a\u548c \"add\" \u64cd\u4f5c\u7c7b\u4f3c\u3002\n\n\n\"idiv\": // \uff08\u5411\u4e0b\u53d6\u6574\u9664\u6cd5\uff09\u64cd\u4f5c\u3002 \u884c\u4e3a\u548c \"add\" \u64cd\u4f5c\u7c7b\u4f3c\u3002\n\n\n\"band\": \n \uff08\u6309\u4f4d\u4e0e\uff09\u64cd\u4f5c\u3002 \u884c\u4e3a\u548c \"add\" \u64cd\u4f5c\u7c7b\u4f3c\uff0c \u4e0d\u540c\u7684\u662f Lua \u4f1a\u5728\u4efb\u4f55\u4e00\u4e2a\u64cd\u4f5c\u6570\u65e0\u6cd5\u8f6c\u6362\u4e3a\u6574\u6570\u65f6 \uff08\u53c2\u89c1 \u00a73.4.3\uff09\u5c1d\u8bd5\u53d6\u5143\u65b9\u6cd5\u3002\n\n\n\"bor\": | \uff08\u6309\u4f4d\u6216\uff09\u64cd\u4f5c\u3002 \u884c\u4e3a\u548c \"band\" \u64cd\u4f5c\u7c7b\u4f3c\u3002\n\n\n\"bxor\": ~ \uff08\u6309\u4f4d\u5f02\u6216\uff09\u64cd\u4f5c\u3002 \u884c\u4e3a\u548c \"band\" \u64cd\u4f5c\u7c7b\u4f3c\u3002\n\n\n\"bnot\": ~ \uff08\u6309\u4f4d\u975e\uff09\u64cd\u4f5c\u3002 \u884c\u4e3a\u548c \"band\" \u64cd\u4f5c\u7c7b\u4f3c\u3002\n\n\n\"shl\": \n \uff08\u5de6\u79fb\uff09\u64cd\u4f5c\u3002 \u884c\u4e3a\u548c \"band\" \u64cd\u4f5c\u7c7b\u4f3c\u3002\n\n\n\"shr\": \n \uff08\u53f3\u79fb\uff09\u64cd\u4f5c\u3002 \u884c\u4e3a\u548c \"band\" \u64cd\u4f5c\u7c7b\u4f3c\u3002\n\n\n\"concat\": .. \uff08\u8fde\u63a5\uff09\u64cd\u4f5c\u3002 \u884c\u4e3a\u548c \"add\" \u64cd\u4f5c\u7c7b\u4f3c\uff0c \u4e0d\u540c\u7684\u662f Lua \u5728\u4efb\u4f55\u64cd\u4f5c\u6570\u5373\u4e0d\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32 \u4e5f\u4e0d\u662f\u6570\u5b57\uff08\u6570\u5b57\u603b\u80fd\u8f6c\u6362\u4e3a\u5bf9\u5e94\u7684\u5b57\u7b26\u4e32\uff09\u7684\u60c5\u51b5\u4e0b\u5c1d\u8bd5\u5143\u65b9\u6cd5\u3002\n\n\n\"len\": # \uff08\u53d6\u957f\u5ea6\uff09\u64cd\u4f5c\u3002 \u5982\u679c\u5bf9\u8c61\u4e0d\u662f\u5b57\u7b26\u4e32\uff0cLua \u4f1a\u5c1d\u8bd5\u5b83\u7684\u5143\u65b9\u6cd5\u3002 \u5982\u679c\u6709\u5143\u65b9\u6cd5\uff0c\u5219\u8c03\u7528\u5b83\u5e76\u5c06\u5bf9\u8c61\u4ee5\u53c2\u6570\u5f62\u5f0f\u4f20\u5165\uff0c \u800c\u8fd4\u56de\u503c\uff08\u88ab\u8c03\u6574\u4e3a\u5355\u4e2a\uff09\u5219\u4f5c\u4e3a\u7ed3\u679c\u3002 \u5982\u679c\u5bf9\u8c61\u662f\u4e00\u5f20\u8868\u4e14\u6ca1\u6709\u5143\u65b9\u6cd5\uff0c Lua \u4f7f\u7528\u8868\u7684\u53d6\u957f\u5ea6\u64cd\u4f5c\uff08\u53c2\u89c1 \u00a73.4.7\uff09\u3002 \u5176\u5b83\u60c5\u51b5\uff0c\u5747\u629b\u51fa\u9519\u8bef\u3002\n\n\n\"eq\": == \uff08\u7b49\u4e8e\uff09\u64cd\u4f5c\u3002 \u548c \"add\" \u64cd\u4f5c\u884c\u4e3a\u7c7b\u4f3c\uff0c \u4e0d\u540c\u7684\u662f Lua \u4ec5\u5728\u4e24\u4e2a\u503c\u90fd\u662f\u8868\u6216\u90fd\u662f\u5b8c\u5168\u7528\u6237\u6570\u636e \u4e14\u5b83\u4eec\u4e0d\u662f\u540c\u4e00\u4e2a\u5bf9\u8c61\u65f6\u624d\u5c1d\u8bd5\u5143\u65b9\u6cd5\u3002 \u8c03\u7528\u7684\u7ed3\u679c\u603b\u4f1a\u88ab\u8f6c\u6362\u4e3a\u5e03\u5c14\u91cf\u3002\n\n\n\"lt\": \n \uff08\u5c0f\u4e8e\uff09\u64cd\u4f5c\u3002 \u548c \"add\" \u64cd\u4f5c\u884c\u4e3a\u7c7b\u4f3c\uff0c \u4e0d\u540c\u7684\u662f Lua \u4ec5\u5728\u4e24\u4e2a\u503c\u4e0d\u5168\u4e3a\u6574\u6570\u4e5f\u4e0d\u5168\u4e3a\u5b57\u7b26\u4e32\u65f6\u624d\u5c1d\u8bd5\u5143\u65b9\u6cd5\u3002 \u8c03\u7528\u7684\u7ed3\u679c\u603b\u4f1a\u88ab\u8f6c\u6362\u4e3a\u5e03\u5c14\u91cf\u3002\n\n\n\"le\": \n= \uff08\u5c0f\u4e8e\u7b49\u4e8e\uff09\u64cd\u4f5c\u3002 \u548c\u5176\u5b83\u64cd\u4f5c\u4e0d\u540c\uff0c \u5c0f\u4e8e\u7b49\u4e8e\u64cd\u4f5c\u53ef\u80fd\u7528\u5230\u4e24\u4e2a\u4e0d\u540c\u7684\u4e8b\u4ef6\u3002 \u9996\u5148\uff0c\u50cf - \"lt\" \u64cd\u4f5c\u7684\u884c\u4e3a\u90a3\u6837\uff0cLua \u5728\u4e24\u4e2a\u64cd\u4f5c\u6570\u4e2d\u67e5\u627e \nle \u5143\u65b9\u6cd5\u3002 \u5982\u679c\u4e00\u4e2a\u5143\u65b9\u6cd5\u90fd\u627e\u4e0d\u5230\uff0c\u5c31\u4f1a\u518d\u6b21\u67e5\u627e \nlt\u4e8b\u4ef6\uff0c \u5b83\u4f1a\u5047\u8bbe a \n= b \u7b49\u4ef7\u4e8e not (b \n a)\u3002 \u800c\u5176\u5b83\u6bd4\u8f83\u64cd\u4f5c\u7b26\u7c7b\u4f3c\uff0c\u5176\u7ed3\u679c\u4f1a\u88ab\u8f6c\u6362\u4e3a\u5e03\u5c14\u91cf\u3002\n\n\n\n\n\"index\": \u7d22\u5f15 table[key]\u3002 \u5f53 table \u4e0d\u662f\u8868\u6216\u662f\u8868 table \u4e2d\u4e0d\u5b58\u5728 key \u8fd9\u4e2a\u952e\u65f6\uff0c\u8fd9\u4e2a\u4e8b\u4ef6\u88ab\u89e6\u53d1\u3002 \u6b64\u65f6\uff0c\u4f1a\u8bfb\u51fa table \u76f8\u5e94\u7684\u5143\u65b9\u6cd5\u3002\n\u5c3d\u7ba1\u540d\u5b57\u53d6\u6210\u8fd9\u6837\uff0c \u8fd9\u4e2a\u4e8b\u4ef6\u7684\u5143\u65b9\u6cd5\u5176\u5b9e\u53ef\u4ee5\u662f\u4e00\u4e2a\u51fd\u6570\u4e5f\u53ef\u4ee5\u662f\u4e00\u5f20\u8868\u3002 \u5982\u679c\u5b83\u662f\u4e00\u4e2a\u51fd\u6570\uff0c\u5219\u4ee5 table \u548c key \u4f5c\u4e3a\u53c2\u6570\u8c03\u7528\u5b83\u3002 \u5982\u679c\u5b83\u662f\u4e00\u5f20\u8868\uff0c\u6700\u7ec8\u7684\u7ed3\u679c\u5c31\u662f\u4ee5 key \u53d6\u7d22\u5f15\u8fd9\u5f20\u8868\u7684\u7ed3\u679c\u3002 \uff08\u8fd9\u4e2a\u7d22\u5f15\u8fc7\u7a0b\u662f\u8d70\u5e38\u89c4\u7684\u6d41\u7a0b\uff0c\u800c\u4e0d\u662f\u76f4\u63a5\u7d22\u5f15\uff0c \u6240\u4ee5\u8fd9\u6b21\u7d22\u5f15\u6709\u53ef\u80fd\u5f15\u53d1\u53e6\u4e00\u6b21\u5143\u65b9\u6cd5\u3002\uff09\n\n\n\n\n\n\n\"newindex\": \u7d22\u5f15\u8d4b\u503c table[key] = value \u3002 \u548c\u7d22\u5f15\u4e8b\u4ef6\u7c7b\u4f3c\uff0c\u5b83\u53d1\u751f\u5728 table \u4e0d\u662f\u8868\u6216\u662f\u8868 table \u4e2d\u4e0d\u5b58\u5728 key \u8fd9\u4e2a\u952e\u7684\u65f6\u5019\u3002 \u6b64\u65f6\uff0c\u4f1a\u8bfb\u51fa table \u76f8\u5e94\u7684\u5143\u65b9\u6cd5\u3002\n\u540c\u7d22\u5f15\u8fc7\u7a0b\u90a3\u6837\uff0c \u8fd9\u4e2a\u4e8b\u4ef6\u7684\u5143\u65b9\u6cd5\u5373\u53ef\u4ee5\u662f\u51fd\u6570\uff0c\u4e5f\u53ef\u4ee5\u662f\u4e00\u5f20\u8868\u3002 \u5982\u679c\u662f\u4e00\u4e2a\u51fd\u6570\uff0c \u5219\u4ee5 table\u3001 key\u3001\u4ee5\u53ca value \u4e3a\u53c2\u6570\u4f20\u5165\u3002 \u5982\u679c\u662f\u4e00\u5f20\u8868\uff0c Lua \u5bf9\u8fd9\u5f20\u8868\u505a\u7d22\u5f15\u8d4b\u503c\u64cd\u4f5c\u3002 \uff08\u8fd9\u4e2a\u7d22\u5f15\u8fc7\u7a0b\u662f\u8d70\u5e38\u89c4\u7684\u6d41\u7a0b\uff0c\u800c\u4e0d\u662f\u76f4\u63a5\u7d22\u5f15\u8d4b\u503c\uff0c \u6240\u4ee5\u8fd9\u6b21\u7d22\u5f15\u8d4b\u503c\u6709\u53ef\u80fd\u5f15\u53d1\u53e6\u4e00\u6b21\u5143\u65b9\u6cd5\u3002\uff09\n\n\n\n\n\n\n\u4e00\u65e6\u6709\u4e86 \"newindex\" \u5143\u65b9\u6cd5\uff0c Lua \u5c31\u4e0d\u518d\u505a\u6700\u521d\u7684\u8d4b\u503c\u64cd\u4f5c\u3002 \uff08\u5982\u679c\u6709\u5fc5\u8981\uff0c\u5728\u5143\u65b9\u6cd5\u5185\u90e8\u53ef\u4ee5\u8c03\u7528 rawset \u6765\u505a\u8d4b\u503c\u3002\uff09\n\n\n\n\n\"call\": \u51fd\u6570\u8c03\u7528\u64cd\u4f5c func(args)\u3002 \u5f53 Lua \u5c1d\u8bd5\u8c03\u7528\u4e00\u4e2a\u975e\u51fd\u6570\u7684\u503c\u7684\u65f6\u5019\u4f1a\u89e6\u53d1\u8fd9\u4e2a\u4e8b\u4ef6 \uff08\u5373 func \u4e0d\u662f\u4e00\u4e2a\u51fd\u6570\uff09\u3002 \u67e5\u627e func \u7684\u5143\u65b9\u6cd5\uff0c \u5982\u679c\u627e\u5f97\u5230\uff0c\u5c31\u8c03\u7528\u8fd9\u4e2a\u5143\u65b9\u6cd5\uff0c func \u4f5c\u4e3a\u7b2c\u4e00\u4e2a\u53c2\u6570\u4f20\u5165\uff0c\u539f\u6765\u8c03\u7528\u7684\u53c2\u6570\uff08args\uff09\u540e\u4f9d\u6b21\u6392\u5728\u540e\u9762\u3002\n\n\n\n\n\u793a\u4f8b\u7a0b\u5e8f\uff1a\n\n\nlocal mt = {}\n\nfunction mt.__add(t1, t2)\n    for k, v in pairs(t2) do\n        table.insert(t1, v)\n    end\n    return t1\nend\n\nlocal t1 = {1, 3}\nlocal t2 = {5, 7}\n\nsetmetatable(t1, mt)\n\nlocal tsum = t1 + t2\nfor k, v in pairs(tsum) do\n    print(v)\nend\n\n\n\n\u8fd0\u884c\u7ed3\u679c\uff1a\n\n\n1\n3\n5\n7", 
            "title": "02"
        }, 
        {
            "location": "/luamd/02/#21-lua", 
            "text": "Lua \u662f\u4e00\u95e8\u52a8\u6001\u7c7b\u578b\u8bed\u8a00\u3002 \u8fd9\u610f\u5473\u7740\u53d8\u91cf\u6ca1\u6709\u7c7b\u578b\uff1b\u53ea\u6709\u503c\u624d\u6709\u7c7b\u578b\u3002  \u8bed\u8a00\u4e2d\u4e0d\u8bbe\u7c7b\u578b\u5b9a\u4e49\u3002 \u6240\u6709\u7684\u503c\u643a\u5e26\u81ea\u5df1\u7684\u7c7b\u578b\u3002Lua \u4e2d\u6240\u6709\u7684\u503c\u90fd\u662f \u4e00\u7b49\u516c\u6c11\u3002 \u8fd9\u610f\u5473\u7740\u6240\u6709\u7684\u503c\u5747\u53ef\u4fdd\u5b58\u5728\u53d8\u91cf\u4e2d\u3001 \u5f53\u4f5c\u53c2\u6570\u4f20\u9012\u7ed9\u5176\u5b83\u51fd\u6570\u3001\u4ee5\u53ca\u4f5c\u4e3a\u8fd4\u56de\u503c\u3002  Lua \u4e2d\u6709\u516b\u79cd\u57fa\u672c\u7c7b\u578b\uff1a nil\u3001boolean\u3001number\u3001string\u3001function\u3001userdata\u3001 thread \u548c table\u3002   Nil \u662f\u503c nil \u7684\u7c7b\u578b \uff0c \u5176\u4e3b\u8981\u7279\u5f81\u5c31\u662f\u548c\u5176\u5b83\u503c\u533a\u522b\u5f00\uff1b\u901a\u5e38\u7528\u6765\u8868\u793a\u4e00\u4e2a\u6709\u610f\u4e49\u7684\u503c\u4e0d\u5b58\u5728\u65f6\u7684\u72b6\u6001\u3002  Boolean \u662f false \u4e0e true \u4e24\u4e2a\u503c\u7684\u7c7b\u578b\u3002 nil \u548c false \u90fd\u4f1a\u5bfc\u81f4\u6761\u4ef6\u5224\u65ad\u4e3a\u5047\uff1b \u800c\u5176\u5b83\u4efb\u4f55\u503c\u90fd\u8868\u793a\u4e3a\u771f\u3002  Number \u4ee3\u8868\u4e86\u6574\u6570\u548c\u5b9e\u6570\uff08\u6d6e\u70b9\u6570\uff09\u3002 number \u7c7b\u578b\u6709\u4e24\u79cd\u5185\u90e8\u8868\u73b0\u65b9\u5f0f\uff0c \u6574\u6570 \u548c \u6d6e\u70b9\u6570\u3002 \u5bf9\u4e8e\u4f55\u65f6\u4f7f\u7528\u54ea\u79cd\u5185\u90e8\u5f62\u5f0f\uff0cLua \u6709\u660e\u786e\u7684\u89c4\u5219\uff0c \u4f46\u5b83\u4e5f\u6309\u9700\u4f5c\u81ea\u52a8\u8f6c\u6362\u3002 \u56e0\u6b64\uff0c\u7a0b\u5e8f\u5458\u591a\u6570\u60c5\u51b5\u4e0b\u53ef\u4ee5\u9009\u62e9\u5ffd\u7565\u6574\u6570\u4e0e\u6d6e\u70b9\u6570\u4e4b\u95f4\u7684\u5dee\u5f02\u6216\u8005\u5047\u8bbe\u5b8c\u5168\u63a7\u5236\u6bcf\u4e2a\u6570\u5b57\u7684\u5185\u90e8\u8868\u73b0\u65b9\u5f0f\u3002 \u6807\u51c6 Lua \u4f7f\u7528 64 \u4f4d\u6574\u6570\u548c\u53cc\u7cbe\u5ea6\uff0864 \u4f4d\uff09\u6d6e\u70b9\u6570\uff0c \u4f46\u4f60\u4e5f\u53ef\u4ee5\u628a Lua \u7f16\u8bd1\u6210\u4f7f\u7528 32 \u4f4d\u6574\u6570\u548c\u5355\u7cbe\u5ea6\uff0832 \u4f4d\uff09\u6d6e\u70b9\u6570\u3002 \u4ee5 32 \u4f4d\u8868\u793a\u6570\u5b57\u5bf9\u5c0f\u578b\u673a\u5668\u4ee5\u53ca\u5d4c\u5165\u5f0f\u7cfb\u7edf\u7279\u522b\u5408\u9002\u3002 \uff08\u53c2\u89c1 luaconf.h \u6587\u4ef6\u4e2d\u7684\u5b8f LUA_32BITS \u3002  String \u8868\u793a\u4e00\u4e2a\u4e0d\u53ef\u53d8\u7684\u5b57\u8282\u5e8f\u5217\u3002  Lua \u5bf9 8 \u4f4d\u662f\u53cb\u597d\u7684\uff1a \u5b57\u7b26\u4e32\u53ef\u4ee5\u5bb9\u7eb3\u4efb\u610f 8 \u4f4d\u503c(1\u5b57\u8282)\uff0c \u5176\u4e2d\u5305\u542b\u96f6 ('\\0') \u3002 Lua \u7684\u5b57\u7b26\u4e32\u4e0e\u7f16\u7801\u65e0\u5173\uff1b \u5b83\u4e0d\u5173\u5fc3\u5b57\u7b26\u4e32\u4e2d\u5177\u4f53\u5185\u5bb9\u3002  Lua \u53ef\u4ee5\u8c03\u7528\uff08\u4ee5\u53ca\u64cd\u4f5c\uff09\u7528 Lua \u6216 C \u7f16\u5199\u7684\u51fd\u6570\u3002 \u8fd9\u4e24\u79cd\u51fd\u6570\u6709\u7edf\u4e00\u7c7b\u578b function\u3002  userdata \u7c7b\u578b\u5141\u8bb8\u5c06 C \u4e2d\u7684\u6570\u636e\u4fdd\u5b58\u5728 Lua \u53d8\u91cf\u4e2d\u3002  \u7528\u6237\u6570\u636e\u7c7b\u578b\u7684\u503c\u662f\u4e00\u4e2a\u5185\u5b58\u5757\uff0c \u6709\u4e24\u79cd\u7528\u6237\u6570\u636e\uff1a  \u5b8c\u5168\u7528\u6237\u6570\u636e  \uff0c\u6307\u4e00\u5757\u7531 Lua \u7ba1\u7406\u7684\u5185\u5b58\u5bf9\u5e94\u7684\u5bf9\u8c61\uff1b  \u8f7b\u91cf\u7528\u6237\u6570\u636e \uff0c\u5219\u6307\u4e00\u4e2a\u7b80\u5355\u7684 C \u6307\u9488 \u3002 \u7528\u6237\u6570\u636e\u5728 Lua \u4e2d\u9664\u4e86\u8d4b\u503c\u4e0e\u76f8\u7b49\u6027\u5224\u65ad\u4e4b\u5916\u6ca1\u6709\u5176\u4ed6\u9884\u5b9a\u4e49\u7684\u64cd\u4f5c\u3002 \u901a\u8fc7\u4f7f\u7528 \u5143\u8868 \uff0c\u7a0b\u5e8f\u5458\u53ef\u4ee5\u7ed9\u5b8c\u5168\u7528\u6237\u6570\u636e\u5b9a\u4e49\u4e00\u7cfb\u5217\u7684\u64cd\u4f5c\u3002 \u4f60\u53ea\u80fd\u901a\u8fc7 C API \u800c\u65e0\u6cd5\u5728 Lua \u4ee3\u7801\u4e2d\u521b\u5efa\u6216\u8005\u4fee\u6539\u7528\u6237\u6570\u636e\u7684\u503c\uff0c \u8fd9\u4fdd\u8bc1\u4e86\u6570\u636e\u4ec5\u88ab\u5bbf\u4e3b\u7a0b\u5e8f\u6240\u63a7\u5236\u3002  thread \u7c7b\u578b\u8868\u793a\u4e86\u4e00\u4e2a\u72ec\u7acb\u7684\u6267\u884c\u5e8f\u5217\uff0c\u88ab\u7528\u4e8e\u5b9e\u73b0\u534f\u7a0b\u3002  Lua \u7684\u7ebf\u7a0b\u4e0e\u64cd\u4f5c\u7cfb\u7edf\u7684\u7ebf\u7a0b\u6beb\u65e0\u5173\u7cfb\u3002 Lua \u4e3a\u6240\u6709\u7684\u7cfb\u7edf\uff0c\u5305\u62ec\u90a3\u4e9b\u4e0d\u652f\u6301\u539f\u751f\u7ebf\u7a0b\u7684\u7cfb\u7edf\uff0c\u63d0\u4f9b\u4e86\u534f\u7a0b\u652f\u6301\u3002  table \u662f\u4e00\u4e2a\u5173\u8054\u6570\u7ec4\uff0c  \u4e5f\u5c31\u662f\u8bf4\uff0c\u8fd9\u4e2a\u6570\u7ec4\u4e0d\u4ec5\u4ec5\u4ee5\u6570\u5b57\u505a\u7d22\u5f15\uff0c \u9664\u4e86 nil \u548c NaN \u4e4b\u5916\u7684\u6240\u6709 Lua \u503c \u90fd\u53ef\u4ee5\u505a\u7d22\u5f15\u3002 \uff08Not a Number \u662f\u4e00\u4e2a\u7279\u6b8a\u7684\u6570\u5b57\uff0c\u5b83\u7528\u4e8e\u8868\u793a\u672a\u5b9a\u4e49\u6216\u8868\u793a\u4e0d\u4e86\u7684\u8fd0\u7b97\u7ed3\u679c\uff0c\u6bd4\u5982 0/0\u3002\uff09  \u8868\u53ef\u4ee5\u662f \u5f02\u6784 \u7684 \uff1b \u4e5f\u5c31\u662f\u8bf4\uff0c\u8868\u5185\u53ef\u4ee5\u5305\u542b\u4efb\u4f55\u7c7b\u578b\u7684\u503c\uff08 nil \u9664\u5916\uff09\u3002 \u4efb\u4f55\u952e\u7684\u503c\u82e5\u4e3a nil \u5c31\u4e0d\u4f1a\u88ab\u8bb0\u5165\u8868\u7ed3\u6784\u5185\u90e8\u3002 \u6362\u8a00\u4e4b\uff0c\u5bf9\u4e8e\u8868\u5185\u4e0d\u5b58\u5728\u7684\u952e\uff0c\u90fd\u5bf9\u5e94\u7740\u503c nil \u3002   \u8868\u662f Lua \u4e2d\u552f\u4e00\u7684\u6570\u636e\u7ed3\u6784\uff0c \u5b83\u53ef\u88ab\u7528\u4e8e\u8868\u793a\u666e\u901a\u6570\u7ec4\u3001\u5e8f\u5217\u3001\u7b26\u53f7\u8868\u3001\u96c6\u5408\u3001\u8bb0\u5f55\u3001\u56fe\u3001\u6811\u7b49\u7b49\u3002  \u5bf9\u4e8e\u8bb0\u5f55\uff0cLua \u4f7f\u7528\u57df\u540d\u4f5c\u4e3a\u7d22\u5f15\u3002 \u8bed\u8a00\u63d0\u4f9b\u4e86 a.name \u8fd9\u6837\u7684\u8bed\u6cd5\u7cd6\u6765\u66ff\u4ee3 a[\"name\"] \u8fd9\u79cd\u5199\u6cd5\u4ee5\u65b9\u4fbf\u8bb0\u5f55\u8fd9\u79cd\u7ed3\u6784\u7684\u4f7f\u7528\u3002 \u5728 Lua \u4e2d\u6709\u591a\u79cd\u4fbf\u5229\u7684\u65b9\u5f0f\u521b\u5efa\u8868\u3002\u6211\u4eec\u4f7f\u7528 \u5e8f\u5217 \u8fd9\u4e2a\u672f\u8bed\u6765\u8868\u793a\u4e00\u4e2a\u7528  {1..n}  \u7684\u6b63\u6574\u6570\u96c6\u505a\u7d22\u5f15\u7684\u8868\u3002 \u8fd9\u91cc\u7684\u975e\u8d1f\u6574\u6570 n \u88ab\u79f0\u4e3a\u8be5\u5e8f\u5217\u7684\u957f\u5ea6\uff09\u3002  \u548c\u7d22\u5f15\u4e00\u6837\uff0c\u8868\u4e2d\u6bcf\u4e2a\u57df\u7684\u503c\u4e5f\u53ef\u4ee5\u662f\u4efb\u4f55\u7c7b\u578b\u3002 \u9700\u8981\u7279\u522b\u6307\u51fa\u7684\u662f\uff1a\u65e2\u7136\u51fd\u6570\u662f\u4e00\u7b49\u516c\u6c11\uff0c\u90a3\u4e48\u8868\u7684\u57df\u4e5f\u53ef\u4ee5\u662f\u51fd\u6570\u3002 \u8fd9\u6837\uff0c\u8868\u5c31\u53ef\u4ee5\u643a\u5e26 \u65b9\u6cd5 \u4e86\u3002  \u7d22\u5f15\u4e00\u5f20\u8868\u7684\u539f\u5219\u9075\u5faa\u8bed\u8a00\u4e2d\u7684\u76f4\u63a5\u6bd4\u8f83\u89c4\u5219\u3002 \u5f53\u4e14\u4ec5\u5f53 i \u4e0e j\u76f4\u63a5\u6bd4\u8f83\u76f8\u7b49\u65f6 \uff08\u5373\u4e0d\u901a\u8fc7\u5143\u65b9\u6cd5\u7684\u6bd4\u8f83\uff09\uff0c \u8868\u8fbe\u5f0f a[i] \u4e0e a[j] \u8868\u793a\u4e86\u8868\u4e2d\u76f8\u540c\u7684\u5143\u7d20\u3002  \u7279\u522b\u6307\u51fa\uff1a\u4e00\u4e2a\u53ef\u4ee5\u5b8c\u5168\u8868\u793a\u4e3a\u6574\u6570\u7684\u6d6e\u70b9\u6570\u548c\u5bf9\u5e94\u7684\u6574\u6570\u76f8\u7b49 \uff08\u4f8b\u5982\uff1a1.0 == 1\uff09\u3002   \u4e3a\u4e86\u6d88\u9664\u6b67\u4e49\uff0c\u5f53\u4e00\u4e2a\u53ef\u4ee5\u5b8c\u5168\u8868\u793a\u4e3a\u6574\u6570\u7684\u6d6e\u70b9\u6570\u505a\u4e3a\u952e\u503c\u65f6\uff0c \u90fd\u4f1a\u88ab\u8f6c\u6362\u4e3a\u5bf9\u5e94\u7684\u6574\u6570\u50a8\u5b58\u3002 \u4f8b\u5982\uff0c\u5f53\u4f60\u5199 a[2.0] = true \u65f6\uff0c \u5b9e\u9645\u88ab\u63d2\u5165\u8868\u4e2d\u7684\u952e\u662f\u6574\u6570 2 \u3002 \uff08\u53e6\u4e00\u65b9\u9762\uff0c2 \u4e0e \"2\" \u662f\u4e24\u4e2a\u4e0d\u540c\u7684 Lua \u503c\uff0c \u6545\u800c\u5b83\u4eec\u53ef\u4ee5\u662f\u540c\u4e00\u5f20\u8868\u4e2d\u7684\u4e0d\u540c\u9879\u3002\uff09  \u8868\u3001\u51fd\u6570\u3001\u7ebf\u7a0b\u3001\u4ee5\u53ca\u5b8c\u5168\u7528\u6237\u6570\u636e\u5728 Lua \u4e2d\u88ab\u79f0\u4e3a \u5bf9\u8c61 \uff1a \u53d8\u91cf\u5e76\u4e0d\u771f\u7684\u6301\u6709\u5b83\u4eec\u7684\u503c\uff0c\u800c\u4ec5\u4fdd\u5b58\u4e86\u5bf9\u8fd9\u4e9b\u5bf9\u8c61\u7684 \u5f15\u7528 \u3002  \u8d4b\u503c\u3001\u53c2\u6570\u4f20\u9012\u3001\u51fd\u6570\u8fd4\u56de\uff0c\u90fd\u662f\u9488\u5bf9\u5f15\u7528\u800c\u4e0d\u662f\u9488\u5bf9\u503c\u7684\u64cd\u4f5c\uff0c \u8fd9\u4e9b\u64cd\u4f5c\u5747\u4e0d\u4f1a\u505a\u4efb\u4f55\u5f62\u5f0f\u7684\u9690\u5f0f\u62f7\u8d1d\u3002 \u5e93\u51fd\u6570 type \u7528\u4e8e\u4ee5\u5b57\u7b26\u4e32\u5f62\u5f0f\u8fd4\u56de\u7ed9\u5b9a\u503c\u7684\u7c7b\u578b\u3002  \u793a\u4f8b\u4ee3\u78011\uff1a  print(type(nil))                    -- \u8f93\u51fa nil\nprint(type(99.7+12*9))              -- \u8f93\u51fa number\nprint(type(true))                   -- \u8f93\u51fa boolean\nprint(type(\"Hello Wikipedia\"))      -- \u8f93\u51fa string\nprint(type(print))                  -- \u8f93\u51fa function\nprint(type{1, 2, test = \"test\"})    -- \u8f93\u51fa table  \u793a\u4f8b\u4ee3\u78012\uff1a  local num -- \u4e3a\u8d4b\u503c\u7684\u5bf9\u8c61\u90fd\u662fnil\nlocal lock = false\n\nif(num) then\n    print(\"num true\")\nelse\n    print(\"num false\")\nend\n\nif(lock) then\n    print(\"lock true\")\nelse\n    print(\"lock false\")\nend  \u793a\u4f8b\u4ee3\u78013\uff1a  local tb = {}\ntb[2.0] = \"hello\"\ntb[\"string\"] = 23456\ntb[\"2\"] = \"lua\"\n\nfor k ,v in pairs(tb) do \n    print(k..\" -  \"..v) -- 2.0\u53d8\u62102\u4fdd\u5b58\u4e86\nend\n\nprint(\"---\")\nprint(tb[\"2\"]) -- \u4fdd\u5b58\u4e86\u4e0d\u540c\u7684\u503c\nprint(tb[2.0])  \u793a\u4f8b\u4ee3\u78014\uff1a  local tb = {}\ntable.insert(tb, 23)\ntable.insert(tb, \"hello lua\")\ntable.insert(tb, \"omg\")\n\nfor k ,v in pairs(tb) do \n    print(k..\" -  \"..v)  \nend  \u8fd0\u884c\u7ed3\u679c\uff1a  1 -  23 \n2 -  hello lua\n3 -  omg  \u628atable\u5f53\u505alist\u4f7f\u7528\u65f6\uff0c\u9ed8\u8ba4key\u4e3a1, 2, 3...n   \u793a\u4f8b\u4ee3\u78015\uff1a  function test()\n    print(\"hello lua\")\nend\n\nlocal test1 = test  \ntest1()", 
            "title": "2.1 lua \u503c\u4e0e\u7c7b\u578b"
        }, 
        {
            "location": "/luamd/02/#22", 
            "text": "\u7531\u4e8e Lua \u662f\u4e00\u95e8\u5d4c\u5165\u5f0f\u6269\u5c55\u8bed\u8a00\uff0c\u5176\u6240\u6709\u884c\u4e3a\u5747\u6e90\u4e8e\u5bbf\u4e3b\u7a0b\u5e8f\u4e2d C \u4ee3\u7801\u5bf9\u67d0\u4e2a Lua \u5e93\u51fd\u6570\u7684\u8c03\u7528\u3002 \uff08\u5355\u72ec\u4f7f\u7528 Lua \u65f6\uff0clua \u7a0b\u5e8f\u5c31\u662f\u5bbf\u4e3b\u7a0b\u5e8f\u3002\uff09 \u6240\u4ee5\uff0c \u5728\u7f16\u8bd1\u6216\u8fd0\u884c Lua \u4ee3\u7801\u5757\u7684\u8fc7\u7a0b\u4e2d\uff0c\u65e0\u8bba\u4f55\u65f6\u53d1\u751f\u9519\u8bef\uff0c \u63a7\u5236\u6743\u90fd\u8fd4\u56de\u7ed9\u5bbf\u4e3b\uff0c\u7531\u5bbf\u4e3b\u8d1f\u8d23\u91c7\u53d6\u6070\u5f53\u7684\u63aa\u65bd\uff08\u6bd4\u5982\u6253\u5370\u9519\u8bef\u6d88\u606f\uff09\u3002  \u53ef\u4ee5\u5728 Lua \u4ee3\u7801\u4e2d\u8c03\u7528  error  \u51fd\u6570\u6765\u663e\u5f0f\u5730\u629b\u51fa\u4e00\u4e2a\u9519\u8bef\u3002 \u5982\u679c\u4f60\u9700\u8981\u5728 Lua \u4e2d\u6355\u83b7\u8fd9\u4e9b\u9519\u8bef\uff0c \u53ef\u4ee5\u4f7f\u7528  pcall \u6216 xpcall \u5728 \u4fdd\u62a4\u6a21\u5f0f \u4e0b\u8c03\u7528\u4e00\u4e2a\u51fd\u6570\u3002  \u65e0\u8bba\u4f55\u65f6\u51fa\u73b0\u9519\u8bef\uff0c\u90fd\u4f1a\u629b\u51fa\u4e00\u4e2a\u643a\u5e26\u9519\u8bef\u4fe1\u606f\u7684\u9519\u8bef\u5bf9\u8c61\uff08\u9519\u8bef\u6d88\u606f\uff09\u3002 Lua \u672c\u8eab\u53ea\u4f1a\u4e3a\u9519\u8bef\u751f\u6210\u5b57\u7b26\u4e32\u7c7b\u578b\u7684\u9519\u8bef\u5bf9\u8c61\uff0c \u4f46\u4f60\u7684\u7a0b\u5e8f\u53ef\u4ee5\u4e3a\u9519\u8bef\u751f\u6210\u4efb\u4f55\u7c7b\u578b\u7684\u9519\u8bef\u5bf9\u8c61\uff0c \u8fd9\u5c31\u770b\u4f60\u7684 Lua \u7a0b\u5e8f\u6216\u5bbf\u4e3b\u7a0b\u5e8f\u5982\u4f55\u5904\u7406\u8fd9\u4e9b\u9519\u8bef\u5bf9\u8c61\u3002  \u4f7f\u7528 xpcall \u6216 lua_pcall \u65f6\uff0c \u4f60\u5e94\u8be5\u63d0\u4f9b\u4e00\u4e2a \u6d88\u606f\u5904\u7406\u51fd\u6570 \u7528\u4e8e\u9519\u8bef\u629b\u51fa\u65f6\u8c03\u7528\u3002  \u8be5\u51fd\u6570\u9700\u63a5\u6536\u539f\u59cb\u7684\u9519\u8bef\u6d88\u606f\uff0c\u5e76\u8fd4\u56de\u4e00\u4e2a\u65b0\u7684\u9519\u8bef\u6d88\u606f\u3002 \u5b83\u5728\u9519\u8bef\u53d1\u751f\u540e\u6808\u5c1a\u672a\u5c55\u5f00\u65f6\u8c03\u7528\uff0c \u56e0\u6b64\u53ef\u4ee5\u5229\u7528\u6808\u6765\u6536\u96c6\u66f4\u591a\u7684\u4fe1\u606f\uff0c \u6bd4\u5982\u901a\u8fc7\u63a2\u77e5\u6808\u6765\u521b\u5efa\u4e00\u7ec4\u6808\u56de\u6eaf\u4fe1\u606f\u3002 \u540c\u65f6\uff0c\u8be5\u5904\u7406\u51fd\u6570\u4e5f\u5904\u4e8e\u4fdd\u62a4\u6a21\u5f0f\u4e0b\uff0c\u6240\u4ee5\u8be5\u51fd\u6570\u5185\u53d1\u751f\u7684\u9519\u8bef\u4f1a\u518d\u6b21\u89e6\u53d1\u5b83\uff08\u9012\u5f52\uff09\u3002 \u5982\u679c\u9012\u5f52\u592a\u6df1\uff0cLua \u4f1a\u7ec8\u6b62\u8c03\u7528\u5e76\u8fd4\u56de\u4e00\u4e2a\u5408\u9002\u7684\u6d88\u606f\u3002  \u793a\u4f8b\uff1a  error(\"lua error xxx\")  \u8fd0\u884c\u7ed3\u679c\uff1a  lua: ll.lua:1: lua error xxx\nstack traceback:\n        [C]: in function 'error'\n        ll.lua:1: in main chunk\n        [C]: in ?", 
            "title": "2.2 \u9519\u8bef\u5904\u7406"
        }, 
        {
            "location": "/luamd/02/#23", 
            "text": "Lua \u91c7\u7528\u4e86\u81ea\u52a8\u5185\u5b58\u7ba1\u7406\u3002 \u8fd9\u610f\u5473\u7740\u4f60\u4e0d\u7528\u64cd\u5fc3\u65b0\u521b\u5efa\u7684\u5bf9\u8c61\u9700\u8981\u7684\u5185\u5b58\u5982\u4f55\u5206\u914d\u51fa\u6765\uff0c \u4e5f\u4e0d\u7528\u8003\u8651\u5728\u5bf9\u8c61\u4e0d\u518d\u88ab\u4f7f\u7528\u540e\u600e\u6837\u91ca\u653e\u5b83\u4eec\u6240\u5360\u7528\u7684\u5185\u5b58\u3002 Lua \u8fd0\u884c\u4e86\u4e00\u4e2a  \u5783\u573e\u6536\u96c6\u5668  \u6765\u6536\u96c6\u6240\u6709 \u6b7b\u5bf9\u8c61 \uff08\u5373\u5728 Lua \u4e2d\u4e0d\u53ef\u80fd\u518d\u8bbf\u95ee\u5230\u7684\u5bf9\u8c61\uff09\u6765\u5b8c\u6210\u81ea\u52a8\u5185\u5b58\u7ba1\u7406\u7684\u5de5\u4f5c\u3002 Lua \u4e2d\u6240\u6709\u7528\u5230\u7684\u5185\u5b58\uff0c\u5982\uff1a\u5b57\u7b26\u4e32\u3001\u8868\u3001\u7528\u6237\u6570\u636e\u3001\u51fd\u6570\u3001\u7ebf\u7a0b\u3001 \u5185\u90e8\u7ed3\u6784\u7b49\uff0c\u90fd\u670d\u4ece\u81ea\u52a8\u7ba1\u7406\u3002", 
            "title": "2.3 \u5783\u573e\u6536\u96c6"
        }, 
        {
            "location": "/luamd/02/#24", 
            "text": "Lua \u4e2d\u7684\u6bcf\u4e2a\u503c\u90fd\u53ef\u4ee5\u6709\u4e00\u4e2a \u5143\u8868\u3002\u8fd9\u4e2a \u5143\u8868 \u5c31\u662f\u4e00\u4e2a\u666e\u901a\u7684 Lua \u8868\uff0c\u5b83\u7528\u4e8e\u5b9a\u4e49\u539f\u59cb\u503c\u5728\u7279\u5b9a\u64cd\u4f5c\u4e0b\u7684\u884c\u4e3a\u3002 \u5982\u679c\u4f60\u60f3\u6539\u53d8\u4e00\u4e2a\u503c\u5728\u7279\u5b9a\u64cd\u4f5c\u4e0b\u7684\u884c\u4e3a\uff0c\u4f60\u53ef\u4ee5\u5728\u5b83\u7684\u5143\u8868\u4e2d\u8bbe\u7f6e\u5bf9\u5e94\u57df\u3002 \u4f8b\u5982\uff0c\u5f53\u4f60\u5bf9\u975e\u6570\u5b57\u503c\u505a\u52a0\u64cd\u4f5c\u65f6\uff0c Lua \u4f1a\u68c0\u67e5\u8be5\u503c\u7684\u5143\u8868\u4e2d\u7684 \"__add\" \u57df\u4e0b\u7684\u51fd\u6570\u3002 \u5982\u679c\u80fd\u627e\u5230\uff0cLua \u5219\u8c03\u7528\u8fd9\u4e2a\u51fd\u6570\u6765\u5b8c\u6210\u52a0\u8fd9\u4e2a\u64cd\u4f5c\u3002  \u5143\u8868\u4e2d\u7684\u952e\u5bf9\u5e94\u7740\u4e0d\u540c\u7684 \u4e8b\u4ef6 \u540d\uff1b \u952e\u5173\u8054\u7684\u90a3\u4e9b\u503c\u88ab\u79f0\u4e3a  \u5143\u65b9\u6cd5 \u3002 \u5728\u4e0a\u9762\u90a3\u4e2a\u4f8b\u5b50\u4e2d\u5f15\u7528\u7684\u4e8b\u4ef6\u4e3a \"add\" \uff0c \u5b8c\u6210\u52a0\u64cd\u4f5c\u7684\u90a3\u4e2a\u51fd\u6570\u5c31\u662f\u5143\u65b9\u6cd5\u3002  \u4f60\u53ef\u4ee5\u7528  getmetatable  \u51fd\u6570 \u6765\u83b7\u53d6\u4efb\u4f55\u503c\u7684\u5143\u8868\u3002  \u4f7f\u7528 setmetatable \u6765\u66ff\u6362\u4e00\u5f20\u8868\u7684\u5143\u8868\u3002  \u5728 Lua \u4e2d\uff0c\u4f60\u4e0d\u53ef\u4ee5\u6539\u53d8\u8868\u4ee5\u5916\u5176\u5b83\u7c7b\u578b\u7684\u503c\u7684\u5143\u8868 \uff08\u9664\u975e\u4f60\u4f7f\u7528\u8c03\u8bd5\u5e93\uff09\uff1b \u82e5\u60f3\u6539\u53d8\u8fd9\u4e9b\u975e\u8868\u7c7b\u578b\u7684\u503c\u7684\u5143\u8868\uff0c\u8bf7\u4f7f\u7528 C API\u3002  \u8868\u548c\u5b8c\u5168\u7528\u6237\u6570\u636e\u6709\u72ec\u7acb\u7684\u5143\u8868 \uff08\u5f53\u7136\uff0c\u591a\u4e2a\u8868\u548c\u7528\u6237\u6570\u636e\u53ef\u4ee5\u5171\u4eab\u540c\u4e00\u4e2a\u5143\u8868\uff09\u3002 \u5176\u5b83\u7c7b\u578b\u7684\u503c\u6309\u7c7b\u578b\u5171\u4eab\u5143\u8868\uff1b \u4e5f\u5c31\u662f\u8bf4\u6240\u6709\u7684\u6570\u5b57\u90fd\u5171\u4eab\u540c\u4e00\u4e2a\u5143\u8868\uff0c \u6240\u6709\u7684\u5b57\u7b26\u4e32\u5171\u4eab\u53e6\u4e00\u4e2a\u5143\u8868\u7b49\u7b49\u3002 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u503c\u662f\u6ca1\u6709\u5143\u8868\u7684\uff0c \u4f46 \u5b57\u7b26\u4e32\u5e93\u5728\u521d\u59cb\u5316\u7684\u65f6\u5019\u4e3a\u5b57\u7b26\u4e32\u7c7b\u578b\u8bbe\u7f6e\u4e86\u5143\u8868\u3002  \u5143\u8868\u51b3\u5b9a\u4e86\u4e00\u4e2a\u5bf9\u8c61\u5728\u6570\u5b66\u8fd0\u7b97\u3001\u4f4d\u8fd0\u7b97\u3001\u6bd4\u8f83\u3001\u8fde\u63a5\u3001 \u53d6\u957f\u5ea6\u3001\u8c03\u7528\u3001\u7d22\u5f15\u65f6\u7684\u884c\u4e3a\u3002 \u5143\u8868\u8fd8\u53ef\u4ee5\u5b9a\u4e49\u4e00\u4e2a\u51fd\u6570\uff0c\u5f53\u8868\u5bf9\u8c61\u6216\u7528\u6237\u6570\u636e\u5bf9\u8c61\u5728\u5783\u573e\u56de\u6536\u65f6\u8c03\u7528\u5b83\u3002  \u63a5\u4e0b\u6765\u4f1a\u7ed9\u51fa\u4e00\u5f20\u5143\u8868\u53ef\u4ee5\u63a7\u5236\u7684\u4e8b\u4ef6\u7684\u5b8c\u6574\u5217\u8868\u3002 \u6bcf\u4e2a\u64cd\u4f5c\u90fd\u7528\u5bf9\u5e94\u7684\u4e8b\u4ef6\u540d\u6765\u533a\u5206\u3002 \u6bcf\u4e2a\u4e8b\u4ef6\u7684\u952e\u540d\u7528\u52a0\u6709    \u524d\u7f00\u7684\u5b57\u7b26\u4e32\u6765\u8868\u793a\uff1b \u4f8b\u5982 \"add\" \u64cd\u4f5c\u7684\u952e\u540d\u4e3a\u5b57\u7b26\u4e32 \" add\"\u3002 \u6ce8\u610f\u3001Lua \u4ece\u5143\u8868\u4e2d\u76f4\u63a5\u83b7\u53d6\u5143\u65b9\u6cd5\uff1b  \u8bbf\u95ee\u5143\u8868\u4e2d\u7684\u5143\u65b9\u6cd5\u6c38\u8fdc\u4e0d\u4f1a\u89e6\u53d1\u53e6\u4e00\u6b21\u5143\u65b9\u6cd5\u3002  \u4e0b\u9762\u7684\u4ee3\u7801\u6a21\u62df\u4e86 Lua \u4ece\u4e00\u4e2a\u5bf9\u8c61 obj \u4e2d\u83b7\u53d6\u4e00\u4e2a\u5143\u65b9\u6cd5\u7684\u8fc7\u7a0b\uff1a   rawget(getmetatable(obj) or {}, \"__\" .. event_name)  \u5bf9\u4e8e\u4e00\u5143\u64cd\u4f5c\u7b26\uff08\u53d6\u8d1f\u3001\u6c42\u957f\u5ea6\u3001\u4f4d\u53cd\uff09\uff0c \u5143\u65b9\u6cd5\u8c03\u7528\u7684\u65f6\u5019\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u662f\u4e2a\u54d1\u5143\uff0c\u5176\u503c\u7b49\u4e8e\u7b2c\u4e00\u4e2a\u53c2\u6570\u3002 \u8fd9\u6837\u5904\u7406\u4ec5\u4ec5\u662f\u4e3a\u4e86\u7b80\u5316 Lua \u7684\u5185\u90e8\u5b9e\u73b0 \uff08\u8fd9\u6837\u5904\u7406\u53ef\u4ee5\u8ba9\u6240\u6709\u7684\u64cd\u4f5c\u90fd\u548c\u4e8c\u5143\u64cd\u4f5c\u4e00\u81f4\uff09\uff0c \u8fd9\u4e2a\u884c\u4e3a\u6709\u53ef\u80fd\u5728\u5c06\u6765\u7684\u7248\u672c\u4e2d\u79fb\u9664\u3002 \uff08\u4f7f\u7528\u8fd9\u4e2a\u989d\u5916\u53c2\u6570\u7684\u884c\u4e3a\u90fd\u662f\u4e0d\u786e\u5b9a\u7684\u3002\uff09  \"add\": + \u64cd\u4f5c\u3002 \u5982\u679c\u4efb\u4f55\u4e0d\u662f\u6570\u5b57\u7684\u503c\uff08\u5305\u62ec\u4e0d\u80fd\u8f6c\u6362\u4e3a\u6570\u5b57\u7684\u5b57\u7b26\u4e32\uff09\u505a\u52a0\u6cd5\uff0c Lua \u5c31\u4f1a\u5c1d\u8bd5\u8c03\u7528\u5143\u65b9\u6cd5\u3002 \u9996\u5148\u3001Lua \u68c0\u67e5\u7b2c\u4e00\u4e2a\u64cd\u4f5c\u6570\uff08\u5373\u4f7f\u5b83\u662f\u5408\u6cd5\u7684\uff09\uff0c \u5982\u679c\u8fd9\u4e2a\u64cd\u4f5c\u6570\u6ca1\u6709\u4e3a __add \u4e8b\u4ef6\u5b9a\u4e49\u5143\u65b9\u6cd5\uff0c Lua \u5c31\u4f1a\u63a5\u7740\u68c0\u67e5\u7b2c\u4e8c\u4e2a\u64cd\u4f5c\u6570\u3002 \u4e00\u65e6 Lua \u627e\u5230\u4e86\u5143\u65b9\u6cd5\uff0c \u5b83\u5c06\u628a\u4e24\u4e2a\u64cd\u4f5c\u6570\u4f5c\u4e3a\u53c2\u6570\u4f20\u5165\u5143\u65b9\u6cd5\uff0c \u5143\u65b9\u6cd5\u7684\u7ed3\u679c\uff08\u8c03\u6574\u4e3a\u5355\u4e2a\u503c\uff09\u4f5c\u4e3a\u8fd9\u4e2a\u64cd\u4f5c\u7684\u7ed3\u679c\u3002 \u5982\u679c\u627e\u4e0d\u5230\u5143\u65b9\u6cd5\uff0c\u5c06\u629b\u51fa\u4e00\u4e2a\u9519\u8bef\u3002   \"sub\": - \u64cd\u4f5c\u3002 \u884c\u4e3a\u548c \"add\" \u64cd\u4f5c\u7c7b\u4f3c\u3002  \"mul\": * \u64cd\u4f5c\u3002 \u884c\u4e3a\u548c \"add\" \u64cd\u4f5c\u7c7b\u4f3c\u3002  \"div\": / \u64cd\u4f5c\u3002 \u884c\u4e3a\u548c \"add\" \u64cd\u4f5c\u7c7b\u4f3c\u3002  \"mod\": % \u64cd\u4f5c\u3002 \u884c\u4e3a\u548c \"add\" \u64cd\u4f5c\u7c7b\u4f3c\u3002  \"pow\": ^ \uff08\u6b21\u65b9\uff09\u64cd\u4f5c\u3002 \u884c\u4e3a\u548c \"add\" \u64cd\u4f5c\u7c7b\u4f3c\u3002  \"unm\": - \uff08\u53d6\u8d1f\uff09\u64cd\u4f5c\u3002 \u884c\u4e3a\u548c \"add\" \u64cd\u4f5c\u7c7b\u4f3c\u3002  \"idiv\": // \uff08\u5411\u4e0b\u53d6\u6574\u9664\u6cd5\uff09\u64cd\u4f5c\u3002 \u884c\u4e3a\u548c \"add\" \u64cd\u4f5c\u7c7b\u4f3c\u3002  \"band\":   \uff08\u6309\u4f4d\u4e0e\uff09\u64cd\u4f5c\u3002 \u884c\u4e3a\u548c \"add\" \u64cd\u4f5c\u7c7b\u4f3c\uff0c \u4e0d\u540c\u7684\u662f Lua \u4f1a\u5728\u4efb\u4f55\u4e00\u4e2a\u64cd\u4f5c\u6570\u65e0\u6cd5\u8f6c\u6362\u4e3a\u6574\u6570\u65f6 \uff08\u53c2\u89c1 \u00a73.4.3\uff09\u5c1d\u8bd5\u53d6\u5143\u65b9\u6cd5\u3002  \"bor\": | \uff08\u6309\u4f4d\u6216\uff09\u64cd\u4f5c\u3002 \u884c\u4e3a\u548c \"band\" \u64cd\u4f5c\u7c7b\u4f3c\u3002  \"bxor\": ~ \uff08\u6309\u4f4d\u5f02\u6216\uff09\u64cd\u4f5c\u3002 \u884c\u4e3a\u548c \"band\" \u64cd\u4f5c\u7c7b\u4f3c\u3002  \"bnot\": ~ \uff08\u6309\u4f4d\u975e\uff09\u64cd\u4f5c\u3002 \u884c\u4e3a\u548c \"band\" \u64cd\u4f5c\u7c7b\u4f3c\u3002  \"shl\":   \uff08\u5de6\u79fb\uff09\u64cd\u4f5c\u3002 \u884c\u4e3a\u548c \"band\" \u64cd\u4f5c\u7c7b\u4f3c\u3002  \"shr\":   \uff08\u53f3\u79fb\uff09\u64cd\u4f5c\u3002 \u884c\u4e3a\u548c \"band\" \u64cd\u4f5c\u7c7b\u4f3c\u3002  \"concat\": .. \uff08\u8fde\u63a5\uff09\u64cd\u4f5c\u3002 \u884c\u4e3a\u548c \"add\" \u64cd\u4f5c\u7c7b\u4f3c\uff0c \u4e0d\u540c\u7684\u662f Lua \u5728\u4efb\u4f55\u64cd\u4f5c\u6570\u5373\u4e0d\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32 \u4e5f\u4e0d\u662f\u6570\u5b57\uff08\u6570\u5b57\u603b\u80fd\u8f6c\u6362\u4e3a\u5bf9\u5e94\u7684\u5b57\u7b26\u4e32\uff09\u7684\u60c5\u51b5\u4e0b\u5c1d\u8bd5\u5143\u65b9\u6cd5\u3002  \"len\": # \uff08\u53d6\u957f\u5ea6\uff09\u64cd\u4f5c\u3002 \u5982\u679c\u5bf9\u8c61\u4e0d\u662f\u5b57\u7b26\u4e32\uff0cLua \u4f1a\u5c1d\u8bd5\u5b83\u7684\u5143\u65b9\u6cd5\u3002 \u5982\u679c\u6709\u5143\u65b9\u6cd5\uff0c\u5219\u8c03\u7528\u5b83\u5e76\u5c06\u5bf9\u8c61\u4ee5\u53c2\u6570\u5f62\u5f0f\u4f20\u5165\uff0c \u800c\u8fd4\u56de\u503c\uff08\u88ab\u8c03\u6574\u4e3a\u5355\u4e2a\uff09\u5219\u4f5c\u4e3a\u7ed3\u679c\u3002 \u5982\u679c\u5bf9\u8c61\u662f\u4e00\u5f20\u8868\u4e14\u6ca1\u6709\u5143\u65b9\u6cd5\uff0c Lua \u4f7f\u7528\u8868\u7684\u53d6\u957f\u5ea6\u64cd\u4f5c\uff08\u53c2\u89c1 \u00a73.4.7\uff09\u3002 \u5176\u5b83\u60c5\u51b5\uff0c\u5747\u629b\u51fa\u9519\u8bef\u3002  \"eq\": == \uff08\u7b49\u4e8e\uff09\u64cd\u4f5c\u3002 \u548c \"add\" \u64cd\u4f5c\u884c\u4e3a\u7c7b\u4f3c\uff0c \u4e0d\u540c\u7684\u662f Lua \u4ec5\u5728\u4e24\u4e2a\u503c\u90fd\u662f\u8868\u6216\u90fd\u662f\u5b8c\u5168\u7528\u6237\u6570\u636e \u4e14\u5b83\u4eec\u4e0d\u662f\u540c\u4e00\u4e2a\u5bf9\u8c61\u65f6\u624d\u5c1d\u8bd5\u5143\u65b9\u6cd5\u3002 \u8c03\u7528\u7684\u7ed3\u679c\u603b\u4f1a\u88ab\u8f6c\u6362\u4e3a\u5e03\u5c14\u91cf\u3002  \"lt\":   \uff08\u5c0f\u4e8e\uff09\u64cd\u4f5c\u3002 \u548c \"add\" \u64cd\u4f5c\u884c\u4e3a\u7c7b\u4f3c\uff0c \u4e0d\u540c\u7684\u662f Lua \u4ec5\u5728\u4e24\u4e2a\u503c\u4e0d\u5168\u4e3a\u6574\u6570\u4e5f\u4e0d\u5168\u4e3a\u5b57\u7b26\u4e32\u65f6\u624d\u5c1d\u8bd5\u5143\u65b9\u6cd5\u3002 \u8c03\u7528\u7684\u7ed3\u679c\u603b\u4f1a\u88ab\u8f6c\u6362\u4e3a\u5e03\u5c14\u91cf\u3002  \"le\":  = \uff08\u5c0f\u4e8e\u7b49\u4e8e\uff09\u64cd\u4f5c\u3002 \u548c\u5176\u5b83\u64cd\u4f5c\u4e0d\u540c\uff0c \u5c0f\u4e8e\u7b49\u4e8e\u64cd\u4f5c\u53ef\u80fd\u7528\u5230\u4e24\u4e2a\u4e0d\u540c\u7684\u4e8b\u4ef6\u3002 \u9996\u5148\uff0c\u50cf - \"lt\" \u64cd\u4f5c\u7684\u884c\u4e3a\u90a3\u6837\uff0cLua \u5728\u4e24\u4e2a\u64cd\u4f5c\u6570\u4e2d\u67e5\u627e  le \u5143\u65b9\u6cd5\u3002 \u5982\u679c\u4e00\u4e2a\u5143\u65b9\u6cd5\u90fd\u627e\u4e0d\u5230\uff0c\u5c31\u4f1a\u518d\u6b21\u67e5\u627e  lt\u4e8b\u4ef6\uff0c \u5b83\u4f1a\u5047\u8bbe a  = b \u7b49\u4ef7\u4e8e not (b   a)\u3002 \u800c\u5176\u5b83\u6bd4\u8f83\u64cd\u4f5c\u7b26\u7c7b\u4f3c\uff0c\u5176\u7ed3\u679c\u4f1a\u88ab\u8f6c\u6362\u4e3a\u5e03\u5c14\u91cf\u3002   \"index\": \u7d22\u5f15 table[key]\u3002 \u5f53 table \u4e0d\u662f\u8868\u6216\u662f\u8868 table \u4e2d\u4e0d\u5b58\u5728 key \u8fd9\u4e2a\u952e\u65f6\uff0c\u8fd9\u4e2a\u4e8b\u4ef6\u88ab\u89e6\u53d1\u3002 \u6b64\u65f6\uff0c\u4f1a\u8bfb\u51fa table \u76f8\u5e94\u7684\u5143\u65b9\u6cd5\u3002\n\u5c3d\u7ba1\u540d\u5b57\u53d6\u6210\u8fd9\u6837\uff0c \u8fd9\u4e2a\u4e8b\u4ef6\u7684\u5143\u65b9\u6cd5\u5176\u5b9e\u53ef\u4ee5\u662f\u4e00\u4e2a\u51fd\u6570\u4e5f\u53ef\u4ee5\u662f\u4e00\u5f20\u8868\u3002 \u5982\u679c\u5b83\u662f\u4e00\u4e2a\u51fd\u6570\uff0c\u5219\u4ee5 table \u548c key \u4f5c\u4e3a\u53c2\u6570\u8c03\u7528\u5b83\u3002 \u5982\u679c\u5b83\u662f\u4e00\u5f20\u8868\uff0c\u6700\u7ec8\u7684\u7ed3\u679c\u5c31\u662f\u4ee5 key \u53d6\u7d22\u5f15\u8fd9\u5f20\u8868\u7684\u7ed3\u679c\u3002 \uff08\u8fd9\u4e2a\u7d22\u5f15\u8fc7\u7a0b\u662f\u8d70\u5e38\u89c4\u7684\u6d41\u7a0b\uff0c\u800c\u4e0d\u662f\u76f4\u63a5\u7d22\u5f15\uff0c \u6240\u4ee5\u8fd9\u6b21\u7d22\u5f15\u6709\u53ef\u80fd\u5f15\u53d1\u53e6\u4e00\u6b21\u5143\u65b9\u6cd5\u3002\uff09    \"newindex\": \u7d22\u5f15\u8d4b\u503c table[key] = value \u3002 \u548c\u7d22\u5f15\u4e8b\u4ef6\u7c7b\u4f3c\uff0c\u5b83\u53d1\u751f\u5728 table \u4e0d\u662f\u8868\u6216\u662f\u8868 table \u4e2d\u4e0d\u5b58\u5728 key \u8fd9\u4e2a\u952e\u7684\u65f6\u5019\u3002 \u6b64\u65f6\uff0c\u4f1a\u8bfb\u51fa table \u76f8\u5e94\u7684\u5143\u65b9\u6cd5\u3002\n\u540c\u7d22\u5f15\u8fc7\u7a0b\u90a3\u6837\uff0c \u8fd9\u4e2a\u4e8b\u4ef6\u7684\u5143\u65b9\u6cd5\u5373\u53ef\u4ee5\u662f\u51fd\u6570\uff0c\u4e5f\u53ef\u4ee5\u662f\u4e00\u5f20\u8868\u3002 \u5982\u679c\u662f\u4e00\u4e2a\u51fd\u6570\uff0c \u5219\u4ee5 table\u3001 key\u3001\u4ee5\u53ca value \u4e3a\u53c2\u6570\u4f20\u5165\u3002 \u5982\u679c\u662f\u4e00\u5f20\u8868\uff0c Lua \u5bf9\u8fd9\u5f20\u8868\u505a\u7d22\u5f15\u8d4b\u503c\u64cd\u4f5c\u3002 \uff08\u8fd9\u4e2a\u7d22\u5f15\u8fc7\u7a0b\u662f\u8d70\u5e38\u89c4\u7684\u6d41\u7a0b\uff0c\u800c\u4e0d\u662f\u76f4\u63a5\u7d22\u5f15\u8d4b\u503c\uff0c \u6240\u4ee5\u8fd9\u6b21\u7d22\u5f15\u8d4b\u503c\u6709\u53ef\u80fd\u5f15\u53d1\u53e6\u4e00\u6b21\u5143\u65b9\u6cd5\u3002\uff09    \u4e00\u65e6\u6709\u4e86 \"newindex\" \u5143\u65b9\u6cd5\uff0c Lua \u5c31\u4e0d\u518d\u505a\u6700\u521d\u7684\u8d4b\u503c\u64cd\u4f5c\u3002 \uff08\u5982\u679c\u6709\u5fc5\u8981\uff0c\u5728\u5143\u65b9\u6cd5\u5185\u90e8\u53ef\u4ee5\u8c03\u7528 rawset \u6765\u505a\u8d4b\u503c\u3002\uff09   \"call\": \u51fd\u6570\u8c03\u7528\u64cd\u4f5c func(args)\u3002 \u5f53 Lua \u5c1d\u8bd5\u8c03\u7528\u4e00\u4e2a\u975e\u51fd\u6570\u7684\u503c\u7684\u65f6\u5019\u4f1a\u89e6\u53d1\u8fd9\u4e2a\u4e8b\u4ef6 \uff08\u5373 func \u4e0d\u662f\u4e00\u4e2a\u51fd\u6570\uff09\u3002 \u67e5\u627e func \u7684\u5143\u65b9\u6cd5\uff0c \u5982\u679c\u627e\u5f97\u5230\uff0c\u5c31\u8c03\u7528\u8fd9\u4e2a\u5143\u65b9\u6cd5\uff0c func \u4f5c\u4e3a\u7b2c\u4e00\u4e2a\u53c2\u6570\u4f20\u5165\uff0c\u539f\u6765\u8c03\u7528\u7684\u53c2\u6570\uff08args\uff09\u540e\u4f9d\u6b21\u6392\u5728\u540e\u9762\u3002   \u793a\u4f8b\u7a0b\u5e8f\uff1a  local mt = {}\n\nfunction mt.__add(t1, t2)\n    for k, v in pairs(t2) do\n        table.insert(t1, v)\n    end\n    return t1\nend\n\nlocal t1 = {1, 3}\nlocal t2 = {5, 7}\n\nsetmetatable(t1, mt)\n\nlocal tsum = t1 + t2\nfor k, v in pairs(tsum) do\n    print(v)\nend  \u8fd0\u884c\u7ed3\u679c\uff1a  1\n3\n5\n7", 
            "title": "2.4 \u5143\u8868\u53ca\u5143\u65b9\u6cd5"
        }, 
        {
            "location": "/luamd/03/", 
            "text": "\u8fd9\u4e00\u7ae0\u63cf\u8ff0\u4e86 Lua \u7684\u8bcd\u6cd5\u3001\u8bed\u6cd5\u548c\u53e5\u6cd5\u3002\n\n\n3.1 \u8bcd\u6cd5\u7ea6\u5b9a\n\n\nLua \u8bed\u8a00\u7684\u683c\u5f0f\u81ea\u7531\u3002 \u5b83\u4f1a\n\u5ffd\u7565\u8bed\u6cd5\u5143\u7d20\uff08\u7b26\u8bb0\uff09\u95f4\u7684\u7a7a\u683c\uff08\u5305\u62ec\u6362\u884c\uff09\u548c\u6ce8\u91ca\n\uff0c \u4ec5\u628a\u5b83\u4eec\u770b\u4f5c\u4e3a\u540d\u5b57\u548c\u5173\u952e\u5b57\u95f4\u7684\u5206\u5272\u7b26\u3002\n\n\nLua \u4e2d\u7684 \u540d\u5b57 \uff08\u4e5f\u88ab\u79f0\u4e3a \u6807\u8bc6\u7b26\uff09 \u53ef\u4ee5\u662f\u7531\u975e\u6570\u5b57\u6253\u5934\u7684\u4efb\u610f\u5b57\u6bcd\u4e0b\u5212\u7ebf\u548c\u6570\u5b57\u6784\u6210\u7684\u5b57\u7b26\u4e32\u3002 \u6807\u8bc6\u7b26\u53ef\u7528\u4e8e\u5bf9\u53d8\u91cf\u3001\u8868\u7684\u57df\u3001\u4ee5\u53ca\u6807\u7b7e\u547d\u540d\u3002\n\n\n\u4e0b\u5217\u5173\u952e\u5b57\u662f\u4fdd\u7559\u7684\uff0c\u4e0d\u53ef\u7528\u4e8e\u540d\u5b57\uff1a\n\n\nand       break     do        else      elseif    end\nfalse     for       function  goto      if        in\nlocal     nil       not       or        repeat    return\nthen      true      until     while\n\n\n\nLua \u8bed\u8a00\u5bf9\n\u5927\u5c0f\u5199\u654f\u611f\n\uff1a and \u662f\u4e00\u4e2a\u4fdd\u7559\u5b57\uff0c\u4f46 And \u4e0e AND \u5219\u662f\u4e24\u4e2a\u4e0d\u540c\u7684\u6709\u6548\u540d\u5b57\u3002 \n\u4f5c\u4e3a\u4e00\u4e2a\u7ea6\u5b9a\uff0c\u7a0b\u5e8f\u5e94\u907f\u514d\u521b\u5efa\u4ee5\u4e0b\u5212\u7ebf\u52a0\u4e00\u4e2a\u6216\u591a\u4e2a\u5927\u5199\u5b57\u6bcd\u6784\u6210\u7684\u540d\u5b57 \uff08\u4f8b\u5982 _VERSION\uff09\u3002\n\n\n\u4e0b\u5217\u5b57\u7b26\u4e32\u662f\u53e6\u5916\u4e00\u4e9b\u7b26\u8bb0\uff1a\n\n\n +     -     *     /     %     ^     #\n \n     ~     |     \n    \n    //\n ==    ~=    \n=    \n=    \n     \n     =\n (     )     {     }     [     ]     ::\n ;     :     ,     .     ..    ...\n\n\n\n\u5b57\u9762\u4e32\u53ef\u4ee5\u7528\u5355\u5f15\u53f7\u6216\u53cc\u5f15\u53f7\u62ec\u8d77\u3002\n \u5b57\u9762\u4e32\u5185\u90e8\u53ef\u4ee5\u5305\u542b\u4e0b\u5217 C \u98ce\u683c\u7684\u8f6c\u4e49\u4e32\uff1a '\\a' \uff08\u54cd\u94c3\uff09\uff0c '\\b' \uff08\u9000\u683c\uff09\uff0c '\\f' \uff08\u6362\u9875\uff09\uff0c '\\n' \uff08\u6362\u884c\uff09\uff0c '\\r' \uff08\u56de\u8f66\uff09\uff0c '\\t' \uff08\u6a2a\u9879\u5236\u8868\uff09\uff0c '\\v' \uff08\u7eb5\u5411\u5236\u8868\uff09\uff0c '\\' \uff08\u53cd\u659c\u6760\uff09\uff0c '\\\"' \uff08\u53cc\u5f15\u53f7\uff09\uff0c \u4ee5\u53ca '\\'' (\u5355\u5f15\u53f7)\u3002 \u5728\u53cd\u659c\u6760\u540e\u8ddf\u4e00\u4e2a\u771f\u6b63\u7684\u6362\u884c\u7b49\u4ef7\u4e8e\u5728\u5b57\u7b26\u4e32\u4e2d\u5199\u4e00\u4e2a\u6362\u884c\u7b26\u3002 \u8f6c\u4e49\u4e32 '\\z' \u4f1a\u5ffd\u7565\u5176\u540e\u7684\u4e00\u7cfb\u5217\u7a7a\u767d\u7b26\uff0c\u5305\u62ec\u6362\u884c\uff1b \u5b83\u5728\u4f60\u9700\u8981\u5bf9\u4e00\u4e2a\u5f88\u957f\u7684\u5b57\u7b26\u4e32\u5e38\u91cf\u65ad\u884c\u4e3a\u591a\u884c\u5e76\u5e0c\u671b\u5728\u6bcf\u4e2a\u65b0\u884c\u4fdd\u6301\u7f29\u8fdb\u65f6\u975e\u5e38\u6709\u7528\u3002\n\n\nLua \u4e2d\u7684\u5b57\u7b26\u4e32\u53ef\u4ee5\u4fdd\u5b58\n\u4efb\u610f 8 \u4f4d\u503c\n\uff0c\u5176\u4e2d\u5305\u62ec\u7528 \n'\\0' \u8868\u793a\u7684 0\n \u3002 \u4e00\u822c\u800c\u8a00\uff0c\u4f60\u53ef\u4ee5\u7528\u5b57\u7b26\u7684\u6570\u5b57\u503c\u6765\u8868\u793a\u8fd9\u4e2a\u5b57\u7b26\u3002 \u65b9\u5f0f\u662f\u7528\u8f6c\u4e49\u4e32 \\xXX\uff0c \u6b64\u5904\u7684 XX \u5fc5\u987b\u662f\u6070\u597d\u4e24\u4e2a\u5b57\u7b26\u7684 16 \u8fdb\u5236\u6570\u3002 \u6216\u8005\u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528\u8f6c\u4e49\u4e32 \\ddd \uff0c \u8fd9\u91cc\u7684 ddd \u662f\u4e00\u5230\u4e09\u4e2a\u5341\u8fdb\u5236\u6570\u5b57\u3002 \uff08\u6ce8\u610f\uff0c\u5982\u679c\u5728\u8f6c\u4e49\u7b26\u540e\u63a5\u7740\u6070\u5de7\u662f\u4e00\u4e2a\u6570\u5b57\u7b26\u53f7\u7684\u8bdd\uff0c \u4f60\u5c31\u5fc5\u987b\u5728\u8fd9\u4e2a\u8f6c\u4e49\u5f62\u5f0f\u4e2d\u5199\u6ee1\u4e09\u4e2a\u6570\u5b57\u3002\uff09\n\n\n\u5bf9\u4e8e\u7528 UTF-8 \u7f16\u7801\u7684 Unicode \u5b57\u7b26\uff0c\u4f60\u53ef\u4ee5\u7528 \u8f6c\u4e49\u7b26 \\u{XXX} \u6765\u8868\u793a \uff08\u8fd9\u91cc\u5fc5\u987b\u6709\u4e00\u5bf9\u82b1\u62ec\u53f7\uff09\uff0c \u6b64\u5904\u7684 XXX \u662f\u7528 16 \u8fdb\u5236\u8868\u793a\u7684\u5b57\u7b26\u7f16\u53f7\u3002\n\n\n\u6570\u5b57\u5e38\u91cf \uff08\u6216\u79f0\u4e3a \u6570\u5b57\u91cf\uff09 \u53ef\u4ee5\u7531\u53ef\u9009\u7684\u5c0f\u6570\u90e8\u5206\u548c\u53ef\u9009\u7684\u5341\u4e3a\u5e95\u7684\u6307\u6570\u90e8\u5206\u6784\u6210\uff0c \n\u6307\u6570\u90e8\u5206\u7528\u5b57\u7b26 'e' \u6216 'E' \u6765\u6807\u8bb0\n\u3002 Lua \u4e5f\u63a5\u53d7\u4ee5 0x \u6216 0X \u5f00\u5934\u7684 16 \u8fdb\u5236\u5e38\u91cf\u3002 16 \u8fdb\u5236\u5e38\u91cf\u4e5f\u63a5\u53d7\u5c0f\u6570\u52a0\u6307\u6570\u90e8\u5206\u7684\u5f62\u5f0f\uff0c\u6307\u6570\u90e8\u5206\u662f\u4ee5\u4e8c\u4e3a\u5e95\uff0c \u7528\u5b57\u7b26 'p' \u6216 'P' \u6765\u6807\u8bb0\u3002 \n\u6570\u5b57\u5e38\u91cf\u4e2d\u5305\u542b\u5c0f\u6570\u70b9\u6216\u6307\u6570\u90e8\u5206\u65f6\uff0c\u88ab\u8ba4\u4e3a\u662f\u4e00\u4e2a\u6d6e\u70b9\u6570\uff1b \u5426\u5219\u88ab\u8ba4\u4e3a\u662f\u4e00\u4e2a\u6574\u6570\u3002\n \u4e0b\u9762\u6709\u4e00\u4e9b\u5408\u6cd5\u7684\u6574\u6570\u5e38\u91cf\u7684\u4f8b\u5b50\uff1a\n\n\n3   345   0xff   0xBEBADA\n\n\n\n\u4ee5\u4e0b\u4e3a\u5408\u6cd5\u7684\u6d6e\u70b9\u5e38\u91cf\uff1a\n\n\n3.0     3.1416     314.16e-2     0.31416E1     34e1\n0x0.1E  0xA23p-4   0X1.921FB54442D18P+1\n\n\n\n\u5728\u5b57\u7b26\u4e32\u5916\u7684\u4efb\u4f55\u5730\u65b9\u51fa\u73b0\u4ee5\u53cc\u6a2a\u7ebf \n(--)\n \u5f00\u5934\u7684\u90e8\u5206\u662f\n \u6ce8\u91ca\n \u3002 \u5982\u679c -- \u540e\u6ca1\u6709\u7d27\u8ddf\u7740\u4e00\u4e2a\u5f00\u5927\u62ec\u53f7\uff0c \u8be5\u6ce8\u91ca\u4e3a \u77ed\u6ce8\u91ca\uff0c \u6ce8\u91ca\u5230\u5f53\u524d\u884c\u672b\u622a\u81f3\u3002 \u5426\u5219\uff0c\u8fd9\u662f\u4e00\u6bb5 \n\u957f\u6ce8\u91ca(--[[  ]]) \n\uff0c \u6ce8\u91ca\u533a\u4e00\u76f4\u7ef4\u6301\u5230\u5bf9\u5e94\u7684\u95ed\u957f\u62ec\u53f7\u3002 \u957f\u6ce8\u91ca\u901a\u5e38\u7528\u4e8e\u4e34\u65f6\u5c4f\u853d\u6389\u4e00\u5927\u6bb5\u4ee3\u7801\u3002\n\n\n\u793a\u4f8b\u4ee3\u7801\uff1a\n\n\nprint(\"hello\") -- hello\n\n--[[\n\nlocal i = 1\ni = i + 1\nprint(i)\n\n]]\n\n\n\n3.2 \u53d8\u91cf\n\n\n\u53d8\u91cf\u662f\u50a8\u5b58\u503c\u7684\u5730\u65b9\u3002 Lua \u4e2d\u6709\u4e09\u79cd\u53d8\u91cf\uff1a\n\u5168\u5c40\u53d8\u91cf\u3001\u5c40\u90e8\u53d8\u91cf\u548c\u8868\u7684\u57df\u3002\n\n\n\u5355\u4e2a\u540d\u5b57\u53ef\u4ee5\u6307\u4ee3\u4e00\u4e2a\u5168\u5c40\u53d8\u91cf\u4e5f\u53ef\u4ee5\u6307\u4ee3\u4e00\u4e2a\u5c40\u90e8\u53d8\u91cf \uff08\u6216\u8005\u662f\u4e00\u4e2a\u51fd\u6570\u7684\u5f62\u53c2\uff0c\u8fd9\u662f\u4e00\u79cd\u7279\u6b8a\u5f62\u5f0f\u7684\u5c40\u90e8\u53d8\u91cf\uff09\u3002\n\n\nvar ::= Name\n\n\n\n\u6240\u6709\u6ca1\u6709\u663e\u5f0f\u58f0\u660e\u4e3a\u5c40\u90e8\u53d8\u91cf(local)\u7684\u53d8\u91cf\u540d\u90fd\u88ab\u5f53\u505a\u5168\u5c40\u53d8\u91cf\u3002\n \u5c40\u90e8\u53d8\u91cf\u6709\u5176\u4f5c\u7528\u8303\u56f4 \uff1a \u5c40\u90e8\u53d8\u91cf\u53ef\u4ee5\u88ab\u5b9a\u4e49\u5728\u5b83\u4f5c\u7528\u8303\u56f4\u4e2d\u7684\u51fd\u6570\u81ea\u7531\u4f7f\u7528\uff09\u3002\n\n\n\u5728\u53d8\u91cf\u7684\u9996\u6b21\u8d4b\u503c\u4e4b\u524d\uff0c\u53d8\u91cf\u7684\u503c\u5747\u4e3a nil\u3002\n\n\n\u65b9\u62ec\u53f7\u88ab\u7528\u6765\u5bf9\u8868\u4f5c\u7d22\u5f15\uff1a\n\n\nvar ::= prefixexp \u2018[\u2019 exp \u2018]\u2019\n\n\n\nvar.Name \u8fd9\u79cd\u8bed\u6cd5\u53ea\u662f\u4e00\u4e2a\u8bed\u6cd5\u7cd6\uff0c\u7528\u6765\u8868\u793a var[\"Name\"]\uff1a\n\n\nvar ::= prefixexp \u2018.\u2019 Name\n\n\n\n\u5c40\u90e8\u53d8\u91cf\u53ef\u4ee5\u5728\u8bed\u53e5\u5757\u4e2d\u4efb\u4f55\u5730\u65b9\u58f0\u660e\u3002\n \u58f0\u660e\u53ef\u4ee5\u5305\u542b\u4e00\u4e2a\u521d\u59cb\u5316\u8d4b\u503c\u64cd\u4f5c\uff1a\n\n\nstat ::= local namelist [\u2018=\u2019 explist]\n\n\n\n\u5982\u679c\u6709\u521d\u59cb\u5316\u503c\u7684\u8bdd\uff0c\u521d\u59cb\u5316\u8d4b\u503c\u64cd\u4f5c\u7684\u8bed\u6cd5\u548c\u8d4b\u503c\u64cd\u4f5c\u4e00\u81f4\u3002 \u82e5\u6ca1\u6709\u521d\u59cb\u5316\u503c\uff0c\u6240\u6709\u7684\u53d8\u91cf\u90fd\u88ab\u521d\u59cb\u5316\u4e3a nil\u3002\n\n\n3.2 \u8bed\u53e5\n\n\nLua \u652f\u6301\u6240\u6709\u4e0e Pascal \u6216\u662f C \u7c7b\u4f3c\u7684\u5e38\u89c1\u5f62\u5f0f\u7684\u8bed\u53e5\uff0c \u8fd9\u4e2a\u96c6\u5408\u5305\u62ec\u8d4b\u503c\uff0c\u63a7\u5236\u7ed3\u6784\uff0c\u51fd\u6570\u8c03\u7528\uff0c\u8fd8\u6709\u53d8\u91cf\u58f0\u660e\u3002\n\n\n3.2.1 \u4ee3\u7801\u5757\n\n\nLua \u7684\u4e00\u4e2a\u7f16\u8bd1\u5355\u5143\u88ab\u79f0\u4e3a\u4e00\u4e2a \u4ee3\u7801\u5757\u3002 \u4ece\u53e5\u6cd5\u6784\u6210\u4e0a\u8bb2\uff0c\u4e00\u4e2a\u4ee3\u7801\u5757\u5c31\u662f\u4e00\u4e2a\u8bed\u53e5\u5757\u3002\n\n\nchunk ::= block\n\n\n\nLua \u628a\u4e00\u4e2a\u4ee3\u7801\u5757\u5f53\u4f5c\u4e00\u4e2a\u62e5\u6709\u4e0d\u5b9a\u53c2\u6570\u7684\u533f\u540d\u51fd\u6570\u6765\u5904\u7406\u3002 \u6b63\u662f\u8fd9\u6837\uff0c\u4ee3\u7801\u5757\u5185\u53ef\u4ee5\u5b9a\u4e49\u5c40\u90e8\u53d8\u91cf\uff0c\u5b83\u53ef\u4ee5\u63a5\u6536\u53c2\u6570\uff0c\u8fd4\u56de\u82e5\u5e72\u503c\u3002 \u6b64\u5916\uff0c\u8fd9\u4e2a\u533f\u540d\u51fd\u6570\u5728\u7f16\u8bd1\u65f6\u8fd8\u4e3a\u5b83\u7684\u4f5c\u7528\u57df\u7ed1\u5b9a\u4e86\u4e00\u4e2a\u5916\u90e8\u5c40\u90e8\u53d8\u91cf _ENV\u3002 \u8be5\u51fd\u6570\u603b\u662f\u628a _ENV \u4f5c\u4e3a\u5b83\u552f\u4e00\u7684\u4e00\u4e2a\u4e0a\u503c\uff0c \u5373\u4f7f\u8fd9\u4e2a\u51fd\u6570\u4e0d\u4f7f\u7528\u8fd9\u4e2a\u53d8\u91cf\uff0c\u5b83\u4e5f\u5b58\u5728\u3002\n\n\n\u4ee3\u7801\u5757\u53ef\u4ee5\u88ab\u4fdd\u5b58\u5728\u6587\u4ef6\u4e2d\uff0c\u4e5f\u53ef\u4ee5\u4f5c\u4e3a\u5bbf\u4e3b\u7a0b\u5e8f\u5185\u90e8\u7684\u4e00\u4e2a\u5b57\u7b26\u4e32\u3002 \u8981\u6267\u884c\u4e00\u4e2a\u4ee3\u7801\u5757\uff0c \u9996\u5148\u8981\u8ba9 Lua \u52a0\u8f7d \u5b83\uff0c \u5c06\u4ee3\u7801\u5757\u4e2d\u7684\u4ee3\u7801\u9884\u7f16\u8bd1\u6210\u865a\u62df\u673a\u4e2d\u7684\u6307\u4ee4\uff0c \u800c\u540e\uff0cLua \u7528\u865a\u62df\u673a\u89e3\u91ca\u5668\u6765\u8fd0\u884c\u7f16\u8bd1\u540e\u7684\u4ee3\u7801\u3002\n\n\n\u4ee3\u7801\u5757\u53ef\u4ee5\u88ab\u9884\u7f16\u8bd1\u4e3a\u4e8c\u8fdb\u5236\u5f62\u5f0f\uff1b \u53c2\u89c1\u7a0b\u5e8f luac \u4ee5\u53ca\u51fd\u6570 string.dump \u53ef\u83b7\u5f97\u66f4\u591a\u7ec6\u8282\u3002 \u7528\u6e90\u7801\u8868\u793a\u7684\u7a0b\u5e8f\u548c\u7f16\u8bd1\u540e\u7684\u5f62\u5f0f\u53ef\u81ea\u7531\u66ff\u6362\uff1b Lua \u4f1a\u81ea\u52a8\u68c0\u6d4b\u6587\u4ef6\u683c\u5f0f\u505a\u76f8\u5e94\u7684\u5904\u7406 \uff08\u53c2\u89c1 load\uff09\u3002\n\n\n3.2.2 \u8d4b\u503c\n\n\nLua \u5141\u8bb8\u591a\u91cd\u8d4b\u503c\u3002 \u56e0\u6b64\uff0c\u8d4b\u503c\u7684\u8bed\u6cd5\u5b9a\u4e49\u662f\u7b49\u53f7\u5de6\u8fb9\u653e\u4e00\u4e2a\u53d8\u91cf\u5217\u8868\uff0c \u800c\u7b49\u53f7\u53f3\u8fb9\u653e\u4e00\u4e2a\u8868\u8fbe\u5f0f\u5217\u8868\u3002\n \u4e24\u8fb9\u7684\u5217\u8868\u4e2d\u7684\u5143\u7d20\u90fd\u7528\u9017\u53f7\u95f4\u5f00\uff1a\n\u5728\u4f5c\u8d4b\u503c\u64cd\u4f5c\u4e4b\u524d\uff0c \u90a3\u503c\u5217\u8868\u4f1a\u88ab \u8c03\u6574 \u4e3a\u5de6\u8fb9\u53d8\u91cf\u5217\u8868\u7684\u4e2a\u6570\u3002 \u5982\u679c\u503c\u6bd4\u9700\u8981\u7684\u66f4\u591a\u7684\u8bdd\uff0c\n\u591a\u4f59\u7684\u503c\u5c31\u88ab\u6254\u6389\u3002\n \n\u5982\u679c\u503c\u7684\u6570\u91cf\u4e0d\u591f\u9700\u6c42\uff0c \u5c06\u4f1a\u6309\u6240\u9700\u6269\u5c55\u82e5\u5e72\u4e2a nil\u3002\n \u5982\u679c\u8868\u8fbe\u5f0f\u5217\u8868\u4ee5\u4e00\u4e2a\u51fd\u6570\u8c03\u7528\u7ed3\u675f\uff0c \u8fd9\u4e2a\u51fd\u6570\u6240\u8fd4\u56de\u7684\u6240\u6709\u503c\u90fd\u4f1a\u5728\u8c03\u6574\u64cd\u4f5c\u4e4b\u524d\u88ab\u7f6e\u5165\u503c\u5217\u8868\u4e2d \uff08\u9664\u975e\u8fd9\u4e2a\u51fd\u6570\u8c03\u7528\u88ab\u7528\u62ec\u53f7\u62ec\u4e86\u8d77\u6765\uff09\u3002\n\n\n\u8d4b\u503c\u8bed\u53e5\u9996\u5148\u8ba9\u6240\u6709\u7684\u8868\u8fbe\u5f0f\u5b8c\u6210\u8fd0\u7b97\uff0c \u4e4b\u540e\u518d\u505a\u8d4b\u503c\u64cd\u4f5c\u3002 \u56e0\u6b64\uff0c\u4e0b\u9762\u8fd9\u6bb5\u4ee3\u7801\n\n\n i = 3\n i, a[i] = i+1, 20\n\n\n\n\u4f1a\u628a a[3] \u8bbe\u7f6e\u4e3a 20\uff0c\u800c\u4e0d\u4f1a\u5f71\u54cd\u5230 a[4] \u3002 \u8fd9\u662f\u56e0\u4e3a a[i] \u4e2d\u7684 i \u5728\u88ab\u8d4b\u503c\u4e3a 4 \u4e4b\u524d\u5c31\u88ab\u8ba1\u7b97\u51fa\u6765\u4e86\uff08\u5f53\u65f6\u662f 3 \uff09\u3002 \u7b80\u5355\u8bf4 \uff0c\u8fd9\u6837\u4e00\u884c\n\n\n x, y = y, x\n\n\n\n\u4f1a\u4ea4\u6362 x \u548c y \u7684\u503c\u3002\n\n\n\u5bf9\u4e8e\u5168\u5c40\u53d8\u91cf x = val \u7684\u8d4b\u503c\u7b49\u4ef7\u4e8e _ENV.x = val \n\n\n3.2.3 \u63a7\u5236\u7ed3\u6784\n\n\nif, while, and repeat \u8fd9\u4e9b\u63a7\u5236\u7ed3\u6784\u7b26\u5408\u901a\u5e38\u7684\u610f\u4e49\uff0c\u800c\u4e14\u4e5f\u6709\u7c7b\u4f3c\u7684\u8bed\u6cd5\uff1a\n\n\nstat ::= while exp do block end\nstat ::= repeat block until exp\nstat ::= if exp then block {elseif exp then block} [else block] end\n\n\n\nLua \u4e5f\u6709\u4e00\u4e2a for \u8bed\u53e5\uff0c\u5b83\u6709\u4e24\u79cd\u5f62\u5f0f\uff0c\u8be6\u89c1\u4e0b\u6587\u3002\n\n\n\u63a7\u5236\u7ed3\u6784\u4e2d\u7684\u6761\u4ef6\u8868\u8fbe\u5f0f\u53ef\u4ee5\u8fd4\u56de\u4efb\u4f55\u503c\u3002 false \u4e0e nil \u4e24\u8005\u90fd\u88ab\u8ba4\u4e3a\u662f\u5047\u3002 \u6240\u6709\u4e0d\u540c\u4e8e nil \u4e0e false \u7684\u5176\u5b83\u503c\u90fd\u88ab\u8ba4\u4e3a\u662f\u771f \uff08\u7279\u522b\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u6570\u5b57 0 \u548c\u7a7a\u5b57\u7b26\u4e32\u4e5f\u88ab\u8ba4\u4e3a\u662f\u771f\uff09\u3002\n\n\n\u5728 repeat\u2013until \u5faa\u73af\u4e2d\uff0c \u5185\u90e8\u8bed\u53e5\u5757\u7684\u7ed3\u675f\u70b9\u4e0d\u662f\u5728 until \u8fd9\u4e2a\u5173\u952e\u5b57\u5904\uff0c \u5b83\u8fd8\u5305\u62ec\u4e86\u5176\u540e\u7684\u6761\u4ef6\u8868\u8fbe\u5f0f\u3002 \u56e0\u6b64\uff0c\u6761\u4ef6\u8868\u8fbe\u5f0f\u4e2d\u53ef\u4ee5\u4f7f\u7528\u5faa\u73af\u5185\u90e8\u8bed\u53e5\u5757\u4e2d\u7684\u5b9a\u4e49\u7684\u5c40\u90e8\u53d8\u91cf\u3002\n\n\ngoto \u8bed\u53e5\u5c06\u7a0b\u5e8f\u7684\u63a7\u5236\u70b9\u8f6c\u79fb\u5230\u4e00\u4e2a\u6807\u7b7e\u5904\u3002 \u7531\u4e8e\u53e5\u6cd5\u4e0a\u7684\u539f\u56e0\uff0c Lua \u91cc\u7684\u6807\u7b7e\u4e5f\u88ab\u8ba4\u4e3a\u662f\u8bed\u53e5\u3002\u9664\u4e86\u5728\u5185\u5d4c\u51fd\u6570\u4e2d\uff0c\u4ee5\u53ca\u5728\u5185\u5d4c\u8bed\u53e5\u5757\u4e2d\u5b9a\u4e49\u4e86\u540c\u540d\u6807\u7b7e\uff0c\u7684\u60c5\u51b5\u5916\uff0c \u6807\u7b7e\u5bf9\u4e8e\u5b83\u5b9a\u4e49\u6240\u5728\u7684\u6574\u4e2a\u8bed\u53e5\u5757\u53ef\u89c1\u3002 \u53ea\u8981 goto \u6ca1\u6709\u8fdb\u5165\u4e00\u4e2a\u65b0\u7684\u5c40\u90e8\u53d8\u91cf\u7684\u4f5c\u7528\u57df\uff0c\u5b83\u53ef\u4ee5\u8df3\u8f6c\u5230\u4efb\u610f\u53ef\u89c1\u6807\u7b7e\u5904\u3002\n\n\n\u6807\u7b7e\u548c\u6ca1\u6709\u5185\u5bb9\u7684\u8bed\u53e5\u88ab\u79f0\u4e3a\u7a7a\u8bed\u53e5\uff0c\u5b83\u4eec\u4e0d\u505a\u4efb\u4f55\u64cd\u4f5c\u3002\n\n\nbreak \u88ab\u7528\u6765\u7ed3\u675f while\u3001 repeat\u3001\u6216 for \u5faa\u73af\uff0c \u5b83\u5c06\u8df3\u5230\u5faa\u73af\u5916\u63a5\u7740\u4e4b\u540e\u7684\u8bed\u53e5\u8fd0\u884c\uff0cbreak \u8df3\u51fa\u6700\u5185\u5c42\u7684\u5faa\u73af\u3002\n\n\nreturn \u88ab\u7528\u4e8e\u4ece\u51fd\u6570\u6216\u662f\u4ee3\u7801\u5757\uff08\u5176\u5b9e\u5b83\u5c31\u662f\u4e00\u4e2a\u51fd\u6570\uff09 \u4e2d\u8fd4\u56de\u503c\u3002 \n\u51fd\u6570\u53ef\u4ee5\u8fd4\u56de\u4e0d\u6b62\u4e00\u4e2a\u503c\n\uff0c\u6240\u4ee5 return \u7684\u8bed\u6cd5\u4e3a\n\n\nstat ::= return [explist] [\u2018;\u2019]\n\n\n\nreturn \u53ea\u80fd\u88ab\u5199\u5728\u4e00\u4e2a\u8bed\u53e5\u5757\u7684\u6700\u540e\u4e00\u53e5\u3002 \u5982\u679c\u4f60\u771f\u7684\u9700\u8981\u4ece\u8bed\u53e5\u5757\u7684\u4e2d\u95f4 return\uff0c \u4f60\u53ef\u4ee5\u4f7f\u7528\u663e\u5f0f\u7684\u5b9a\u4e49\u4e00\u4e2a\u5185\u90e8\u8bed\u53e5\u5757\uff0c \u4e00\u822c\u5199\u4f5c do return end\u3002 \u53ef\u4ee5\u8fd9\u6837\u5199\u662f\u56e0\u4e3a\u73b0\u5728 return \u6210\u4e86\uff08\u5185\u90e8\uff09\u8bed\u53e5\u5757\u7684\u6700\u540e\u4e00\u53e5\u4e86\u3002\n\n\n\u793a\u4f8b\u4ee3\u7801\uff1a\n\n\nlocal i = 0\nwhile i \n 3 do \n    print(i)\n    i = i + 1\nend\nprint(\"---\")\n\nlocal i = 0\nrepeat\n    print(i)\n    i = i + 1\nuntil i \n 5\n\n\n\n\u8fd0\u884c\u7ed3\u679c\uff1a\n\n\n0\n1\n2\n---\n0\n1\n2\n3\n4\n5\n\n\n\n3.2.4 For \u8bed\u53e5\n\n\nfor \u6709\u4e24\u79cd\u5f62\u5f0f\uff1a\u4e00\u79cd\u662f\u6570\u5b57\u5f62\u5f0f\uff0c\u53e6\u4e00\u79cd\u662f\u901a\u7528\u5f62\u5f0f\u3002\n\n\n\u6570\u5b57\u5f62\u5f0f\u7684 for \u5faa\u73af\uff0c\u901a\u8fc7\u4e00\u4e2a\u6570\u5b66\u8fd0\u7b97\u4e0d\u65ad\u5730\u8fd0\u884c\u5185\u90e8\u7684\u4ee3\u7801\u5757\u3002 \u4e0b\u9762\u662f\u5b83\u7684\u8bed\u6cd5\uff1a\n\n\nstat ::= for Name \u2018=\u2019 exp \u2018,\u2019 exp [\u2018,\u2019 exp] do block end\n\n\n\nblock \u5c06\u628a name \u4f5c\u5faa\u73af\u53d8\u91cf\u3002 \u4ece\u7b2c\u4e00\u4e2a exp \u5f00\u59cb\u8d77\uff0c\u76f4\u5230\u7b2c\u4e8c\u4e2a exp \u7684\u503c\u4e3a\u6b62\uff0c \u5176\u6b65\u957f\u4e3a\u7b2c\u4e09\u4e2a exp \u3002 \u66f4\u786e\u5207\u7684\u8bf4\uff0c\u4e00\u4e2a for \u5faa\u73af\u770b\u8d77\u6765\u662f\u8fd9\u4e2a\u6837\u5b50\n\n\n for v = e1, e2, e3 do block end\n\n\n\n\u6ce8\u610f\u4e0b\u9762\u8fd9\u51e0\u70b9\uff1a\n\n\n\n\n\u6240\u6709\u4e09\u4e2a\u63a7\u5236\u8868\u8fbe\u5f0f\u90fd\u53ea\u88ab\u8fd0\u7b97\u4e00\u6b21\uff0c \u8868\u8fbe\u5f0f\u7684\u8ba1\u7b97\u5728\u5faa\u73af\u5f00\u59cb\u4e4b\u524d\u3002 \u8fd9\u4e9b\u8868\u8fbe\u5f0f\u7684\u7ed3\u679c\u5fc5\u987b\u662f\u6570\u5b57\u3002\n\n\nvar\uff0climit\uff0c\u4ee5\u53ca step \u90fd\u662f\u4e00\u4e9b\u4e0d\u53ef\u89c1\u7684\u53d8\u91cf\u3002 \u8fd9\u91cc\u7ed9\u5b83\u4eec\u8d77\u7684\u540d\u5b57\u90fd\u4ec5\u4ec5\u7528\u4e8e\u89e3\u91ca\u65b9\u4fbf\u3002\n\n\n\u5982\u679c\u7b2c\u4e09\u4e2a\u8868\u8fbe\u5f0f\uff08\u6b65\u957f\uff09\u6ca1\u6709\u7ed9\u51fa\uff0c\u4f1a\u628a\u6b65\u957f\u8bbe\u4e3a 1 \u3002\n\n\n\u4f60\u53ef\u4ee5\u7528 break \u548c goto \u6765\u9000\u51fa for \u5faa\u73af\u3002\n\n\n\u5faa\u73af\u53d8\u91cf v \u662f\u4e00\u4e2a\u5faa\u73af\u5185\u90e8\u7684\u5c40\u90e8\u53d8\u91cf\uff1b \u5982\u679c\u4f60\u9700\u8981\u5728\u5faa\u73af\u7ed3\u675f\u540e\u4f7f\u7528\u8fd9\u4e2a\u503c\uff0c \u5728\u9000\u51fa\u5faa\u73af\u524d\u628a\u5b83\u8d4b\u7ed9\u53e6\u4e00\u4e2a\u53d8\u91cf\u3002\n\n\n\n\n\u901a\u7528\u5f62\u5f0f\u7684 for \u901a\u8fc7\u4e00\u4e2a\u53eb\u4f5c \u8fed\u4ee3\u5668 \u7684\u51fd\u6570\u5de5\u4f5c\u3002\n \u6bcf\u6b21\u8fed\u4ee3\uff0c\u8fed\u4ee3\u5668\u51fd\u6570\u90fd\u4f1a\u88ab\u8c03\u7528\u4ee5\u4ea7\u751f\u4e00\u4e2a\u65b0\u7684\u503c\uff0c \u5f53\u8fd9\u4e2a\u503c\u4e3a nil \u65f6\uff0c\u5faa\u73af\u505c\u6b62\u3002 \u901a\u7528\u5f62\u5f0f\u7684 for \u5faa\u73af\u7684\u8bed\u6cd5\u5982\u4e0b\uff1a\n\n\nstat ::= for namelist in explist do block end\nnamelist ::= Name {\u2018,\u2019 Name}\n\n\n\n\u8fd9\u6837\u7684 for \u8bed\u53e5\n\n\n for var_1, \u00b7\u00b7\u00b7, var_n in explist do block end\n\n\n\n\u6ce8\u610f\u4ee5\u4e0b\u51e0\u70b9\uff1a\n\n\n\n\nexplist \u53ea\u4f1a\u88ab\u8ba1\u7b97\u4e00\u6b21\u3002 \u5b83\u8fd4\u56de\u4e09\u4e2a\u503c\uff0c \u4e00\u4e2a \u8fed\u4ee3\u5668 \u51fd\u6570\uff0c \u4e00\u4e2a \u72b6\u6001\uff0c \u4e00\u4e2a \u8fed\u4ee3\u5668\u7684\u521d\u59cb\u503c\u3002\n\n\nf\uff0c s\uff0c\u4e0e var \u90fd\u662f\u4e0d\u53ef\u89c1\u7684\u53d8\u91cf\u3002 \u8fd9\u91cc\u7ed9\u5b83\u4eec\u8d77\u7684\u540d\u5b57\u90fd\u53ea\u662f\u4e3a\u4e86\u89e3\u8bf4\u65b9\u4fbf\u3002\n\n\n\u4f60\u53ef\u4ee5\u4f7f\u7528 break \u6765\u8df3\u51fa for \u5faa\u73af\u3002\n\n\n\u73af\u53d8\u91cf var_i \u5bf9\u4e8e\u5faa\u73af\u6765\u8bf4\u662f\u4e00\u4e2a\u5c40\u90e8\u53d8\u91cf\uff1b \u4f60\u4e0d\u53ef\u4ee5\u5728 for \u5faa\u73af\u7ed3\u675f\u540e\u7ee7\u7eed\u4f7f\u7528\u3002 \u5982\u679c\u4f60\u9700\u8981\u4fdd\u7559\u8fd9\u4e9b\u503c\uff0c\u90a3\u4e48\u5c31\u5728\u5faa\u73af\u8df3\u51fa\u6216\u7ed3\u675f\u524d\u8d4b\u503c\u5230\u522b\u7684\u53d8\u91cf\u91cc\u53bb\u3002\n\n\n\n\n3.2.5 for\u793a\u4f8b\u4ee3\u7801\uff1a\n\n\nfor i=1, 10, 1 do -- \u6ce8\u610f\u8fd9\u91cc\u4ece1\u5f00\u59cb\u7684\n    print(i)\nend\n\nlocal nums = {11, 22, 33}\nfor i,v in ipairs(nums) do \n    print(i..' -\n '..v) \nend\n\nlocal user = {}\nuser[123] = \"jjk\"\nuser[\"hello\"] = \"world\"\n\nfor k, v in pairs(user) do\n    print(k..\" \"..v)\nend\n\n\n\n3.2.6 \u6570\u5b66\u8fd0\u7b97\u64cd\u4f5c\u7b26\n\n\nLua \u652f\u6301\u4e0b\u5217\u6570\u5b66\u8fd0\u7b97\u64cd\u4f5c\u7b26\uff1a\n\n\n\n\n+: \u52a0\u6cd5\n\n\n-: \u51cf\u6cd5\n\n\n*: \u4e58\u6cd5\n\n\n/: \u6d6e\u70b9\u9664\u6cd5\n\n\n//: \u5411\u4e0b\u53d6\u6574\u9664\u6cd5\n\n\n%: \u53d6\u6a21\n\n\n^: \u4e58\u65b9\n\n\n-: \u53d6\u8d1f\n\n\n\n\n\u9664\u4e86\u4e58\u65b9\u548c\u6d6e\u70b9\u9664\u6cd5\u8fd0\u7b97\uff0c \u6570\u5b66\u8fd0\u7b97\u6309\u5982\u4e0b\u65b9\u5f0f\u5de5\u4f5c\uff1a \u5982\u679c\u4e24\u4e2a\u64cd\u4f5c\u6570\u90fd\u662f\u6574\u6570\uff0c \u8be5\u64cd\u4f5c\u4ee5\u6574\u6570\u65b9\u5f0f\u64cd\u4f5c\u4e14\u7ed3\u679c\u4e5f\u5c06\u662f\u4e00\u4e2a\u6574\u6570\u3002 \n\u5426\u5219\uff0c\u5f53\u4e24\u4e2a\u64cd\u4f5c\u6570\u90fd\u662f\u6570\u5b57\u6216\u53ef\u4ee5\u88ab\u8f6c\u6362\u4e3a\u6570\u5b57\u7684\u5b57\u7b26\u4e32\u65f6\uff0c \u64cd\u4f5c\u6570\u4f1a\u88ab\u8f6c\u6362\u6210\u4e24\u4e2a\u6d6e\u70b9\u6570\uff0c \n\u64cd\u4f5c\u6309\u901a\u5e38\u7684\u6d6e\u70b9\u89c4\u5219\uff08\u4e00\u822c\u9075\u5faa IEEE 754 \u6807\u51c6\uff09 \u6765\u8fdb\u884c\uff0c\n\u7ed3\u679c\u4e5f\u662f\u4e00\u4e2a\u6d6e\u70b9\u6570\u3002\n\n\n\u4e58\u65b9\u548c\u6d6e\u70b9\u9664\u6cd5 \uff08/\uff09 \u603b\u662f\u628a\u64cd\u4f5c\u6570\u8f6c\u6362\u6210\u6d6e\u70b9\u6570\u8fdb\u884c\uff0c\u5176\u7ed3\u679c\u603b\u662f\u6d6e\u70b9\u6570\u3002 \n\u4e58\u65b9\u4f7f\u7528 ISO C \u51fd\u6570 pow\uff0c \u56e0\u6b64\u5b83\u4e5f\u53ef\u4ee5\u63a5\u53d7\u975e\u6574\u6570\u7684\u6307\u6570\u3002\n\n\n\u793a\u4f8b\uff1a\n\n\nprint(23 + \"12.1\") -- 35.1\n\n\n\n3.2.7 \u4f4d\u64cd\u4f5c\u7b26\n\n\nLua \u652f\u6301\u4e0b\u5217\u4f4d\u64cd\u4f5c\u7b26\uff1a\n\n\n\n\n: \u6309\u4f4d\u4e0e\n\n\n|: \u6309\u4f4d\u6216\n\n\n~: \u6309\u4f4d\u5f02\u6216\n\n\n\n\n\n\n\n\n: \u53f3\u79fb\n\n\n\n\n\n\n\n\n: \u5de6\u79fb\n\n\n~: \u6309\u4f4d\u975e\n\n\n\n\n\u6240\u6709\u7684\u4f4d\u64cd\u4f5c\u90fd\u5c06\u64cd\u4f5c\u6570\u5148\u8f6c\u6362\u4e3a\u6574\u6570\uff0c \u7136\u540e\u6309\u4f4d\u64cd\u4f5c\uff0c\u5176\u7ed3\u679c\u662f\u4e00\u4e2a\u6574\u6570\u3002\n\n\n\u5bf9\u4e8e\u53f3\u79fb\u548c\u5de6\u79fb\uff0c\u5747\u7528\u96f6\u6765\u586b\u8865\u7a7a\u4f4d\u3002 \u79fb\u52a8\u7684\u4f4d\u6570\u82e5\u4e3a\u8d1f\uff0c\u5219\u5411\u53cd\u65b9\u5411\u4f4d\u79fb\uff1b \u82e5\u79fb\u52a8\u7684\u4f4d\u6570\u7684\u7edd\u5bf9\u503c\u5927\u4e8e\u7b49\u4e8e \u6574\u6570\u672c\u8eab\u7684\u4f4d\u6570\uff0c\u5176\u7ed3\u679c\u4e3a\u96f6 \uff08\u6240\u6709\u4f4d\u90fd\u88ab\u79fb\u51fa\uff09\u3002\n\n\n3.2.8 \u5f3a\u5236\u8f6c\u6362\n\n\nLua \u5bf9\u4e00\u4e9b\u7c7b\u578b\u548c\u503c\u7684\u5185\u90e8\u8868\u793a\u4f1a\u5728\u8fd0\u884c\u65f6\u505a\u4e00\u4e9b\u6570\u5b66\u8f6c\u6362\u3002 \n\u4f4d\u64cd\u4f5c\u603b\u662f\u5c06\u6d6e\u70b9\u64cd\u4f5c\u6570\u8f6c\u6362\u6210\u6574\u6570\u3002\n \n\u4e58\u65b9\u548c\u6d6e\u70b9\u9664\u6cd5\u603b\u662f\u5c06\u6574\u6570\u8f6c\u6362\u4e3a\u6d6e\u70b9\u6570\u3002\n \n\u5176\u5b83\u6570\u5b66\u64cd\u4f5c\u82e5\u9488\u5bf9\u6df7\u5408\u64cd\u4f5c\u6570 \uff08\u6574\u6570\u548c\u6d6e\u70b9\u6570\uff09\u5c06\u628a\u6574\u6570\u8f6c\u6362\u4e3a\u6d6e\u70b9\u6570\n\uff1b \u8fd9\u4e00\u70b9\u88ab\u79f0\u4e3a \u901a\u5e38\u89c4\u5219\u3002 C API \u540c\u6837\u4f1a\u6309\u9700\u628a\u6574\u6570\u8f6c\u6362\u4e3a\u6d6e\u70b9\u6570\u4ee5\u53ca \u628a\u6d6e\u70b9\u6570\u8f6c\u6362\u4e3a\u6574\u6570\u3002 \u6b64\u5916\uff0c\u5b57\u7b26\u4e32\u8fde\u63a5\u64cd\u4f5c\u9664\u4e86\u5b57\u7b26\u4e32\uff0c\u4e5f\u53ef\u4ee5\u63a5\u53d7\u6570\u5b57\u4f5c\u4e3a\u53c2\u6570\u3002\n\n\n\u5f53\u64cd\u4f5c\u9700\u8981\u6570\u5b57\u65f6\uff0cLua \u8fd8\u4f1a\u628a\u5b57\u7b26\u4e32\u8f6c\u6362\u4e3a\u6570\u5b57\u3002\n\n\n\u5f53\u628a\u4e00\u4e2a\u6574\u6570\u8f6c\u6362\u4e3a\u6d6e\u70b9\u6570\u65f6\uff0c \u82e5\u6574\u6570\u503c\u6070\u597d\u53ef\u4ee5\u8868\u793a\u4e3a\u4e00\u4e2a\u6d6e\u70b9\u6570\uff0c\u90a3\u5c31\u53d6\u90a3\u4e2a\u6d6e\u70b9\u6570\u3002 \u5426\u5219\uff0c\u8f6c\u6362\u4f1a\u53d6\u6700\u63a5\u8fd1\u7684\u8f83\u5927\u503c\u6216\u8f83\u5c0f\u503c\u6765\u8868\u793a\u8fd9\u4e2a\u6570\u3002 \u8fd9\u79cd\u8f6c\u6362\u662f\u4e0d\u4f1a\u5931\u8d25\u7684\u3002\n\n\n\u5c06\u6d6e\u70b9\u6570\u8f6c\u4e3a\u6574\u6570\u7684\u8fc7\u7a0b\u4f1a\u68c0\u67e5 \u6d6e\u70b9\u6570\u80fd\u5426\u88ab\u51c6\u786e\u7684\u8868\u8fbe\u4e3a\u4e00\u4e2a\u6574\u6570 \uff08\u5373\uff0c\u6d6e\u70b9\u6570\u662f\u4e00\u4e2a\u6574\u6570\u503c\u4e14\u5728\u6574\u6570\u53ef\u4ee5\u8868\u8fbe\u7684\u533a\u95f4\uff09\u3002 \u5982\u679c\u53ef\u4ee5\uff0c\u7ed3\u679c\u5c31\u662f\u90a3\u4e2a\u6570\uff0c\u5426\u5219\u8f6c\u6362\u5931\u8d25\u3002\n\n\n\u4ece\u5b57\u7b26\u4e32\u5230\u6570\u5b57\u7684\u8f6c\u6362\u8fc7\u7a0b\u9075\u5faa\u4ee5\u4e0b\u6d41\u7a0b\uff1a \u9996\u5148\uff0c\u9075\u5faa\u6309 Lua \u8bcd\u6cd5\u5206\u6790\u5668\u7684\u89c4\u5219\u5206\u6790\u8bed\u6cd5\u6765\u8f6c\u6362\u4e3a\u5bf9\u5e94\u7684 \u6574\u6570\u6216\u6d6e\u70b9\u6570\u3002 \uff08\u5b57\u7b26\u4e32\u53ef\u4ee5\u6709\u524d\u7f6e\u6216\u540e\u7f6e\u7684\u7a7a\u683c\u4ee5\u53ca\u4e00\u4e2a\u7b26\u53f7\u3002\uff09 \u7136\u540e\uff0c\u7ed3\u679c\u6570\u5b57\u518d\u6309\u524d\u8ff0\u89c4\u5219\u8f6c\u6362\u4e3a\u6240\u9700\u8981\u7684\u7c7b\u578b\uff08\u6d6e\u70b9\u6216\u6574\u6570\uff09\u3002\n\n\n\u4ece\u6570\u5b57\u8f6c\u6362\u4e3a\u5b57\u7b26\u4e32\u4f7f\u7528\u975e\u6307\u5b9a\u7684\u4eba\u53ef\u8bfb\u7684\u683c\u5f0f\u3002 \u82e5\u60f3\u5b8c\u5168\u63a7\u5236\u6570\u5b57\u5230\u5b57\u7b26\u4e32\u7684\u8f6c\u6362\u8fc7\u7a0b\uff0c \u53ef\u4ee5\u4f7f\u7528\u5b57\u7b26\u4e32\u5e93\u4e2d\u7684 format \u51fd\u6570 \uff08\u53c2\u89c1 string.format\uff09\u3002\n\n\n3.2.9 \u6bd4\u8f83\u64cd\u4f5c\u7b26\n\n\nLua \u652f\u6301\u4e0b\u5217\u6bd4\u8f83\u64cd\u4f5c\u7b26\uff1a\n\n\n\n\n==: \u7b49\u4e8e\n\n\n~=: \u4e0d\u7b49\u4e8e\n\n\n: \u5c0f\u4e8e\n\n\n\n\n\n\n: \u5927\u4e8e\n\n\n\n\n\n\n=: \u5c0f\u4e8e\u7b49\u4e8e\n\n\n\n\n\n\n=: \u5927\u4e8e\u7b49\u4e8e\n\n\n\n\n\n\n\n\n\u8fd9\u4e9b\u64cd\u4f5c\u7684\u7ed3\u679c\u4e0d\u662f false \u5c31\u662f true\u3002\n\n\n\u7b49\u4e8e\u64cd\u4f5c \uff08==\uff09\u5148\u6bd4\u8f83\u64cd\u4f5c\u6570\u7684\u7c7b\u578b\u3002 \u5982\u679c\u7c7b\u578b\u4e0d\u540c\uff0c\u7ed3\u679c\u5c31\u662f false\u3002 \u5426\u5219\uff0c\u7ee7\u7eed\u6bd4\u8f83\u503c\u3002 \u5b57\u7b26\u4e32\u6309\u4e00\u822c\u7684\u65b9\u5f0f\u6bd4\u8f83\u3002 \u6570\u5b57\u9075\u5faa\u4e8c\u5143\u64cd\u4f5c\u7684\u89c4\u5219\uff1a \n\u5982\u679c\u4e24\u4e2a\u64cd\u4f5c\u6570\u90fd\u662f\u6574\u6570\uff0c \u5b83\u4eec\u6309\u6574\u6570\u6bd4\u8f83\uff1b \u5426\u5219\uff0c\u5b83\u4eec\u5148\u8f6c\u6362\u4e3a\u6d6e\u70b9\u6570\uff0c\u7136\u540e\u518d\u505a\u6bd4\u8f83\u3002\n\n\n\u8868\uff0c\u7528\u6237\u6570\u636e\uff0c\u4ee5\u53ca\u7ebf\u7a0b\u90fd\u6309\u5f15\u7528\u6bd4\u8f83\uff1a \u53ea\u6709\u4e24\u8005\u5f15\u7528\u540c\u4e00\u4e2a\u5bf9\u8c61\u65f6\u624d\u8ba4\u4e3a\u5b83\u4eec\u76f8\u7b49\u3002\n \u6bcf\u6b21\u4f60\u521b\u5efa\u4e00\u4e2a\u65b0\u5bf9\u8c61\uff08\u4e00\u5f20\u8868\uff0c\u4e00\u4e2a\u7528\u6237\u6570\u636e\uff0c\u6216\u4e00\u4e2a\u7ebf\u7a0b\uff09\uff0c \u65b0\u5bf9\u8c61\u90fd\u4e00\u5b9a\u548c\u5df2\u6709\u4e14\u5b58\u5728\u7684\u5bf9\u8c61\u4e0d\u540c\u3002 \u76f8\u540c\u5f15\u7528\u7684\u95ed\u5305\u4e00\u5b9a\u76f8\u7b49\u3002 \u6709\u4efb\u4f55\u53ef\u5bdf\u89c9\u7684\u5dee\u5f02\uff08\u4e0d\u540c\u7684\u884c\u4e3a\uff0c\u4e0d\u540c\u7684\u5b9a\u4e49\uff09\u4e00\u5b9a\u4e0d\u7b49\u3002\n\n\n\u4f60\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528 \"eq\" \u5143\u65b9\u6cd5\u6765\u6539\u53d8 Lua \u6bd4\u8f83\u8868\u548c\u7528\u6237\u6570\u636e\u65f6\u7684\u65b9\u5f0f\u3002\n\n\n\u7b49\u4e8e\u64cd\u4f5c\u4e0d\u4f1a\u5c06\u5b57\u7b26\u4e32\u8f6c\u6362\u4e3a\u6570\u5b57\uff0c\u53cd\u4e4b\u4ea6\u7136\u3002 \u5373\uff0c\"0\"==0 \u7ed3\u679c\u4e3a false\uff0c \u4e14 t[0] \u4e0e t[\"0\"] \u6307\u4ee3\u7740\u8868\u4e2d\u7684\u4e0d\u540c\u9879\u3002\n\n\n~= \u64cd\u4f5c\u5b8c\u5168\u7b49\u4ef7\u4e8e (==) \u64cd\u4f5c\u7684\u53cd\u503c\u3002\n\n\n\u5927\u5c0f\u6bd4\u8f83\u64cd\u4f5c\u4ee5\u4ee5\u4e0b\u65b9\u5f0f\u8fdb\u884c\u3002 \u5982\u679c\u53c2\u6570\u90fd\u662f\u6570\u5b57\uff0c \u5b83\u4eec\u6309\u4e8c\u5143\u64cd\u4f5c\u7684\u5e38\u89c4\u8fdb\u884c\u3002 \u5426\u5219\uff0c\u5982\u679c\u4e24\u4e2a\u53c2\u6570\u90fd\u662f\u5b57\u7b26\u4e32\uff0c \u5b83\u4eec\u7684\u503c\u6309\u5f53\u524d\u7684\u533a\u57df\u8bbe\u7f6e\u6765\u6bd4\u8f83\u3002 \u518d\u5219\uff0cLua \u5c31\u8bd5\u7740\u8c03\u7528 \"lt\" \u6216\u662f \"le\" \u5143\u65b9\u6cd5 \u3002 a \n b \u7684\u6bd4\u8f83\u88ab\u8f6c\u8bd1\u4e3a b \n a\uff0c a \n= b \u88ab\u8f6c\u8bd1\u4e3a b \n= a\u3002\n\n\n\u793a\u4f8b\u4ee3\u7801\uff1a\n\n\nprint(2 == 2.0) -- true\nprint(2 ~= 2.0) -- false\nprint(2 == \"2\") -- false\n\nlocal t1 = {}\nlocal t2 = {}\n\nlocal t3 = t1\nlocal t4 = t1\nlocal t5 = t2\n\nprint(t3 == t4) -- true\nprint(t3 == t5) -- false\n\n\n\n3.2.10 \u903b\u8f91\u64cd\u4f5c\u7b26\n\n\nLua \u4e2d\u7684\u903b\u8f91\u64cd\u4f5c\u7b26\u6709 and\uff0c or\uff0c\u4ee5\u53ca not\u3002 \u548c\u63a7\u5236\u7ed3\u6784\u4e00\u6837\uff0c \n\u6240\u6709\u7684\u903b\u8f91\u64cd\u4f5c\u7b26\u628a false \u548c nil \u90fd\u4f5c\u4e3a\u5047\uff0c \u800c\u5176\u5b83\u7684\u4e00\u5207\u90fd\u5f53\u4f5c\u771f\u3002\n\n\n\u53d6\u53cd\u64cd\u4f5c not \u603b\u662f\u8fd4\u56de false \u6216 true \u4e2d\u7684\u4e00\u4e2a\u3002 \u4e0e\u64cd\u4f5c\u7b26 and \u5728\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a false \u6216 nil \u65f6 \u8fd4\u56de\u8fd9\u7b2c\u4e00\u4e2a\u53c2\u6570\uff1b \u5426\u5219\uff0cand \u8fd4\u56de\u7b2c\u4e8c\u4e2a\u53c2\u6570\u3002 \u6216\u64cd\u4f5c\u7b26 or \u5728\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e0d\u4e3a nil \u4e5f\u4e0d\u4e3a false \u65f6\uff0c \u8fd4\u56de\u8fd9\u7b2c\u4e00\u4e2a\u53c2\u6570\uff0c\u5426\u5219\u8fd4\u56de\u7b2c\u4e8c\u4e2a\u53c2\u6570\u3002 \nand \u548c or \u90fd\u9075\u5faa\u77ed\u8def\u89c4\u5219\uff1b \u4e5f\u5c31\u662f\u8bf4\uff0c\u7b2c\u4e8c\u4e2a\u64cd\u4f5c\u6570\u53ea\u5728\u9700\u8981\u7684\u65f6\u5019\u53bb\u6c42\u503c\u3002\n \u8fd9\u91cc\u6709\u4e00\u4e9b\u4f8b\u5b50\uff1a\n\n\n 10 or 20            -- 10\n 10 or error()       -- 10\n nil or \"a\"          -- \"a\"\n nil and 10          -- nil\n false and error()   -- false\n false and nil       -- false\n false or nil        -- nil\n 10 and 20           -- 20\n\n\n\n3.2.11 \u5b57\u7b26\u4e32\u8fde\u63a5\n\n\nLua \u4e2d\u5b57\u7b26\u4e32\u7684\u8fde\u63a5\u64cd\u4f5c\u7b26\u5199\u4f5c\u4e24\u4e2a\u70b9\uff08'..'\uff09\u3002 \u5982\u679c\u4e24\u4e2a\u64cd\u4f5c\u6570\u90fd\u662f\u5b57\u7b26\u4e32\u6216\u90fd\u662f\u6570\u5b57\uff0c \u8fde\u63a5\u64cd\u4f5c\u5c06\u5176\u8f6c\u6362\u4e3a\u5b57\u7b26\u4e32\u3002 \u5426\u5219\uff0c\u4f1a\u8c03\u7528\u5143\u65b9\u6cd5 __concat\u3002\n\n\n\u793a\u4f8b\u4ee3\u7801\uff1a\n\n\nprint(\"hello\"..\"lua\") -- hellolua\n\n\n\n3.2.12 \u53d6\u957f\u5ea6\u64cd\u4f5c\u7b26\n\n\n\u53d6\u957f\u5ea6\u64cd\u4f5c\u7b26\u5199\u4f5c\n\u4e00\u5143\u524d\u7f6e\u7b26 #\n\u3002 \u5b57\u7b26\u4e32\u7684\u957f\u5ea6\u662f\u5b83\u7684\u5b57\u8282\u6570\uff08\u5c31\u662f\u4ee5\u4e00\u4e2a\u5b57\u7b26\u4e00\u4e2a\u5b57\u8282\u8ba1\u7b97\u7684\u5b57\u7b26\u4e32\u957f\u5ea6\uff09\u3002\n\n\n\u7a0b\u5e8f\u53ef\u4ee5\u901a\u8fc7 \n__len \u5143\u65b9\u6cd5\n\u6765\u4fee\u6539\u5bf9\u5b57\u7b26\u4e32\u7c7b\u578b\u5916\u7684\u4efb\u4f55\u503c\u7684\u53d6\u957f\u5ea6\u64cd\u4f5c\u884c\u4e3a\u3002\n\n\n\u793a\u4f8b\u4ee3\u7801\uff1a\n\n\nlocal tb = {1, 2, 3}\n\nprint(#\"hello\") -- 5\nprint(#tb)      -- 3\n\n\n\n3.2.13 \u4f18\u5148\u7ea7\n\n\nLua \u4e2d\u64cd\u4f5c\u7b26\u7684\u4f18\u5148\u7ea7\u5199\u5728\u4e0b\u8868\u4e2d\uff0c\u4ece\u4f4e\u5230\u9ad8\u4f18\u5148\u7ea7\u6392\u5e8f\uff1a\n\n\n or\n and\n \n     \n     \n=    \n=    ~=    ==\n |\n ~\n \n\n \n    \n\n ..\n +     -\n *     /     //    %\n unary operators (not   #     -     ~)\n ^\n\n\n\n\u901a\u5e38\uff0c \u4f60\u53ef\u4ee5\u7528\u62ec\u53f7\u6765\u6539\u53d8\u8fd0\u7b97\u6b21\u5e8f\u3002 \u8fde\u63a5\u64cd\u4f5c\u7b26 ('..') \u548c\u4e58\u65b9\u64cd\u4f5c ('^') \u662f\u4ece\u53f3\u81f3\u5de6\u7684\u3002 \u5176\u5b83\u6240\u6709\u7684\u64cd\u4f5c\u90fd\u662f\u4ece\u5de6\u81f3\u53f3\u3002\n\n\n3.2.14 \u53ef\u89c1\u6027\u89c4\u5219\n\n\nLua \u8bed\u8a00\u6709\u8bcd\u6cd5\u4f5c\u7528\u8303\u56f4\u3002 \u53d8\u91cf\u7684\u4f5c\u7528\u8303\u56f4\u5f00\u59cb\u4e8e\u58f0\u660e\u5b83\u4eec\u4e4b\u540e\u7684\u7b2c\u4e00\u4e2a\u8bed\u53e5\u6bb5\uff0c \u7ed3\u675f\u4e8e\u5305\u542b\u8fd9\u4e2a\u58f0\u660e\u7684\u6700\u5185\u5c42\u8bed\u53e5\u5757\u7684\u6700\u540e\u4e00\u4e2a\u975e\u7a7a\u8bed\u53e5\u3002 \u770b\u4e0b\u9762\u8fd9\u4e9b\u4f8b\u5b50\uff1a\n\n\nx = 10                -- \u5168\u5c40\u53d8\u91cf\ndo                    -- \u65b0\u7684\u8bed\u53e5\u5757\n    local x = x       -- \u65b0\u7684\u4e00\u4e2a 'x', \u5b83\u7684\u503c\u73b0\u5728\u662f 10\n    print(x)          -- 10\n    x = x+1\n\n    do                -- \u53e6\u4e00\u4e2a\u8bed\u53e5\u5757\n     local x = x+1    -- \u53c8\u4e00\u4e2a 'x'\n     print(x)         -- 12\n    end\n    print(x)          -- 11\nend\nprint(x)              -- 10 \uff08\u53d6\u5230\u7684\u662f\u5168\u5c40\u7684\u90a3\u4e00\u4e2a\uff09\n\n\n\n\u6ce8\u610f\u8fd9\u91cc\uff0c\u7c7b\u4f3c local x = x \u8fd9\u6837\u7684\u58f0\u660e\uff0c \u65b0\u7684 x \u6b63\u5728\u88ab\u58f0\u660e\uff0c\u4f46\u662f\u8fd8\u6ca1\u6709\u8fdb\u5165\u5b83\u7684\u4f5c\u7528\u8303\u56f4\uff0c \u6240\u4ee5\u7b2c\u4e8c\u4e2a x \u6307\u5411\u7684\u662f\u5916\u9762\u4e00\u5c42\u7684\u53d8\u91cf\u3002\n\n\n\u56e0\u4e3a\u6709\u8fd9\u6837\u4e00\u4e2a\u8bcd\u6cd5\u4f5c\u7528\u8303\u56f4\u7684\u89c4\u5219\uff0c \u5c40\u90e8\u53d8\u91cf\u53ef\u4ee5\u88ab\u5728\u5b83\u7684\u4f5c\u7528\u8303\u56f4\u5185\u5b9a\u4e49\u7684\u51fd\u6570\u81ea\u7531\u4f7f\u7528\u3002 \n\u5f53\u4e00\u4e2a\u5c40\u90e8\u53d8\u91cf\u88ab\u5185\u5c42\u7684\u51fd\u6570\u4e2d\u4f7f\u7528\u7684\u65f6\u5019\uff0c \u5b83\u88ab\u5185\u5c42\u51fd\u6570\u79f0\u4f5c \u4e0a\u503c\uff0c\u6216\u662f \u5916\u90e8\u5c40\u90e8\u53d8\u91cf\u3002\n\n\n3.3 \u95ed\u5305\n\n\n\u95ed\u5305\u662f\u7531\u51fd\u6570\u548c\u4e0e\u5176\u76f8\u5173\u7684\u5f15\u7528\u73af\u5883\u7ec4\u5408\u800c\u6210\u7684\u5b9e\u4f53\uff0c\n\u95ed\u5305=\u51fd\u6570+\u5f15\u7528\u73af\u5883\u3002\n\n\n\u793a\u4f8b1\uff1a\n\n\nfunction newCounter()\n     local i = 0\n     return function ()  \n          i = i + 1     \n          return i \n     end\nend\n\nc1 = newCounter()\nc2 = newCounter()\n\nprint(c1()) -- 1\nprint(c1()) -- 2\nprint(c1()) -- 3\nprint(c2()) -- 1\nprint(c2()) -- 2\n\n\n\n\u4e0a\u8ff0\u4ee3\u7801\u4e2d\u7684newCounter\u51fd\u6570\u8fd4\u56de\u4e86\u4e00\u4e2a\u51fd\u6570\uff0c\u800c\u8fd9\u4e2a\u8fd4\u56de\u7684\u533f\u540d\u51fd\u6570\u5c31\u662f\u95ed\u5305\u7684\u7ec4\u6210\u90e8\u5206\u4e2d\u7684\u51fd\u6570\uff1b\u5f15\u7528\u73af\u5883\u5c31\u662f\u53d8\u91cfi\u6240\u5728\u7684\u73af\u5883\u3002\u5b9e\u9645\u4e0a\uff0c\u95ed\u5305\u53ea\u662f\u5728\u5f62\u5f0f\u548c\u8868\u73b0\u4e0a\u50cf\u51fd\u6570\uff0c\u4f46\u5b9e\u9645\u4e0a\u4e0d\u662f\u51fd\u6570\uff0c\u6211\u4eec\u90fd\u77e5\u9053\uff0c\u51fd\u6570\u5c31\u662f\u4e00\u4e9b\u53ef\u6267\u884c\u8bed\u53e5\u7684\u7ec4\u5408\u4f53\uff0c\u8fd9\u4e9b\u4ee3\u7801\u8bed\u53e5\u5728\u51fd\u6570\u88ab\u5b9a\u4e49\u540e\u5c31\u786e\u5b9a\u4e86\uff0c\u5e76\u4e0d\u4f1a\u518d\u6267\u884c\u65f6\u53d1\u751f\u53d8\u5316\uff0c\u6240\u4ee5\u51fd\u6570\u53ea\u6709\u4e00\u4e2a\u5b9e\u4f8b\u3002\n\u800c\u95ed\u5305\u5728\u8fd0\u884c\u65f6\u53ef\u4ee5\u6709\u591a\u4e2a\u5b9e\u4f8b\uff0c\n\u4e0d\u540c\u7684\u5f15\u7528\u73af\u5883\u548c\u76f8\u540c\u7684\u51fd\u6570\u7ec4\u5408\u53ef\u4ee5\u4ea7\u751f\u4e0d\u540c\u7684\u5b9e\u4f8b\uff0c\u5c31\u597d\u6bd4\u76f8\u540c\u7684\u7c7b\u4ee3\u7801\uff0c\u53ef\u4ee5\u521b\u5efa\u4e0d\u540c\u7684\u7c7b\u5b9e\u4f8b\u4e00\u6837\u3002\n\n\n\u793a\u4f8b2\uff1a\n\n\nfunction Fun1()\n     local iVal = 10          -- upvalue\n\n     function InnerFunc1()     \n          print(iVal)           \n     end\n     function InnerFunc2()   \n          iVal = iVal + 10\n     end\n\n     return InnerFunc1, InnerFunc2\nend\n\n\nlocal a, b = Fun1()\n\na()   -- 10\nb()   -- \u5728b\u51fd\u6570\u4e2d\u4fee\u6539\u4e86upvalue iVal\na()   -- 20\n\n\n\n\u4e0a\u8ff0\u8fd9\u6bb5\u7b80\u5355\u7684\u4ee3\u7801\uff0c\u5c31\u9a8c\u8bc1\u4e86\u5728\n\u5185\u5d4c\u51fd\u6570\u4e2d\u662f\u5171\u4eabupvalue\u7684\n\uff0c\u5c31\u597d\u6bd4C++\u7c7b\u4e2d\u7684\u6210\u5458\u51fd\u6570\u53ef\u4ee5\u8bbf\u95ee\u548c\u4fee\u6539\u6210\u5458\u53d8\u91cf\u4e00\u6837\u3002\n\n\n3.4 lua : \u5192\u53f7\u6807\u8bc6\u7b26\u7528\u6cd5\n\n\nlua \u9762\u5bf9\u5bf9\u8c61\u7684\u5217\u5b50\n\n\n\u793a\u4f8b1\uff1a\n\n\nAccount = { balance = 0 }\nfunction Account.withDraw(self, v)\n     self.balance = self.balance - v\nend\n\na = Account\n\na.withDraw(a, 100) -- 0 - 100 = -100\nprint(a.balance) -- -100\n\n\n\n\u4f7f\u7528self\u53c2\u6570\u662f\u6240\u6709\u9762\u5411\u5bf9\u8c61\u8bed\u8a00\u7684\u4e00\u4e2a\u6838\u5fc3\u3002\u5927\u591a\u6570\u9762\u5411\u5bf9\u8c61\u8bed\u8a00\u90fd\u5bf9\u7a0b\u5e8f\u5458\u9690\u85cf\u4e86self\u53c2\u6570\uff0c\u4ece\u800c\u4f7f\u5f97\u7a0b\u5e8f\u5458\u4e0d\u5fc5\u663e\u793a\u5730\u58f0\u660e\u8fd9\u4e2a\u53c2\u6570\u3002Lua \u4e5f\u53ef\u4ee5\uff0c\u5f53\u6211\u4eec\u5728\u5b9a\u4e49\u51fd\u6570\u65f6\uff0c\u4f7f\u7528\u4e86\u5192\u53f7\uff0c\u5219\u80fd\u9690\u85cf\u8be5\u53c2\u6570\uff0c\u90a3\u4e48\u4e0a\u8ff0\u4ee3\u7801\u4f7f\u7528\u5192\u53f7\u6765\u6539\u4e0b\uff0c\u5c31\u662f\u4e0b\u9762\u8fd9\u4e2a\u6837\u5b50\u4e86\u3002\n\n\n\u793a\u4f8b2\uff1a\n\n\nAccount = {balance = 0}\nfunction Account:withDraw(v) -- \u6ce8\u610f\u8fd9\u91cc\u7684\u5192\u53f7\":\"\n     self.balance = self.balance - v\nend\n\na = Account\n\na:withDraw(100) -- \u6ce8\u610f\u8fd9\u91cc\u7684\u8c03\u7528\u65f6\uff0c\u4e5f\u9700\u8981\u5192\u53f7\":\"\nprint(a.balance)\n\n\n\n3.5 lua :: \u6807\u8bc6\u7b26\u7528\u6cd5\n\n\n::\u7528\u6765\u6807\u8bc6 goto \u7684lable\n\n\nLua\u652f\u6301goto\u8bed\u6cd5, \u4f46\u662f\u6709\u4e00\u5b9a\u7684\u5c40\u9650\u6027.\n\n\n\n\n\u4e0d\u80fd\u5728block\u5916\u9762\u8df3\u5165block(\u56e0\u4e3ablock\u4e2d\u7684lable\u4e0d\u53ef\u89c1), \n\n\n\u4e0d\u80fd\u8df3\u51fa\u6216\u8005\u8df3\u5165\u4e00\u4e2a\u51fd\u6570. \n\n\n\u4e0d\u80fd\u8df3\u5165\u672c\u5730\u53d8\u91cf\u7684\u4f5c\u7528\u57df.\n\n\n\n\ngoto \u6a21\u62df continue \u7684\u793a\u4f8b\uff1a\n\n\ni = 0\nwhile i\n10 do\n  i = i+1\n  if i%2 == 1 then \n    goto continue \n  else \n    print(i)\n  end\n  ::continue::\nend\n\n\n\n3.6 lua \u51fd\u6570\u53ef\u53d8\u53c2\u6570\n\n\nfunction funcList.CRC_MODBUS(...)\n    local str = \"\"\n    for k, v in ipairs({...}) do\n        str = str..v\n    end\n    print(\"func args: \"..str)\nend", 
            "title": "03"
        }, 
        {
            "location": "/luamd/03/#31", 
            "text": "Lua \u8bed\u8a00\u7684\u683c\u5f0f\u81ea\u7531\u3002 \u5b83\u4f1a \u5ffd\u7565\u8bed\u6cd5\u5143\u7d20\uff08\u7b26\u8bb0\uff09\u95f4\u7684\u7a7a\u683c\uff08\u5305\u62ec\u6362\u884c\uff09\u548c\u6ce8\u91ca \uff0c \u4ec5\u628a\u5b83\u4eec\u770b\u4f5c\u4e3a\u540d\u5b57\u548c\u5173\u952e\u5b57\u95f4\u7684\u5206\u5272\u7b26\u3002  Lua \u4e2d\u7684 \u540d\u5b57 \uff08\u4e5f\u88ab\u79f0\u4e3a \u6807\u8bc6\u7b26\uff09 \u53ef\u4ee5\u662f\u7531\u975e\u6570\u5b57\u6253\u5934\u7684\u4efb\u610f\u5b57\u6bcd\u4e0b\u5212\u7ebf\u548c\u6570\u5b57\u6784\u6210\u7684\u5b57\u7b26\u4e32\u3002 \u6807\u8bc6\u7b26\u53ef\u7528\u4e8e\u5bf9\u53d8\u91cf\u3001\u8868\u7684\u57df\u3001\u4ee5\u53ca\u6807\u7b7e\u547d\u540d\u3002  \u4e0b\u5217\u5173\u952e\u5b57\u662f\u4fdd\u7559\u7684\uff0c\u4e0d\u53ef\u7528\u4e8e\u540d\u5b57\uff1a  and       break     do        else      elseif    end\nfalse     for       function  goto      if        in\nlocal     nil       not       or        repeat    return\nthen      true      until     while  Lua \u8bed\u8a00\u5bf9 \u5927\u5c0f\u5199\u654f\u611f \uff1a and \u662f\u4e00\u4e2a\u4fdd\u7559\u5b57\uff0c\u4f46 And \u4e0e AND \u5219\u662f\u4e24\u4e2a\u4e0d\u540c\u7684\u6709\u6548\u540d\u5b57\u3002  \u4f5c\u4e3a\u4e00\u4e2a\u7ea6\u5b9a\uff0c\u7a0b\u5e8f\u5e94\u907f\u514d\u521b\u5efa\u4ee5\u4e0b\u5212\u7ebf\u52a0\u4e00\u4e2a\u6216\u591a\u4e2a\u5927\u5199\u5b57\u6bcd\u6784\u6210\u7684\u540d\u5b57 \uff08\u4f8b\u5982 _VERSION\uff09\u3002  \u4e0b\u5217\u5b57\u7b26\u4e32\u662f\u53e6\u5916\u4e00\u4e9b\u7b26\u8bb0\uff1a   +     -     *     /     %     ^     #\n       ~     |               //\n ==    ~=     =     =                =\n (     )     {     }     [     ]     ::\n ;     :     ,     .     ..    ...  \u5b57\u9762\u4e32\u53ef\u4ee5\u7528\u5355\u5f15\u53f7\u6216\u53cc\u5f15\u53f7\u62ec\u8d77\u3002  \u5b57\u9762\u4e32\u5185\u90e8\u53ef\u4ee5\u5305\u542b\u4e0b\u5217 C \u98ce\u683c\u7684\u8f6c\u4e49\u4e32\uff1a '\\a' \uff08\u54cd\u94c3\uff09\uff0c '\\b' \uff08\u9000\u683c\uff09\uff0c '\\f' \uff08\u6362\u9875\uff09\uff0c '\\n' \uff08\u6362\u884c\uff09\uff0c '\\r' \uff08\u56de\u8f66\uff09\uff0c '\\t' \uff08\u6a2a\u9879\u5236\u8868\uff09\uff0c '\\v' \uff08\u7eb5\u5411\u5236\u8868\uff09\uff0c '\\' \uff08\u53cd\u659c\u6760\uff09\uff0c '\\\"' \uff08\u53cc\u5f15\u53f7\uff09\uff0c \u4ee5\u53ca '\\'' (\u5355\u5f15\u53f7)\u3002 \u5728\u53cd\u659c\u6760\u540e\u8ddf\u4e00\u4e2a\u771f\u6b63\u7684\u6362\u884c\u7b49\u4ef7\u4e8e\u5728\u5b57\u7b26\u4e32\u4e2d\u5199\u4e00\u4e2a\u6362\u884c\u7b26\u3002 \u8f6c\u4e49\u4e32 '\\z' \u4f1a\u5ffd\u7565\u5176\u540e\u7684\u4e00\u7cfb\u5217\u7a7a\u767d\u7b26\uff0c\u5305\u62ec\u6362\u884c\uff1b \u5b83\u5728\u4f60\u9700\u8981\u5bf9\u4e00\u4e2a\u5f88\u957f\u7684\u5b57\u7b26\u4e32\u5e38\u91cf\u65ad\u884c\u4e3a\u591a\u884c\u5e76\u5e0c\u671b\u5728\u6bcf\u4e2a\u65b0\u884c\u4fdd\u6301\u7f29\u8fdb\u65f6\u975e\u5e38\u6709\u7528\u3002  Lua \u4e2d\u7684\u5b57\u7b26\u4e32\u53ef\u4ee5\u4fdd\u5b58 \u4efb\u610f 8 \u4f4d\u503c \uff0c\u5176\u4e2d\u5305\u62ec\u7528  '\\0' \u8868\u793a\u7684 0  \u3002 \u4e00\u822c\u800c\u8a00\uff0c\u4f60\u53ef\u4ee5\u7528\u5b57\u7b26\u7684\u6570\u5b57\u503c\u6765\u8868\u793a\u8fd9\u4e2a\u5b57\u7b26\u3002 \u65b9\u5f0f\u662f\u7528\u8f6c\u4e49\u4e32 \\xXX\uff0c \u6b64\u5904\u7684 XX \u5fc5\u987b\u662f\u6070\u597d\u4e24\u4e2a\u5b57\u7b26\u7684 16 \u8fdb\u5236\u6570\u3002 \u6216\u8005\u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528\u8f6c\u4e49\u4e32 \\ddd \uff0c \u8fd9\u91cc\u7684 ddd \u662f\u4e00\u5230\u4e09\u4e2a\u5341\u8fdb\u5236\u6570\u5b57\u3002 \uff08\u6ce8\u610f\uff0c\u5982\u679c\u5728\u8f6c\u4e49\u7b26\u540e\u63a5\u7740\u6070\u5de7\u662f\u4e00\u4e2a\u6570\u5b57\u7b26\u53f7\u7684\u8bdd\uff0c \u4f60\u5c31\u5fc5\u987b\u5728\u8fd9\u4e2a\u8f6c\u4e49\u5f62\u5f0f\u4e2d\u5199\u6ee1\u4e09\u4e2a\u6570\u5b57\u3002\uff09  \u5bf9\u4e8e\u7528 UTF-8 \u7f16\u7801\u7684 Unicode \u5b57\u7b26\uff0c\u4f60\u53ef\u4ee5\u7528 \u8f6c\u4e49\u7b26 \\u{XXX} \u6765\u8868\u793a \uff08\u8fd9\u91cc\u5fc5\u987b\u6709\u4e00\u5bf9\u82b1\u62ec\u53f7\uff09\uff0c \u6b64\u5904\u7684 XXX \u662f\u7528 16 \u8fdb\u5236\u8868\u793a\u7684\u5b57\u7b26\u7f16\u53f7\u3002  \u6570\u5b57\u5e38\u91cf \uff08\u6216\u79f0\u4e3a \u6570\u5b57\u91cf\uff09 \u53ef\u4ee5\u7531\u53ef\u9009\u7684\u5c0f\u6570\u90e8\u5206\u548c\u53ef\u9009\u7684\u5341\u4e3a\u5e95\u7684\u6307\u6570\u90e8\u5206\u6784\u6210\uff0c  \u6307\u6570\u90e8\u5206\u7528\u5b57\u7b26 'e' \u6216 'E' \u6765\u6807\u8bb0 \u3002 Lua \u4e5f\u63a5\u53d7\u4ee5 0x \u6216 0X \u5f00\u5934\u7684 16 \u8fdb\u5236\u5e38\u91cf\u3002 16 \u8fdb\u5236\u5e38\u91cf\u4e5f\u63a5\u53d7\u5c0f\u6570\u52a0\u6307\u6570\u90e8\u5206\u7684\u5f62\u5f0f\uff0c\u6307\u6570\u90e8\u5206\u662f\u4ee5\u4e8c\u4e3a\u5e95\uff0c \u7528\u5b57\u7b26 'p' \u6216 'P' \u6765\u6807\u8bb0\u3002  \u6570\u5b57\u5e38\u91cf\u4e2d\u5305\u542b\u5c0f\u6570\u70b9\u6216\u6307\u6570\u90e8\u5206\u65f6\uff0c\u88ab\u8ba4\u4e3a\u662f\u4e00\u4e2a\u6d6e\u70b9\u6570\uff1b \u5426\u5219\u88ab\u8ba4\u4e3a\u662f\u4e00\u4e2a\u6574\u6570\u3002  \u4e0b\u9762\u6709\u4e00\u4e9b\u5408\u6cd5\u7684\u6574\u6570\u5e38\u91cf\u7684\u4f8b\u5b50\uff1a  3   345   0xff   0xBEBADA  \u4ee5\u4e0b\u4e3a\u5408\u6cd5\u7684\u6d6e\u70b9\u5e38\u91cf\uff1a  3.0     3.1416     314.16e-2     0.31416E1     34e1\n0x0.1E  0xA23p-4   0X1.921FB54442D18P+1  \u5728\u5b57\u7b26\u4e32\u5916\u7684\u4efb\u4f55\u5730\u65b9\u51fa\u73b0\u4ee5\u53cc\u6a2a\u7ebf  (--)  \u5f00\u5934\u7684\u90e8\u5206\u662f  \u6ce8\u91ca  \u3002 \u5982\u679c -- \u540e\u6ca1\u6709\u7d27\u8ddf\u7740\u4e00\u4e2a\u5f00\u5927\u62ec\u53f7\uff0c \u8be5\u6ce8\u91ca\u4e3a \u77ed\u6ce8\u91ca\uff0c \u6ce8\u91ca\u5230\u5f53\u524d\u884c\u672b\u622a\u81f3\u3002 \u5426\u5219\uff0c\u8fd9\u662f\u4e00\u6bb5  \u957f\u6ce8\u91ca(--[[  ]])  \uff0c \u6ce8\u91ca\u533a\u4e00\u76f4\u7ef4\u6301\u5230\u5bf9\u5e94\u7684\u95ed\u957f\u62ec\u53f7\u3002 \u957f\u6ce8\u91ca\u901a\u5e38\u7528\u4e8e\u4e34\u65f6\u5c4f\u853d\u6389\u4e00\u5927\u6bb5\u4ee3\u7801\u3002  \u793a\u4f8b\u4ee3\u7801\uff1a  print(\"hello\") -- hello\n\n--[[\n\nlocal i = 1\ni = i + 1\nprint(i)\n\n]]", 
            "title": "3.1 \u8bcd\u6cd5\u7ea6\u5b9a"
        }, 
        {
            "location": "/luamd/03/#32", 
            "text": "\u53d8\u91cf\u662f\u50a8\u5b58\u503c\u7684\u5730\u65b9\u3002 Lua \u4e2d\u6709\u4e09\u79cd\u53d8\u91cf\uff1a \u5168\u5c40\u53d8\u91cf\u3001\u5c40\u90e8\u53d8\u91cf\u548c\u8868\u7684\u57df\u3002  \u5355\u4e2a\u540d\u5b57\u53ef\u4ee5\u6307\u4ee3\u4e00\u4e2a\u5168\u5c40\u53d8\u91cf\u4e5f\u53ef\u4ee5\u6307\u4ee3\u4e00\u4e2a\u5c40\u90e8\u53d8\u91cf \uff08\u6216\u8005\u662f\u4e00\u4e2a\u51fd\u6570\u7684\u5f62\u53c2\uff0c\u8fd9\u662f\u4e00\u79cd\u7279\u6b8a\u5f62\u5f0f\u7684\u5c40\u90e8\u53d8\u91cf\uff09\u3002  var ::= Name  \u6240\u6709\u6ca1\u6709\u663e\u5f0f\u58f0\u660e\u4e3a\u5c40\u90e8\u53d8\u91cf(local)\u7684\u53d8\u91cf\u540d\u90fd\u88ab\u5f53\u505a\u5168\u5c40\u53d8\u91cf\u3002  \u5c40\u90e8\u53d8\u91cf\u6709\u5176\u4f5c\u7528\u8303\u56f4 \uff1a \u5c40\u90e8\u53d8\u91cf\u53ef\u4ee5\u88ab\u5b9a\u4e49\u5728\u5b83\u4f5c\u7528\u8303\u56f4\u4e2d\u7684\u51fd\u6570\u81ea\u7531\u4f7f\u7528\uff09\u3002 \n\u5728\u53d8\u91cf\u7684\u9996\u6b21\u8d4b\u503c\u4e4b\u524d\uff0c\u53d8\u91cf\u7684\u503c\u5747\u4e3a nil\u3002  \u65b9\u62ec\u53f7\u88ab\u7528\u6765\u5bf9\u8868\u4f5c\u7d22\u5f15\uff1a  var ::= prefixexp \u2018[\u2019 exp \u2018]\u2019  var.Name \u8fd9\u79cd\u8bed\u6cd5\u53ea\u662f\u4e00\u4e2a\u8bed\u6cd5\u7cd6\uff0c\u7528\u6765\u8868\u793a var[\"Name\"]\uff1a  var ::= prefixexp \u2018.\u2019 Name  \u5c40\u90e8\u53d8\u91cf\u53ef\u4ee5\u5728\u8bed\u53e5\u5757\u4e2d\u4efb\u4f55\u5730\u65b9\u58f0\u660e\u3002  \u58f0\u660e\u53ef\u4ee5\u5305\u542b\u4e00\u4e2a\u521d\u59cb\u5316\u8d4b\u503c\u64cd\u4f5c\uff1a  stat ::= local namelist [\u2018=\u2019 explist]  \u5982\u679c\u6709\u521d\u59cb\u5316\u503c\u7684\u8bdd\uff0c\u521d\u59cb\u5316\u8d4b\u503c\u64cd\u4f5c\u7684\u8bed\u6cd5\u548c\u8d4b\u503c\u64cd\u4f5c\u4e00\u81f4\u3002 \u82e5\u6ca1\u6709\u521d\u59cb\u5316\u503c\uff0c\u6240\u6709\u7684\u53d8\u91cf\u90fd\u88ab\u521d\u59cb\u5316\u4e3a nil\u3002", 
            "title": "3.2 \u53d8\u91cf"
        }, 
        {
            "location": "/luamd/03/#32_1", 
            "text": "Lua \u652f\u6301\u6240\u6709\u4e0e Pascal \u6216\u662f C \u7c7b\u4f3c\u7684\u5e38\u89c1\u5f62\u5f0f\u7684\u8bed\u53e5\uff0c \u8fd9\u4e2a\u96c6\u5408\u5305\u62ec\u8d4b\u503c\uff0c\u63a7\u5236\u7ed3\u6784\uff0c\u51fd\u6570\u8c03\u7528\uff0c\u8fd8\u6709\u53d8\u91cf\u58f0\u660e\u3002  3.2.1 \u4ee3\u7801\u5757  Lua \u7684\u4e00\u4e2a\u7f16\u8bd1\u5355\u5143\u88ab\u79f0\u4e3a\u4e00\u4e2a \u4ee3\u7801\u5757\u3002 \u4ece\u53e5\u6cd5\u6784\u6210\u4e0a\u8bb2\uff0c\u4e00\u4e2a\u4ee3\u7801\u5757\u5c31\u662f\u4e00\u4e2a\u8bed\u53e5\u5757\u3002  chunk ::= block  Lua \u628a\u4e00\u4e2a\u4ee3\u7801\u5757\u5f53\u4f5c\u4e00\u4e2a\u62e5\u6709\u4e0d\u5b9a\u53c2\u6570\u7684\u533f\u540d\u51fd\u6570\u6765\u5904\u7406\u3002 \u6b63\u662f\u8fd9\u6837\uff0c\u4ee3\u7801\u5757\u5185\u53ef\u4ee5\u5b9a\u4e49\u5c40\u90e8\u53d8\u91cf\uff0c\u5b83\u53ef\u4ee5\u63a5\u6536\u53c2\u6570\uff0c\u8fd4\u56de\u82e5\u5e72\u503c\u3002 \u6b64\u5916\uff0c\u8fd9\u4e2a\u533f\u540d\u51fd\u6570\u5728\u7f16\u8bd1\u65f6\u8fd8\u4e3a\u5b83\u7684\u4f5c\u7528\u57df\u7ed1\u5b9a\u4e86\u4e00\u4e2a\u5916\u90e8\u5c40\u90e8\u53d8\u91cf _ENV\u3002 \u8be5\u51fd\u6570\u603b\u662f\u628a _ENV \u4f5c\u4e3a\u5b83\u552f\u4e00\u7684\u4e00\u4e2a\u4e0a\u503c\uff0c \u5373\u4f7f\u8fd9\u4e2a\u51fd\u6570\u4e0d\u4f7f\u7528\u8fd9\u4e2a\u53d8\u91cf\uff0c\u5b83\u4e5f\u5b58\u5728\u3002  \u4ee3\u7801\u5757\u53ef\u4ee5\u88ab\u4fdd\u5b58\u5728\u6587\u4ef6\u4e2d\uff0c\u4e5f\u53ef\u4ee5\u4f5c\u4e3a\u5bbf\u4e3b\u7a0b\u5e8f\u5185\u90e8\u7684\u4e00\u4e2a\u5b57\u7b26\u4e32\u3002 \u8981\u6267\u884c\u4e00\u4e2a\u4ee3\u7801\u5757\uff0c \u9996\u5148\u8981\u8ba9 Lua \u52a0\u8f7d \u5b83\uff0c \u5c06\u4ee3\u7801\u5757\u4e2d\u7684\u4ee3\u7801\u9884\u7f16\u8bd1\u6210\u865a\u62df\u673a\u4e2d\u7684\u6307\u4ee4\uff0c \u800c\u540e\uff0cLua \u7528\u865a\u62df\u673a\u89e3\u91ca\u5668\u6765\u8fd0\u884c\u7f16\u8bd1\u540e\u7684\u4ee3\u7801\u3002  \u4ee3\u7801\u5757\u53ef\u4ee5\u88ab\u9884\u7f16\u8bd1\u4e3a\u4e8c\u8fdb\u5236\u5f62\u5f0f\uff1b \u53c2\u89c1\u7a0b\u5e8f luac \u4ee5\u53ca\u51fd\u6570 string.dump \u53ef\u83b7\u5f97\u66f4\u591a\u7ec6\u8282\u3002 \u7528\u6e90\u7801\u8868\u793a\u7684\u7a0b\u5e8f\u548c\u7f16\u8bd1\u540e\u7684\u5f62\u5f0f\u53ef\u81ea\u7531\u66ff\u6362\uff1b Lua \u4f1a\u81ea\u52a8\u68c0\u6d4b\u6587\u4ef6\u683c\u5f0f\u505a\u76f8\u5e94\u7684\u5904\u7406 \uff08\u53c2\u89c1 load\uff09\u3002  3.2.2 \u8d4b\u503c  Lua \u5141\u8bb8\u591a\u91cd\u8d4b\u503c\u3002 \u56e0\u6b64\uff0c\u8d4b\u503c\u7684\u8bed\u6cd5\u5b9a\u4e49\u662f\u7b49\u53f7\u5de6\u8fb9\u653e\u4e00\u4e2a\u53d8\u91cf\u5217\u8868\uff0c \u800c\u7b49\u53f7\u53f3\u8fb9\u653e\u4e00\u4e2a\u8868\u8fbe\u5f0f\u5217\u8868\u3002  \u4e24\u8fb9\u7684\u5217\u8868\u4e2d\u7684\u5143\u7d20\u90fd\u7528\u9017\u53f7\u95f4\u5f00\uff1a\n\u5728\u4f5c\u8d4b\u503c\u64cd\u4f5c\u4e4b\u524d\uff0c \u90a3\u503c\u5217\u8868\u4f1a\u88ab \u8c03\u6574 \u4e3a\u5de6\u8fb9\u53d8\u91cf\u5217\u8868\u7684\u4e2a\u6570\u3002 \u5982\u679c\u503c\u6bd4\u9700\u8981\u7684\u66f4\u591a\u7684\u8bdd\uff0c \u591a\u4f59\u7684\u503c\u5c31\u88ab\u6254\u6389\u3002   \u5982\u679c\u503c\u7684\u6570\u91cf\u4e0d\u591f\u9700\u6c42\uff0c \u5c06\u4f1a\u6309\u6240\u9700\u6269\u5c55\u82e5\u5e72\u4e2a nil\u3002  \u5982\u679c\u8868\u8fbe\u5f0f\u5217\u8868\u4ee5\u4e00\u4e2a\u51fd\u6570\u8c03\u7528\u7ed3\u675f\uff0c \u8fd9\u4e2a\u51fd\u6570\u6240\u8fd4\u56de\u7684\u6240\u6709\u503c\u90fd\u4f1a\u5728\u8c03\u6574\u64cd\u4f5c\u4e4b\u524d\u88ab\u7f6e\u5165\u503c\u5217\u8868\u4e2d \uff08\u9664\u975e\u8fd9\u4e2a\u51fd\u6570\u8c03\u7528\u88ab\u7528\u62ec\u53f7\u62ec\u4e86\u8d77\u6765\uff09\u3002  \u8d4b\u503c\u8bed\u53e5\u9996\u5148\u8ba9\u6240\u6709\u7684\u8868\u8fbe\u5f0f\u5b8c\u6210\u8fd0\u7b97\uff0c \u4e4b\u540e\u518d\u505a\u8d4b\u503c\u64cd\u4f5c\u3002 \u56e0\u6b64\uff0c\u4e0b\u9762\u8fd9\u6bb5\u4ee3\u7801   i = 3\n i, a[i] = i+1, 20  \u4f1a\u628a a[3] \u8bbe\u7f6e\u4e3a 20\uff0c\u800c\u4e0d\u4f1a\u5f71\u54cd\u5230 a[4] \u3002 \u8fd9\u662f\u56e0\u4e3a a[i] \u4e2d\u7684 i \u5728\u88ab\u8d4b\u503c\u4e3a 4 \u4e4b\u524d\u5c31\u88ab\u8ba1\u7b97\u51fa\u6765\u4e86\uff08\u5f53\u65f6\u662f 3 \uff09\u3002 \u7b80\u5355\u8bf4 \uff0c\u8fd9\u6837\u4e00\u884c   x, y = y, x  \u4f1a\u4ea4\u6362 x \u548c y \u7684\u503c\u3002  \u5bf9\u4e8e\u5168\u5c40\u53d8\u91cf x = val \u7684\u8d4b\u503c\u7b49\u4ef7\u4e8e _ENV.x = val   3.2.3 \u63a7\u5236\u7ed3\u6784  if, while, and repeat \u8fd9\u4e9b\u63a7\u5236\u7ed3\u6784\u7b26\u5408\u901a\u5e38\u7684\u610f\u4e49\uff0c\u800c\u4e14\u4e5f\u6709\u7c7b\u4f3c\u7684\u8bed\u6cd5\uff1a  stat ::= while exp do block end\nstat ::= repeat block until exp\nstat ::= if exp then block {elseif exp then block} [else block] end  Lua \u4e5f\u6709\u4e00\u4e2a for \u8bed\u53e5\uff0c\u5b83\u6709\u4e24\u79cd\u5f62\u5f0f\uff0c\u8be6\u89c1\u4e0b\u6587\u3002  \u63a7\u5236\u7ed3\u6784\u4e2d\u7684\u6761\u4ef6\u8868\u8fbe\u5f0f\u53ef\u4ee5\u8fd4\u56de\u4efb\u4f55\u503c\u3002 false \u4e0e nil \u4e24\u8005\u90fd\u88ab\u8ba4\u4e3a\u662f\u5047\u3002 \u6240\u6709\u4e0d\u540c\u4e8e nil \u4e0e false \u7684\u5176\u5b83\u503c\u90fd\u88ab\u8ba4\u4e3a\u662f\u771f \uff08\u7279\u522b\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u6570\u5b57 0 \u548c\u7a7a\u5b57\u7b26\u4e32\u4e5f\u88ab\u8ba4\u4e3a\u662f\u771f\uff09\u3002  \u5728 repeat\u2013until \u5faa\u73af\u4e2d\uff0c \u5185\u90e8\u8bed\u53e5\u5757\u7684\u7ed3\u675f\u70b9\u4e0d\u662f\u5728 until \u8fd9\u4e2a\u5173\u952e\u5b57\u5904\uff0c \u5b83\u8fd8\u5305\u62ec\u4e86\u5176\u540e\u7684\u6761\u4ef6\u8868\u8fbe\u5f0f\u3002 \u56e0\u6b64\uff0c\u6761\u4ef6\u8868\u8fbe\u5f0f\u4e2d\u53ef\u4ee5\u4f7f\u7528\u5faa\u73af\u5185\u90e8\u8bed\u53e5\u5757\u4e2d\u7684\u5b9a\u4e49\u7684\u5c40\u90e8\u53d8\u91cf\u3002  goto \u8bed\u53e5\u5c06\u7a0b\u5e8f\u7684\u63a7\u5236\u70b9\u8f6c\u79fb\u5230\u4e00\u4e2a\u6807\u7b7e\u5904\u3002 \u7531\u4e8e\u53e5\u6cd5\u4e0a\u7684\u539f\u56e0\uff0c Lua \u91cc\u7684\u6807\u7b7e\u4e5f\u88ab\u8ba4\u4e3a\u662f\u8bed\u53e5\u3002\u9664\u4e86\u5728\u5185\u5d4c\u51fd\u6570\u4e2d\uff0c\u4ee5\u53ca\u5728\u5185\u5d4c\u8bed\u53e5\u5757\u4e2d\u5b9a\u4e49\u4e86\u540c\u540d\u6807\u7b7e\uff0c\u7684\u60c5\u51b5\u5916\uff0c \u6807\u7b7e\u5bf9\u4e8e\u5b83\u5b9a\u4e49\u6240\u5728\u7684\u6574\u4e2a\u8bed\u53e5\u5757\u53ef\u89c1\u3002 \u53ea\u8981 goto \u6ca1\u6709\u8fdb\u5165\u4e00\u4e2a\u65b0\u7684\u5c40\u90e8\u53d8\u91cf\u7684\u4f5c\u7528\u57df\uff0c\u5b83\u53ef\u4ee5\u8df3\u8f6c\u5230\u4efb\u610f\u53ef\u89c1\u6807\u7b7e\u5904\u3002  \u6807\u7b7e\u548c\u6ca1\u6709\u5185\u5bb9\u7684\u8bed\u53e5\u88ab\u79f0\u4e3a\u7a7a\u8bed\u53e5\uff0c\u5b83\u4eec\u4e0d\u505a\u4efb\u4f55\u64cd\u4f5c\u3002  break \u88ab\u7528\u6765\u7ed3\u675f while\u3001 repeat\u3001\u6216 for \u5faa\u73af\uff0c \u5b83\u5c06\u8df3\u5230\u5faa\u73af\u5916\u63a5\u7740\u4e4b\u540e\u7684\u8bed\u53e5\u8fd0\u884c\uff0cbreak \u8df3\u51fa\u6700\u5185\u5c42\u7684\u5faa\u73af\u3002  return \u88ab\u7528\u4e8e\u4ece\u51fd\u6570\u6216\u662f\u4ee3\u7801\u5757\uff08\u5176\u5b9e\u5b83\u5c31\u662f\u4e00\u4e2a\u51fd\u6570\uff09 \u4e2d\u8fd4\u56de\u503c\u3002  \u51fd\u6570\u53ef\u4ee5\u8fd4\u56de\u4e0d\u6b62\u4e00\u4e2a\u503c \uff0c\u6240\u4ee5 return \u7684\u8bed\u6cd5\u4e3a  stat ::= return [explist] [\u2018;\u2019]  return \u53ea\u80fd\u88ab\u5199\u5728\u4e00\u4e2a\u8bed\u53e5\u5757\u7684\u6700\u540e\u4e00\u53e5\u3002 \u5982\u679c\u4f60\u771f\u7684\u9700\u8981\u4ece\u8bed\u53e5\u5757\u7684\u4e2d\u95f4 return\uff0c \u4f60\u53ef\u4ee5\u4f7f\u7528\u663e\u5f0f\u7684\u5b9a\u4e49\u4e00\u4e2a\u5185\u90e8\u8bed\u53e5\u5757\uff0c \u4e00\u822c\u5199\u4f5c do return end\u3002 \u53ef\u4ee5\u8fd9\u6837\u5199\u662f\u56e0\u4e3a\u73b0\u5728 return \u6210\u4e86\uff08\u5185\u90e8\uff09\u8bed\u53e5\u5757\u7684\u6700\u540e\u4e00\u53e5\u4e86\u3002  \u793a\u4f8b\u4ee3\u7801\uff1a  local i = 0\nwhile i   3 do \n    print(i)\n    i = i + 1\nend\nprint(\"---\")\n\nlocal i = 0\nrepeat\n    print(i)\n    i = i + 1\nuntil i   5  \u8fd0\u884c\u7ed3\u679c\uff1a  0\n1\n2\n---\n0\n1\n2\n3\n4\n5  3.2.4 For \u8bed\u53e5  for \u6709\u4e24\u79cd\u5f62\u5f0f\uff1a\u4e00\u79cd\u662f\u6570\u5b57\u5f62\u5f0f\uff0c\u53e6\u4e00\u79cd\u662f\u901a\u7528\u5f62\u5f0f\u3002  \u6570\u5b57\u5f62\u5f0f\u7684 for \u5faa\u73af\uff0c\u901a\u8fc7\u4e00\u4e2a\u6570\u5b66\u8fd0\u7b97\u4e0d\u65ad\u5730\u8fd0\u884c\u5185\u90e8\u7684\u4ee3\u7801\u5757\u3002 \u4e0b\u9762\u662f\u5b83\u7684\u8bed\u6cd5\uff1a  stat ::= for Name \u2018=\u2019 exp \u2018,\u2019 exp [\u2018,\u2019 exp] do block end  block \u5c06\u628a name \u4f5c\u5faa\u73af\u53d8\u91cf\u3002 \u4ece\u7b2c\u4e00\u4e2a exp \u5f00\u59cb\u8d77\uff0c\u76f4\u5230\u7b2c\u4e8c\u4e2a exp \u7684\u503c\u4e3a\u6b62\uff0c \u5176\u6b65\u957f\u4e3a\u7b2c\u4e09\u4e2a exp \u3002 \u66f4\u786e\u5207\u7684\u8bf4\uff0c\u4e00\u4e2a for \u5faa\u73af\u770b\u8d77\u6765\u662f\u8fd9\u4e2a\u6837\u5b50   for v = e1, e2, e3 do block end  \u6ce8\u610f\u4e0b\u9762\u8fd9\u51e0\u70b9\uff1a   \u6240\u6709\u4e09\u4e2a\u63a7\u5236\u8868\u8fbe\u5f0f\u90fd\u53ea\u88ab\u8fd0\u7b97\u4e00\u6b21\uff0c \u8868\u8fbe\u5f0f\u7684\u8ba1\u7b97\u5728\u5faa\u73af\u5f00\u59cb\u4e4b\u524d\u3002 \u8fd9\u4e9b\u8868\u8fbe\u5f0f\u7684\u7ed3\u679c\u5fc5\u987b\u662f\u6570\u5b57\u3002  var\uff0climit\uff0c\u4ee5\u53ca step \u90fd\u662f\u4e00\u4e9b\u4e0d\u53ef\u89c1\u7684\u53d8\u91cf\u3002 \u8fd9\u91cc\u7ed9\u5b83\u4eec\u8d77\u7684\u540d\u5b57\u90fd\u4ec5\u4ec5\u7528\u4e8e\u89e3\u91ca\u65b9\u4fbf\u3002  \u5982\u679c\u7b2c\u4e09\u4e2a\u8868\u8fbe\u5f0f\uff08\u6b65\u957f\uff09\u6ca1\u6709\u7ed9\u51fa\uff0c\u4f1a\u628a\u6b65\u957f\u8bbe\u4e3a 1 \u3002  \u4f60\u53ef\u4ee5\u7528 break \u548c goto \u6765\u9000\u51fa for \u5faa\u73af\u3002  \u5faa\u73af\u53d8\u91cf v \u662f\u4e00\u4e2a\u5faa\u73af\u5185\u90e8\u7684\u5c40\u90e8\u53d8\u91cf\uff1b \u5982\u679c\u4f60\u9700\u8981\u5728\u5faa\u73af\u7ed3\u675f\u540e\u4f7f\u7528\u8fd9\u4e2a\u503c\uff0c \u5728\u9000\u51fa\u5faa\u73af\u524d\u628a\u5b83\u8d4b\u7ed9\u53e6\u4e00\u4e2a\u53d8\u91cf\u3002   \u901a\u7528\u5f62\u5f0f\u7684 for \u901a\u8fc7\u4e00\u4e2a\u53eb\u4f5c \u8fed\u4ee3\u5668 \u7684\u51fd\u6570\u5de5\u4f5c\u3002  \u6bcf\u6b21\u8fed\u4ee3\uff0c\u8fed\u4ee3\u5668\u51fd\u6570\u90fd\u4f1a\u88ab\u8c03\u7528\u4ee5\u4ea7\u751f\u4e00\u4e2a\u65b0\u7684\u503c\uff0c \u5f53\u8fd9\u4e2a\u503c\u4e3a nil \u65f6\uff0c\u5faa\u73af\u505c\u6b62\u3002 \u901a\u7528\u5f62\u5f0f\u7684 for \u5faa\u73af\u7684\u8bed\u6cd5\u5982\u4e0b\uff1a  stat ::= for namelist in explist do block end\nnamelist ::= Name {\u2018,\u2019 Name}  \u8fd9\u6837\u7684 for \u8bed\u53e5   for var_1, \u00b7\u00b7\u00b7, var_n in explist do block end  \u6ce8\u610f\u4ee5\u4e0b\u51e0\u70b9\uff1a   explist \u53ea\u4f1a\u88ab\u8ba1\u7b97\u4e00\u6b21\u3002 \u5b83\u8fd4\u56de\u4e09\u4e2a\u503c\uff0c \u4e00\u4e2a \u8fed\u4ee3\u5668 \u51fd\u6570\uff0c \u4e00\u4e2a \u72b6\u6001\uff0c \u4e00\u4e2a \u8fed\u4ee3\u5668\u7684\u521d\u59cb\u503c\u3002  f\uff0c s\uff0c\u4e0e var \u90fd\u662f\u4e0d\u53ef\u89c1\u7684\u53d8\u91cf\u3002 \u8fd9\u91cc\u7ed9\u5b83\u4eec\u8d77\u7684\u540d\u5b57\u90fd\u53ea\u662f\u4e3a\u4e86\u89e3\u8bf4\u65b9\u4fbf\u3002  \u4f60\u53ef\u4ee5\u4f7f\u7528 break \u6765\u8df3\u51fa for \u5faa\u73af\u3002  \u73af\u53d8\u91cf var_i \u5bf9\u4e8e\u5faa\u73af\u6765\u8bf4\u662f\u4e00\u4e2a\u5c40\u90e8\u53d8\u91cf\uff1b \u4f60\u4e0d\u53ef\u4ee5\u5728 for \u5faa\u73af\u7ed3\u675f\u540e\u7ee7\u7eed\u4f7f\u7528\u3002 \u5982\u679c\u4f60\u9700\u8981\u4fdd\u7559\u8fd9\u4e9b\u503c\uff0c\u90a3\u4e48\u5c31\u5728\u5faa\u73af\u8df3\u51fa\u6216\u7ed3\u675f\u524d\u8d4b\u503c\u5230\u522b\u7684\u53d8\u91cf\u91cc\u53bb\u3002   3.2.5 for\u793a\u4f8b\u4ee3\u7801\uff1a  for i=1, 10, 1 do -- \u6ce8\u610f\u8fd9\u91cc\u4ece1\u5f00\u59cb\u7684\n    print(i)\nend\n\nlocal nums = {11, 22, 33}\nfor i,v in ipairs(nums) do \n    print(i..' -  '..v) \nend\n\nlocal user = {}\nuser[123] = \"jjk\"\nuser[\"hello\"] = \"world\"\n\nfor k, v in pairs(user) do\n    print(k..\" \"..v)\nend  3.2.6 \u6570\u5b66\u8fd0\u7b97\u64cd\u4f5c\u7b26  Lua \u652f\u6301\u4e0b\u5217\u6570\u5b66\u8fd0\u7b97\u64cd\u4f5c\u7b26\uff1a   +: \u52a0\u6cd5  -: \u51cf\u6cd5  *: \u4e58\u6cd5  /: \u6d6e\u70b9\u9664\u6cd5  //: \u5411\u4e0b\u53d6\u6574\u9664\u6cd5  %: \u53d6\u6a21  ^: \u4e58\u65b9  -: \u53d6\u8d1f   \u9664\u4e86\u4e58\u65b9\u548c\u6d6e\u70b9\u9664\u6cd5\u8fd0\u7b97\uff0c \u6570\u5b66\u8fd0\u7b97\u6309\u5982\u4e0b\u65b9\u5f0f\u5de5\u4f5c\uff1a \u5982\u679c\u4e24\u4e2a\u64cd\u4f5c\u6570\u90fd\u662f\u6574\u6570\uff0c \u8be5\u64cd\u4f5c\u4ee5\u6574\u6570\u65b9\u5f0f\u64cd\u4f5c\u4e14\u7ed3\u679c\u4e5f\u5c06\u662f\u4e00\u4e2a\u6574\u6570\u3002  \u5426\u5219\uff0c\u5f53\u4e24\u4e2a\u64cd\u4f5c\u6570\u90fd\u662f\u6570\u5b57\u6216\u53ef\u4ee5\u88ab\u8f6c\u6362\u4e3a\u6570\u5b57\u7684\u5b57\u7b26\u4e32\u65f6\uff0c \u64cd\u4f5c\u6570\u4f1a\u88ab\u8f6c\u6362\u6210\u4e24\u4e2a\u6d6e\u70b9\u6570\uff0c  \u64cd\u4f5c\u6309\u901a\u5e38\u7684\u6d6e\u70b9\u89c4\u5219\uff08\u4e00\u822c\u9075\u5faa IEEE 754 \u6807\u51c6\uff09 \u6765\u8fdb\u884c\uff0c \u7ed3\u679c\u4e5f\u662f\u4e00\u4e2a\u6d6e\u70b9\u6570\u3002  \u4e58\u65b9\u548c\u6d6e\u70b9\u9664\u6cd5 \uff08/\uff09 \u603b\u662f\u628a\u64cd\u4f5c\u6570\u8f6c\u6362\u6210\u6d6e\u70b9\u6570\u8fdb\u884c\uff0c\u5176\u7ed3\u679c\u603b\u662f\u6d6e\u70b9\u6570\u3002  \u4e58\u65b9\u4f7f\u7528 ISO C \u51fd\u6570 pow\uff0c \u56e0\u6b64\u5b83\u4e5f\u53ef\u4ee5\u63a5\u53d7\u975e\u6574\u6570\u7684\u6307\u6570\u3002  \u793a\u4f8b\uff1a  print(23 + \"12.1\") -- 35.1  3.2.7 \u4f4d\u64cd\u4f5c\u7b26  Lua \u652f\u6301\u4e0b\u5217\u4f4d\u64cd\u4f5c\u7b26\uff1a   : \u6309\u4f4d\u4e0e  |: \u6309\u4f4d\u6216  ~: \u6309\u4f4d\u5f02\u6216     : \u53f3\u79fb     : \u5de6\u79fb  ~: \u6309\u4f4d\u975e   \u6240\u6709\u7684\u4f4d\u64cd\u4f5c\u90fd\u5c06\u64cd\u4f5c\u6570\u5148\u8f6c\u6362\u4e3a\u6574\u6570\uff0c \u7136\u540e\u6309\u4f4d\u64cd\u4f5c\uff0c\u5176\u7ed3\u679c\u662f\u4e00\u4e2a\u6574\u6570\u3002  \u5bf9\u4e8e\u53f3\u79fb\u548c\u5de6\u79fb\uff0c\u5747\u7528\u96f6\u6765\u586b\u8865\u7a7a\u4f4d\u3002 \u79fb\u52a8\u7684\u4f4d\u6570\u82e5\u4e3a\u8d1f\uff0c\u5219\u5411\u53cd\u65b9\u5411\u4f4d\u79fb\uff1b \u82e5\u79fb\u52a8\u7684\u4f4d\u6570\u7684\u7edd\u5bf9\u503c\u5927\u4e8e\u7b49\u4e8e \u6574\u6570\u672c\u8eab\u7684\u4f4d\u6570\uff0c\u5176\u7ed3\u679c\u4e3a\u96f6 \uff08\u6240\u6709\u4f4d\u90fd\u88ab\u79fb\u51fa\uff09\u3002  3.2.8 \u5f3a\u5236\u8f6c\u6362  Lua \u5bf9\u4e00\u4e9b\u7c7b\u578b\u548c\u503c\u7684\u5185\u90e8\u8868\u793a\u4f1a\u5728\u8fd0\u884c\u65f6\u505a\u4e00\u4e9b\u6570\u5b66\u8f6c\u6362\u3002  \u4f4d\u64cd\u4f5c\u603b\u662f\u5c06\u6d6e\u70b9\u64cd\u4f5c\u6570\u8f6c\u6362\u6210\u6574\u6570\u3002   \u4e58\u65b9\u548c\u6d6e\u70b9\u9664\u6cd5\u603b\u662f\u5c06\u6574\u6570\u8f6c\u6362\u4e3a\u6d6e\u70b9\u6570\u3002   \u5176\u5b83\u6570\u5b66\u64cd\u4f5c\u82e5\u9488\u5bf9\u6df7\u5408\u64cd\u4f5c\u6570 \uff08\u6574\u6570\u548c\u6d6e\u70b9\u6570\uff09\u5c06\u628a\u6574\u6570\u8f6c\u6362\u4e3a\u6d6e\u70b9\u6570 \uff1b \u8fd9\u4e00\u70b9\u88ab\u79f0\u4e3a \u901a\u5e38\u89c4\u5219\u3002 C API \u540c\u6837\u4f1a\u6309\u9700\u628a\u6574\u6570\u8f6c\u6362\u4e3a\u6d6e\u70b9\u6570\u4ee5\u53ca \u628a\u6d6e\u70b9\u6570\u8f6c\u6362\u4e3a\u6574\u6570\u3002 \u6b64\u5916\uff0c\u5b57\u7b26\u4e32\u8fde\u63a5\u64cd\u4f5c\u9664\u4e86\u5b57\u7b26\u4e32\uff0c\u4e5f\u53ef\u4ee5\u63a5\u53d7\u6570\u5b57\u4f5c\u4e3a\u53c2\u6570\u3002  \u5f53\u64cd\u4f5c\u9700\u8981\u6570\u5b57\u65f6\uff0cLua \u8fd8\u4f1a\u628a\u5b57\u7b26\u4e32\u8f6c\u6362\u4e3a\u6570\u5b57\u3002  \u5f53\u628a\u4e00\u4e2a\u6574\u6570\u8f6c\u6362\u4e3a\u6d6e\u70b9\u6570\u65f6\uff0c \u82e5\u6574\u6570\u503c\u6070\u597d\u53ef\u4ee5\u8868\u793a\u4e3a\u4e00\u4e2a\u6d6e\u70b9\u6570\uff0c\u90a3\u5c31\u53d6\u90a3\u4e2a\u6d6e\u70b9\u6570\u3002 \u5426\u5219\uff0c\u8f6c\u6362\u4f1a\u53d6\u6700\u63a5\u8fd1\u7684\u8f83\u5927\u503c\u6216\u8f83\u5c0f\u503c\u6765\u8868\u793a\u8fd9\u4e2a\u6570\u3002 \u8fd9\u79cd\u8f6c\u6362\u662f\u4e0d\u4f1a\u5931\u8d25\u7684\u3002  \u5c06\u6d6e\u70b9\u6570\u8f6c\u4e3a\u6574\u6570\u7684\u8fc7\u7a0b\u4f1a\u68c0\u67e5 \u6d6e\u70b9\u6570\u80fd\u5426\u88ab\u51c6\u786e\u7684\u8868\u8fbe\u4e3a\u4e00\u4e2a\u6574\u6570 \uff08\u5373\uff0c\u6d6e\u70b9\u6570\u662f\u4e00\u4e2a\u6574\u6570\u503c\u4e14\u5728\u6574\u6570\u53ef\u4ee5\u8868\u8fbe\u7684\u533a\u95f4\uff09\u3002 \u5982\u679c\u53ef\u4ee5\uff0c\u7ed3\u679c\u5c31\u662f\u90a3\u4e2a\u6570\uff0c\u5426\u5219\u8f6c\u6362\u5931\u8d25\u3002  \u4ece\u5b57\u7b26\u4e32\u5230\u6570\u5b57\u7684\u8f6c\u6362\u8fc7\u7a0b\u9075\u5faa\u4ee5\u4e0b\u6d41\u7a0b\uff1a \u9996\u5148\uff0c\u9075\u5faa\u6309 Lua \u8bcd\u6cd5\u5206\u6790\u5668\u7684\u89c4\u5219\u5206\u6790\u8bed\u6cd5\u6765\u8f6c\u6362\u4e3a\u5bf9\u5e94\u7684 \u6574\u6570\u6216\u6d6e\u70b9\u6570\u3002 \uff08\u5b57\u7b26\u4e32\u53ef\u4ee5\u6709\u524d\u7f6e\u6216\u540e\u7f6e\u7684\u7a7a\u683c\u4ee5\u53ca\u4e00\u4e2a\u7b26\u53f7\u3002\uff09 \u7136\u540e\uff0c\u7ed3\u679c\u6570\u5b57\u518d\u6309\u524d\u8ff0\u89c4\u5219\u8f6c\u6362\u4e3a\u6240\u9700\u8981\u7684\u7c7b\u578b\uff08\u6d6e\u70b9\u6216\u6574\u6570\uff09\u3002  \u4ece\u6570\u5b57\u8f6c\u6362\u4e3a\u5b57\u7b26\u4e32\u4f7f\u7528\u975e\u6307\u5b9a\u7684\u4eba\u53ef\u8bfb\u7684\u683c\u5f0f\u3002 \u82e5\u60f3\u5b8c\u5168\u63a7\u5236\u6570\u5b57\u5230\u5b57\u7b26\u4e32\u7684\u8f6c\u6362\u8fc7\u7a0b\uff0c \u53ef\u4ee5\u4f7f\u7528\u5b57\u7b26\u4e32\u5e93\u4e2d\u7684 format \u51fd\u6570 \uff08\u53c2\u89c1 string.format\uff09\u3002  3.2.9 \u6bd4\u8f83\u64cd\u4f5c\u7b26  Lua \u652f\u6301\u4e0b\u5217\u6bd4\u8f83\u64cd\u4f5c\u7b26\uff1a   ==: \u7b49\u4e8e  ~=: \u4e0d\u7b49\u4e8e  : \u5c0f\u4e8e    : \u5927\u4e8e    =: \u5c0f\u4e8e\u7b49\u4e8e    =: \u5927\u4e8e\u7b49\u4e8e     \u8fd9\u4e9b\u64cd\u4f5c\u7684\u7ed3\u679c\u4e0d\u662f false \u5c31\u662f true\u3002  \u7b49\u4e8e\u64cd\u4f5c \uff08==\uff09\u5148\u6bd4\u8f83\u64cd\u4f5c\u6570\u7684\u7c7b\u578b\u3002 \u5982\u679c\u7c7b\u578b\u4e0d\u540c\uff0c\u7ed3\u679c\u5c31\u662f false\u3002 \u5426\u5219\uff0c\u7ee7\u7eed\u6bd4\u8f83\u503c\u3002 \u5b57\u7b26\u4e32\u6309\u4e00\u822c\u7684\u65b9\u5f0f\u6bd4\u8f83\u3002 \u6570\u5b57\u9075\u5faa\u4e8c\u5143\u64cd\u4f5c\u7684\u89c4\u5219\uff1a  \u5982\u679c\u4e24\u4e2a\u64cd\u4f5c\u6570\u90fd\u662f\u6574\u6570\uff0c \u5b83\u4eec\u6309\u6574\u6570\u6bd4\u8f83\uff1b \u5426\u5219\uff0c\u5b83\u4eec\u5148\u8f6c\u6362\u4e3a\u6d6e\u70b9\u6570\uff0c\u7136\u540e\u518d\u505a\u6bd4\u8f83\u3002  \u8868\uff0c\u7528\u6237\u6570\u636e\uff0c\u4ee5\u53ca\u7ebf\u7a0b\u90fd\u6309\u5f15\u7528\u6bd4\u8f83\uff1a \u53ea\u6709\u4e24\u8005\u5f15\u7528\u540c\u4e00\u4e2a\u5bf9\u8c61\u65f6\u624d\u8ba4\u4e3a\u5b83\u4eec\u76f8\u7b49\u3002  \u6bcf\u6b21\u4f60\u521b\u5efa\u4e00\u4e2a\u65b0\u5bf9\u8c61\uff08\u4e00\u5f20\u8868\uff0c\u4e00\u4e2a\u7528\u6237\u6570\u636e\uff0c\u6216\u4e00\u4e2a\u7ebf\u7a0b\uff09\uff0c \u65b0\u5bf9\u8c61\u90fd\u4e00\u5b9a\u548c\u5df2\u6709\u4e14\u5b58\u5728\u7684\u5bf9\u8c61\u4e0d\u540c\u3002 \u76f8\u540c\u5f15\u7528\u7684\u95ed\u5305\u4e00\u5b9a\u76f8\u7b49\u3002 \u6709\u4efb\u4f55\u53ef\u5bdf\u89c9\u7684\u5dee\u5f02\uff08\u4e0d\u540c\u7684\u884c\u4e3a\uff0c\u4e0d\u540c\u7684\u5b9a\u4e49\uff09\u4e00\u5b9a\u4e0d\u7b49\u3002  \u4f60\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528 \"eq\" \u5143\u65b9\u6cd5\u6765\u6539\u53d8 Lua \u6bd4\u8f83\u8868\u548c\u7528\u6237\u6570\u636e\u65f6\u7684\u65b9\u5f0f\u3002  \u7b49\u4e8e\u64cd\u4f5c\u4e0d\u4f1a\u5c06\u5b57\u7b26\u4e32\u8f6c\u6362\u4e3a\u6570\u5b57\uff0c\u53cd\u4e4b\u4ea6\u7136\u3002 \u5373\uff0c\"0\"==0 \u7ed3\u679c\u4e3a false\uff0c \u4e14 t[0] \u4e0e t[\"0\"] \u6307\u4ee3\u7740\u8868\u4e2d\u7684\u4e0d\u540c\u9879\u3002  ~= \u64cd\u4f5c\u5b8c\u5168\u7b49\u4ef7\u4e8e (==) \u64cd\u4f5c\u7684\u53cd\u503c\u3002  \u5927\u5c0f\u6bd4\u8f83\u64cd\u4f5c\u4ee5\u4ee5\u4e0b\u65b9\u5f0f\u8fdb\u884c\u3002 \u5982\u679c\u53c2\u6570\u90fd\u662f\u6570\u5b57\uff0c \u5b83\u4eec\u6309\u4e8c\u5143\u64cd\u4f5c\u7684\u5e38\u89c4\u8fdb\u884c\u3002 \u5426\u5219\uff0c\u5982\u679c\u4e24\u4e2a\u53c2\u6570\u90fd\u662f\u5b57\u7b26\u4e32\uff0c \u5b83\u4eec\u7684\u503c\u6309\u5f53\u524d\u7684\u533a\u57df\u8bbe\u7f6e\u6765\u6bd4\u8f83\u3002 \u518d\u5219\uff0cLua \u5c31\u8bd5\u7740\u8c03\u7528 \"lt\" \u6216\u662f \"le\" \u5143\u65b9\u6cd5 \u3002 a   b \u7684\u6bd4\u8f83\u88ab\u8f6c\u8bd1\u4e3a b   a\uff0c a  = b \u88ab\u8f6c\u8bd1\u4e3a b  = a\u3002  \u793a\u4f8b\u4ee3\u7801\uff1a  print(2 == 2.0) -- true\nprint(2 ~= 2.0) -- false\nprint(2 == \"2\") -- false\n\nlocal t1 = {}\nlocal t2 = {}\n\nlocal t3 = t1\nlocal t4 = t1\nlocal t5 = t2\n\nprint(t3 == t4) -- true\nprint(t3 == t5) -- false  3.2.10 \u903b\u8f91\u64cd\u4f5c\u7b26  Lua \u4e2d\u7684\u903b\u8f91\u64cd\u4f5c\u7b26\u6709 and\uff0c or\uff0c\u4ee5\u53ca not\u3002 \u548c\u63a7\u5236\u7ed3\u6784\u4e00\u6837\uff0c  \u6240\u6709\u7684\u903b\u8f91\u64cd\u4f5c\u7b26\u628a false \u548c nil \u90fd\u4f5c\u4e3a\u5047\uff0c \u800c\u5176\u5b83\u7684\u4e00\u5207\u90fd\u5f53\u4f5c\u771f\u3002  \u53d6\u53cd\u64cd\u4f5c not \u603b\u662f\u8fd4\u56de false \u6216 true \u4e2d\u7684\u4e00\u4e2a\u3002 \u4e0e\u64cd\u4f5c\u7b26 and \u5728\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a false \u6216 nil \u65f6 \u8fd4\u56de\u8fd9\u7b2c\u4e00\u4e2a\u53c2\u6570\uff1b \u5426\u5219\uff0cand \u8fd4\u56de\u7b2c\u4e8c\u4e2a\u53c2\u6570\u3002 \u6216\u64cd\u4f5c\u7b26 or \u5728\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e0d\u4e3a nil \u4e5f\u4e0d\u4e3a false \u65f6\uff0c \u8fd4\u56de\u8fd9\u7b2c\u4e00\u4e2a\u53c2\u6570\uff0c\u5426\u5219\u8fd4\u56de\u7b2c\u4e8c\u4e2a\u53c2\u6570\u3002  and \u548c or \u90fd\u9075\u5faa\u77ed\u8def\u89c4\u5219\uff1b \u4e5f\u5c31\u662f\u8bf4\uff0c\u7b2c\u4e8c\u4e2a\u64cd\u4f5c\u6570\u53ea\u5728\u9700\u8981\u7684\u65f6\u5019\u53bb\u6c42\u503c\u3002  \u8fd9\u91cc\u6709\u4e00\u4e9b\u4f8b\u5b50\uff1a   10 or 20            -- 10\n 10 or error()       -- 10\n nil or \"a\"          -- \"a\"\n nil and 10          -- nil\n false and error()   -- false\n false and nil       -- false\n false or nil        -- nil\n 10 and 20           -- 20  3.2.11 \u5b57\u7b26\u4e32\u8fde\u63a5  Lua \u4e2d\u5b57\u7b26\u4e32\u7684\u8fde\u63a5\u64cd\u4f5c\u7b26\u5199\u4f5c\u4e24\u4e2a\u70b9\uff08'..'\uff09\u3002 \u5982\u679c\u4e24\u4e2a\u64cd\u4f5c\u6570\u90fd\u662f\u5b57\u7b26\u4e32\u6216\u90fd\u662f\u6570\u5b57\uff0c \u8fde\u63a5\u64cd\u4f5c\u5c06\u5176\u8f6c\u6362\u4e3a\u5b57\u7b26\u4e32\u3002 \u5426\u5219\uff0c\u4f1a\u8c03\u7528\u5143\u65b9\u6cd5 __concat\u3002  \u793a\u4f8b\u4ee3\u7801\uff1a  print(\"hello\"..\"lua\") -- hellolua  3.2.12 \u53d6\u957f\u5ea6\u64cd\u4f5c\u7b26  \u53d6\u957f\u5ea6\u64cd\u4f5c\u7b26\u5199\u4f5c \u4e00\u5143\u524d\u7f6e\u7b26 # \u3002 \u5b57\u7b26\u4e32\u7684\u957f\u5ea6\u662f\u5b83\u7684\u5b57\u8282\u6570\uff08\u5c31\u662f\u4ee5\u4e00\u4e2a\u5b57\u7b26\u4e00\u4e2a\u5b57\u8282\u8ba1\u7b97\u7684\u5b57\u7b26\u4e32\u957f\u5ea6\uff09\u3002  \u7a0b\u5e8f\u53ef\u4ee5\u901a\u8fc7  __len \u5143\u65b9\u6cd5 \u6765\u4fee\u6539\u5bf9\u5b57\u7b26\u4e32\u7c7b\u578b\u5916\u7684\u4efb\u4f55\u503c\u7684\u53d6\u957f\u5ea6\u64cd\u4f5c\u884c\u4e3a\u3002  \u793a\u4f8b\u4ee3\u7801\uff1a  local tb = {1, 2, 3}\n\nprint(#\"hello\") -- 5\nprint(#tb)      -- 3  3.2.13 \u4f18\u5148\u7ea7  Lua \u4e2d\u64cd\u4f5c\u7b26\u7684\u4f18\u5148\u7ea7\u5199\u5728\u4e0b\u8868\u4e2d\uff0c\u4ece\u4f4e\u5230\u9ad8\u4f18\u5148\u7ea7\u6392\u5e8f\uff1a   or\n and\n              =     =    ~=    ==\n |\n ~\n  \n       \n ..\n +     -\n *     /     //    %\n unary operators (not   #     -     ~)\n ^  \u901a\u5e38\uff0c \u4f60\u53ef\u4ee5\u7528\u62ec\u53f7\u6765\u6539\u53d8\u8fd0\u7b97\u6b21\u5e8f\u3002 \u8fde\u63a5\u64cd\u4f5c\u7b26 ('..') \u548c\u4e58\u65b9\u64cd\u4f5c ('^') \u662f\u4ece\u53f3\u81f3\u5de6\u7684\u3002 \u5176\u5b83\u6240\u6709\u7684\u64cd\u4f5c\u90fd\u662f\u4ece\u5de6\u81f3\u53f3\u3002  3.2.14 \u53ef\u89c1\u6027\u89c4\u5219  Lua \u8bed\u8a00\u6709\u8bcd\u6cd5\u4f5c\u7528\u8303\u56f4\u3002 \u53d8\u91cf\u7684\u4f5c\u7528\u8303\u56f4\u5f00\u59cb\u4e8e\u58f0\u660e\u5b83\u4eec\u4e4b\u540e\u7684\u7b2c\u4e00\u4e2a\u8bed\u53e5\u6bb5\uff0c \u7ed3\u675f\u4e8e\u5305\u542b\u8fd9\u4e2a\u58f0\u660e\u7684\u6700\u5185\u5c42\u8bed\u53e5\u5757\u7684\u6700\u540e\u4e00\u4e2a\u975e\u7a7a\u8bed\u53e5\u3002 \u770b\u4e0b\u9762\u8fd9\u4e9b\u4f8b\u5b50\uff1a  x = 10                -- \u5168\u5c40\u53d8\u91cf\ndo                    -- \u65b0\u7684\u8bed\u53e5\u5757\n    local x = x       -- \u65b0\u7684\u4e00\u4e2a 'x', \u5b83\u7684\u503c\u73b0\u5728\u662f 10\n    print(x)          -- 10\n    x = x+1\n\n    do                -- \u53e6\u4e00\u4e2a\u8bed\u53e5\u5757\n     local x = x+1    -- \u53c8\u4e00\u4e2a 'x'\n     print(x)         -- 12\n    end\n    print(x)          -- 11\nend\nprint(x)              -- 10 \uff08\u53d6\u5230\u7684\u662f\u5168\u5c40\u7684\u90a3\u4e00\u4e2a\uff09  \u6ce8\u610f\u8fd9\u91cc\uff0c\u7c7b\u4f3c local x = x \u8fd9\u6837\u7684\u58f0\u660e\uff0c \u65b0\u7684 x \u6b63\u5728\u88ab\u58f0\u660e\uff0c\u4f46\u662f\u8fd8\u6ca1\u6709\u8fdb\u5165\u5b83\u7684\u4f5c\u7528\u8303\u56f4\uff0c \u6240\u4ee5\u7b2c\u4e8c\u4e2a x \u6307\u5411\u7684\u662f\u5916\u9762\u4e00\u5c42\u7684\u53d8\u91cf\u3002  \u56e0\u4e3a\u6709\u8fd9\u6837\u4e00\u4e2a\u8bcd\u6cd5\u4f5c\u7528\u8303\u56f4\u7684\u89c4\u5219\uff0c \u5c40\u90e8\u53d8\u91cf\u53ef\u4ee5\u88ab\u5728\u5b83\u7684\u4f5c\u7528\u8303\u56f4\u5185\u5b9a\u4e49\u7684\u51fd\u6570\u81ea\u7531\u4f7f\u7528\u3002  \u5f53\u4e00\u4e2a\u5c40\u90e8\u53d8\u91cf\u88ab\u5185\u5c42\u7684\u51fd\u6570\u4e2d\u4f7f\u7528\u7684\u65f6\u5019\uff0c \u5b83\u88ab\u5185\u5c42\u51fd\u6570\u79f0\u4f5c \u4e0a\u503c\uff0c\u6216\u662f \u5916\u90e8\u5c40\u90e8\u53d8\u91cf\u3002", 
            "title": "3.2 \u8bed\u53e5"
        }, 
        {
            "location": "/luamd/03/#33", 
            "text": "\u95ed\u5305\u662f\u7531\u51fd\u6570\u548c\u4e0e\u5176\u76f8\u5173\u7684\u5f15\u7528\u73af\u5883\u7ec4\u5408\u800c\u6210\u7684\u5b9e\u4f53\uff0c \u95ed\u5305=\u51fd\u6570+\u5f15\u7528\u73af\u5883\u3002  \u793a\u4f8b1\uff1a  function newCounter()\n     local i = 0\n     return function ()  \n          i = i + 1     \n          return i \n     end\nend\n\nc1 = newCounter()\nc2 = newCounter()\n\nprint(c1()) -- 1\nprint(c1()) -- 2\nprint(c1()) -- 3\nprint(c2()) -- 1\nprint(c2()) -- 2  \u4e0a\u8ff0\u4ee3\u7801\u4e2d\u7684newCounter\u51fd\u6570\u8fd4\u56de\u4e86\u4e00\u4e2a\u51fd\u6570\uff0c\u800c\u8fd9\u4e2a\u8fd4\u56de\u7684\u533f\u540d\u51fd\u6570\u5c31\u662f\u95ed\u5305\u7684\u7ec4\u6210\u90e8\u5206\u4e2d\u7684\u51fd\u6570\uff1b\u5f15\u7528\u73af\u5883\u5c31\u662f\u53d8\u91cfi\u6240\u5728\u7684\u73af\u5883\u3002\u5b9e\u9645\u4e0a\uff0c\u95ed\u5305\u53ea\u662f\u5728\u5f62\u5f0f\u548c\u8868\u73b0\u4e0a\u50cf\u51fd\u6570\uff0c\u4f46\u5b9e\u9645\u4e0a\u4e0d\u662f\u51fd\u6570\uff0c\u6211\u4eec\u90fd\u77e5\u9053\uff0c\u51fd\u6570\u5c31\u662f\u4e00\u4e9b\u53ef\u6267\u884c\u8bed\u53e5\u7684\u7ec4\u5408\u4f53\uff0c\u8fd9\u4e9b\u4ee3\u7801\u8bed\u53e5\u5728\u51fd\u6570\u88ab\u5b9a\u4e49\u540e\u5c31\u786e\u5b9a\u4e86\uff0c\u5e76\u4e0d\u4f1a\u518d\u6267\u884c\u65f6\u53d1\u751f\u53d8\u5316\uff0c\u6240\u4ee5\u51fd\u6570\u53ea\u6709\u4e00\u4e2a\u5b9e\u4f8b\u3002 \u800c\u95ed\u5305\u5728\u8fd0\u884c\u65f6\u53ef\u4ee5\u6709\u591a\u4e2a\u5b9e\u4f8b\uff0c \u4e0d\u540c\u7684\u5f15\u7528\u73af\u5883\u548c\u76f8\u540c\u7684\u51fd\u6570\u7ec4\u5408\u53ef\u4ee5\u4ea7\u751f\u4e0d\u540c\u7684\u5b9e\u4f8b\uff0c\u5c31\u597d\u6bd4\u76f8\u540c\u7684\u7c7b\u4ee3\u7801\uff0c\u53ef\u4ee5\u521b\u5efa\u4e0d\u540c\u7684\u7c7b\u5b9e\u4f8b\u4e00\u6837\u3002  \u793a\u4f8b2\uff1a  function Fun1()\n     local iVal = 10          -- upvalue\n\n     function InnerFunc1()     \n          print(iVal)           \n     end\n     function InnerFunc2()   \n          iVal = iVal + 10\n     end\n\n     return InnerFunc1, InnerFunc2\nend\n\n\nlocal a, b = Fun1()\n\na()   -- 10\nb()   -- \u5728b\u51fd\u6570\u4e2d\u4fee\u6539\u4e86upvalue iVal\na()   -- 20  \u4e0a\u8ff0\u8fd9\u6bb5\u7b80\u5355\u7684\u4ee3\u7801\uff0c\u5c31\u9a8c\u8bc1\u4e86\u5728 \u5185\u5d4c\u51fd\u6570\u4e2d\u662f\u5171\u4eabupvalue\u7684 \uff0c\u5c31\u597d\u6bd4C++\u7c7b\u4e2d\u7684\u6210\u5458\u51fd\u6570\u53ef\u4ee5\u8bbf\u95ee\u548c\u4fee\u6539\u6210\u5458\u53d8\u91cf\u4e00\u6837\u3002", 
            "title": "3.3 \u95ed\u5305"
        }, 
        {
            "location": "/luamd/03/#34-lua", 
            "text": "lua \u9762\u5bf9\u5bf9\u8c61\u7684\u5217\u5b50  \u793a\u4f8b1\uff1a  Account = { balance = 0 }\nfunction Account.withDraw(self, v)\n     self.balance = self.balance - v\nend\n\na = Account\n\na.withDraw(a, 100) -- 0 - 100 = -100\nprint(a.balance) -- -100  \u4f7f\u7528self\u53c2\u6570\u662f\u6240\u6709\u9762\u5411\u5bf9\u8c61\u8bed\u8a00\u7684\u4e00\u4e2a\u6838\u5fc3\u3002\u5927\u591a\u6570\u9762\u5411\u5bf9\u8c61\u8bed\u8a00\u90fd\u5bf9\u7a0b\u5e8f\u5458\u9690\u85cf\u4e86self\u53c2\u6570\uff0c\u4ece\u800c\u4f7f\u5f97\u7a0b\u5e8f\u5458\u4e0d\u5fc5\u663e\u793a\u5730\u58f0\u660e\u8fd9\u4e2a\u53c2\u6570\u3002Lua \u4e5f\u53ef\u4ee5\uff0c\u5f53\u6211\u4eec\u5728\u5b9a\u4e49\u51fd\u6570\u65f6\uff0c\u4f7f\u7528\u4e86\u5192\u53f7\uff0c\u5219\u80fd\u9690\u85cf\u8be5\u53c2\u6570\uff0c\u90a3\u4e48\u4e0a\u8ff0\u4ee3\u7801\u4f7f\u7528\u5192\u53f7\u6765\u6539\u4e0b\uff0c\u5c31\u662f\u4e0b\u9762\u8fd9\u4e2a\u6837\u5b50\u4e86\u3002  \u793a\u4f8b2\uff1a  Account = {balance = 0}\nfunction Account:withDraw(v) -- \u6ce8\u610f\u8fd9\u91cc\u7684\u5192\u53f7\":\"\n     self.balance = self.balance - v\nend\n\na = Account\n\na:withDraw(100) -- \u6ce8\u610f\u8fd9\u91cc\u7684\u8c03\u7528\u65f6\uff0c\u4e5f\u9700\u8981\u5192\u53f7\":\"\nprint(a.balance)", 
            "title": "3.4 lua : \u5192\u53f7\u6807\u8bc6\u7b26\u7528\u6cd5"
        }, 
        {
            "location": "/luamd/03/#35-lua", 
            "text": "::\u7528\u6765\u6807\u8bc6 goto \u7684lable  Lua\u652f\u6301goto\u8bed\u6cd5, \u4f46\u662f\u6709\u4e00\u5b9a\u7684\u5c40\u9650\u6027.   \u4e0d\u80fd\u5728block\u5916\u9762\u8df3\u5165block(\u56e0\u4e3ablock\u4e2d\u7684lable\u4e0d\u53ef\u89c1),   \u4e0d\u80fd\u8df3\u51fa\u6216\u8005\u8df3\u5165\u4e00\u4e2a\u51fd\u6570.   \u4e0d\u80fd\u8df3\u5165\u672c\u5730\u53d8\u91cf\u7684\u4f5c\u7528\u57df.   goto \u6a21\u62df continue \u7684\u793a\u4f8b\uff1a  i = 0\nwhile i 10 do\n  i = i+1\n  if i%2 == 1 then \n    goto continue \n  else \n    print(i)\n  end\n  ::continue::\nend", 
            "title": "3.5 lua :: \u6807\u8bc6\u7b26\u7528\u6cd5"
        }, 
        {
            "location": "/luamd/03/#36-lua", 
            "text": "function funcList.CRC_MODBUS(...)\n    local str = \"\"\n    for k, v in ipairs({...}) do\n        str = str..v\n    end\n    print(\"func args: \"..str)\nend", 
            "title": "3.6 lua \u51fd\u6570\u53ef\u53d8\u53c2\u6570"
        }, 
        {
            "location": "/luamd/04/", 
            "text": "lua \u6807\u51c6\u5e93\n\n\n\u6807\u51c6\u5e93\u63d0\u4f9b\u4e86\u4e00\u4e9b\u6709\u7528\u7684\u51fd\u6570, \u5b83\u4eec\u90fd\u662f\u76f4\u63a5\u7528 \nC API \u5b9e\u73b0\u7684\n\u3002 \u5176\u4e2d\u4e00\u4e9b\u51fd\u6570\u63d0\u4f9b\u4e86\u539f\u672c\u8bed\u8a00\u5c31\u6709\u7684\u670d\u52a1 \uff08\u4f8b\u5982\uff0ctype \u4e0e getmetatable\uff09\uff1b \u53e6\u4e00\u4e9b\u63d0\u4f9b\u548c\u201c\u5916\u90e8\u201d\u6253\u4ea4\u9053\u7684\u670d\u52a1\uff08\u4f8b\u5982 I/O \uff09\uff1b \u8fd8\u6709\u4e9b\u672c\u53ef\u4ee5\u7528 Lua \u672c\u8eab\u6765\u5b9e\u73b0\uff0c\u4f46\u5728 C \u4e2d\u5b9e\u73b0\u53ef\u4ee5\u6ee1\u8db3\u5173\u952e\u70b9\u4e0a\u7684\u6027\u80fd\u9700\u6c42 \uff08\u4f8b\u5982 table.sort\uff09\u3002\n\n\n\u6240\u6709\u7684\u5e93\u90fd\u662f\u76f4\u63a5\u7528 C API \u5b9e\u73b0\u7684\uff0c\u5e76\u4ee5\u5206\u79bb\u7684 C \u6a21\u5757\u5f62\u5f0f\u63d0\u4f9b\u3002 \u76ee\u524d\uff0cLua \u6709\u4e0b\u5217\u6807\u51c6\u5e93\uff1a\n\n\n\n\n\u57fa\u7840\u5e93 \n\n\n\u534f\u7a0b\u5e93 \n\n\n\u5305\u7ba1\u7406\u5e93 \n\n\n\u5b57\u7b26\u4e32\u63a7\u5236 \n\n\n\u57fa\u7840 UTF-8 \u652f\u6301 \n\n\n\u8868\u63a7\u5236 \n\n\n\u6570\u5b66\u51fd\u6570 (sin \uff0clog \u7b49)\n\n\n\u8f93\u5165\u8f93\u51fa \n\n\n\u64cd\u4f5c\u7cfb\u7edf\u5e93 \n\n\n\u8c03\u8bd5\u5e93  \n\n\n\n\n\u9664\u4e86\u57fa\u7840\u5e93\u548c\u5305\u7ba1\u7406\u5e93\uff0c \u5176\u5b83\u5e93\u90fd\u628a\u81ea\u5df1\u7684\u51fd\u6570\u653e\u5728\u4e00\u5f20\u5168\u5c40\u8868\u7684\u57df\u4e2d\uff0c \u6216\u662f\u4ee5\u5bf9\u8c61\u65b9\u6cd5\u7684\u5f62\u5f0f\u63d0\u4f9b\u3002\u8981\u4f7f\u7528\u8fd9\u4e9b\u5e93\uff0c\nC \u7684\u5bbf\u4e3b\u7a0b\u5e8f\u9700\u8981\u5148\u8c03\u7528\u4e00\u4e0b luaL_openlibs \u8fd9\u4e2a\u51fd\u6570\n\uff0c\u8fd9\u6837\u5c31\u80fd\u6253\u5f00\u6240\u6709\u7684\u6807\u51c6\u5e93\u3002 \u6216\u8005\u5bbf\u4e3b\u7a0b\u5e8f\u4e5f\u53ef\u4ee5\u7528 luaL_requiref \u5206\u522b\u6253\u5f00\u8fd9\u4e9b\u5e93\uff1a \n\n\n\n\nluaopen_base \uff08\u57fa\u7840\u5e93\uff09 \n\n\nluaopen_package \uff08\u5305\u7ba1\u7406\u5e93\uff09 \n\n\nluaopen_coroutine \uff08\u534f\u7a0b\u5e93\uff09 \n\n\nluaopen_string \uff08\u5b57\u7b26\u4e32\u5e93\uff09 \n\n\nluaopen_utf8 \uff08UTF8 \u5e93\uff09 \n\n\nluaopen_table \uff08\u8868\u5904\u7406\u5e93\uff09\n\n\nluaopen_math \uff08\u6570\u5b66\u5e93\uff09\n\n\nluaopen_io \uff08I/O \u5e93\uff09 \n\n\nluaopen_os \uff08\u64cd\u4f5c\u7cfb\u7edf\u5e93\uff09 \n\n\nluaopen_debug \uff08\u8c03\u8bd5\u5e93\uff09 \n\n\n\n\n\u8fd9\u4e9b\u51fd\u6570\u90fd\u5b9a\u4e49\u5728 lualib.h \u4e2d\u3002\n\n\n4.1\u57fa\u7840\u51fd\u6570\n\n\n\u57fa\u7840\u5e93\u63d0\u4f9b\u4e86 Lua \u6838\u5fc3\u51fd\u6570\u3002 \u5982\u679c\u4f60\u4e0d\u5c06\u8fd9\u4e2a\u5e93\u5305\u542b\u5728\u4f60\u7684\u7a0b\u5e8f\u4e2d\uff0c \u4f60\u5c31\u9700\u8981\u5c0f\u5fc3\u68c0\u67e5\u7a0b\u5e8f\u662f\u5426\u9700\u8981\u81ea\u5df1\u63d0\u4f9b\u5176\u4e2d\u4e00\u4e9b\u7279\u6027\u7684\u5b9e\u73b0\u3002\u8fd9\u91cc\u5217\u51fa\u4e86\u4e00\u4e9b\u5e38\u7528\u7684\u57fa\u7840\u5e93\u51fd\u6570\uff1a\n\n\n4.1.1 assert (v [, message])\n\n\n\u5982\u679c\u5176\u53c2\u6570 v \u7684\u503c\u4e3a\u5047\uff08nil \u6216 false\uff09\uff0c \u5b83\u5c31\u8c03\u7528 error\uff1b \u5426\u5219\uff0c\u8fd4\u56de\u6240\u6709\u7684\u53c2\u6570\u3002 \u5728\u9519\u8bef\u60c5\u51b5\u65f6\uff0c message \u6307\u90a3\u4e2a\u9519\u8bef\u5bf9\u8c61\uff1b \u5982\u679c\u4e0d\u63d0\u4f9b\u8fd9\u4e2a\u53c2\u6570\uff0c\u53c2\u6570\u9ed8\u8ba4\u4e3a \"assertion failed!\" \u3002\n\n\n\u6848\u5217\uff1a\n\n\nassert(5 == 67)\n\n\n\n\u8fd0\u884c\u7ed3\u679c\uff1a\n\n\nlua: ll.lua:1: assertion failed!\nstack traceback:\n        [C]: in function 'assert'\n        ll.lua:1: in main chunk\n        [C]: in ?\n\n\n\n4.1.2 print (\u00b7\u00b7\u00b7)\n\n\n\u63a5\u6536\u4efb\u610f\u6570\u91cf\u7684\u53c2\u6570\uff0c\u5e76\u5c06\u5b83\u4eec\u7684\u503c\u6253\u5370\u5230 stdout\u3002 \u5b83\u7528 tostring \u51fd\u6570\u5c06\u6bcf\u4e2a\u53c2\u6570\u90fd\u8f6c\u6362\u4e3a\u5b57\u7b26\u4e32\u3002 print \u4e0d\u7528\u4e8e\u505a\u683c\u5f0f\u5316\u8f93\u51fa\u3002\u4ec5\u4f5c\u4e3a\u770b\u4e00\u4e0b\u67d0\u4e2a\u503c\u7684\u5feb\u6377\u65b9\u5f0f\u3002 \u591a\u7528\u4e8e\u8c03\u8bd5\u3002 \u5b8c\u6574\u7684\u5bf9\u8f93\u51fa\u7684\u63a7\u5236\uff0c\u8bf7\u4f7f\u7528 string.format \u4ee5\u53ca io.write\u3002\n\n\n4.1.3 error (message [, level])\n\n\n\u4e2d\u6b62\u4e0a\u4e00\u6b21\u4fdd\u62a4\u51fd\u6570\u8c03\u7528\uff0c \u5c06\u9519\u8bef\u5bf9\u8c61 message \u8fd4\u56de\u3002 \u51fd\u6570 error \u6c38\u8fdc\u4e0d\u4f1a\u8fd4\u56de\u3002\n\u5f53 message \u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\u65f6\uff0c\u901a\u5e38 error \u4f1a\u628a\u4e00\u4e9b\u6709\u5173\u51fa\u9519\u4f4d\u7f6e\u7684\u4fe1\u606f\u9644\u52a0\u5728\u6d88\u606f\u7684\u524d\u5934\u3002 level \u53c2\u6570\u6307\u660e\u4e86\u600e\u6837\u83b7\u5f97\u51fa\u9519\u4f4d\u7f6e\u3002 \u5bf9\u4e8e level 1 \uff08\u9ed8\u8ba4\u503c\uff09\uff0c\u51fa\u9519\u4f4d\u7f6e\u6307 error \u51fd\u6570\u8c03\u7528\u7684\u4f4d\u7f6e\u3002 Level 2 \u5c06\u51fa\u9519\u4f4d\u7f6e\u6307\u5411\u8c03\u7528 error\u7684\u51fd\u6570\u7684\u51fd\u6570\uff1b\u4ee5\u6b64\u7c7b\u63a8\u3002 \u4f20\u5165 level 0 \u53ef\u4ee5\u907f\u514d\u5728\u6d88\u606f\u524d\u6dfb\u52a0\u51fa\u9519\u4f4d\u7f6e\u4fe1\u606f\u3002\n\n\n4.1.4 getmetatable (object)\n\n\n\u5982\u679c object \u4e0d\u5305\u542b\u5143\u8868\uff0c\u8fd4\u56de nil \u3002 \u5426\u5219\uff0c\u5982\u679c\u5728\u8be5\u5bf9\u8c61\u7684\u5143\u8868\u4e2d\u6709 \"__metatable\" \u57df\u65f6\u8fd4\u56de\u5176\u5173\u8054\u503c\uff0c \u6ca1\u6709\u65f6\u8fd4\u56de\u8be5\u5bf9\u8c61\u7684\u5143\u8868\u3002\n\n\n4.1.5 ipairs (t)\n\n\n\u8fd4\u56de\u4e09\u4e2a\u503c\uff08\u8fed\u4ee3\u51fd\u6570\u3001\u8868 t \u4ee5\u53ca 0 \uff09\uff0c \u5982\u6b64\uff0c\u4ee5\u4e0b\u4ee3\u7801\n\n\n for i,v in ipairs(t) do body end\n\n\n\n\u5c06\u8fed\u4ee3\u952e\u503c\u5bf9\uff081,t[1]) \uff0c(2,t[2])\uff0c ... \uff0c\u76f4\u5230\u7b2c\u4e00\u4e2a\u7a7a\u503c\u3002\n\n\n\u793a\u4f8b\u4ee3\u7801\uff1a\n\n\nlocal nums = {11, 22, 33}\nfor i,v in ipairs(nums) do \n    print(i..' -\n '..v) \nend\n\n\n\n4.1.6 pcall (f [, arg1, \u00b7\u00b7\u00b7])\n\n\n\u4f20\u5165\u53c2\u6570\uff0c\u4ee5 \u4fdd\u62a4\u6a21\u5f0f \u8c03\u7528\u51fd\u6570 f \u3002 \n\u8fd9\u610f\u5473\u7740 f \u4e2d\u7684\u4efb\u4f55\u9519\u8bef\u4e0d\u4f1a\u629b\u51fa\uff1b \u53d6\u800c\u4ee3\u4e4b\u7684\u662f\uff0cpcall \u4f1a\u5c06\u9519\u8bef\u6355\u83b7\u5230\uff0c\u5e76\u8fd4\u56de\u4e00\u4e2a\u72b6\u6001\u7801\u3002 \u7b2c\u4e00\u4e2a\u8fd4\u56de\u503c\u662f\u72b6\u6001\u7801\uff08\u4e00\u4e2a\u5e03\u5c14\u91cf\uff09\uff0c \u5f53\u6ca1\u6709\u9519\u8bef\u65f6\uff0c\u5176\u4e3a\u771f\u3002 \u6b64\u65f6\uff0cpcall \u540c\u6837\u4f1a\u5728\u72b6\u6001\u7801\u540e\u8fd4\u56de\u6240\u6709\u8c03\u7528\u7684\u7ed3\u679c\u3002 \u5728\u6709\u9519\u8bef\u65f6\uff0cpcall \u8fd4\u56de false \u52a0\u9519\u8bef\u6d88\u606f\u3002\n\n\n4.1.7 rawequal (v1, v2)\n\n\n\u5728\u4e0d\u89e6\u53d1\u4efb\u4f55\u5143\u65b9\u6cd5\u7684\u60c5\u51b5\u4e0b \u68c0\u67e5 v1 \u662f\u5426\u548c v2 \u76f8\u7b49\u3002 \u8fd4\u56de\u4e00\u4e2a\u5e03\u5c14\u91cf\u3002\n\n\n4.1.8 rawlen (v)\n\n\n\u5728\u4e0d\u89e6\u53d1\u4efb\u4f55\u5143\u65b9\u6cd5\u7684\u60c5\u51b5\u4e0b \u8fd4\u56de\u5bf9\u8c61 v \u7684\u957f\u5ea6\u3002 v \u53ef\u4ee5\u662f\u8868\u6216\u5b57\u7b26\u4e32\u3002 \u5b83\u8fd4\u56de\u4e00\u4e2a\u6574\u6570\u3002\n\n\n4.1.9 setmetatable (table, metatable)\n\n\n\u7ed9\u6307\u5b9a\u8868\u8bbe\u7f6e\u5143\u8868\u3002\n\uff08\u4f60\u4e0d\u80fd\u5728 Lua \u4e2d\u6539\u53d8\u5176\u5b83\u7c7b\u578b\u503c\u7684\u5143\u8868\uff0c\u90a3\u4e9b\u53ea\u80fd\u5728 C \u91cc\u505a\u3002\uff09 \u5982\u679c metatable \u662f nil\uff0c \u5c06\u6307\u5b9a\u8868\u7684\u5143\u8868\u79fb\u9664\u3002 \u5982\u679c\u539f\u6765\u90a3\u5f20\u5143\u8868\u6709 \"__metatable\" \u57df\uff0c\u629b\u51fa\u4e00\u4e2a\u9519\u8bef\u3002\n\n\n\u8fd9\u4e2a\u51fd\u6570\u8fd4\u56de table\u3002\n\n\n4.1.10 tonumber (e [, base])\n\n\n\u5982\u679c\u8c03\u7528\u7684\u65f6\u5019\u6ca1\u6709 base\uff0c tonumber \u5c1d\u8bd5\u628a\u53c2\u6570\u8f6c\u6362\u4e3a\u4e00\u4e2a\u6570\u5b57\u3002 \u5982\u679c\u53c2\u6570\u5df2\u7ecf\u662f\u4e00\u4e2a\u6570\u5b57\uff0c\u6216\u662f\u4e00\u4e2a\u53ef\u4ee5\u8f6c\u6362\u4e3a\u6570\u5b57\u7684\u5b57\u7b26\u4e32\uff0c tonumber \u5c31\u8fd4\u56de\u8fd9\u4e2a\u6570\u5b57\uff1b \u5426\u5219\u8fd4\u56de nil\u3002\n\n\n\u5b57\u7b26\u4e32\u7684\u8f6c\u6362\u7ed3\u679c\u53ef\u80fd\u662f\u6574\u6570\u4e5f\u53ef\u80fd\u662f\u6d6e\u70b9\u6570\uff0c \u8fd9\u53d6\u51b3\u4e8e Lua \u7684\u8f6c\u6362\u6587\u6cd5\u3002 \uff08\u5b57\u7b26\u4e32\u53ef\u4ee5\u6709\u524d\u7f6e\u548c\u540e\u7f6e\u7684\u7a7a\u683c\uff0c\u53ef\u4ee5\u5e26\u7b26\u53f7\u3002\uff09\n\n\n\u5f53\u4f20\u5165 base \u8c03\u7528\u5b83\u65f6\uff0c e \u5fc5\u987b\u662f\u4e00\u4e2a\u4ee5\u8be5\u8fdb\u5236\u8868\u793a\u7684\u6574\u6570\u5b57\u7b26\u4e32\u3002\n \u8fdb\u5236\u53ef\u4ee5\u662f 2 \u5230 36 \uff08\u5305\u542b 2 \u548c 36\uff09\u4e4b\u95f4\u7684\u4efb\u4f55\u6574\u6570\u3002 \u5927\u4e8e 10 \u8fdb\u5236\u65f6\uff0c\u5b57\u6bcd 'A' \uff08\u5927\u5c0f\u5199\u5747\u53ef\uff09\u8868\u793a 10 \uff0c 'B' \u8868\u793a 11\uff0c\u4f9d\u6b21\u5230 'Z' \u8868\u793a 35 \u3002 \u5982\u679c\u5b57\u7b26\u4e32 e \u4e0d\u662f\u8be5\u8fdb\u5236\u4e0b\u7684\u5408\u6cd5\u6570\u5b57\uff0c \u51fd\u6570\u8fd4\u56de nil\u3002\n\n\n4.1.11 tostring (v)\n\n\n\u53ef\u4ee5\u63a5\u6536\u4efb\u4f55\u7c7b\u578b\uff0c\u5b83\u5c06\u5176\u8f6c\u6362\u4e3a\u4eba\u53ef\u9605\u8bfb\u7684\u5b57\u7b26\u4e32\u5f62\u5f0f\u3002 \u6d6e\u70b9\u6570\u603b\u88ab\u8f6c\u6362\u4e3a\u6d6e\u70b9\u6570\u7684\u8868\u73b0\u5f62\u5f0f\uff08\u5c0f\u6570\u70b9\u5f62\u5f0f\u6216\u662f\u6307\u6570\u5f62\u5f0f\uff09\u3002 \uff08\u5982\u679c\u60f3\u5b8c\u5168\u63a7\u5236\u6570\u5b57\u5982\u4f55\u88ab\u8f6c\u6362\uff0c\u53ef\u4ee5\u4f7f\u7528 string.format\u3002\uff09\n\u5982\u679c v \u6709 \"__tostring\" \u57df\u7684\u5143\u8868\uff0c tostring \u4f1a\u4ee5 v \u4e3a\u53c2\u6570\u8c03\u7528\u5b83\u3002 \u5e76\u7528\u5b83\u7684\u7ed3\u679c\u4f5c\u4e3a\u8fd4\u56de\u503c\u3002\n\n\n4.1.12 type (v)\n\n\n\u5c06\u53c2\u6570\u7684\u7c7b\u578b\u7f16\u7801\u4e3a\u4e00\u4e2a\u5b57\u7b26\u4e32\u8fd4\u56de\u3002 \u51fd\u6570\u53ef\u80fd\u7684\u8fd4\u56de\u503c\u6709 \"nil\" \uff08\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u800c\u4e0d\u662f nil \u503c\uff09\uff0c \"number\"\uff0c \"string\"\uff0c \"boolean\"\uff0c \"table\"\uff0c \"function\"\uff0c \"thread\"\uff0c \"userdata\"\u3002\n\n\n\u793a\u4f8b\u4ee3\u7801\uff1a\n\n\nlocal num = tonumber(\"12.5\")\nlocal str = tostring(13.2)\n\nprint(type(num)) -- number\nprint(type(str)) -- string\nprint(tonumber(\"FF\", 16)) -- 255\n\n\n\n4.2 \u534f\u7a0b\u7ba1\u7406\n\n\n\u5173\u4e8e\u534f\u7a0b\u7684\u64cd\u4f5c\u4f5c\u4e3a\u57fa\u7840\u5e93\u7684\u4e00\u4e2a\u5b50\u5e93\uff0c \u88ab\u653e\u5728\u4e00\u4e2a\u72ec\u7acb\u8868 coroutine \u4e2d\u3002 \n\n\n4.2.1 coroutine.create (f)\n\n\n\u521b\u5efa\u4e00\u4e2a\u4e3b\u4f53\u51fd\u6570\u4e3a f \u7684\u65b0\u534f\u7a0b\u3002 f \u5fc5\u987b\u662f\u4e00\u4e2a Lua \u7684\u51fd\u6570\u3002 \u8fd4\u56de\u8fd9\u4e2a\u65b0\u534f\u7a0b\uff0c\u5b83\u662f\u4e00\u4e2a\u7c7b\u578b\u4e3a \"thread\" \u7684\u5bf9\u8c61\u3002\n\n\n4.2.2 coroutine.isyieldable ()\n\n\n\u5982\u679c\u6b63\u5728\u8fd0\u884c\u7684\u534f\u7a0b\u53ef\u4ee5\u8ba9\u51fa\uff0c\u5219\u8fd4\u56de\u771f\u3002\n\n\n\u4e0d\u5728\u4e3b\u7ebf\u7a0b\u4e2d\u6216\u4e0d\u5728\u4e00\u4e2a\u65e0\u6cd5\u8ba9\u51fa\u7684 C \u51fd\u6570\u4e2d\u65f6\uff0c\u5f53\u524d\u534f\u7a0b\u662f\u53ef\u8ba9\u51fa\u7684\u3002\n\n\n4.2.3 coroutine.resume (co [, val1, \u00b7\u00b7\u00b7])\n\n\n\u5f00\u59cb\u6216\u7ee7\u7eed\u534f\u7a0b co \u7684\u8fd0\u884c\u3002 \u5f53\u4f60\u7b2c\u4e00\u6b21\u5ef6\u7eed\u4e00\u4e2a\u534f\u7a0b\uff0c\u5b83\u4f1a\u4ece\u4e3b\u4f53\u51fd\u6570\u5904\u5f00\u59cb\u8fd0\u884c\u3002 val1, ... \u8fd9\u4e9b\u503c\u4f1a\u4ee5\u53c2\u6570\u5f62\u5f0f\u4f20\u5165\u4e3b\u4f53\u51fd\u6570\u3002 \u5982\u679c\u8be5\u534f\u7a0b\u88ab\u8ba9\u51fa\uff0cresume \u4f1a\u91cd\u65b0\u542f\u52a8\u5b83\uff1b val1, ... \u8fd9\u4e9b\u53c2\u6570\u4f1a\u4f5c\u4e3a\u8ba9\u51fa\u70b9\u7684\u8fd4\u56de\u503c\u3002\n\n\n\u5982\u679c\u534f\u7a0b\u8fd0\u884c\u8d77\u6765\u6ca1\u6709\u9519\u8bef\uff0c resume \u8fd4\u56de true \u52a0\u4e0a\u4f20\u7ed9 yield \u7684\u6240\u6709\u503c \uff08\u5f53\u534f\u7a0b\u8ba9\u51fa\uff09\uff0c \u6216\u662f\u4e3b\u4f53\u51fd\u6570\u7684\u6240\u6709\u8fd4\u56de\u503c\uff08\u5f53\u534f\u7a0b\u4e2d\u6b62\uff09\u3002 \u5982\u679c\u6709\u4efb\u4f55\u9519\u8bef\u53d1\u751f\uff0c resume \u8fd4\u56de false \u52a0\u9519\u8bef\u6d88\u606f\u3002\n\n\n4.2.4 coroutine.running ()\n\n\n\u8fd4\u56de\u5f53\u524d\u6b63\u5728\u8fd0\u884c\u7684\u534f\u7a0b\u52a0\u4e00\u4e2a\u5e03\u5c14\u91cf\u3002 \u5982\u679c\u5f53\u524d\u8fd0\u884c\u7684\u534f\u7a0b\u662f\u4e3b\u7ebf\u7a0b\uff0c\u5176\u4e3a\u771f\u3002\n\n\n4.2.5 coroutine.status (co)\n\n\n\u4ee5\u5b57\u7b26\u4e32\u5f62\u5f0f\u8fd4\u56de\u534f\u7a0b co \u7684\u72b6\u6001\uff1a \n\n\n\n\n\u5f53\u534f\u7a0b\u6b63\u5728\u8fd0\u884c\uff08\u5b83\u5c31\u662f\u8c03\u7528 status \u7684\u90a3\u4e2a\uff09 \uff0c\u8fd4\u56de \"running\"\uff1b \n\n\n\u5982\u679c\u534f\u7a0b\u8c03\u7528 yield \u6302\u8d77\u6216\u662f\u8fd8\u6ca1\u6709\u5f00\u59cb\u8fd0\u884c\uff0c\u8fd4\u56de \"suspended\"\uff1b\n\n\n\u5982\u679c\u534f\u7a0b\u662f\u6d3b\u52a8\u7684\uff0c\u90fd\u5e76\u4e0d\u5728\u8fd0\u884c\uff08\u5373\u5b83\u6b63\u5728\u5ef6\u7eed\u5176\u5b83\u534f\u7a0b\uff09\uff0c\u8fd4\u56de \"normal\"\uff1b \n\n\n\u5982\u679c\u534f\u7a0b\u8fd0\u884c\u5b8c\u4e3b\u4f53\u51fd\u6570\u6216\u56e0\u9519\u8bef\u505c\u6b62\uff0c\u8fd4\u56de \"dead\"\u3002\n\n\n\n\n4.2.6 coroutine.wrap (f)\n\n\n\u521b\u5efa\u4e00\u4e2a\u4e3b\u4f53\u51fd\u6570\u4e3a f \u7684\u65b0\u534f\u7a0b\u3002 f \u5fc5\u987b\u662f\u4e00\u4e2a Lua \u7684\u51fd\u6570\u3002 \u8fd4\u56de\u4e00\u4e2a\u51fd\u6570\uff0c \u6bcf\u6b21\u8c03\u7528\u8be5\u51fd\u6570\u90fd\u4f1a\u5ef6\u7eed\u8be5\u534f\u7a0b\u3002 \u4f20\u7ed9\u8fd9\u4e2a\u51fd\u6570\u7684\u53c2\u6570\u90fd\u4f1a\u4f5c\u4e3a resume \u7684\u989d\u5916\u53c2\u6570\u3002 \u548c resume \u8fd4\u56de\u76f8\u540c\u7684\u503c\uff0c \u53ea\u662f\u6ca1\u6709\u7b2c\u4e00\u4e2a\u5e03\u5c14\u91cf\u3002 \u5982\u679c\u53d1\u751f\u4efb\u4f55\u9519\u8bef\uff0c\u629b\u51fa\u8fd9\u4e2a\u9519\u8bef\u3002\n\n\n4.2.7 coroutine.yield (\u00b7\u00b7\u00b7)\n\n\n\u6302\u8d77\u6b63\u5728\u8c03\u7528\u7684\u534f\u7a0b\u7684\u6267\u884c\u3002 \u4f20\u9012\u7ed9 yield \u7684\u53c2\u6570\u90fd\u4f1a\u8f6c\u4e3a resume \u7684\u989d\u5916\u8fd4\u56de\u503c\u3002\n\n\n\u793a\u4f8b1-\u7b80\u5355\u7684\u6848\u4f8b\uff1a\n\n\nlocal co = coroutine.create(function () \n    print(\"Hello World\") \nend)\n\nprint(coroutine.status(co))   -- suspended\n\ncoroutine.resume(co)          -- Hello World\n\n\n\n\u8c03\u7528\u4e86resume\u51fd\u6570\uff0c\u5c06\u534f\u540c\u7a0b\u5e8fco\u7531suspended\u6539\u4e3arunning\u72b6\u6001\uff0c\u5f53\u6253\u5370\u4e86Hello World\u4e4b\u540e\uff0c\u534f\u540c\u7a0b\u5e8fco\u5c31\u5904\u4e8e\u6b7b\u4ea1\u72b6\u6001\u3002\n\n\n\u793a\u4f8b2-yield\u4e0eresume\uff1a\n\n\nlocal co = coroutine.create(function ()\n     for i = 1, 10 do\n          print(\"co\", i)\n          coroutine.yield()     -- \u6302\u8d77\n     end\nend)\n\n\nprint(coroutine.status(co))     -- suspended\n\ncoroutine.resume(co)            -- \u6253\u5370co 1\n\nprint(coroutine.status(co))     -- suspended\n\ncoroutine.resume(co)            -- \u6253\u5370co 2\n\nprint(coroutine.status(co))     -- suspended\n\ncoroutine.resume(co)            -- \u6253\u5370co 3\ncoroutine.resume(co)            -- \u6253\u5370co 4\ncoroutine.resume(co)            -- \u6253\u5370co 5\ncoroutine.resume(co)            -- \u6253\u5370co 6\ncoroutine.resume(co)            -- \u6253\u5370co 7\ncoroutine.resume(co)            -- \u6253\u5370co 8\ncoroutine.resume(co)            -- \u6253\u5370co 9\ncoroutine.resume(co)            -- \u6253\u5370co 10\ncoroutine.resume(co)            -- \u4ec0\u4e48\u90fd\u4e0d\u6253\u5370\nprint(coroutine.status(co))     -- dead\n\n\n\n4.3 \u6a21\u5757\n\n\n\u5305\u7ba1\u7406\u5e93\u63d0\u4f9b\u4e86\u4ece Lua \u4e2d\u52a0\u8f7d\u6a21\u5757\u7684\u57fa\u7840\u5e93\u3002 \u53ea\u6709\u4e00\u4e2a\u5bfc\u51fa\u51fd\u6570\u76f4\u63a5\u653e\u5728\u5168\u5c40\u73af\u5883\u4e2d\uff1a require\u3002 \u6240\u6709\u5176\u5b83\u7684\u90e8\u5206\u90fd\u5bfc\u51fa\u5728\u8868 package \u4e2d\u3002\n\n\n4.3.1 require (modname)\n\n\n\u52a0\u8f7d\u4e00\u4e2a\u6a21\u5757\u3002\n \u8fd9\u4e2a\u51fd\u6570\u9996\u5148\u67e5\u627e package.loaded \u8868\uff0c \u68c0\u6d4b modname \u662f\u5426\u88ab\u52a0\u8f7d\u8fc7\u3002 \u5982\u679c\u88ab\u52a0\u8f7d\u8fc7\uff0crequire \u8fd4\u56de package.loaded[modname] \u4e2d\u4fdd\u5b58\u7684\u503c\u3002 \u5426\u5219\uff0c\u5b83\u8bd5\u7740\u4e3a\u6a21\u5757\u5bfb\u627e \u52a0\u8f7d\u5668 \u3002\n\n\nrequire \u9075\u5faa package.searchers \u5e8f\u5217\u7684\u6307\u5f15\u6765\u67e5\u627e\u52a0\u8f7d\u5668\u3002 \u5982\u679c\u6539\u53d8\u8fd9\u4e2a\u5e8f\u5217\uff0c\u6211\u4eec\u53ef\u4ee5\u6539\u53d8 require \u5982\u4f55\u67e5\u627e\u4e00\u4e2a\u6a21\u5757\u3002 \u4e0b\u5217\u8bf4\u660e\u57fa\u4e8e package.searchers \u7684\u9ed8\u8ba4\u914d\u7f6e\u3002\n\n\n\u9996\u5148 require \u67e5\u627e package.preload[modname] \u3002 \u5982\u679c\u8fd9\u91cc\u6709\u4e00\u4e2a\u503c\uff0c\u8fd9\u4e2a\u503c\uff08\u5fc5\u987b\u662f\u4e00\u4e2a\u51fd\u6570\uff09\u5c31\u662f\u90a3\u4e2a\u52a0\u8f7d\u5668\u3002 \u5426\u5219 require \u4f7f\u7528 Lua \u52a0\u8f7d\u5668\u53bb\u67e5\u627e package.path \u7684\u8def\u5f84\u3002 \u5982\u679c\u67e5\u627e\u5931\u8d25\uff0c\u63a5\u7740\u4f7f\u7528 C \u52a0\u8f7d\u5668\u53bb\u67e5\u627e package.cpath \u7684\u8def\u5f84\u3002 \u5982\u679c\u90fd\u5931\u8d25\u4e86\uff0c\u518d\u5c1d\u8bd5 \u4e00\u4f53\u5316 \u52a0\u8f7d\u5668 \uff08\u53c2\u89c1 package.searchers\uff09\u3002\n\n\n\u6bcf\u6b21\u627e\u5230\u4e00\u4e2a\u52a0\u8f7d\u5668\uff0crequire \u90fd\u7528\u4e24\u4e2a\u53c2\u6570\u8c03\u7528\u52a0\u8f7d\u5668\uff1a modname \u548c\u4e00\u4e2a\u5728\u83b7\u53d6\u52a0\u8f7d\u5668\u8fc7\u7a0b\u4e2d\u5f97\u5230\u7684\u53c2\u6570\u3002 \uff08\u5982\u679c\u901a\u8fc7\u67e5\u627e\u6587\u4ef6\u5f97\u5230\u7684\u52a0\u8f7d\u5668\uff0c\u8fd9\u4e2a\u989d\u5916\u53c2\u6570\u662f\u6587\u4ef6\u540d\u3002\uff09 \u5982\u679c\u52a0\u8f7d\u5668\u8fd4\u56de\u975e\u7a7a\u503c\uff0c require \u5c06\u8fd9\u4e2a\u503c\u8d4b\u7ed9 package.loaded[modname]\u3002 \u5982\u679c\u52a0\u8f7d\u5668\u6ca1\u80fd\u8fd4\u56de\u4e00\u4e2a\u975e\u7a7a\u503c\u7528\u4e8e\u8d4b\u7ed9 package.loaded[modname]\uff0c require \u4f1a\u5728\u90a3\u91cc\u8bbe\u5165 true \u3002 \u65e0\u8bba\u662f\u4ec0\u4e48\u60c5\u51b5\uff0crequire \u90fd\u4f1a\u8fd4\u56de package.loaded[modname] \u7684\u6700\u7ec8\u503c\u3002\n\n\n\u5982\u679c\u5728\u52a0\u8f7d\u6216\u8fd0\u884c\u6a21\u5757\u65f6\u6709\u9519\u8bef\uff0c \u6216\u662f\u65e0\u6cd5\u4e3a\u6a21\u5757\u627e\u5230\u52a0\u8f7d\u5668\uff0c require \u90fd\u4f1a\u629b\u51fa\u9519\u8bef\u3002\n\n\n4.3.2 package.config\n\n\n\u4e00\u4e2a\u63cf\u8ff0\u6709\u4e00\u4e9b\u4e3a\u5305\u7ba1\u7406\u51c6\u5907\u7684\u7f16\u8bd1\u671f\u914d\u7f6e\u4fe1\u606f\u7684\u4e32\u3002 \u8fd9\u4e2a\u5b57\u7b26\u4e32\u7531\u4e00\u7cfb\u5217\u884c\u6784\u6210\uff1a\n\n\n\n\n\u7b2c\u4e00\u884c\u662f\u76ee\u5f55\u5206\u5272\u4e32\u3002 \u5bf9\u4e8e Windows \u9ed8\u8ba4\u662f '\\' \uff0c\u5bf9\u4e8e\u5176\u5b83\u7cfb\u7edf\u662f '/' \u3002\n\n\n\u7b2c\u4e8c\u884c\u662f\u7528\u4e8e\u8def\u5f84\u4e2d\u7684\u5206\u5272\u7b26\u3002\u9ed8\u8ba4\u503c\u662f ';' \u3002\n\n\n\u7b2c\u4e09\u884c\u662f\u7528\u4e8e\u6807\u8bb0\u6a21\u677f\u66ff\u6362\u70b9\u7684\u5b57\u7b26\u4e32\u3002 \u9ed8\u8ba4\u662f '?' \u3002\n\n\n\u7b2c\u56db\u884c\u662f\u5728 Windows \u4e2d\u5c06\u88ab\u66ff\u6362\u6210\u6267\u884c\u7a0b\u5e8f\u6240\u5728\u76ee\u5f55\u7684\u8def\u5f84\u7684\u5b57\u7b26\u4e32\u3002 \u9ed8\u8ba4\u662f '!' \u3002\n\n\n\u7b2c\u4e94\u884c\u662f\u4e00\u4e2a\u8bb0\u53f7\uff0c\u8be5\u8bb0\u53f7\u4e4b\u540e\u7684\u6240\u6709\u6587\u672c\u5c06\u5728\u6784\u5efa luaopen_ \u51fd\u6570\u540d\u65f6\u88ab\u5ffd\u7565\u6389\u3002 \u9ed8\u8ba4\u662f '-'\u3002\n\n\n\n\n4.3.3 package.cpath\n\n\n\u8fd9\u4e2a\u8def\u5f84\u88ab require \u5728 C \u52a0\u8f7d\u5668\u4e2d\u505a\u641c\u7d22\u65f6\u7528\u5230\u3002\n\n\nLua \u7528\u548c\u521d\u59cb\u5316 Lua \u8def\u5f84 package.path \u76f8\u540c\u7684\u65b9\u5f0f\u521d\u59cb\u5316 C \u8def\u5f84 package.cpath \u3002 \u5b83\u4f1a\u4f7f\u7528\u73af\u5883\u53d8\u91cf LUA_CPATH_5_3 \u6216 \u73af\u5883\u53d8\u91cf LUA_CPATH \u521d\u59cb\u5316\u3002 \u8981\u4e48\u5c31\u91c7\u7528 luaconf.h \u4e2d\u5b9a\u4e49\u7684\u9ed8\u8ba4\u8def\u5f84\u3002\n\n\n4.3.4 package.path\n\n\n\u8fd9\u4e2a\u8def\u5f84\u88ab require \u5728 Lua \u52a0\u8f7d\u5668\u4e2d\u505a\u641c\u7d22\u65f6\u7528\u5230\u3002\n\n\n\u5728\u542f\u52a8\u65f6\uff0cLua \u7528\u73af\u5883\u53d8\u91cf LUA_PATH_5_3 \u6216\u73af\u5883\u53d8\u91cf LUA_PATH \u6765\u521d\u59cb\u5316\u8fd9\u4e2a\u53d8\u91cf\u3002 \u6216\u91c7\u7528 luaconf.h \u4e2d\u7684\u9ed8\u8ba4\u8def\u5f84\u3002 \u73af\u5883\u53d8\u91cf\u4e2d\u51fa\u73b0\u7684\u6240\u6709 \";;\" \u90fd\u4f1a\u88ab\u66ff\u6362\u6210\u9ed8\u8ba4\u8def\u5f84\u3002\n\n\n4.3.5 package.searchers\n\n\n\u7528\u4e8e require \u63a7\u5236\u5982\u4f55\u52a0\u8f7d\u6a21\u5757\u7684\u8868\u3002\n\n\n\u8fd9\u5f20\u8868\u5185\u7684\u6bcf\u4e00\u9879\u90fd\u662f\u4e00\u4e2a \u67e5\u627e\u5668\u51fd\u6570\u3002 \u5f53\u67e5\u627e\u4e00\u4e2a\u6a21\u5757\u65f6\uff0c require \u6309\u6b21\u5e8f\u8c03\u7528\u8fd9\u4e9b\u67e5\u627e\u5668\uff0c \u5e76\u4f20\u5165\u6a21\u5757\u540d\uff08require \u7684\u53c2\u6570\uff09\u4f5c\u4e3a\u552f\u4e00\u7684\u4e00\u4e2a\u53c2\u6570\u3002 \u6b64\u51fd\u6570\u53ef\u4ee5\u8fd4\u56de\u53e6\u4e00\u4e2a\u51fd\u6570\uff08\u6a21\u5757\u7684 \u52a0\u8f7d\u5668\uff09\u52a0\u4e0a\u53e6\u4e00\u4e2a\u5c06\u4f20\u9012\u7ed9\u8fd9\u4e2a\u52a0\u8f7d\u5668\u7684\u53c2\u6570\u3002 \u6216\u662f\u8fd4\u56de\u4e00\u4e2a\u63cf\u8ff0\u4e3a\u4f55\u6ca1\u6709\u627e\u5230\u8fd9\u4e2a\u6a21\u5757\u7684\u5b57\u7b26\u4e32 \uff08\u6216\u662f\u8fd4\u56de nil \u4ec0\u4e48\u4e5f\u4e0d\u60f3\u8bf4\uff09\u3002\n\n\nLua \u7528\u56db\u4e2a\u67e5\u627e\u5668\u51fd\u6570\u521d\u59cb\u5316\u8fd9\u5f20\u8868\u3002\n\n\n\n\n\n\n\u7b2c\u4e00\u4e2a\u67e5\u627e\u5668\u5c31\u662f\u7b80\u5355\u7684\u5728 package.preload \u8868\u4e2d\u67e5\u627e\u52a0\u8f7d\u5668\u3002\n\n\n\n\n\n\n\u7b2c\u4e8c\u4e2a\u67e5\u627e\u5668\u7528\u4e8e\u67e5\u627e Lua \u5e93\u7684\u52a0\u8f7d\u5e93\u3002 \u5b83\u4f7f\u7528\u50a8\u5b58\u5728 package.path \u4e2d\u7684\u8def\u5f84\u6765\u505a\u67e5\u627e\u5de5\u4f5c\u3002 \u67e5\u627e\u8fc7\u7a0b\u548c\u51fd\u6570 package.searchpath \u63cf\u8ff0\u7684\u4e00\u81f4\u3002\n\n\n\n\n\n\n\u7b2c\u4e09\u4e2a\u67e5\u627e\u5668\u7528\u4e8e\u67e5\u627e C \u5e93\u7684\u52a0\u8f7d\u5e93\u3002 \u5b83\u4f7f\u7528\u50a8\u5b58\u5728 package.cpath \u4e2d\u7684\u8def\u5f84\u6765\u505a\u67e5\u627e\u5de5\u4f5c\u3002 \u540c\u6837\uff0c \u67e5\u627e\u8fc7\u7a0b\u548c\u51fd\u6570 package.searchpath \u63cf\u8ff0\u7684\u4e00\u81f4\u3002 \u4f8b\u5982\uff0c\u5982\u679c C \u8def\u5f84\u662f\u8fd9\u6837\u4e00\u4e2a\u5b57\u7b26\u4e32\n\n\n\"./?.so;./?.dll;/usr/local/?/init.so\"\n\u67e5\u627e\u5668\u67e5\u627e\u6a21\u5757 foo \u4f1a\u4f9d\u6b21\u5c1d\u8bd5\u6253\u5f00\u6587\u4ef6 ./foo.so\uff0c./foo.dll\uff0c \u4ee5\u53ca /usr/local/foo/init.so\u3002 \u4e00\u65e6\u5b83\u627e\u5230\u4e00\u4e2a C \u5e93\uff0c \u67e5\u627e\u5668\u9996\u5148\u4f7f\u7528\u52a8\u6001\u94fe\u63a5\u673a\u5236\u8fde\u63a5\u8be5\u5e93\u3002 \u7136\u540e\u5c1d\u8bd5\u5728\u8be5\u5e93\u4e2d\u627e\u5230\u53ef\u4ee5\u7528\u4f5c\u52a0\u8f7d\u5668\u7684 C \u51fd\u6570\u3002 \u8fd9\u4e2a C \u51fd\u6570\u7684\u540d\u5b57\u662f \"luaopen_\" \u7d27\u63a5\u6a21\u5757\u540d\u7684\u5b57\u7b26\u4e32\uff0c \u5176\u4e2d\u5b57\u7b26\u4e32\u4e2d\u6240\u6709\u7684\u4e0b\u5212\u7ebf\u90fd\u4f1a\u88ab\u66ff\u6362\u6210\u70b9\u3002 \u6b64\u5916\uff0c\u5982\u679c\u6a21\u5757\u540d\u4e2d\u6709\u6a2a\u7ebf\uff0c \u6a2a\u7ebf\u540e\u9762\u7684\u90e8\u5206\uff08\u5305\u62ec\u6a2a\u7ebf\uff09\u90fd\u88ab\u53bb\u6389\u3002 \u4f8b\u5982\uff0c\u5982\u679c\u6a21\u5757\u540d\u4e3a a.b.c-v2.1\uff0c \u51fd\u6570\u540d\u5c31\u662f luaopen_a_b_c\u3002\n\n\n\n\n\n\n\u7b2c\u56db\u4e2a\u641c\u7d22\u5668\u662f\u3000\u4e00\u4f53\u5316\u52a0\u8f7d\u5668\u3002 \u5b83\u4ece C \u8def\u5f84\u4e2d\u67e5\u627e\u6307\u5b9a\u6a21\u5757\u7684\u6839\u540d\u5b57\u3002 \u4f8b\u5982\uff0c\u5f53\u8bf7\u6c42 a.b.c\u3000\u65f6\uff0c \u5b83\u5c06\u67e5\u627e a \u8fd9\u4e2a C \u5e93\u3002 \u5982\u679c\u627e\u5f97\u5230\uff0c\u5b83\u4f1a\u5728\u91cc\u9762\u627e\u5b50\u6a21\u5757\u7684\u52a0\u8f7d\u51fd\u6570\u3002 \u5728\u6211\u4eec\u7684\u4f8b\u5b50\u4e2d\uff0c\u5c31\u662f\u627e\u3000luaopen_a_b_c\u3002 \u5229\u7528\u8fd9\u4e2a\u673a\u5236\uff0c\u53ef\u4ee5\u628a\u82e5\u5e72 C \u5b50\u6a21\u5757\u6253\u5305\u8fdb\u5355\u4e2a\u5e93\u3002 \u6bcf\u4e2a\u5b50\u6a21\u5757\u90fd\u53ef\u4ee5\u6709\u539f\u672c\u7684\u52a0\u8f7d\u51fd\u6570\u540d\u3002\n\n\n\n\n\n\n\u9664\u4e86\u7b2c\u4e00\u4e2a\uff08\u9884\u52a0\u8f7d\uff09\u641c\u7d22\u5668\u5916\uff0c\u6bcf\u4e2a\u641c\u7d22\u5668\u90fd\u4f1a\u8fd4\u56de \u5b83\u627e\u5230\u7684\u6a21\u5757\u7684\u6587\u4ef6\u540d\u3002 \u8fd9\u548c package.searchpath \u7684\u8fd4\u56de\u503c\u4e00\u6837\u3002 \u7b2c\u4e00\u4e2a\u641c\u7d22\u5668\u6ca1\u6709\u8fd4\u56de\u503c\u3002\n\n\n4.3.6 package.searchpath (name, path [, sep [, rep]])\n\n\n\u5728\u6307\u5b9a path \u4e2d\u641c\u7d22\u6307\u5b9a\u7684 name \u3002\n\n\n\u8def\u5f84\u662f\u4e00\u4e2a\u5305\u542b\u6709\u4e00\u7cfb\u5217\u4ee5\u5206\u53f7\u5206\u5272\u7684 \u6a21\u677f \u6784\u6210\u7684\u5b57\u7b26\u4e32\u3002 \u5bf9\u4e8e\u6bcf\u4e2a\u6a21\u677f\uff0c\u90fd\u4f1a\u7528 name \u66ff\u6362\u5176\u4e2d\u7684\u6bcf\u4e2a\u95ee\u53f7\uff08\u5982\u679c\u6709\u7684\u8bdd\uff09\u3002 \u4e14\u5c06\u5176\u4e2d\u7684 sep \uff08\u9ed8\u8ba4\u662f\u70b9\uff09\u66ff\u6362\u4e3a rep \uff08\u9ed8\u8ba4\u662f\u7cfb\u7edf\u7684\u76ee\u5f55\u5206\u5272\u7b26\uff09\u3002 \u7136\u540e\u5c1d\u8bd5\u6253\u5f00\u8fd9\u4e2a\u6587\u4ef6\u540d\u3002\n\n\n\u4f8b\u5982\uff0c\u5982\u679c\u8def\u5f84\u662f\u5b57\u7b26\u4e32\n\n\n \"./?.lua;./?.lc;/usr/local/?/init.lua\"\n\n\n\n\u641c\u7d22 foo.a\u3000\u8fd9\u4e2a\u540d\u5b57\u5c06 \u4f9d\u6b21\u5c1d\u8bd5\u6253\u5f00\u6587\u4ef6 ./foo/a.lua\u3000\uff0c ./foo/a.lc\u3000\uff0c\u4ee5\u53ca /usr/local/foo/a/init.lua\u3002\n\n\n\u8fd4\u56de\u7b2c\u4e00\u4e2a\u53ef\u4ee5\u7528\u8bfb\u6a21\u5f0f\u6253\u5f00\uff08\u5e76\u9a6c\u4e0a\u5173\u95ed\u8be5\u6587\u4ef6\uff09\u7684\u6587\u4ef6\u7684\u540d\u5b57\u3002 \u5982\u679c\u4e0d\u5b58\u5728\u8fd9\u6837\u7684\u6587\u4ef6\uff0c\u8fd4\u56de nil \u52a0\u4e0a\u9519\u8bef\u6d88\u606f\u3002 \uff08\u8fd9\u6761\u9519\u8bef\u6d88\u606f\u5217\u51fa\u4e86\u6240\u6709\u5c1d\u8bd5\u6253\u5f00\u7684\u6587\u4ef6\u540d\u3002\uff09\n\n\n\u793a\u4f8b\u4ee3\u7801(\u590d\u6570\u6848\u4f8b)\uff1a\n\n\ncomplex.lua \n\n\ncomplex = {}\n\nfunction complex.new(r, i) \n    return {r = r, i = i} -- a table\nend\n\nfunction complex.add(c1, c2)\n    return complex.new(c1.r + c2.r, c1.i + c2.i)\nend\n\nfunction complex.sub(c1, c2)\n    return complex.new(c1.r - c2.r, c1.i - c2.i)\nend\n\nreturn complex\n\n\n\ntest.lua\n\n\nlocal complex = require(\"complex\")\n\nlocal c1 = complex.new(0, 1) -- a table\nlocal c2 = complex.new(1, 2)\n\nlocal ret = complex.add(c1, c2)\n\nprint(ret.r, ret.i) -- 1 3\n\n\n\n4.4 \u5b57\u7b26\u4e32\u5904\u7406\n\n\n\u8fd9\u4e2a\u5e93\u63d0\u4f9b\u4e86\u5b57\u7b26\u4e32\u5904\u7406\u7684\u901a\u7528\u51fd\u6570\u3002 \u4f8b\u5982\u5b57\u7b26\u4e32\u67e5\u627e\u3001\u5b50\u4e32\u3001\u6a21\u5f0f\u5339\u914d\u7b49\u3002 \n\u5f53\u5728 Lua \u4e2d\u5bf9\u5b57\u7b26\u4e32\u505a\u7d22\u5f15\u65f6\uff0c\u7b2c\u4e00\u4e2a\u5b57\u7b26\u4ece 1 \u5f00\u59cb\u8ba1\u7b97\uff08\u800c\u4e0d\u662f C \u91cc\u7684 0 \uff09\u3002 \u7d22\u5f15\u53ef\u4ee5\u662f\u8d1f\u6570\uff0c\u5b83\u6307\u4ece\u5b57\u7b26\u4e32\u672b\u5c3e\u53cd\u5411\u89e3\u6790\u3002 \u5373\uff0c\u6700\u540e\u4e00\u4e2a\u5b57\u7b26\u5728 -1 \u4f4d\u7f6e\u5904\uff0c\u7b49\u7b49\u3002\n\n\n\u5b57\u7b26\u4e32\u5e93\u4e2d\u7684\u6240\u6709\u51fd\u6570\u90fd\u5728\u8868 string \u4e2d\u3002 \u5b83\u8fd8\u5c06\u5176\u8bbe\u7f6e\u4e3a\u5b57\u7b26\u4e32\u5143\u8868\u7684 __index \u57df\u3002 \u56e0\u6b64\uff0c\u4f60\u53ef\u4ee5\u4ee5\u9762\u5411\u5bf9\u8c61\u7684\u5f62\u5f0f\u4f7f\u7528\u5b57\u7b26\u4e32\u51fd\u6570\u3002 \u4f8b\u5982\uff0cstring.byte(s,i) \u53ef\u4ee5\u5199\u6210 s:byte(i)\u3002\n\n\n\u5b57\u7b26\u4e32\u5e93\u5047\u5b9a\u91c7\u7528\u5355\u5b57\u8282\u5b57\u7b26\u7f16\u7801\n\n\n4.4.1 string.format (formatstring, \u00b7\u00b7\u00b7)\n\n\n\u8fd4\u56de\u4e0d\u5b9a\u6570\u91cf\u53c2\u6570\u7684\u683c\u5f0f\u5316\u7248\u672c\uff0c \u683c\u5f0f\u5316\u4e32\u4e3a\u7b2c\u4e00\u4e2a\u53c2\u6570\uff08\u5fc5\u987b\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\uff09\u3002 \u683c\u5f0f\u5316\u5b57\u7b26\u4e32\u9075\u5faa ISO C \u51fd\u6570 sprintf \u7684\u89c4\u5219\u3002 \u4e0d\u540c\u70b9\u5728\u4e8e\u9009\u9879 *, h, L, l, n, p \u4e0d\u652f\u6301\uff0c \u53e6\u5916\u8fd8\u589e\u52a0\u4e86\u4e00\u4e2a\u9009\u9879 q\u3002 q \u9009\u9879\u5c06\u4e00\u4e2a\u5b57\u7b26\u4e32\u683c\u5f0f\u5316\u4e3a\u4e24\u4e2a\u53cc\u5f15\u53f7\u62ec\u8d77\uff0c\u5bf9\u5185\u90e8\u5b57\u7b26\u505a\u6070\u5f53\u7684\u8f6c\u4e49\u5904\u7406\u7684\u5b57\u7b26\u4e32\u3002 \u8be5\u5b57\u7b26\u4e32\u53ef\u4ee5\u5b89\u5168\u7684\u88ab Lua \u89e3\u91ca\u5668\u8bfb\u56de\u6765\u3002 \u4f8b\u5982\uff0c\u8c03\u7528\n\n\n string.format('%q', 'a string with \"quotes\" and \\n new line')\n\n\n\n\u4f1a\u4ea7\u751f\u5b57\u7b26\u4e32\uff1a\n\n\n \"a string with \\\"quotes\\\" and \\\n  new line\"\n\n\n\n\u9009\u9879 A and a \uff08\u5982\u679c\u6709\u7684\u8bdd\uff09\uff0c E, e, f, G, and g \u90fd\u671f\u5f85\u4e00\u4e2a\u5bf9\u5e94\u7684\u6570\u5b57\u53c2\u6570\u3002 \u9009\u9879 c, d, i, o, u, X, and x \u5219\u671f\u5f85\u4e00\u4e2a\u6574\u6570\u3002 \u9009\u9879 q \u671f\u5f85\u4e00\u4e2a\u5b57\u7b26\u4e32\uff1b \u9009\u9879 s \u671f\u5f85\u4e00\u4e2a\u6ca1\u6709\u5185\u5d4c\u96f6\u7684\u5b57\u7b26\u4e32\u3002 \u5982\u679c\u9009\u9879 s \u5bf9\u5e94\u7684\u53c2\u6570\u4e0d\u662f\u5b57\u7b26\u4e32\uff0c\u5b83\u4f1a\u7528\u548c tostring \u4e00\u81f4\u7684\u89c4\u5219\u8f6c\u6362\u6210\u5b57\u7b26\u4e32\u3002\n\n\n4.4.2 string.gmatch (s, pattern)\n\n\n\u8fd4\u56de\u4e00\u4e2a\u8fed\u4ee3\u5668\u51fd\u6570\u3002 \u6bcf\u6b21\u8c03\u7528\u8fd9\u4e2a\u51fd\u6570\u90fd\u4f1a\u7ee7\u7eed\u4ee5 pattern \u5bf9 s \u505a\u5339\u914d\uff0c\u5e76\u8fd4\u56de\u6240\u6709\u6355\u83b7\u5230\u7684\u503c\u3002 \u5982\u679c pattern \u4e2d\u6ca1\u6709\u6307\u5b9a\u6355\u83b7\uff0c\u5219\u6bcf\u6b21\u6355\u83b7\u6574\u4e2a pattern\u3002\n\u4e0b\u9762\u8fd9\u4e2a\u4f8b\u5b50\u4f1a\u5faa\u73af\u8fed\u4ee3\u5b57\u7b26\u4e32 s \u4e2d\u6240\u6709\u7684\u5355\u8bcd\uff0c \u5e76\u9010\u884c\u6253\u5370\uff1a\n\n\n s = \"hello world from Lua\"\n for w in string.gmatch(s, \"%a+\") do\n   print(w)\n end\n\n\n\n\u4e0b\u4e00\u4e2a\u4f8b\u5b50\u4ece\u6307\u5b9a\u7684\u5b57\u7b26\u4e32\u4e2d\u6536\u96c6\u6240\u6709\u7684\u952e\u503c\u5bf9 key=value\uff1a\n\n\nlocal s = \"from=world, to=Lua\"\n\nfor k, v in string.gmatch(s, \"(%w+)=(%w+)\") do\n    print (k..' -\n '..v)    \nend\n\n\n\n4.4.3 string.gsub (s, pattern, repl [, n])\n\n\n\u5c06\u5b57\u7b26\u4e32 s \u4e2d\uff0c\u6240\u6709\u7684\uff08\u6216\u662f\u5728 n \u7ed9\u51fa\u65f6\u7684\u524d n \u4e2a\uff09 pattern \u90fd\u66ff\u6362\u6210 repl \uff0c\u5e76\u8fd4\u56de\u5176\u526f\u672c\u3002 repl \u53ef\u4ee5\u662f\u5b57\u7b26\u4e32\u3001\u8868\u3001\u6216\u51fd\u6570\u3002 gsub \u8fd8\u4f1a\u5728\u7b2c\u4e8c\u4e2a\u8fd4\u56de\u503c\u8fd4\u56de\u4e00\u5171\u53d1\u751f\u4e86\u591a\u5c11\u6b21\u5339\u914d\u3002\n gsub \u8fd9\u4e2a\u540d\u5b57\u6765\u6e90\u4e8e Global SUBstitution \u3002\n\n\n-\n \u5982\u679c repl \u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\n\u90a3\u4e48\u628a\u8fd9\u4e2a\u5b57\u7b26\u4e32\u4f5c\u4e3a\u66ff\u6362\u54c1\u3002 \u5b57\u7b26 % \u662f\u4e00\u4e2a\u8f6c\u4e49\u7b26\uff1a repl \u4e2d\u7684\u6240\u6709\u5f62\u5f0f\u4e3a %d \u7684\u4e32\u8868\u793a \u7b2c d \u4e2a\u6355\u83b7\u5230\u7684\u5b50\u4e32\uff0cd \u53ef\u4ee5\u662f 1 \u5230 9 \u3002 \u4e32 %0 \u8868\u793a\u6574\u4e2a\u5339\u914d\u3002 \u4e32 %% \u8868\u793a\u5355\u4e2a %\u3002\n- \n\u5982\u679c repl \u662f\u5f20\u8868\uff0c\n\u6bcf\u6b21\u5339\u914d\u65f6\u90fd\u4f1a\u7528\u7b2c\u4e00\u4e2a\u6355\u83b7\u7269\u4f5c\u4e3a\u952e\u53bb\u67e5\u8fd9\u5f20\u8868\u3002\n- \u5982\u679c repl \u662f\u4e2a\u51fd\u6570\uff0c\u5219\u5728\u6bcf\u6b21\u5339\u914d\u53d1\u751f\u65f6\u90fd\u4f1a\u8c03\u7528\u8fd9\u4e2a\u51fd\u6570\u3002 \u6240\u6709\u6355\u83b7\u5230\u7684\u5b50\u4e32\u4f9d\u6b21\u4f5c\u4e3a\u53c2\u6570\u4f20\u5165\u3002\n\u4efb\u4f55\u60c5\u51b5\u4e0b\uff0c\u6a21\u677f\u4e2d\u6ca1\u6709\u8bbe\u5b9a\u6355\u83b7\u90fd\u770b\u6210\u662f\u6355\u83b7\u6574\u4e2a\u6a21\u677f\u3002\n- \n\u5982\u679c\u8868\u7684\u67e5\u8be2\u7ed3\u679c\u6216\u51fd\u6570\u7684\u8fd4\u56de\u7ed3\u679c\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\u6216\u662f\u4e2a\u6570\u5b57\uff0c\n \u90fd\u5c06\u5176\u4f5c\u4e3a\u66ff\u6362\u7528\u4e32\uff1b \u800c\u5728\u8fd4\u56de false \u6216 nil\u3000\u65f6\u4e0d\u4f5c\u66ff\u6362 \uff08\u5373\u4fdd\u7559\u5339\u914d\u524d\u7684\u539f\u59cb\u4e32\uff09\u3002\n\n\n\u793a\u4f8b\u4ee3\u7801\uff1a\n\n\nx = string.gsub(\"hello world\", \"(%w+)\", \"%1 %1\")\nprint(x)\n-- x=\"hello hello world world\"\n\nx = string.gsub(\"hello world\", \"%w+\", \"%0 %0\", 1)\nprint(x)\n-- x=\"hello hello world\"\n\nx = string.gsub(\"hello world from Lua\", \"(%w+)%s*(%w+)\", \"%2 %1\")\nprint(x)\n-- x=\"world hello Lua from\"\n\nx = string.gsub(\"home = $HOME, user = $USER\", \"%$(%w+)\", os.getenv)\nprint(x)\n-- x=\"home = /home/roberto, user = roberto\"\n\nx = string.gsub(\"4+5 = $return 4+5$\", \"%$(.-)%$\", function (s)\n   return load(s)()\n end)\nprint(x)\n-- x=\"4+5 = 9\"\n\nlocal t = {name=\"lua\", version=\"5.3\"}\nx = string.gsub(\"$name-$version.tar.gz\", \"%$(%w+)\", t)\nprint(x)\n-- x=\"lua-5.3.tar.gz\"\n\n\n\n4.4.4 string.len (s)\n\n\n\u63a5\u6536\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u8fd4\u56de\u5176\u957f\u5ea6\u3002 \u7a7a\u4e32 \"\" \u7684\u957f\u5ea6\u4e3a 0 \u3002 \u5185\u5d4c\u96f6\u4e5f\u7edf\u8ba1\u5728\u5185\uff0c\u56e0\u6b64 \"a\\000bc\\000\" \u7684\u957f\u5ea6\u4e3a 5 \u3002\n\n\n4.4.5 string.lower (s)\n\n\n\u63a5\u6536\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u5c06\u5176\u4e2d\u7684\u5927\u5199\u5b57\u7b26\u90fd\u8f6c\u4e3a\u5c0f\u5199\u540e\u8fd4\u56de\u5176\u526f\u672c\u3002 \u5176\u5b83\u7684\u5b57\u7b26\u4e32\u4e0d\u4f1a\u66f4\u6539\u3002 \u5bf9\u5927\u5199\u5b57\u7b26\u7684\u5b9a\u4e49\u53d6\u51b3\u4e8e\u5f53\u524d\u7684\u533a\u57df\u8bbe\u7f6e\u3002\n\n\n4.4.6 string.reverse (s)\n\n\n\u8fd4\u56de\u5b57\u7b26\u4e32 s \u7684\u7ffb\u8f6c\u4e32\u3002\n\n\n4.4.7 string.sub (s, i [, j])\n\n\n\u8fd4\u56de s \u7684\u5b50\u4e32\n\uff0c \u8be5\u5b50\u4e32\u4ece i \u5f00\u59cb\u5230 j \u4e3a\u6b62\uff1b i \u548c j \u90fd\u53ef\u4ee5\u4e3a\u8d1f\u6570\u3002 \u5982\u679c\u4e0d\u7ed9\u51fa j \uff0c\u5c31\u5f53\u5b83\u662f -1 \uff08\u548c\u5b57\u7b26\u4e32\u957f\u5ea6\u76f8\u540c\uff09\u3002 \u7279\u522b\u662f\uff0c \u8c03\u7528 string.sub(s,1,j) \u53ef\u4ee5\u8fd4\u56de s \u7684\u957f\u5ea6\u4e3a j \u7684\u524d\u7f00\u4e32\uff0c \u800c string.sub(s, -i) \u8fd4\u56de\u957f\u5ea6\u4e3a i \u7684\u540e\u7f00\u4e32\u3002\n\u5982\u679c\u5728\u5bf9\u8d1f\u6570\u7d22\u5f15\u8f6c\u4e49\u540e i \u5c0f\u4e8e 1 \u7684\u8bdd\uff0c\u5c31\u4fee\u6b63\u56de 1 \u3002 \u5982\u679c j \u6bd4\u5b57\u7b26\u4e32\u7684\u957f\u5ea6\u8fd8\u5927\uff0c\u5c31\u4fee\u6b63\u4e3a\u5b57\u7b26\u4e32\u957f\u5ea6\u3002 \u5982\u679c\u5728\u4fee\u6b63\u4e4b\u540e\uff0ci \u5927\u4e8e j\uff0c \u51fd\u6570\u8fd4\u56de\u7a7a\u4e32\u3002\n\n\n4.4.8 string.upper (s)\n\n\n\u63a5\u6536\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u5c06\u5176\u4e2d\u7684\u5c0f\u5199\u5b57\u7b26\u90fd\u8f6c\u4e3a\u5927\u5199\u540e\u8fd4\u56de\u5176\u526f\u672c\u3002 \u5176\u5b83\u7684\u5b57\u7b26\u4e32\u4e0d\u4f1a\u66f4\u6539\u3002 \u5bf9\u5c0f\u5199\u5b57\u7b26\u7684\u5b9a\u4e49\u53d6\u51b3\u4e8e\u5f53\u524d\u7684\u533a\u57df\u8bbe\u7f6e\u3002\n\n\n\u793a\u4f8b\u4ee3\u7801\uff1a\n\n\nlocal str = \"hello lua\"\n\nprint(string.len(str))        -- 9\nprint(string.rep(str, 2))     -- hello luahello lua\nprint(string.upper(str))      -- HELLO LUA\nprint(string.sub(str, 2, 6))  -- ello\nprint(string.sub(str, 2, -2)) -- ello lu\nprint(string.format(\"%s %d\", \"hello lua\", 32)) -- hello lua 32\n\n\n\n\u5728Lua\u4e2d\uff0c\u5b57\u7b26\u4e32\u7684\u7b2c\u4e00\u4e2a\u5b57\u7b26\u7684\u7d22\u5f15\u662f1\uff0c\u4f46\u662f\uff0c\u7d22\u5f15\u4e5f\u53ef\u4ee5\u662f\u8d1f\u6570\uff0c\u8868\u793a\u4ece\u5b57\u7b26\u4e32\u7684\u5c3e\u90e8\u5f00\u59cb\u8ba1\u6570\uff0c\u7d22\u5f15-1\u4ee3\u8868\u5b57\u7b26\u4e32\u7684\u6700\u540e\u4e00\u4e2a\u5b57\u7b26\u3002\n\n\n4.5 \u5339\u914d\u6a21\u5f0f\n\n\nLua \u4e2d\u7684\u5339\u914d\u6a21\u5f0f\u76f4\u63a5\u7528\u5e38\u89c4\u7684\u5b57\u7b26\u4e32\u6765\u63cf\u8ff0\u3002 \u5b83\u7528\u4e8e\u6a21\u5f0f\u5339\u914d\u51fd\u6570 string.find, string.gmatch, string.gsub, string.match\u3002 \u8fd9\u4e00\u8282\u8868\u8ff0\u4e86\u8fd9\u4e9b\u5b57\u7b26\u4e32\u7684\u8bed\u6cd5\u53ca\u542b\u4e49\uff08\u5373\u5b83\u80fd\u5339\u914d\u5230\u4ec0\u4e48\uff09\u3002\n\n\n4.5.1 \u5b57\u7b26\u7c7b\n\n\n\u5b57\u7b26\u7c7b\u7528\u4e8e\u8868\u793a\u4e00\u4e2a\u5b57\u7b26\u96c6\u5408\u3002 \u4e0b\u5217\u7ec4\u5408\u53ef\u7528\u4e8e\u5b57\u7b26\u7c7b\uff1a\n\n\n\n\nx: \uff08\u8fd9\u91cc x \u4e0d\u80fd\u662f \u9b54\u6cd5\u5b57\u7b26 ^$()%.[]*+-? \u4e2d\u7684\u4e00\u5458\uff09 \u8868\u793a\u5b57\u7b26 x \u81ea\u8eab\u3002\n\n\n.: \uff08\u4e00\u4e2a\u70b9\uff09\u53ef\u8868\u793a\u4efb\u4f55\u5b57\u7b26\u3002\n\n\n%a: \u8868\u793a\u4efb\u4f55\u5b57\u6bcd\u3002\n\n\n%c: \u8868\u793a\u4efb\u4f55\u63a7\u5236\u5b57\u7b26\u3002\n\n\n%d: \u8868\u793a\u4efb\u4f55\u6570\u5b57\u3002\n\n\n%g: \u8868\u793a\u4efb\u4f55\u9664\u7a7a\u767d\u7b26\u5916\u7684\u53ef\u6253\u5370\u5b57\u7b26\u3002\n\n\n%l: \u8868\u793a\u6240\u6709\u5c0f\u5199\u5b57\u6bcd\u3002\n\n\n%p: \u8868\u793a\u6240\u6709\u6807\u70b9\u7b26\u53f7\u3002\n\n\n%s: \u8868\u793a\u6240\u6709\u7a7a\u767d\u5b57\u7b26\u3002\n\n\n%u: \u8868\u793a\u6240\u6709\u5927\u5199\u5b57\u6bcd\u3002\n\n\n%w: \u8868\u793a\u6240\u6709\u5b57\u6bcd\u53ca\u6570\u5b57\u3002\n\n\n%x: \u8868\u793a\u6240\u6709 16 \u8fdb\u5236\u6570\u5b57\u7b26\u53f7\u3002\n\n\n%x: \uff08\u8fd9\u91cc\u7684 x \u662f\u4efb\u610f\u975e\u5b57\u6bcd\u6216\u6570\u5b57\u7684\u5b57\u7b26\uff09 \u8868\u793a\u5b57\u7b26 x\u3002 \u8fd9\u662f\u5bf9\u9b54\u6cd5\u5b57\u7b26\u8f6c\u4e49\u7684\u6807\u51c6\u65b9\u6cd5\u3002 \u6240\u6709\u975e\u5b57\u6bcd\u6216\u6570\u5b57\u7684\u5b57\u7b26 \uff08\u5305\u62ec\u6240\u6709\u6807\u70b9\uff0c\u4e5f\u5305\u62ec\u975e\u9b54\u6cd5\u5b57\u7b26\uff09 \u90fd\u53ef\u4ee5\u7528\u524d\u7f6e\u4e00\u4e2a '%' \u653e\u5728\u6a21\u5f0f\u4e32\u4e2d\u8868\u793a\u81ea\u8eab\u3002\n\n\n\n\n[set]: \u8868\u793a set\u3000\u4e2d\u6240\u6709\u5b57\u7b26\u7684\u8054\u5408\u3002 \u53ef\u4ee5\u4ee5 '-' \u8fde\u63a5\uff0c\u5347\u5e8f\u4e66\u5199\u8303\u56f4\u4e24\u7aef\u7684\u5b57\u7b26\u6765\u8868\u793a\u4e00\u4e2a\u8303\u56f4\u7684\u5b57\u7b26\u96c6\u3002 \u4e0a\u9762\u63d0\u5230\u7684 %x \u5f62\u5f0f\u4e5f\u53ef\u4ee5\u5728 set \u4e2d\u4f7f\u7528 \u8868\u793a\u5176\u4e2d\u7684\u4e00\u4e2a\u5143\u7d20\u3002 \u5176\u5b83\u51fa\u73b0\u5728 set \u4e2d\u7684\u5b57\u7b26\u5219\u4ee3\u8868\u5b83\u4eec\u81ea\u5df1\u3002 \u4f8b\u5982\uff0c[%w_] \uff08\u6216 [_%w]\uff09 \u8868\u793a\u6240\u6709\u7684\u5b57\u6bcd\u6570\u5b57\u52a0\u4e0b\u5212\u7ebf\uff09\uff0c [0-7] \u8868\u793a 8 \u8fdb\u5236\u6570\u5b57\uff0c [0-7%l%-]\u3000\u8868\u793a 8 \u8fdb\u5236\u6570\u5b57\u52a0\u5c0f\u5199\u5b57\u6bcd\u4e0e '-' \u5b57\u7b26\u3002\n\u4ea4\u53c9\u4f7f\u7528\u7c7b\u548c\u8303\u56f4\u7684\u884c\u4e3a\u672a\u5b9a\u4e49\u3002 \u56e0\u6b64\uff0c\u50cf [%a-z] \u6216 [a-%%] \u8fd9\u6837\u7684\u6a21\u5f0f\u4e32\u6ca1\u6709\u610f\u4e49\u3002\n\n\n\n\n\n\n[^set]: \u8868\u793a set \u7684\u8865\u96c6\uff0c \u5176\u4e2d set \u5982\u4e0a\u9762\u7684\u89e3\u91ca\u3002\n\u6240\u6709\u5355\u4e2a\u5b57\u6bcd\u8868\u793a\u7684\u7c7b\u522b\uff08%a\uff0c%c\uff0c\u7b49\uff09\uff0c \u82e5\u5c06\u5176\u5b57\u6bcd\u6539\u4e3a\u5927\u5199\uff0c\u5747\u8868\u793a\u5bf9\u5e94\u7684\u8865\u96c6\u3002 \u4f8b\u5982\uff0c%S \u8868\u793a\u6240\u6709\u975e\u7a7a\u683c\u7684\u5b57\u7b26\u3002\n\n\n\n\n\n\n\u5982\u4f55\u5b9a\u4e49\u5b57\u6bcd\u3001\u7a7a\u683c\u3001\u6216\u662f\u5176\u4ed6\u5b57\u7b26\u7ec4\u53d6\u51b3\u4e8e\u5f53\u524d\u7684\u533a\u57df\u8bbe\u7f6e\u3002 \u7279\u522b\u6ce8\u610f\uff1a[a-z]\u3000\u672a\u5fc5\u7b49\u4ef7\u4e8e %l \u3002\n\n\n4.5.2 \u6a21\u5f0f\u6761\u76ee\uff1a\n\n\n\u6a21\u5f0f\u6761\u76ee\u53ef\u4ee5\u662f\uff1a\n\n\n\n\n\u5355\u4e2a\u5b57\u7b26\u7c7b\u5339\u914d\u8be5\u7c7b\u522b\u4e2d\u4efb\u610f\u5355\u4e2a\u5b57\u7b26\uff1b\n\n\n\u5355\u4e2a\u5b57\u7b26\u7c7b\u8ddf\u4e00\u4e2a '*'\uff0c \u5c06\u5339\u914d\u96f6\u6216\u591a\u4e2a\u8be5\u7c7b\u7684\u5b57\u7b26\u3002 \u8fd9\u4e2a\u6761\u76ee\u603b\u662f\u5339\u914d\u5c3d\u53ef\u80fd\u957f\u7684\u4e32\uff1b\n\n\n\u5355\u4e2a\u5b57\u7b26\u7c7b\u8ddf\u4e00\u4e2a '+'\uff0c \u5c06\u5339\u914d\u4e00\u6216\u66f4\u591a\u4e2a\u8be5\u7c7b\u7684\u5b57\u7b26\u3002 \u8fd9\u4e2a\u6761\u76ee\u603b\u662f\u5339\u914d\u5c3d\u53ef\u80fd\u957f\u7684\u4e32\uff1b\n\n\n\u5355\u4e2a\u5b57\u7b26\u7c7b\u8ddf\u4e00\u4e2a '-'\uff0c \u5c06\u5339\u914d\u96f6\u6216\u66f4\u591a\u4e2a\u8be5\u7c7b\u7684\u5b57\u7b26\u3002 \u548c '*' \u4e0d\u540c\uff0c \u8fd9\u4e2a\u6761\u76ee\u603b\u662f\u5339\u914d\u5c3d\u53ef\u80fd\u77ed\u7684\u4e32\uff1b\n\n\n\u5355\u4e2a\u5b57\u7b26\u7c7b\u8ddf\u4e00\u4e2a '?'\uff0c \u5c06\u5339\u914d\u96f6\u6216\u4e00\u4e2a\u8be5\u7c7b\u7684\u5b57\u7b26\u3002 \u53ea\u8981\u6709\u53ef\u80fd\uff0c\u5b83\u4f1a\u5339\u914d\u4e00\u4e2a\uff1b\n\n\n%n\uff0c \u8fd9\u91cc\u7684 n \u53ef\u4ee5\u4ece 1 \u5230 9\uff1b \u8fd9\u4e2a\u6761\u76ee\u5339\u914d\u4e00\u4e2a\u7b49\u4e8e n \u53f7\u6355\u83b7\u7269\uff08\u540e\u9762\u6709\u63cf\u8ff0\uff09\u7684\u5b50\u4e32\u3002\n\n\n%bxy\uff0c \u8fd9\u91cc\u7684 x \u548c y \u662f\u4e24\u4e2a\u660e\u786e\u7684\u5b57\u7b26\uff1b \u8fd9\u4e2a\u6761\u76ee\u5339\u914d\u4ee5 x \u5f00\u59cb y \u7ed3\u675f\uff0c \u4e14\u5176\u4e2d x \u548c y \u4fdd\u6301 \u5e73\u8861 \u7684\u5b57\u7b26\u4e32\u3002 \u610f\u601d\u662f\uff0c\u5982\u679c\u4ece\u5de6\u5230\u53f3\u8bfb\u8fd9\u4e2a\u5b57\u7b26\u4e32\uff0c\u5bf9\u6bcf\u6b21\u8bfb\u5230\u4e00\u4e2a x \u5c31 +1 \uff0c\u8bfb\u5230\u4e00\u4e2a y \u5c31 -1\uff0c \u6700\u7ec8\u7ed3\u675f\u5904\u7684\u90a3\u4e2a y \u662f\u7b2c\u4e00\u4e2a\u8bb0\u6570\u5230 0 \u7684 y\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u6761\u76ee %b() \u53ef\u4ee5\u5339\u914d\u5230\u62ec\u53f7\u5e73\u8861\u7684\u8868\u8fbe\u5f0f\u3002\n\n\n%f[set]\uff0c \u6307 \u8fb9\u5883\u6a21\u5f0f\uff1b \u8fd9\u4e2a\u6761\u76ee\u4f1a\u5339\u914d\u5230\u4e00\u4e2a\u4f4d\u4e8e set \u5185\u67d0\u4e2a\u5b57\u7b26\u4e4b\u524d\u7684\u4e00\u4e2a\u7a7a\u4e32\uff0c \u4e14\u8fd9\u4e2a\u4f4d\u7f6e\u7684\u524d\u4e00\u4e2a\u5b57\u7b26\u4e0d\u5c5e\u4e8e set \u3002 \u96c6\u5408 set \u7684\u542b\u4e49\u5982\u524d\u9762\u6240\u8ff0\u3002 \u5339\u914d\u51fa\u7684\u90a3\u4e2a\u7a7a\u4e32\u4e4b\u5f00\u59cb\u548c\u7ed3\u675f\u70b9\u7684\u8ba1\u7b97\u5c31\u770b\u6210\u8be5\u5904\u6709\u4e2a\u5b57\u7b26 '\\0' \u4e00\u6837\u3002\n\n\n\n\n4.5.3 \u6a21\u5f0f\uff1a\n\n\n\u6a21\u5f0f \u6307\u4e00\u4e2a\u6a21\u5f0f\u6761\u76ee\u7684\u5e8f\u5217\u3002 \u5728\u6a21\u5f0f\u6700\u524d\u9762\u52a0\u4e0a\u7b26\u53f7 '^' \u5c06\u951a\u5b9a\u4ece\u5b57\u7b26\u4e32\u7684\u5f00\u59cb\u5904\u505a\u5339\u914d\u3002 \u5728\u6a21\u5f0f\u6700\u540e\u9762\u52a0\u4e0a\u7b26\u53f7 '$' \u5c06\u4f7f\u5339\u914d\u8fc7\u7a0b\u951a\u5b9a\u5230\u5b57\u7b26\u4e32\u7684\u7ed3\u5c3e\u3002 \u5982\u679c '^' \u548c '$' \u51fa\u73b0\u5728\u5176\u5b83\u4f4d\u7f6e\uff0c\u5b83\u4eec\u5747\u6ca1\u6709\u7279\u6b8a\u542b\u4e49\uff0c\u53ea\u8868\u793a\u81ea\u8eab\u3002\n\n\n4.5.4 \u6355\u83b7\uff1a\n\n\n\u6a21\u5f0f\u53ef\u4ee5\u5728\u5185\u90e8\u7528\u5c0f\u62ec\u53f7\u62ec\u8d77\u4e00\u4e2a\u5b50\u6a21\u5f0f\uff1b \u8fd9\u4e9b\u5b50\u6a21\u5f0f\u88ab\u79f0\u4e3a \u6355\u83b7\u7269\u3002 \u5f53\u5339\u914d\u6210\u529f\u65f6\uff0c\u7531 \u6355\u83b7\u7269 \u5339\u914d\u5230\u7684\u5b57\u7b26\u4e32\u4e2d\u7684\u5b50\u4e32\u88ab\u4fdd\u5b58\u8d77\u6765\u7528\u4e8e\u672a\u6765\u7684\u7528\u9014\u3002 \u6355\u83b7\u7269\u4ee5\u5b83\u4eec\u5de6\u62ec\u53f7\u7684\u6b21\u5e8f\u6765\u7f16\u53f7\u3002 \u4f8b\u5982\uff0c\u5bf9\u4e8e\u6a21\u5f0f \"(a\n(.)%w(%s\n))\" \uff0c \u5b57\u7b26\u4e32\u4e2d\u5339\u914d\u5230 \"a\n(.)%w(%s\n)\" \u7684\u90e8\u5206\u4fdd\u5b58\u5728\u7b2c\u4e00\u4e2a\u6355\u83b7\u7269\u4e2d \uff08\u56e0\u6b64\u662f\u7f16\u53f7 1 \uff09\uff1b \u7531 \".\" \u5339\u914d\u5230\u7684\u5b57\u7b26\u662f 2 \u53f7\u6355\u83b7\u7269\uff0c \u5339\u914d\u5230 \"%s*\" \u7684\u90a3\u90e8\u5206\u662f 3 \u53f7\u3002\n\n\n\u4f5c\u4e3a\u4e00\u4e2a\u7279\u4f8b\uff0c\u7a7a\u7684\u6355\u83b7 () \u5c06\u6355\u83b7\u5230\u5f53\u524d\u5b57\u7b26\u4e32\u7684\u4f4d\u7f6e\uff08\u5b83\u662f\u4e00\u4e2a\u6570\u5b57\uff09\u3002 \u4f8b\u5982\uff0c\u5982\u679c\u5c06\u6a21\u5f0f \"()aa()\" \u4f5c\u7528\u5230\u5b57\u7b26\u4e32 \"flaaap\" \u4e0a\uff0c\u5c06\u4ea7\u751f\u4e24\u4e2a\u6355\u83b7\u7269\uff1a 3 \u548c 5 \u3002", 
            "title": "04"
        }, 
        {
            "location": "/luamd/04/#lua", 
            "text": "\u6807\u51c6\u5e93\u63d0\u4f9b\u4e86\u4e00\u4e9b\u6709\u7528\u7684\u51fd\u6570, \u5b83\u4eec\u90fd\u662f\u76f4\u63a5\u7528  C API \u5b9e\u73b0\u7684 \u3002 \u5176\u4e2d\u4e00\u4e9b\u51fd\u6570\u63d0\u4f9b\u4e86\u539f\u672c\u8bed\u8a00\u5c31\u6709\u7684\u670d\u52a1 \uff08\u4f8b\u5982\uff0ctype \u4e0e getmetatable\uff09\uff1b \u53e6\u4e00\u4e9b\u63d0\u4f9b\u548c\u201c\u5916\u90e8\u201d\u6253\u4ea4\u9053\u7684\u670d\u52a1\uff08\u4f8b\u5982 I/O \uff09\uff1b \u8fd8\u6709\u4e9b\u672c\u53ef\u4ee5\u7528 Lua \u672c\u8eab\u6765\u5b9e\u73b0\uff0c\u4f46\u5728 C \u4e2d\u5b9e\u73b0\u53ef\u4ee5\u6ee1\u8db3\u5173\u952e\u70b9\u4e0a\u7684\u6027\u80fd\u9700\u6c42 \uff08\u4f8b\u5982 table.sort\uff09\u3002  \u6240\u6709\u7684\u5e93\u90fd\u662f\u76f4\u63a5\u7528 C API \u5b9e\u73b0\u7684\uff0c\u5e76\u4ee5\u5206\u79bb\u7684 C \u6a21\u5757\u5f62\u5f0f\u63d0\u4f9b\u3002 \u76ee\u524d\uff0cLua \u6709\u4e0b\u5217\u6807\u51c6\u5e93\uff1a   \u57fa\u7840\u5e93   \u534f\u7a0b\u5e93   \u5305\u7ba1\u7406\u5e93   \u5b57\u7b26\u4e32\u63a7\u5236   \u57fa\u7840 UTF-8 \u652f\u6301   \u8868\u63a7\u5236   \u6570\u5b66\u51fd\u6570 (sin \uff0clog \u7b49)  \u8f93\u5165\u8f93\u51fa   \u64cd\u4f5c\u7cfb\u7edf\u5e93   \u8c03\u8bd5\u5e93     \u9664\u4e86\u57fa\u7840\u5e93\u548c\u5305\u7ba1\u7406\u5e93\uff0c \u5176\u5b83\u5e93\u90fd\u628a\u81ea\u5df1\u7684\u51fd\u6570\u653e\u5728\u4e00\u5f20\u5168\u5c40\u8868\u7684\u57df\u4e2d\uff0c \u6216\u662f\u4ee5\u5bf9\u8c61\u65b9\u6cd5\u7684\u5f62\u5f0f\u63d0\u4f9b\u3002\u8981\u4f7f\u7528\u8fd9\u4e9b\u5e93\uff0c C \u7684\u5bbf\u4e3b\u7a0b\u5e8f\u9700\u8981\u5148\u8c03\u7528\u4e00\u4e0b luaL_openlibs \u8fd9\u4e2a\u51fd\u6570 \uff0c\u8fd9\u6837\u5c31\u80fd\u6253\u5f00\u6240\u6709\u7684\u6807\u51c6\u5e93\u3002 \u6216\u8005\u5bbf\u4e3b\u7a0b\u5e8f\u4e5f\u53ef\u4ee5\u7528 luaL_requiref \u5206\u522b\u6253\u5f00\u8fd9\u4e9b\u5e93\uff1a    luaopen_base \uff08\u57fa\u7840\u5e93\uff09   luaopen_package \uff08\u5305\u7ba1\u7406\u5e93\uff09   luaopen_coroutine \uff08\u534f\u7a0b\u5e93\uff09   luaopen_string \uff08\u5b57\u7b26\u4e32\u5e93\uff09   luaopen_utf8 \uff08UTF8 \u5e93\uff09   luaopen_table \uff08\u8868\u5904\u7406\u5e93\uff09  luaopen_math \uff08\u6570\u5b66\u5e93\uff09  luaopen_io \uff08I/O \u5e93\uff09   luaopen_os \uff08\u64cd\u4f5c\u7cfb\u7edf\u5e93\uff09   luaopen_debug \uff08\u8c03\u8bd5\u5e93\uff09    \u8fd9\u4e9b\u51fd\u6570\u90fd\u5b9a\u4e49\u5728 lualib.h \u4e2d\u3002", 
            "title": "lua \u6807\u51c6\u5e93"
        }, 
        {
            "location": "/luamd/04/#41", 
            "text": "\u57fa\u7840\u5e93\u63d0\u4f9b\u4e86 Lua \u6838\u5fc3\u51fd\u6570\u3002 \u5982\u679c\u4f60\u4e0d\u5c06\u8fd9\u4e2a\u5e93\u5305\u542b\u5728\u4f60\u7684\u7a0b\u5e8f\u4e2d\uff0c \u4f60\u5c31\u9700\u8981\u5c0f\u5fc3\u68c0\u67e5\u7a0b\u5e8f\u662f\u5426\u9700\u8981\u81ea\u5df1\u63d0\u4f9b\u5176\u4e2d\u4e00\u4e9b\u7279\u6027\u7684\u5b9e\u73b0\u3002\u8fd9\u91cc\u5217\u51fa\u4e86\u4e00\u4e9b\u5e38\u7528\u7684\u57fa\u7840\u5e93\u51fd\u6570\uff1a  4.1.1 assert (v [, message])  \u5982\u679c\u5176\u53c2\u6570 v \u7684\u503c\u4e3a\u5047\uff08nil \u6216 false\uff09\uff0c \u5b83\u5c31\u8c03\u7528 error\uff1b \u5426\u5219\uff0c\u8fd4\u56de\u6240\u6709\u7684\u53c2\u6570\u3002 \u5728\u9519\u8bef\u60c5\u51b5\u65f6\uff0c message \u6307\u90a3\u4e2a\u9519\u8bef\u5bf9\u8c61\uff1b \u5982\u679c\u4e0d\u63d0\u4f9b\u8fd9\u4e2a\u53c2\u6570\uff0c\u53c2\u6570\u9ed8\u8ba4\u4e3a \"assertion failed!\" \u3002  \u6848\u5217\uff1a  assert(5 == 67)  \u8fd0\u884c\u7ed3\u679c\uff1a  lua: ll.lua:1: assertion failed!\nstack traceback:\n        [C]: in function 'assert'\n        ll.lua:1: in main chunk\n        [C]: in ?  4.1.2 print (\u00b7\u00b7\u00b7)  \u63a5\u6536\u4efb\u610f\u6570\u91cf\u7684\u53c2\u6570\uff0c\u5e76\u5c06\u5b83\u4eec\u7684\u503c\u6253\u5370\u5230 stdout\u3002 \u5b83\u7528 tostring \u51fd\u6570\u5c06\u6bcf\u4e2a\u53c2\u6570\u90fd\u8f6c\u6362\u4e3a\u5b57\u7b26\u4e32\u3002 print \u4e0d\u7528\u4e8e\u505a\u683c\u5f0f\u5316\u8f93\u51fa\u3002\u4ec5\u4f5c\u4e3a\u770b\u4e00\u4e0b\u67d0\u4e2a\u503c\u7684\u5feb\u6377\u65b9\u5f0f\u3002 \u591a\u7528\u4e8e\u8c03\u8bd5\u3002 \u5b8c\u6574\u7684\u5bf9\u8f93\u51fa\u7684\u63a7\u5236\uff0c\u8bf7\u4f7f\u7528 string.format \u4ee5\u53ca io.write\u3002  4.1.3 error (message [, level])  \u4e2d\u6b62\u4e0a\u4e00\u6b21\u4fdd\u62a4\u51fd\u6570\u8c03\u7528\uff0c \u5c06\u9519\u8bef\u5bf9\u8c61 message \u8fd4\u56de\u3002 \u51fd\u6570 error \u6c38\u8fdc\u4e0d\u4f1a\u8fd4\u56de\u3002\n\u5f53 message \u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\u65f6\uff0c\u901a\u5e38 error \u4f1a\u628a\u4e00\u4e9b\u6709\u5173\u51fa\u9519\u4f4d\u7f6e\u7684\u4fe1\u606f\u9644\u52a0\u5728\u6d88\u606f\u7684\u524d\u5934\u3002 level \u53c2\u6570\u6307\u660e\u4e86\u600e\u6837\u83b7\u5f97\u51fa\u9519\u4f4d\u7f6e\u3002 \u5bf9\u4e8e level 1 \uff08\u9ed8\u8ba4\u503c\uff09\uff0c\u51fa\u9519\u4f4d\u7f6e\u6307 error \u51fd\u6570\u8c03\u7528\u7684\u4f4d\u7f6e\u3002 Level 2 \u5c06\u51fa\u9519\u4f4d\u7f6e\u6307\u5411\u8c03\u7528 error\u7684\u51fd\u6570\u7684\u51fd\u6570\uff1b\u4ee5\u6b64\u7c7b\u63a8\u3002 \u4f20\u5165 level 0 \u53ef\u4ee5\u907f\u514d\u5728\u6d88\u606f\u524d\u6dfb\u52a0\u51fa\u9519\u4f4d\u7f6e\u4fe1\u606f\u3002  4.1.4 getmetatable (object)  \u5982\u679c object \u4e0d\u5305\u542b\u5143\u8868\uff0c\u8fd4\u56de nil \u3002 \u5426\u5219\uff0c\u5982\u679c\u5728\u8be5\u5bf9\u8c61\u7684\u5143\u8868\u4e2d\u6709 \"__metatable\" \u57df\u65f6\u8fd4\u56de\u5176\u5173\u8054\u503c\uff0c \u6ca1\u6709\u65f6\u8fd4\u56de\u8be5\u5bf9\u8c61\u7684\u5143\u8868\u3002  4.1.5 ipairs (t)  \u8fd4\u56de\u4e09\u4e2a\u503c\uff08\u8fed\u4ee3\u51fd\u6570\u3001\u8868 t \u4ee5\u53ca 0 \uff09\uff0c \u5982\u6b64\uff0c\u4ee5\u4e0b\u4ee3\u7801   for i,v in ipairs(t) do body end  \u5c06\u8fed\u4ee3\u952e\u503c\u5bf9\uff081,t[1]) \uff0c(2,t[2])\uff0c ... \uff0c\u76f4\u5230\u7b2c\u4e00\u4e2a\u7a7a\u503c\u3002  \u793a\u4f8b\u4ee3\u7801\uff1a  local nums = {11, 22, 33}\nfor i,v in ipairs(nums) do \n    print(i..' -  '..v) \nend  4.1.6 pcall (f [, arg1, \u00b7\u00b7\u00b7])  \u4f20\u5165\u53c2\u6570\uff0c\u4ee5 \u4fdd\u62a4\u6a21\u5f0f \u8c03\u7528\u51fd\u6570 f \u3002  \u8fd9\u610f\u5473\u7740 f \u4e2d\u7684\u4efb\u4f55\u9519\u8bef\u4e0d\u4f1a\u629b\u51fa\uff1b \u53d6\u800c\u4ee3\u4e4b\u7684\u662f\uff0cpcall \u4f1a\u5c06\u9519\u8bef\u6355\u83b7\u5230\uff0c\u5e76\u8fd4\u56de\u4e00\u4e2a\u72b6\u6001\u7801\u3002 \u7b2c\u4e00\u4e2a\u8fd4\u56de\u503c\u662f\u72b6\u6001\u7801\uff08\u4e00\u4e2a\u5e03\u5c14\u91cf\uff09\uff0c \u5f53\u6ca1\u6709\u9519\u8bef\u65f6\uff0c\u5176\u4e3a\u771f\u3002 \u6b64\u65f6\uff0cpcall \u540c\u6837\u4f1a\u5728\u72b6\u6001\u7801\u540e\u8fd4\u56de\u6240\u6709\u8c03\u7528\u7684\u7ed3\u679c\u3002 \u5728\u6709\u9519\u8bef\u65f6\uff0cpcall \u8fd4\u56de false \u52a0\u9519\u8bef\u6d88\u606f\u3002  4.1.7 rawequal (v1, v2)  \u5728\u4e0d\u89e6\u53d1\u4efb\u4f55\u5143\u65b9\u6cd5\u7684\u60c5\u51b5\u4e0b \u68c0\u67e5 v1 \u662f\u5426\u548c v2 \u76f8\u7b49\u3002 \u8fd4\u56de\u4e00\u4e2a\u5e03\u5c14\u91cf\u3002  4.1.8 rawlen (v)  \u5728\u4e0d\u89e6\u53d1\u4efb\u4f55\u5143\u65b9\u6cd5\u7684\u60c5\u51b5\u4e0b \u8fd4\u56de\u5bf9\u8c61 v \u7684\u957f\u5ea6\u3002 v \u53ef\u4ee5\u662f\u8868\u6216\u5b57\u7b26\u4e32\u3002 \u5b83\u8fd4\u56de\u4e00\u4e2a\u6574\u6570\u3002  4.1.9 setmetatable (table, metatable)  \u7ed9\u6307\u5b9a\u8868\u8bbe\u7f6e\u5143\u8868\u3002 \uff08\u4f60\u4e0d\u80fd\u5728 Lua \u4e2d\u6539\u53d8\u5176\u5b83\u7c7b\u578b\u503c\u7684\u5143\u8868\uff0c\u90a3\u4e9b\u53ea\u80fd\u5728 C \u91cc\u505a\u3002\uff09 \u5982\u679c metatable \u662f nil\uff0c \u5c06\u6307\u5b9a\u8868\u7684\u5143\u8868\u79fb\u9664\u3002 \u5982\u679c\u539f\u6765\u90a3\u5f20\u5143\u8868\u6709 \"__metatable\" \u57df\uff0c\u629b\u51fa\u4e00\u4e2a\u9519\u8bef\u3002  \u8fd9\u4e2a\u51fd\u6570\u8fd4\u56de table\u3002  4.1.10 tonumber (e [, base])  \u5982\u679c\u8c03\u7528\u7684\u65f6\u5019\u6ca1\u6709 base\uff0c tonumber \u5c1d\u8bd5\u628a\u53c2\u6570\u8f6c\u6362\u4e3a\u4e00\u4e2a\u6570\u5b57\u3002 \u5982\u679c\u53c2\u6570\u5df2\u7ecf\u662f\u4e00\u4e2a\u6570\u5b57\uff0c\u6216\u662f\u4e00\u4e2a\u53ef\u4ee5\u8f6c\u6362\u4e3a\u6570\u5b57\u7684\u5b57\u7b26\u4e32\uff0c tonumber \u5c31\u8fd4\u56de\u8fd9\u4e2a\u6570\u5b57\uff1b \u5426\u5219\u8fd4\u56de nil\u3002  \u5b57\u7b26\u4e32\u7684\u8f6c\u6362\u7ed3\u679c\u53ef\u80fd\u662f\u6574\u6570\u4e5f\u53ef\u80fd\u662f\u6d6e\u70b9\u6570\uff0c \u8fd9\u53d6\u51b3\u4e8e Lua \u7684\u8f6c\u6362\u6587\u6cd5\u3002 \uff08\u5b57\u7b26\u4e32\u53ef\u4ee5\u6709\u524d\u7f6e\u548c\u540e\u7f6e\u7684\u7a7a\u683c\uff0c\u53ef\u4ee5\u5e26\u7b26\u53f7\u3002\uff09  \u5f53\u4f20\u5165 base \u8c03\u7528\u5b83\u65f6\uff0c e \u5fc5\u987b\u662f\u4e00\u4e2a\u4ee5\u8be5\u8fdb\u5236\u8868\u793a\u7684\u6574\u6570\u5b57\u7b26\u4e32\u3002  \u8fdb\u5236\u53ef\u4ee5\u662f 2 \u5230 36 \uff08\u5305\u542b 2 \u548c 36\uff09\u4e4b\u95f4\u7684\u4efb\u4f55\u6574\u6570\u3002 \u5927\u4e8e 10 \u8fdb\u5236\u65f6\uff0c\u5b57\u6bcd 'A' \uff08\u5927\u5c0f\u5199\u5747\u53ef\uff09\u8868\u793a 10 \uff0c 'B' \u8868\u793a 11\uff0c\u4f9d\u6b21\u5230 'Z' \u8868\u793a 35 \u3002 \u5982\u679c\u5b57\u7b26\u4e32 e \u4e0d\u662f\u8be5\u8fdb\u5236\u4e0b\u7684\u5408\u6cd5\u6570\u5b57\uff0c \u51fd\u6570\u8fd4\u56de nil\u3002  4.1.11 tostring (v)  \u53ef\u4ee5\u63a5\u6536\u4efb\u4f55\u7c7b\u578b\uff0c\u5b83\u5c06\u5176\u8f6c\u6362\u4e3a\u4eba\u53ef\u9605\u8bfb\u7684\u5b57\u7b26\u4e32\u5f62\u5f0f\u3002 \u6d6e\u70b9\u6570\u603b\u88ab\u8f6c\u6362\u4e3a\u6d6e\u70b9\u6570\u7684\u8868\u73b0\u5f62\u5f0f\uff08\u5c0f\u6570\u70b9\u5f62\u5f0f\u6216\u662f\u6307\u6570\u5f62\u5f0f\uff09\u3002 \uff08\u5982\u679c\u60f3\u5b8c\u5168\u63a7\u5236\u6570\u5b57\u5982\u4f55\u88ab\u8f6c\u6362\uff0c\u53ef\u4ee5\u4f7f\u7528 string.format\u3002\uff09\n\u5982\u679c v \u6709 \"__tostring\" \u57df\u7684\u5143\u8868\uff0c tostring \u4f1a\u4ee5 v \u4e3a\u53c2\u6570\u8c03\u7528\u5b83\u3002 \u5e76\u7528\u5b83\u7684\u7ed3\u679c\u4f5c\u4e3a\u8fd4\u56de\u503c\u3002  4.1.12 type (v)  \u5c06\u53c2\u6570\u7684\u7c7b\u578b\u7f16\u7801\u4e3a\u4e00\u4e2a\u5b57\u7b26\u4e32\u8fd4\u56de\u3002 \u51fd\u6570\u53ef\u80fd\u7684\u8fd4\u56de\u503c\u6709 \"nil\" \uff08\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u800c\u4e0d\u662f nil \u503c\uff09\uff0c \"number\"\uff0c \"string\"\uff0c \"boolean\"\uff0c \"table\"\uff0c \"function\"\uff0c \"thread\"\uff0c \"userdata\"\u3002  \u793a\u4f8b\u4ee3\u7801\uff1a  local num = tonumber(\"12.5\")\nlocal str = tostring(13.2)\n\nprint(type(num)) -- number\nprint(type(str)) -- string\nprint(tonumber(\"FF\", 16)) -- 255", 
            "title": "4.1\u57fa\u7840\u51fd\u6570"
        }, 
        {
            "location": "/luamd/04/#42", 
            "text": "\u5173\u4e8e\u534f\u7a0b\u7684\u64cd\u4f5c\u4f5c\u4e3a\u57fa\u7840\u5e93\u7684\u4e00\u4e2a\u5b50\u5e93\uff0c \u88ab\u653e\u5728\u4e00\u4e2a\u72ec\u7acb\u8868 coroutine \u4e2d\u3002   4.2.1 coroutine.create (f)  \u521b\u5efa\u4e00\u4e2a\u4e3b\u4f53\u51fd\u6570\u4e3a f \u7684\u65b0\u534f\u7a0b\u3002 f \u5fc5\u987b\u662f\u4e00\u4e2a Lua \u7684\u51fd\u6570\u3002 \u8fd4\u56de\u8fd9\u4e2a\u65b0\u534f\u7a0b\uff0c\u5b83\u662f\u4e00\u4e2a\u7c7b\u578b\u4e3a \"thread\" \u7684\u5bf9\u8c61\u3002  4.2.2 coroutine.isyieldable ()  \u5982\u679c\u6b63\u5728\u8fd0\u884c\u7684\u534f\u7a0b\u53ef\u4ee5\u8ba9\u51fa\uff0c\u5219\u8fd4\u56de\u771f\u3002  \u4e0d\u5728\u4e3b\u7ebf\u7a0b\u4e2d\u6216\u4e0d\u5728\u4e00\u4e2a\u65e0\u6cd5\u8ba9\u51fa\u7684 C \u51fd\u6570\u4e2d\u65f6\uff0c\u5f53\u524d\u534f\u7a0b\u662f\u53ef\u8ba9\u51fa\u7684\u3002  4.2.3 coroutine.resume (co [, val1, \u00b7\u00b7\u00b7])  \u5f00\u59cb\u6216\u7ee7\u7eed\u534f\u7a0b co \u7684\u8fd0\u884c\u3002 \u5f53\u4f60\u7b2c\u4e00\u6b21\u5ef6\u7eed\u4e00\u4e2a\u534f\u7a0b\uff0c\u5b83\u4f1a\u4ece\u4e3b\u4f53\u51fd\u6570\u5904\u5f00\u59cb\u8fd0\u884c\u3002 val1, ... \u8fd9\u4e9b\u503c\u4f1a\u4ee5\u53c2\u6570\u5f62\u5f0f\u4f20\u5165\u4e3b\u4f53\u51fd\u6570\u3002 \u5982\u679c\u8be5\u534f\u7a0b\u88ab\u8ba9\u51fa\uff0cresume \u4f1a\u91cd\u65b0\u542f\u52a8\u5b83\uff1b val1, ... \u8fd9\u4e9b\u53c2\u6570\u4f1a\u4f5c\u4e3a\u8ba9\u51fa\u70b9\u7684\u8fd4\u56de\u503c\u3002  \u5982\u679c\u534f\u7a0b\u8fd0\u884c\u8d77\u6765\u6ca1\u6709\u9519\u8bef\uff0c resume \u8fd4\u56de true \u52a0\u4e0a\u4f20\u7ed9 yield \u7684\u6240\u6709\u503c \uff08\u5f53\u534f\u7a0b\u8ba9\u51fa\uff09\uff0c \u6216\u662f\u4e3b\u4f53\u51fd\u6570\u7684\u6240\u6709\u8fd4\u56de\u503c\uff08\u5f53\u534f\u7a0b\u4e2d\u6b62\uff09\u3002 \u5982\u679c\u6709\u4efb\u4f55\u9519\u8bef\u53d1\u751f\uff0c resume \u8fd4\u56de false \u52a0\u9519\u8bef\u6d88\u606f\u3002  4.2.4 coroutine.running ()  \u8fd4\u56de\u5f53\u524d\u6b63\u5728\u8fd0\u884c\u7684\u534f\u7a0b\u52a0\u4e00\u4e2a\u5e03\u5c14\u91cf\u3002 \u5982\u679c\u5f53\u524d\u8fd0\u884c\u7684\u534f\u7a0b\u662f\u4e3b\u7ebf\u7a0b\uff0c\u5176\u4e3a\u771f\u3002  4.2.5 coroutine.status (co)  \u4ee5\u5b57\u7b26\u4e32\u5f62\u5f0f\u8fd4\u56de\u534f\u7a0b co \u7684\u72b6\u6001\uff1a    \u5f53\u534f\u7a0b\u6b63\u5728\u8fd0\u884c\uff08\u5b83\u5c31\u662f\u8c03\u7528 status \u7684\u90a3\u4e2a\uff09 \uff0c\u8fd4\u56de \"running\"\uff1b   \u5982\u679c\u534f\u7a0b\u8c03\u7528 yield \u6302\u8d77\u6216\u662f\u8fd8\u6ca1\u6709\u5f00\u59cb\u8fd0\u884c\uff0c\u8fd4\u56de \"suspended\"\uff1b  \u5982\u679c\u534f\u7a0b\u662f\u6d3b\u52a8\u7684\uff0c\u90fd\u5e76\u4e0d\u5728\u8fd0\u884c\uff08\u5373\u5b83\u6b63\u5728\u5ef6\u7eed\u5176\u5b83\u534f\u7a0b\uff09\uff0c\u8fd4\u56de \"normal\"\uff1b   \u5982\u679c\u534f\u7a0b\u8fd0\u884c\u5b8c\u4e3b\u4f53\u51fd\u6570\u6216\u56e0\u9519\u8bef\u505c\u6b62\uff0c\u8fd4\u56de \"dead\"\u3002   4.2.6 coroutine.wrap (f)  \u521b\u5efa\u4e00\u4e2a\u4e3b\u4f53\u51fd\u6570\u4e3a f \u7684\u65b0\u534f\u7a0b\u3002 f \u5fc5\u987b\u662f\u4e00\u4e2a Lua \u7684\u51fd\u6570\u3002 \u8fd4\u56de\u4e00\u4e2a\u51fd\u6570\uff0c \u6bcf\u6b21\u8c03\u7528\u8be5\u51fd\u6570\u90fd\u4f1a\u5ef6\u7eed\u8be5\u534f\u7a0b\u3002 \u4f20\u7ed9\u8fd9\u4e2a\u51fd\u6570\u7684\u53c2\u6570\u90fd\u4f1a\u4f5c\u4e3a resume \u7684\u989d\u5916\u53c2\u6570\u3002 \u548c resume \u8fd4\u56de\u76f8\u540c\u7684\u503c\uff0c \u53ea\u662f\u6ca1\u6709\u7b2c\u4e00\u4e2a\u5e03\u5c14\u91cf\u3002 \u5982\u679c\u53d1\u751f\u4efb\u4f55\u9519\u8bef\uff0c\u629b\u51fa\u8fd9\u4e2a\u9519\u8bef\u3002  4.2.7 coroutine.yield (\u00b7\u00b7\u00b7)  \u6302\u8d77\u6b63\u5728\u8c03\u7528\u7684\u534f\u7a0b\u7684\u6267\u884c\u3002 \u4f20\u9012\u7ed9 yield \u7684\u53c2\u6570\u90fd\u4f1a\u8f6c\u4e3a resume \u7684\u989d\u5916\u8fd4\u56de\u503c\u3002  \u793a\u4f8b1-\u7b80\u5355\u7684\u6848\u4f8b\uff1a  local co = coroutine.create(function () \n    print(\"Hello World\") \nend)\n\nprint(coroutine.status(co))   -- suspended\n\ncoroutine.resume(co)          -- Hello World  \u8c03\u7528\u4e86resume\u51fd\u6570\uff0c\u5c06\u534f\u540c\u7a0b\u5e8fco\u7531suspended\u6539\u4e3arunning\u72b6\u6001\uff0c\u5f53\u6253\u5370\u4e86Hello World\u4e4b\u540e\uff0c\u534f\u540c\u7a0b\u5e8fco\u5c31\u5904\u4e8e\u6b7b\u4ea1\u72b6\u6001\u3002  \u793a\u4f8b2-yield\u4e0eresume\uff1a  local co = coroutine.create(function ()\n     for i = 1, 10 do\n          print(\"co\", i)\n          coroutine.yield()     -- \u6302\u8d77\n     end\nend)\n\n\nprint(coroutine.status(co))     -- suspended\n\ncoroutine.resume(co)            -- \u6253\u5370co 1\n\nprint(coroutine.status(co))     -- suspended\n\ncoroutine.resume(co)            -- \u6253\u5370co 2\n\nprint(coroutine.status(co))     -- suspended\n\ncoroutine.resume(co)            -- \u6253\u5370co 3\ncoroutine.resume(co)            -- \u6253\u5370co 4\ncoroutine.resume(co)            -- \u6253\u5370co 5\ncoroutine.resume(co)            -- \u6253\u5370co 6\ncoroutine.resume(co)            -- \u6253\u5370co 7\ncoroutine.resume(co)            -- \u6253\u5370co 8\ncoroutine.resume(co)            -- \u6253\u5370co 9\ncoroutine.resume(co)            -- \u6253\u5370co 10\ncoroutine.resume(co)            -- \u4ec0\u4e48\u90fd\u4e0d\u6253\u5370\nprint(coroutine.status(co))     -- dead", 
            "title": "4.2 \u534f\u7a0b\u7ba1\u7406"
        }, 
        {
            "location": "/luamd/04/#43", 
            "text": "\u5305\u7ba1\u7406\u5e93\u63d0\u4f9b\u4e86\u4ece Lua \u4e2d\u52a0\u8f7d\u6a21\u5757\u7684\u57fa\u7840\u5e93\u3002 \u53ea\u6709\u4e00\u4e2a\u5bfc\u51fa\u51fd\u6570\u76f4\u63a5\u653e\u5728\u5168\u5c40\u73af\u5883\u4e2d\uff1a require\u3002 \u6240\u6709\u5176\u5b83\u7684\u90e8\u5206\u90fd\u5bfc\u51fa\u5728\u8868 package \u4e2d\u3002  4.3.1 require (modname)  \u52a0\u8f7d\u4e00\u4e2a\u6a21\u5757\u3002  \u8fd9\u4e2a\u51fd\u6570\u9996\u5148\u67e5\u627e package.loaded \u8868\uff0c \u68c0\u6d4b modname \u662f\u5426\u88ab\u52a0\u8f7d\u8fc7\u3002 \u5982\u679c\u88ab\u52a0\u8f7d\u8fc7\uff0crequire \u8fd4\u56de package.loaded[modname] \u4e2d\u4fdd\u5b58\u7684\u503c\u3002 \u5426\u5219\uff0c\u5b83\u8bd5\u7740\u4e3a\u6a21\u5757\u5bfb\u627e \u52a0\u8f7d\u5668 \u3002  require \u9075\u5faa package.searchers \u5e8f\u5217\u7684\u6307\u5f15\u6765\u67e5\u627e\u52a0\u8f7d\u5668\u3002 \u5982\u679c\u6539\u53d8\u8fd9\u4e2a\u5e8f\u5217\uff0c\u6211\u4eec\u53ef\u4ee5\u6539\u53d8 require \u5982\u4f55\u67e5\u627e\u4e00\u4e2a\u6a21\u5757\u3002 \u4e0b\u5217\u8bf4\u660e\u57fa\u4e8e package.searchers \u7684\u9ed8\u8ba4\u914d\u7f6e\u3002  \u9996\u5148 require \u67e5\u627e package.preload[modname] \u3002 \u5982\u679c\u8fd9\u91cc\u6709\u4e00\u4e2a\u503c\uff0c\u8fd9\u4e2a\u503c\uff08\u5fc5\u987b\u662f\u4e00\u4e2a\u51fd\u6570\uff09\u5c31\u662f\u90a3\u4e2a\u52a0\u8f7d\u5668\u3002 \u5426\u5219 require \u4f7f\u7528 Lua \u52a0\u8f7d\u5668\u53bb\u67e5\u627e package.path \u7684\u8def\u5f84\u3002 \u5982\u679c\u67e5\u627e\u5931\u8d25\uff0c\u63a5\u7740\u4f7f\u7528 C \u52a0\u8f7d\u5668\u53bb\u67e5\u627e package.cpath \u7684\u8def\u5f84\u3002 \u5982\u679c\u90fd\u5931\u8d25\u4e86\uff0c\u518d\u5c1d\u8bd5 \u4e00\u4f53\u5316 \u52a0\u8f7d\u5668 \uff08\u53c2\u89c1 package.searchers\uff09\u3002  \u6bcf\u6b21\u627e\u5230\u4e00\u4e2a\u52a0\u8f7d\u5668\uff0crequire \u90fd\u7528\u4e24\u4e2a\u53c2\u6570\u8c03\u7528\u52a0\u8f7d\u5668\uff1a modname \u548c\u4e00\u4e2a\u5728\u83b7\u53d6\u52a0\u8f7d\u5668\u8fc7\u7a0b\u4e2d\u5f97\u5230\u7684\u53c2\u6570\u3002 \uff08\u5982\u679c\u901a\u8fc7\u67e5\u627e\u6587\u4ef6\u5f97\u5230\u7684\u52a0\u8f7d\u5668\uff0c\u8fd9\u4e2a\u989d\u5916\u53c2\u6570\u662f\u6587\u4ef6\u540d\u3002\uff09 \u5982\u679c\u52a0\u8f7d\u5668\u8fd4\u56de\u975e\u7a7a\u503c\uff0c require \u5c06\u8fd9\u4e2a\u503c\u8d4b\u7ed9 package.loaded[modname]\u3002 \u5982\u679c\u52a0\u8f7d\u5668\u6ca1\u80fd\u8fd4\u56de\u4e00\u4e2a\u975e\u7a7a\u503c\u7528\u4e8e\u8d4b\u7ed9 package.loaded[modname]\uff0c require \u4f1a\u5728\u90a3\u91cc\u8bbe\u5165 true \u3002 \u65e0\u8bba\u662f\u4ec0\u4e48\u60c5\u51b5\uff0crequire \u90fd\u4f1a\u8fd4\u56de package.loaded[modname] \u7684\u6700\u7ec8\u503c\u3002  \u5982\u679c\u5728\u52a0\u8f7d\u6216\u8fd0\u884c\u6a21\u5757\u65f6\u6709\u9519\u8bef\uff0c \u6216\u662f\u65e0\u6cd5\u4e3a\u6a21\u5757\u627e\u5230\u52a0\u8f7d\u5668\uff0c require \u90fd\u4f1a\u629b\u51fa\u9519\u8bef\u3002  4.3.2 package.config  \u4e00\u4e2a\u63cf\u8ff0\u6709\u4e00\u4e9b\u4e3a\u5305\u7ba1\u7406\u51c6\u5907\u7684\u7f16\u8bd1\u671f\u914d\u7f6e\u4fe1\u606f\u7684\u4e32\u3002 \u8fd9\u4e2a\u5b57\u7b26\u4e32\u7531\u4e00\u7cfb\u5217\u884c\u6784\u6210\uff1a   \u7b2c\u4e00\u884c\u662f\u76ee\u5f55\u5206\u5272\u4e32\u3002 \u5bf9\u4e8e Windows \u9ed8\u8ba4\u662f '\\' \uff0c\u5bf9\u4e8e\u5176\u5b83\u7cfb\u7edf\u662f '/' \u3002  \u7b2c\u4e8c\u884c\u662f\u7528\u4e8e\u8def\u5f84\u4e2d\u7684\u5206\u5272\u7b26\u3002\u9ed8\u8ba4\u503c\u662f ';' \u3002  \u7b2c\u4e09\u884c\u662f\u7528\u4e8e\u6807\u8bb0\u6a21\u677f\u66ff\u6362\u70b9\u7684\u5b57\u7b26\u4e32\u3002 \u9ed8\u8ba4\u662f '?' \u3002  \u7b2c\u56db\u884c\u662f\u5728 Windows \u4e2d\u5c06\u88ab\u66ff\u6362\u6210\u6267\u884c\u7a0b\u5e8f\u6240\u5728\u76ee\u5f55\u7684\u8def\u5f84\u7684\u5b57\u7b26\u4e32\u3002 \u9ed8\u8ba4\u662f '!' \u3002  \u7b2c\u4e94\u884c\u662f\u4e00\u4e2a\u8bb0\u53f7\uff0c\u8be5\u8bb0\u53f7\u4e4b\u540e\u7684\u6240\u6709\u6587\u672c\u5c06\u5728\u6784\u5efa luaopen_ \u51fd\u6570\u540d\u65f6\u88ab\u5ffd\u7565\u6389\u3002 \u9ed8\u8ba4\u662f '-'\u3002   4.3.3 package.cpath  \u8fd9\u4e2a\u8def\u5f84\u88ab require \u5728 C \u52a0\u8f7d\u5668\u4e2d\u505a\u641c\u7d22\u65f6\u7528\u5230\u3002  Lua \u7528\u548c\u521d\u59cb\u5316 Lua \u8def\u5f84 package.path \u76f8\u540c\u7684\u65b9\u5f0f\u521d\u59cb\u5316 C \u8def\u5f84 package.cpath \u3002 \u5b83\u4f1a\u4f7f\u7528\u73af\u5883\u53d8\u91cf LUA_CPATH_5_3 \u6216 \u73af\u5883\u53d8\u91cf LUA_CPATH \u521d\u59cb\u5316\u3002 \u8981\u4e48\u5c31\u91c7\u7528 luaconf.h \u4e2d\u5b9a\u4e49\u7684\u9ed8\u8ba4\u8def\u5f84\u3002  4.3.4 package.path  \u8fd9\u4e2a\u8def\u5f84\u88ab require \u5728 Lua \u52a0\u8f7d\u5668\u4e2d\u505a\u641c\u7d22\u65f6\u7528\u5230\u3002  \u5728\u542f\u52a8\u65f6\uff0cLua \u7528\u73af\u5883\u53d8\u91cf LUA_PATH_5_3 \u6216\u73af\u5883\u53d8\u91cf LUA_PATH \u6765\u521d\u59cb\u5316\u8fd9\u4e2a\u53d8\u91cf\u3002 \u6216\u91c7\u7528 luaconf.h \u4e2d\u7684\u9ed8\u8ba4\u8def\u5f84\u3002 \u73af\u5883\u53d8\u91cf\u4e2d\u51fa\u73b0\u7684\u6240\u6709 \";;\" \u90fd\u4f1a\u88ab\u66ff\u6362\u6210\u9ed8\u8ba4\u8def\u5f84\u3002  4.3.5 package.searchers  \u7528\u4e8e require \u63a7\u5236\u5982\u4f55\u52a0\u8f7d\u6a21\u5757\u7684\u8868\u3002  \u8fd9\u5f20\u8868\u5185\u7684\u6bcf\u4e00\u9879\u90fd\u662f\u4e00\u4e2a \u67e5\u627e\u5668\u51fd\u6570\u3002 \u5f53\u67e5\u627e\u4e00\u4e2a\u6a21\u5757\u65f6\uff0c require \u6309\u6b21\u5e8f\u8c03\u7528\u8fd9\u4e9b\u67e5\u627e\u5668\uff0c \u5e76\u4f20\u5165\u6a21\u5757\u540d\uff08require \u7684\u53c2\u6570\uff09\u4f5c\u4e3a\u552f\u4e00\u7684\u4e00\u4e2a\u53c2\u6570\u3002 \u6b64\u51fd\u6570\u53ef\u4ee5\u8fd4\u56de\u53e6\u4e00\u4e2a\u51fd\u6570\uff08\u6a21\u5757\u7684 \u52a0\u8f7d\u5668\uff09\u52a0\u4e0a\u53e6\u4e00\u4e2a\u5c06\u4f20\u9012\u7ed9\u8fd9\u4e2a\u52a0\u8f7d\u5668\u7684\u53c2\u6570\u3002 \u6216\u662f\u8fd4\u56de\u4e00\u4e2a\u63cf\u8ff0\u4e3a\u4f55\u6ca1\u6709\u627e\u5230\u8fd9\u4e2a\u6a21\u5757\u7684\u5b57\u7b26\u4e32 \uff08\u6216\u662f\u8fd4\u56de nil \u4ec0\u4e48\u4e5f\u4e0d\u60f3\u8bf4\uff09\u3002  Lua \u7528\u56db\u4e2a\u67e5\u627e\u5668\u51fd\u6570\u521d\u59cb\u5316\u8fd9\u5f20\u8868\u3002    \u7b2c\u4e00\u4e2a\u67e5\u627e\u5668\u5c31\u662f\u7b80\u5355\u7684\u5728 package.preload \u8868\u4e2d\u67e5\u627e\u52a0\u8f7d\u5668\u3002    \u7b2c\u4e8c\u4e2a\u67e5\u627e\u5668\u7528\u4e8e\u67e5\u627e Lua \u5e93\u7684\u52a0\u8f7d\u5e93\u3002 \u5b83\u4f7f\u7528\u50a8\u5b58\u5728 package.path \u4e2d\u7684\u8def\u5f84\u6765\u505a\u67e5\u627e\u5de5\u4f5c\u3002 \u67e5\u627e\u8fc7\u7a0b\u548c\u51fd\u6570 package.searchpath \u63cf\u8ff0\u7684\u4e00\u81f4\u3002    \u7b2c\u4e09\u4e2a\u67e5\u627e\u5668\u7528\u4e8e\u67e5\u627e C \u5e93\u7684\u52a0\u8f7d\u5e93\u3002 \u5b83\u4f7f\u7528\u50a8\u5b58\u5728 package.cpath \u4e2d\u7684\u8def\u5f84\u6765\u505a\u67e5\u627e\u5de5\u4f5c\u3002 \u540c\u6837\uff0c \u67e5\u627e\u8fc7\u7a0b\u548c\u51fd\u6570 package.searchpath \u63cf\u8ff0\u7684\u4e00\u81f4\u3002 \u4f8b\u5982\uff0c\u5982\u679c C \u8def\u5f84\u662f\u8fd9\u6837\u4e00\u4e2a\u5b57\u7b26\u4e32  \"./?.so;./?.dll;/usr/local/?/init.so\"\n\u67e5\u627e\u5668\u67e5\u627e\u6a21\u5757 foo \u4f1a\u4f9d\u6b21\u5c1d\u8bd5\u6253\u5f00\u6587\u4ef6 ./foo.so\uff0c./foo.dll\uff0c \u4ee5\u53ca /usr/local/foo/init.so\u3002 \u4e00\u65e6\u5b83\u627e\u5230\u4e00\u4e2a C \u5e93\uff0c \u67e5\u627e\u5668\u9996\u5148\u4f7f\u7528\u52a8\u6001\u94fe\u63a5\u673a\u5236\u8fde\u63a5\u8be5\u5e93\u3002 \u7136\u540e\u5c1d\u8bd5\u5728\u8be5\u5e93\u4e2d\u627e\u5230\u53ef\u4ee5\u7528\u4f5c\u52a0\u8f7d\u5668\u7684 C \u51fd\u6570\u3002 \u8fd9\u4e2a C \u51fd\u6570\u7684\u540d\u5b57\u662f \"luaopen_\" \u7d27\u63a5\u6a21\u5757\u540d\u7684\u5b57\u7b26\u4e32\uff0c \u5176\u4e2d\u5b57\u7b26\u4e32\u4e2d\u6240\u6709\u7684\u4e0b\u5212\u7ebf\u90fd\u4f1a\u88ab\u66ff\u6362\u6210\u70b9\u3002 \u6b64\u5916\uff0c\u5982\u679c\u6a21\u5757\u540d\u4e2d\u6709\u6a2a\u7ebf\uff0c \u6a2a\u7ebf\u540e\u9762\u7684\u90e8\u5206\uff08\u5305\u62ec\u6a2a\u7ebf\uff09\u90fd\u88ab\u53bb\u6389\u3002 \u4f8b\u5982\uff0c\u5982\u679c\u6a21\u5757\u540d\u4e3a a.b.c-v2.1\uff0c \u51fd\u6570\u540d\u5c31\u662f luaopen_a_b_c\u3002    \u7b2c\u56db\u4e2a\u641c\u7d22\u5668\u662f\u3000\u4e00\u4f53\u5316\u52a0\u8f7d\u5668\u3002 \u5b83\u4ece C \u8def\u5f84\u4e2d\u67e5\u627e\u6307\u5b9a\u6a21\u5757\u7684\u6839\u540d\u5b57\u3002 \u4f8b\u5982\uff0c\u5f53\u8bf7\u6c42 a.b.c\u3000\u65f6\uff0c \u5b83\u5c06\u67e5\u627e a \u8fd9\u4e2a C \u5e93\u3002 \u5982\u679c\u627e\u5f97\u5230\uff0c\u5b83\u4f1a\u5728\u91cc\u9762\u627e\u5b50\u6a21\u5757\u7684\u52a0\u8f7d\u51fd\u6570\u3002 \u5728\u6211\u4eec\u7684\u4f8b\u5b50\u4e2d\uff0c\u5c31\u662f\u627e\u3000luaopen_a_b_c\u3002 \u5229\u7528\u8fd9\u4e2a\u673a\u5236\uff0c\u53ef\u4ee5\u628a\u82e5\u5e72 C \u5b50\u6a21\u5757\u6253\u5305\u8fdb\u5355\u4e2a\u5e93\u3002 \u6bcf\u4e2a\u5b50\u6a21\u5757\u90fd\u53ef\u4ee5\u6709\u539f\u672c\u7684\u52a0\u8f7d\u51fd\u6570\u540d\u3002    \u9664\u4e86\u7b2c\u4e00\u4e2a\uff08\u9884\u52a0\u8f7d\uff09\u641c\u7d22\u5668\u5916\uff0c\u6bcf\u4e2a\u641c\u7d22\u5668\u90fd\u4f1a\u8fd4\u56de \u5b83\u627e\u5230\u7684\u6a21\u5757\u7684\u6587\u4ef6\u540d\u3002 \u8fd9\u548c package.searchpath \u7684\u8fd4\u56de\u503c\u4e00\u6837\u3002 \u7b2c\u4e00\u4e2a\u641c\u7d22\u5668\u6ca1\u6709\u8fd4\u56de\u503c\u3002  4.3.6 package.searchpath (name, path [, sep [, rep]])  \u5728\u6307\u5b9a path \u4e2d\u641c\u7d22\u6307\u5b9a\u7684 name \u3002  \u8def\u5f84\u662f\u4e00\u4e2a\u5305\u542b\u6709\u4e00\u7cfb\u5217\u4ee5\u5206\u53f7\u5206\u5272\u7684 \u6a21\u677f \u6784\u6210\u7684\u5b57\u7b26\u4e32\u3002 \u5bf9\u4e8e\u6bcf\u4e2a\u6a21\u677f\uff0c\u90fd\u4f1a\u7528 name \u66ff\u6362\u5176\u4e2d\u7684\u6bcf\u4e2a\u95ee\u53f7\uff08\u5982\u679c\u6709\u7684\u8bdd\uff09\u3002 \u4e14\u5c06\u5176\u4e2d\u7684 sep \uff08\u9ed8\u8ba4\u662f\u70b9\uff09\u66ff\u6362\u4e3a rep \uff08\u9ed8\u8ba4\u662f\u7cfb\u7edf\u7684\u76ee\u5f55\u5206\u5272\u7b26\uff09\u3002 \u7136\u540e\u5c1d\u8bd5\u6253\u5f00\u8fd9\u4e2a\u6587\u4ef6\u540d\u3002  \u4f8b\u5982\uff0c\u5982\u679c\u8def\u5f84\u662f\u5b57\u7b26\u4e32   \"./?.lua;./?.lc;/usr/local/?/init.lua\"  \u641c\u7d22 foo.a\u3000\u8fd9\u4e2a\u540d\u5b57\u5c06 \u4f9d\u6b21\u5c1d\u8bd5\u6253\u5f00\u6587\u4ef6 ./foo/a.lua\u3000\uff0c ./foo/a.lc\u3000\uff0c\u4ee5\u53ca /usr/local/foo/a/init.lua\u3002  \u8fd4\u56de\u7b2c\u4e00\u4e2a\u53ef\u4ee5\u7528\u8bfb\u6a21\u5f0f\u6253\u5f00\uff08\u5e76\u9a6c\u4e0a\u5173\u95ed\u8be5\u6587\u4ef6\uff09\u7684\u6587\u4ef6\u7684\u540d\u5b57\u3002 \u5982\u679c\u4e0d\u5b58\u5728\u8fd9\u6837\u7684\u6587\u4ef6\uff0c\u8fd4\u56de nil \u52a0\u4e0a\u9519\u8bef\u6d88\u606f\u3002 \uff08\u8fd9\u6761\u9519\u8bef\u6d88\u606f\u5217\u51fa\u4e86\u6240\u6709\u5c1d\u8bd5\u6253\u5f00\u7684\u6587\u4ef6\u540d\u3002\uff09  \u793a\u4f8b\u4ee3\u7801(\u590d\u6570\u6848\u4f8b)\uff1a  complex.lua   complex = {}\n\nfunction complex.new(r, i) \n    return {r = r, i = i} -- a table\nend\n\nfunction complex.add(c1, c2)\n    return complex.new(c1.r + c2.r, c1.i + c2.i)\nend\n\nfunction complex.sub(c1, c2)\n    return complex.new(c1.r - c2.r, c1.i - c2.i)\nend\n\nreturn complex  test.lua  local complex = require(\"complex\")\n\nlocal c1 = complex.new(0, 1) -- a table\nlocal c2 = complex.new(1, 2)\n\nlocal ret = complex.add(c1, c2)\n\nprint(ret.r, ret.i) -- 1 3", 
            "title": "4.3 \u6a21\u5757"
        }, 
        {
            "location": "/luamd/04/#44", 
            "text": "\u8fd9\u4e2a\u5e93\u63d0\u4f9b\u4e86\u5b57\u7b26\u4e32\u5904\u7406\u7684\u901a\u7528\u51fd\u6570\u3002 \u4f8b\u5982\u5b57\u7b26\u4e32\u67e5\u627e\u3001\u5b50\u4e32\u3001\u6a21\u5f0f\u5339\u914d\u7b49\u3002  \u5f53\u5728 Lua \u4e2d\u5bf9\u5b57\u7b26\u4e32\u505a\u7d22\u5f15\u65f6\uff0c\u7b2c\u4e00\u4e2a\u5b57\u7b26\u4ece 1 \u5f00\u59cb\u8ba1\u7b97\uff08\u800c\u4e0d\u662f C \u91cc\u7684 0 \uff09\u3002 \u7d22\u5f15\u53ef\u4ee5\u662f\u8d1f\u6570\uff0c\u5b83\u6307\u4ece\u5b57\u7b26\u4e32\u672b\u5c3e\u53cd\u5411\u89e3\u6790\u3002 \u5373\uff0c\u6700\u540e\u4e00\u4e2a\u5b57\u7b26\u5728 -1 \u4f4d\u7f6e\u5904\uff0c\u7b49\u7b49\u3002  \u5b57\u7b26\u4e32\u5e93\u4e2d\u7684\u6240\u6709\u51fd\u6570\u90fd\u5728\u8868 string \u4e2d\u3002 \u5b83\u8fd8\u5c06\u5176\u8bbe\u7f6e\u4e3a\u5b57\u7b26\u4e32\u5143\u8868\u7684 __index \u57df\u3002 \u56e0\u6b64\uff0c\u4f60\u53ef\u4ee5\u4ee5\u9762\u5411\u5bf9\u8c61\u7684\u5f62\u5f0f\u4f7f\u7528\u5b57\u7b26\u4e32\u51fd\u6570\u3002 \u4f8b\u5982\uff0cstring.byte(s,i) \u53ef\u4ee5\u5199\u6210 s:byte(i)\u3002  \u5b57\u7b26\u4e32\u5e93\u5047\u5b9a\u91c7\u7528\u5355\u5b57\u8282\u5b57\u7b26\u7f16\u7801  4.4.1 string.format (formatstring, \u00b7\u00b7\u00b7)  \u8fd4\u56de\u4e0d\u5b9a\u6570\u91cf\u53c2\u6570\u7684\u683c\u5f0f\u5316\u7248\u672c\uff0c \u683c\u5f0f\u5316\u4e32\u4e3a\u7b2c\u4e00\u4e2a\u53c2\u6570\uff08\u5fc5\u987b\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\uff09\u3002 \u683c\u5f0f\u5316\u5b57\u7b26\u4e32\u9075\u5faa ISO C \u51fd\u6570 sprintf \u7684\u89c4\u5219\u3002 \u4e0d\u540c\u70b9\u5728\u4e8e\u9009\u9879 *, h, L, l, n, p \u4e0d\u652f\u6301\uff0c \u53e6\u5916\u8fd8\u589e\u52a0\u4e86\u4e00\u4e2a\u9009\u9879 q\u3002 q \u9009\u9879\u5c06\u4e00\u4e2a\u5b57\u7b26\u4e32\u683c\u5f0f\u5316\u4e3a\u4e24\u4e2a\u53cc\u5f15\u53f7\u62ec\u8d77\uff0c\u5bf9\u5185\u90e8\u5b57\u7b26\u505a\u6070\u5f53\u7684\u8f6c\u4e49\u5904\u7406\u7684\u5b57\u7b26\u4e32\u3002 \u8be5\u5b57\u7b26\u4e32\u53ef\u4ee5\u5b89\u5168\u7684\u88ab Lua \u89e3\u91ca\u5668\u8bfb\u56de\u6765\u3002 \u4f8b\u5982\uff0c\u8c03\u7528   string.format('%q', 'a string with \"quotes\" and \\n new line')  \u4f1a\u4ea7\u751f\u5b57\u7b26\u4e32\uff1a   \"a string with \\\"quotes\\\" and \\\n  new line\"  \u9009\u9879 A and a \uff08\u5982\u679c\u6709\u7684\u8bdd\uff09\uff0c E, e, f, G, and g \u90fd\u671f\u5f85\u4e00\u4e2a\u5bf9\u5e94\u7684\u6570\u5b57\u53c2\u6570\u3002 \u9009\u9879 c, d, i, o, u, X, and x \u5219\u671f\u5f85\u4e00\u4e2a\u6574\u6570\u3002 \u9009\u9879 q \u671f\u5f85\u4e00\u4e2a\u5b57\u7b26\u4e32\uff1b \u9009\u9879 s \u671f\u5f85\u4e00\u4e2a\u6ca1\u6709\u5185\u5d4c\u96f6\u7684\u5b57\u7b26\u4e32\u3002 \u5982\u679c\u9009\u9879 s \u5bf9\u5e94\u7684\u53c2\u6570\u4e0d\u662f\u5b57\u7b26\u4e32\uff0c\u5b83\u4f1a\u7528\u548c tostring \u4e00\u81f4\u7684\u89c4\u5219\u8f6c\u6362\u6210\u5b57\u7b26\u4e32\u3002  4.4.2 string.gmatch (s, pattern)  \u8fd4\u56de\u4e00\u4e2a\u8fed\u4ee3\u5668\u51fd\u6570\u3002 \u6bcf\u6b21\u8c03\u7528\u8fd9\u4e2a\u51fd\u6570\u90fd\u4f1a\u7ee7\u7eed\u4ee5 pattern \u5bf9 s \u505a\u5339\u914d\uff0c\u5e76\u8fd4\u56de\u6240\u6709\u6355\u83b7\u5230\u7684\u503c\u3002 \u5982\u679c pattern \u4e2d\u6ca1\u6709\u6307\u5b9a\u6355\u83b7\uff0c\u5219\u6bcf\u6b21\u6355\u83b7\u6574\u4e2a pattern\u3002\n\u4e0b\u9762\u8fd9\u4e2a\u4f8b\u5b50\u4f1a\u5faa\u73af\u8fed\u4ee3\u5b57\u7b26\u4e32 s \u4e2d\u6240\u6709\u7684\u5355\u8bcd\uff0c \u5e76\u9010\u884c\u6253\u5370\uff1a   s = \"hello world from Lua\"\n for w in string.gmatch(s, \"%a+\") do\n   print(w)\n end  \u4e0b\u4e00\u4e2a\u4f8b\u5b50\u4ece\u6307\u5b9a\u7684\u5b57\u7b26\u4e32\u4e2d\u6536\u96c6\u6240\u6709\u7684\u952e\u503c\u5bf9 key=value\uff1a  local s = \"from=world, to=Lua\"\n\nfor k, v in string.gmatch(s, \"(%w+)=(%w+)\") do\n    print (k..' -  '..v)    \nend  4.4.3 string.gsub (s, pattern, repl [, n])  \u5c06\u5b57\u7b26\u4e32 s \u4e2d\uff0c\u6240\u6709\u7684\uff08\u6216\u662f\u5728 n \u7ed9\u51fa\u65f6\u7684\u524d n \u4e2a\uff09 pattern \u90fd\u66ff\u6362\u6210 repl \uff0c\u5e76\u8fd4\u56de\u5176\u526f\u672c\u3002 repl \u53ef\u4ee5\u662f\u5b57\u7b26\u4e32\u3001\u8868\u3001\u6216\u51fd\u6570\u3002 gsub \u8fd8\u4f1a\u5728\u7b2c\u4e8c\u4e2a\u8fd4\u56de\u503c\u8fd4\u56de\u4e00\u5171\u53d1\u751f\u4e86\u591a\u5c11\u6b21\u5339\u914d\u3002  gsub \u8fd9\u4e2a\u540d\u5b57\u6765\u6e90\u4e8e Global SUBstitution \u3002  -  \u5982\u679c repl \u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c \u90a3\u4e48\u628a\u8fd9\u4e2a\u5b57\u7b26\u4e32\u4f5c\u4e3a\u66ff\u6362\u54c1\u3002 \u5b57\u7b26 % \u662f\u4e00\u4e2a\u8f6c\u4e49\u7b26\uff1a repl \u4e2d\u7684\u6240\u6709\u5f62\u5f0f\u4e3a %d \u7684\u4e32\u8868\u793a \u7b2c d \u4e2a\u6355\u83b7\u5230\u7684\u5b50\u4e32\uff0cd \u53ef\u4ee5\u662f 1 \u5230 9 \u3002 \u4e32 %0 \u8868\u793a\u6574\u4e2a\u5339\u914d\u3002 \u4e32 %% \u8868\u793a\u5355\u4e2a %\u3002\n-  \u5982\u679c repl \u662f\u5f20\u8868\uff0c \u6bcf\u6b21\u5339\u914d\u65f6\u90fd\u4f1a\u7528\u7b2c\u4e00\u4e2a\u6355\u83b7\u7269\u4f5c\u4e3a\u952e\u53bb\u67e5\u8fd9\u5f20\u8868\u3002\n- \u5982\u679c repl \u662f\u4e2a\u51fd\u6570\uff0c\u5219\u5728\u6bcf\u6b21\u5339\u914d\u53d1\u751f\u65f6\u90fd\u4f1a\u8c03\u7528\u8fd9\u4e2a\u51fd\u6570\u3002 \u6240\u6709\u6355\u83b7\u5230\u7684\u5b50\u4e32\u4f9d\u6b21\u4f5c\u4e3a\u53c2\u6570\u4f20\u5165\u3002\n\u4efb\u4f55\u60c5\u51b5\u4e0b\uff0c\u6a21\u677f\u4e2d\u6ca1\u6709\u8bbe\u5b9a\u6355\u83b7\u90fd\u770b\u6210\u662f\u6355\u83b7\u6574\u4e2a\u6a21\u677f\u3002\n-  \u5982\u679c\u8868\u7684\u67e5\u8be2\u7ed3\u679c\u6216\u51fd\u6570\u7684\u8fd4\u56de\u7ed3\u679c\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\u6216\u662f\u4e2a\u6570\u5b57\uff0c  \u90fd\u5c06\u5176\u4f5c\u4e3a\u66ff\u6362\u7528\u4e32\uff1b \u800c\u5728\u8fd4\u56de false \u6216 nil\u3000\u65f6\u4e0d\u4f5c\u66ff\u6362 \uff08\u5373\u4fdd\u7559\u5339\u914d\u524d\u7684\u539f\u59cb\u4e32\uff09\u3002  \u793a\u4f8b\u4ee3\u7801\uff1a  x = string.gsub(\"hello world\", \"(%w+)\", \"%1 %1\")\nprint(x)\n-- x=\"hello hello world world\"\n\nx = string.gsub(\"hello world\", \"%w+\", \"%0 %0\", 1)\nprint(x)\n-- x=\"hello hello world\"\n\nx = string.gsub(\"hello world from Lua\", \"(%w+)%s*(%w+)\", \"%2 %1\")\nprint(x)\n-- x=\"world hello Lua from\"\n\nx = string.gsub(\"home = $HOME, user = $USER\", \"%$(%w+)\", os.getenv)\nprint(x)\n-- x=\"home = /home/roberto, user = roberto\"\n\nx = string.gsub(\"4+5 = $return 4+5$\", \"%$(.-)%$\", function (s)\n   return load(s)()\n end)\nprint(x)\n-- x=\"4+5 = 9\"\n\nlocal t = {name=\"lua\", version=\"5.3\"}\nx = string.gsub(\"$name-$version.tar.gz\", \"%$(%w+)\", t)\nprint(x)\n-- x=\"lua-5.3.tar.gz\"  4.4.4 string.len (s)  \u63a5\u6536\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u8fd4\u56de\u5176\u957f\u5ea6\u3002 \u7a7a\u4e32 \"\" \u7684\u957f\u5ea6\u4e3a 0 \u3002 \u5185\u5d4c\u96f6\u4e5f\u7edf\u8ba1\u5728\u5185\uff0c\u56e0\u6b64 \"a\\000bc\\000\" \u7684\u957f\u5ea6\u4e3a 5 \u3002  4.4.5 string.lower (s)  \u63a5\u6536\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u5c06\u5176\u4e2d\u7684\u5927\u5199\u5b57\u7b26\u90fd\u8f6c\u4e3a\u5c0f\u5199\u540e\u8fd4\u56de\u5176\u526f\u672c\u3002 \u5176\u5b83\u7684\u5b57\u7b26\u4e32\u4e0d\u4f1a\u66f4\u6539\u3002 \u5bf9\u5927\u5199\u5b57\u7b26\u7684\u5b9a\u4e49\u53d6\u51b3\u4e8e\u5f53\u524d\u7684\u533a\u57df\u8bbe\u7f6e\u3002  4.4.6 string.reverse (s)  \u8fd4\u56de\u5b57\u7b26\u4e32 s \u7684\u7ffb\u8f6c\u4e32\u3002  4.4.7 string.sub (s, i [, j])  \u8fd4\u56de s \u7684\u5b50\u4e32 \uff0c \u8be5\u5b50\u4e32\u4ece i \u5f00\u59cb\u5230 j \u4e3a\u6b62\uff1b i \u548c j \u90fd\u53ef\u4ee5\u4e3a\u8d1f\u6570\u3002 \u5982\u679c\u4e0d\u7ed9\u51fa j \uff0c\u5c31\u5f53\u5b83\u662f -1 \uff08\u548c\u5b57\u7b26\u4e32\u957f\u5ea6\u76f8\u540c\uff09\u3002 \u7279\u522b\u662f\uff0c \u8c03\u7528 string.sub(s,1,j) \u53ef\u4ee5\u8fd4\u56de s \u7684\u957f\u5ea6\u4e3a j \u7684\u524d\u7f00\u4e32\uff0c \u800c string.sub(s, -i) \u8fd4\u56de\u957f\u5ea6\u4e3a i \u7684\u540e\u7f00\u4e32\u3002\n\u5982\u679c\u5728\u5bf9\u8d1f\u6570\u7d22\u5f15\u8f6c\u4e49\u540e i \u5c0f\u4e8e 1 \u7684\u8bdd\uff0c\u5c31\u4fee\u6b63\u56de 1 \u3002 \u5982\u679c j \u6bd4\u5b57\u7b26\u4e32\u7684\u957f\u5ea6\u8fd8\u5927\uff0c\u5c31\u4fee\u6b63\u4e3a\u5b57\u7b26\u4e32\u957f\u5ea6\u3002 \u5982\u679c\u5728\u4fee\u6b63\u4e4b\u540e\uff0ci \u5927\u4e8e j\uff0c \u51fd\u6570\u8fd4\u56de\u7a7a\u4e32\u3002  4.4.8 string.upper (s)  \u63a5\u6536\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u5c06\u5176\u4e2d\u7684\u5c0f\u5199\u5b57\u7b26\u90fd\u8f6c\u4e3a\u5927\u5199\u540e\u8fd4\u56de\u5176\u526f\u672c\u3002 \u5176\u5b83\u7684\u5b57\u7b26\u4e32\u4e0d\u4f1a\u66f4\u6539\u3002 \u5bf9\u5c0f\u5199\u5b57\u7b26\u7684\u5b9a\u4e49\u53d6\u51b3\u4e8e\u5f53\u524d\u7684\u533a\u57df\u8bbe\u7f6e\u3002  \u793a\u4f8b\u4ee3\u7801\uff1a  local str = \"hello lua\"\n\nprint(string.len(str))        -- 9\nprint(string.rep(str, 2))     -- hello luahello lua\nprint(string.upper(str))      -- HELLO LUA\nprint(string.sub(str, 2, 6))  -- ello\nprint(string.sub(str, 2, -2)) -- ello lu\nprint(string.format(\"%s %d\", \"hello lua\", 32)) -- hello lua 32  \u5728Lua\u4e2d\uff0c\u5b57\u7b26\u4e32\u7684\u7b2c\u4e00\u4e2a\u5b57\u7b26\u7684\u7d22\u5f15\u662f1\uff0c\u4f46\u662f\uff0c\u7d22\u5f15\u4e5f\u53ef\u4ee5\u662f\u8d1f\u6570\uff0c\u8868\u793a\u4ece\u5b57\u7b26\u4e32\u7684\u5c3e\u90e8\u5f00\u59cb\u8ba1\u6570\uff0c\u7d22\u5f15-1\u4ee3\u8868\u5b57\u7b26\u4e32\u7684\u6700\u540e\u4e00\u4e2a\u5b57\u7b26\u3002", 
            "title": "4.4 \u5b57\u7b26\u4e32\u5904\u7406"
        }, 
        {
            "location": "/luamd/04/#45", 
            "text": "Lua \u4e2d\u7684\u5339\u914d\u6a21\u5f0f\u76f4\u63a5\u7528\u5e38\u89c4\u7684\u5b57\u7b26\u4e32\u6765\u63cf\u8ff0\u3002 \u5b83\u7528\u4e8e\u6a21\u5f0f\u5339\u914d\u51fd\u6570 string.find, string.gmatch, string.gsub, string.match\u3002 \u8fd9\u4e00\u8282\u8868\u8ff0\u4e86\u8fd9\u4e9b\u5b57\u7b26\u4e32\u7684\u8bed\u6cd5\u53ca\u542b\u4e49\uff08\u5373\u5b83\u80fd\u5339\u914d\u5230\u4ec0\u4e48\uff09\u3002  4.5.1 \u5b57\u7b26\u7c7b  \u5b57\u7b26\u7c7b\u7528\u4e8e\u8868\u793a\u4e00\u4e2a\u5b57\u7b26\u96c6\u5408\u3002 \u4e0b\u5217\u7ec4\u5408\u53ef\u7528\u4e8e\u5b57\u7b26\u7c7b\uff1a   x: \uff08\u8fd9\u91cc x \u4e0d\u80fd\u662f \u9b54\u6cd5\u5b57\u7b26 ^$()%.[]*+-? \u4e2d\u7684\u4e00\u5458\uff09 \u8868\u793a\u5b57\u7b26 x \u81ea\u8eab\u3002  .: \uff08\u4e00\u4e2a\u70b9\uff09\u53ef\u8868\u793a\u4efb\u4f55\u5b57\u7b26\u3002  %a: \u8868\u793a\u4efb\u4f55\u5b57\u6bcd\u3002  %c: \u8868\u793a\u4efb\u4f55\u63a7\u5236\u5b57\u7b26\u3002  %d: \u8868\u793a\u4efb\u4f55\u6570\u5b57\u3002  %g: \u8868\u793a\u4efb\u4f55\u9664\u7a7a\u767d\u7b26\u5916\u7684\u53ef\u6253\u5370\u5b57\u7b26\u3002  %l: \u8868\u793a\u6240\u6709\u5c0f\u5199\u5b57\u6bcd\u3002  %p: \u8868\u793a\u6240\u6709\u6807\u70b9\u7b26\u53f7\u3002  %s: \u8868\u793a\u6240\u6709\u7a7a\u767d\u5b57\u7b26\u3002  %u: \u8868\u793a\u6240\u6709\u5927\u5199\u5b57\u6bcd\u3002  %w: \u8868\u793a\u6240\u6709\u5b57\u6bcd\u53ca\u6570\u5b57\u3002  %x: \u8868\u793a\u6240\u6709 16 \u8fdb\u5236\u6570\u5b57\u7b26\u53f7\u3002  %x: \uff08\u8fd9\u91cc\u7684 x \u662f\u4efb\u610f\u975e\u5b57\u6bcd\u6216\u6570\u5b57\u7684\u5b57\u7b26\uff09 \u8868\u793a\u5b57\u7b26 x\u3002 \u8fd9\u662f\u5bf9\u9b54\u6cd5\u5b57\u7b26\u8f6c\u4e49\u7684\u6807\u51c6\u65b9\u6cd5\u3002 \u6240\u6709\u975e\u5b57\u6bcd\u6216\u6570\u5b57\u7684\u5b57\u7b26 \uff08\u5305\u62ec\u6240\u6709\u6807\u70b9\uff0c\u4e5f\u5305\u62ec\u975e\u9b54\u6cd5\u5b57\u7b26\uff09 \u90fd\u53ef\u4ee5\u7528\u524d\u7f6e\u4e00\u4e2a '%' \u653e\u5728\u6a21\u5f0f\u4e32\u4e2d\u8868\u793a\u81ea\u8eab\u3002   [set]: \u8868\u793a set\u3000\u4e2d\u6240\u6709\u5b57\u7b26\u7684\u8054\u5408\u3002 \u53ef\u4ee5\u4ee5 '-' \u8fde\u63a5\uff0c\u5347\u5e8f\u4e66\u5199\u8303\u56f4\u4e24\u7aef\u7684\u5b57\u7b26\u6765\u8868\u793a\u4e00\u4e2a\u8303\u56f4\u7684\u5b57\u7b26\u96c6\u3002 \u4e0a\u9762\u63d0\u5230\u7684 %x \u5f62\u5f0f\u4e5f\u53ef\u4ee5\u5728 set \u4e2d\u4f7f\u7528 \u8868\u793a\u5176\u4e2d\u7684\u4e00\u4e2a\u5143\u7d20\u3002 \u5176\u5b83\u51fa\u73b0\u5728 set \u4e2d\u7684\u5b57\u7b26\u5219\u4ee3\u8868\u5b83\u4eec\u81ea\u5df1\u3002 \u4f8b\u5982\uff0c[%w_] \uff08\u6216 [_%w]\uff09 \u8868\u793a\u6240\u6709\u7684\u5b57\u6bcd\u6570\u5b57\u52a0\u4e0b\u5212\u7ebf\uff09\uff0c [0-7] \u8868\u793a 8 \u8fdb\u5236\u6570\u5b57\uff0c [0-7%l%-]\u3000\u8868\u793a 8 \u8fdb\u5236\u6570\u5b57\u52a0\u5c0f\u5199\u5b57\u6bcd\u4e0e '-' \u5b57\u7b26\u3002\n\u4ea4\u53c9\u4f7f\u7528\u7c7b\u548c\u8303\u56f4\u7684\u884c\u4e3a\u672a\u5b9a\u4e49\u3002 \u56e0\u6b64\uff0c\u50cf [%a-z] \u6216 [a-%%] \u8fd9\u6837\u7684\u6a21\u5f0f\u4e32\u6ca1\u6709\u610f\u4e49\u3002    [^set]: \u8868\u793a set \u7684\u8865\u96c6\uff0c \u5176\u4e2d set \u5982\u4e0a\u9762\u7684\u89e3\u91ca\u3002\n\u6240\u6709\u5355\u4e2a\u5b57\u6bcd\u8868\u793a\u7684\u7c7b\u522b\uff08%a\uff0c%c\uff0c\u7b49\uff09\uff0c \u82e5\u5c06\u5176\u5b57\u6bcd\u6539\u4e3a\u5927\u5199\uff0c\u5747\u8868\u793a\u5bf9\u5e94\u7684\u8865\u96c6\u3002 \u4f8b\u5982\uff0c%S \u8868\u793a\u6240\u6709\u975e\u7a7a\u683c\u7684\u5b57\u7b26\u3002    \u5982\u4f55\u5b9a\u4e49\u5b57\u6bcd\u3001\u7a7a\u683c\u3001\u6216\u662f\u5176\u4ed6\u5b57\u7b26\u7ec4\u53d6\u51b3\u4e8e\u5f53\u524d\u7684\u533a\u57df\u8bbe\u7f6e\u3002 \u7279\u522b\u6ce8\u610f\uff1a[a-z]\u3000\u672a\u5fc5\u7b49\u4ef7\u4e8e %l \u3002  4.5.2 \u6a21\u5f0f\u6761\u76ee\uff1a  \u6a21\u5f0f\u6761\u76ee\u53ef\u4ee5\u662f\uff1a   \u5355\u4e2a\u5b57\u7b26\u7c7b\u5339\u914d\u8be5\u7c7b\u522b\u4e2d\u4efb\u610f\u5355\u4e2a\u5b57\u7b26\uff1b  \u5355\u4e2a\u5b57\u7b26\u7c7b\u8ddf\u4e00\u4e2a '*'\uff0c \u5c06\u5339\u914d\u96f6\u6216\u591a\u4e2a\u8be5\u7c7b\u7684\u5b57\u7b26\u3002 \u8fd9\u4e2a\u6761\u76ee\u603b\u662f\u5339\u914d\u5c3d\u53ef\u80fd\u957f\u7684\u4e32\uff1b  \u5355\u4e2a\u5b57\u7b26\u7c7b\u8ddf\u4e00\u4e2a '+'\uff0c \u5c06\u5339\u914d\u4e00\u6216\u66f4\u591a\u4e2a\u8be5\u7c7b\u7684\u5b57\u7b26\u3002 \u8fd9\u4e2a\u6761\u76ee\u603b\u662f\u5339\u914d\u5c3d\u53ef\u80fd\u957f\u7684\u4e32\uff1b  \u5355\u4e2a\u5b57\u7b26\u7c7b\u8ddf\u4e00\u4e2a '-'\uff0c \u5c06\u5339\u914d\u96f6\u6216\u66f4\u591a\u4e2a\u8be5\u7c7b\u7684\u5b57\u7b26\u3002 \u548c '*' \u4e0d\u540c\uff0c \u8fd9\u4e2a\u6761\u76ee\u603b\u662f\u5339\u914d\u5c3d\u53ef\u80fd\u77ed\u7684\u4e32\uff1b  \u5355\u4e2a\u5b57\u7b26\u7c7b\u8ddf\u4e00\u4e2a '?'\uff0c \u5c06\u5339\u914d\u96f6\u6216\u4e00\u4e2a\u8be5\u7c7b\u7684\u5b57\u7b26\u3002 \u53ea\u8981\u6709\u53ef\u80fd\uff0c\u5b83\u4f1a\u5339\u914d\u4e00\u4e2a\uff1b  %n\uff0c \u8fd9\u91cc\u7684 n \u53ef\u4ee5\u4ece 1 \u5230 9\uff1b \u8fd9\u4e2a\u6761\u76ee\u5339\u914d\u4e00\u4e2a\u7b49\u4e8e n \u53f7\u6355\u83b7\u7269\uff08\u540e\u9762\u6709\u63cf\u8ff0\uff09\u7684\u5b50\u4e32\u3002  %bxy\uff0c \u8fd9\u91cc\u7684 x \u548c y \u662f\u4e24\u4e2a\u660e\u786e\u7684\u5b57\u7b26\uff1b \u8fd9\u4e2a\u6761\u76ee\u5339\u914d\u4ee5 x \u5f00\u59cb y \u7ed3\u675f\uff0c \u4e14\u5176\u4e2d x \u548c y \u4fdd\u6301 \u5e73\u8861 \u7684\u5b57\u7b26\u4e32\u3002 \u610f\u601d\u662f\uff0c\u5982\u679c\u4ece\u5de6\u5230\u53f3\u8bfb\u8fd9\u4e2a\u5b57\u7b26\u4e32\uff0c\u5bf9\u6bcf\u6b21\u8bfb\u5230\u4e00\u4e2a x \u5c31 +1 \uff0c\u8bfb\u5230\u4e00\u4e2a y \u5c31 -1\uff0c \u6700\u7ec8\u7ed3\u675f\u5904\u7684\u90a3\u4e2a y \u662f\u7b2c\u4e00\u4e2a\u8bb0\u6570\u5230 0 \u7684 y\u3002 \u4e3e\u4e2a\u4f8b\u5b50\uff0c\u6761\u76ee %b() \u53ef\u4ee5\u5339\u914d\u5230\u62ec\u53f7\u5e73\u8861\u7684\u8868\u8fbe\u5f0f\u3002  %f[set]\uff0c \u6307 \u8fb9\u5883\u6a21\u5f0f\uff1b \u8fd9\u4e2a\u6761\u76ee\u4f1a\u5339\u914d\u5230\u4e00\u4e2a\u4f4d\u4e8e set \u5185\u67d0\u4e2a\u5b57\u7b26\u4e4b\u524d\u7684\u4e00\u4e2a\u7a7a\u4e32\uff0c \u4e14\u8fd9\u4e2a\u4f4d\u7f6e\u7684\u524d\u4e00\u4e2a\u5b57\u7b26\u4e0d\u5c5e\u4e8e set \u3002 \u96c6\u5408 set \u7684\u542b\u4e49\u5982\u524d\u9762\u6240\u8ff0\u3002 \u5339\u914d\u51fa\u7684\u90a3\u4e2a\u7a7a\u4e32\u4e4b\u5f00\u59cb\u548c\u7ed3\u675f\u70b9\u7684\u8ba1\u7b97\u5c31\u770b\u6210\u8be5\u5904\u6709\u4e2a\u5b57\u7b26 '\\0' \u4e00\u6837\u3002   4.5.3 \u6a21\u5f0f\uff1a  \u6a21\u5f0f \u6307\u4e00\u4e2a\u6a21\u5f0f\u6761\u76ee\u7684\u5e8f\u5217\u3002 \u5728\u6a21\u5f0f\u6700\u524d\u9762\u52a0\u4e0a\u7b26\u53f7 '^' \u5c06\u951a\u5b9a\u4ece\u5b57\u7b26\u4e32\u7684\u5f00\u59cb\u5904\u505a\u5339\u914d\u3002 \u5728\u6a21\u5f0f\u6700\u540e\u9762\u52a0\u4e0a\u7b26\u53f7 '$' \u5c06\u4f7f\u5339\u914d\u8fc7\u7a0b\u951a\u5b9a\u5230\u5b57\u7b26\u4e32\u7684\u7ed3\u5c3e\u3002 \u5982\u679c '^' \u548c '$' \u51fa\u73b0\u5728\u5176\u5b83\u4f4d\u7f6e\uff0c\u5b83\u4eec\u5747\u6ca1\u6709\u7279\u6b8a\u542b\u4e49\uff0c\u53ea\u8868\u793a\u81ea\u8eab\u3002  4.5.4 \u6355\u83b7\uff1a  \u6a21\u5f0f\u53ef\u4ee5\u5728\u5185\u90e8\u7528\u5c0f\u62ec\u53f7\u62ec\u8d77\u4e00\u4e2a\u5b50\u6a21\u5f0f\uff1b \u8fd9\u4e9b\u5b50\u6a21\u5f0f\u88ab\u79f0\u4e3a \u6355\u83b7\u7269\u3002 \u5f53\u5339\u914d\u6210\u529f\u65f6\uff0c\u7531 \u6355\u83b7\u7269 \u5339\u914d\u5230\u7684\u5b57\u7b26\u4e32\u4e2d\u7684\u5b50\u4e32\u88ab\u4fdd\u5b58\u8d77\u6765\u7528\u4e8e\u672a\u6765\u7684\u7528\u9014\u3002 \u6355\u83b7\u7269\u4ee5\u5b83\u4eec\u5de6\u62ec\u53f7\u7684\u6b21\u5e8f\u6765\u7f16\u53f7\u3002 \u4f8b\u5982\uff0c\u5bf9\u4e8e\u6a21\u5f0f \"(a (.)%w(%s ))\" \uff0c \u5b57\u7b26\u4e32\u4e2d\u5339\u914d\u5230 \"a (.)%w(%s )\" \u7684\u90e8\u5206\u4fdd\u5b58\u5728\u7b2c\u4e00\u4e2a\u6355\u83b7\u7269\u4e2d \uff08\u56e0\u6b64\u662f\u7f16\u53f7 1 \uff09\uff1b \u7531 \".\" \u5339\u914d\u5230\u7684\u5b57\u7b26\u662f 2 \u53f7\u6355\u83b7\u7269\uff0c \u5339\u914d\u5230 \"%s*\" \u7684\u90a3\u90e8\u5206\u662f 3 \u53f7\u3002  \u4f5c\u4e3a\u4e00\u4e2a\u7279\u4f8b\uff0c\u7a7a\u7684\u6355\u83b7 () \u5c06\u6355\u83b7\u5230\u5f53\u524d\u5b57\u7b26\u4e32\u7684\u4f4d\u7f6e\uff08\u5b83\u662f\u4e00\u4e2a\u6570\u5b57\uff09\u3002 \u4f8b\u5982\uff0c\u5982\u679c\u5c06\u6a21\u5f0f \"()aa()\" \u4f5c\u7528\u5230\u5b57\u7b26\u4e32 \"flaaap\" \u4e0a\uff0c\u5c06\u4ea7\u751f\u4e24\u4e2a\u6355\u83b7\u7269\uff1a 3 \u548c 5 \u3002", 
            "title": "4.5 \u5339\u914d\u6a21\u5f0f"
        }, 
        {
            "location": "/luamd/05/", 
            "text": "5.1 UTF-8 \u652f\u6301\n\n\n\u8fd9\u4e2a\u5e93\u63d0\u4f9b\u4e86\u5bf9 UTF-8 \u7f16\u7801\u7684\u57fa\u7840\u652f\u6301\u3002 \u6240\u6709\u7684\u51fd\u6570\u90fd\u653e\u5728\u8868 utf8 \u4e2d\u3002 \u6b64\u5e93\u4e0d\u63d0\u4f9b\u9664\u7f16\u7801\u5904\u7406\u4e4b\u5916\u7684\u4efb\u4f55 Unicode \u652f\u6301\u3002 \u6240\u6709\u9700\u8981\u4e86\u89e3\u5b57\u7b26\u542b\u4e49\u7684\u64cd\u4f5c\uff0c\u6bd4\u5982\u5b57\u7b26\u5206\u7c7b\uff0c\u90fd\u4e0d\u5728\u6b64\u8303\u7574\u3002\n\n\n\u9664\u975e\u53e6\u6709\u8bf4\u660e\uff0c \u5f53\u4e00\u4e2a\u51fd\u6570\u9700\u8981\u4e00\u4e2a\u5b57\u8282\u4f4d\u7f6e\u7684\u53c2\u6570\u65f6\uff0c \u90fd\u5047\u5b9a\u8fd9\u4e2a\u4f4d\u7f6e\u8981\u4e48\u4ece\u5b57\u8282\u5e8f\u5217\u7684\u5f00\u59cb\u8ba1\u7b97\uff0c \u8981\u4e48\u4ece\u5b57\u7b26\u4e32\u957f\u5ea6\u52a0\u4e00\u7684\u4f4d\u7f6e\u7b97\u3002 \u548c\u5b57\u7b26\u4e32\u5e93\u4e00\u6837\uff0c\u8d1f\u7684\u7d22\u5f15\u4ece\u5b57\u7b26\u4e32\u672b\u5c3e\u8ba1\u8d77\u3002\n\n\n5.1.1 utf8.char (\u00b7\u00b7\u00b7)\n\n\n\u63a5\u6536\u96f6\u6216\u591a\u4e2a\u6574\u6570\uff0c \u5c06\u6bcf\u4e2a\u6574\u6570\u8f6c\u6362\u6210\u5bf9\u5e94\u7684 UTF-8 \u5b57\u8282\u5e8f\u5217\uff0c\u5e76\u8fd4\u56de\u8fd9\u4e9b\u5e8f\u5217\u8fde\u63a5\u5230\u4e00\u8d77\u7684\u5b57\u7b26\u4e32\u3002\n\n\n5.1.2 utf8.charpattern\n\n\n\u7528\u4e8e\u7cbe\u786e\u5339\u914d\u5230\u4e00\u4e2a UTF-8 \u5b57\u8282\u5e8f\u5217\u7684\u6a21\u5f0f\uff08\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u5e76\u975e\u51fd\u6570\uff09\"[\\0-\\x7F\\xC2-\\xF4][\\x80-\\xBF]*\"\u3002 \u5b83\u5047\u5b9a\u5904\u7406\u7684\u5bf9\u8c61\u662f\u4e00\u4e2a\u5408\u6cd5\u7684 UTF-8 \u5b57\u7b26\u4e32\u3002\n\n\n5.1.3 utf8.codes (s)\n\n\n\u8fd4\u56de\u4e00\u7cfb\u5217\u7684\u503c\uff0c\u53ef\u4ee5\u8ba9\n\n\n for p, c in utf8.codes(s) do body end\n\n\n\n\u8fed\u4ee3\u51fa\u5b57\u7b26\u4e32 s \u4e2d\u6240\u6709\u7684\u5b57\u7b26\u3002 \u8fd9\u91cc\u7684 p \u662f\u4f4d\u7f6e\uff08\u6309\u5b57\u8282\u6570\uff09\u800c c \u662f\u6bcf\u4e2a\u5b57\u7b26\u7684\u7f16\u53f7\u3002 \u5982\u679c\u5904\u7406\u5230\u4e00\u4e2a\u4e0d\u5408\u6cd5\u7684\u5b57\u8282\u5e8f\u5217\uff0c\u5c06\u629b\u51fa\u4e00\u4e2a\u9519\u8bef\u3002\n\n\n5.1.4 utf8.codepoint (s [, i [, j]])\n\n\n\u4e00\u6574\u6570\u5f62\u5f0f\u8fd4\u56de s \u4e2d \u4ece\u4f4d\u7f6e i \u5230 j \u95f4\uff08\u5305\u62ec\u4e24\u7aef\uff09 \u6240\u6709\u5b57\u7b26\u7684\u7f16\u53f7\u3002 \u9ed8\u8ba4\u7684 i \u4e3a 1 \uff0c\u9ed8\u8ba4\u7684 j \u4e3a i\u3002 \u5982\u679c\u78b0\u4e0a\u4e0d\u5408\u6cd5\u7684\u5b57\u8282\u5e8f\u5217\uff0c\u629b\u51fa\u4e00\u4e2a\u9519\u8bef\u3002\n\n\n5.1.5 utf8.len (s [, i [, j]])\n\n\n\u8fd4\u56de\u5b57\u7b26\u4e32 s \u4e2d \u4ece\u4f4d\u7f6e i \u5230 j \u95f4 \uff08\u5305\u62ec\u4e24\u7aef\uff09 UTF-8 \u5b57\u7b26\u7684\u4e2a\u6570\u3002 \u9ed8\u8ba4\u7684 i \u4e3a 1 \uff0c\u9ed8\u8ba4\u7684 j \u4e3a -1 \u3002 \u5982\u679c\u5b83\u627e\u5230\u4efb\u4f55\u4e0d\u5408\u6cd5\u7684\u5b57\u8282\u5e8f\u5217\uff0c \u8fd4\u56de\u5047\u503c\u52a0\u4e0a\u7b2c\u4e00\u4e2a\u4e0d\u5408\u6cd5\u5b57\u8282\u7684\u4f4d\u7f6e\u3002\n\n\n5.1.6 utf8.offset (s, n [, i])\n\n\n\u8fd4\u56de\u7f16\u7801\u5728 s \u4e2d\u7684\u7b2c n \u4e2a\u5b57\u7b26\u7684\u5f00\u59cb\u4f4d\u7f6e\uff08\u6309\u5b57\u8282\u6570\uff09 \uff08\u4ece\u4f4d\u7f6e i \u5904\u5f00\u59cb\u7edf\u8ba1\uff09\u3002 \u8d1f n \u5219\u53d6\u5728\u4f4d\u7f6e i \u524d\u7684\u5b57\u7b26\u3002 \u5f53 n \u662f\u975e\u8d1f\u6570\u65f6\uff0c\u9ed8\u8ba4\u7684 i \u662f 1\uff0c \u5426\u5219\u9ed8\u8ba4\u4e3a #s + 1\u3002 \u56e0\u6b64\uff0cutf8.offset(s, -n) \u53d6\u5b57\u7b26\u4e32\u7684\u5012\u6570\u7b2c n \u4e2a\u5b57\u7b26\u7684\u4f4d\u7f6e\u3002 \u5982\u679c\u6307\u5b9a\u7684\u5b57\u7b26\u4e0d\u5728\u5176\u4e2d\u6216\u5728\u7ed3\u675f\u70b9\u4e4b\u540e\uff0c\u51fd\u6570\u8fd4\u56de nil\u3002\n\u4f5c\u4e3a\u7279\u4f8b\uff0c\u5f53 n \u7b49\u4e8e 0 \u65f6\uff0c \u6b64\u51fd\u6570\u8fd4\u56de\u542b\u6709 s \u7b2c i \u5b57\u8282\u7684\u90a3\u4e2a\u5b57\u7b26\u7684\u5f00\u59cb\u4f4d\u7f6e\u3002\n\n\n\u8fd9\u4e2a\u51fd\u6570\u5047\u5b9a s \u662f\u4e00\u4e2a\u5408\u6cd5\u7684 UTF-8 \u5b57\u7b26\u4e32\u3002\n\n\n5.2 \u8868\u5904\u7406\n\n\n\u8fd9\u4e2a\u5e93\u63d0\u4f9b\u4e86\u8868\u5904\u7406\u7684\u901a\u7528\u51fd\u6570\u3002 \u6240\u6709\u51fd\u6570\u90fd\u653e\u5728\u8868 table \u4e2d\u3002\n\n\n\u8bb0\u4f4f\uff0c\u65e0\u8bba\u4f55\u65f6\uff0c\u82e5\u4e00\u4e2a\u64cd\u4f5c\u9700\u8981\u53d6\u8868\u7684\u957f\u5ea6\uff0c \u8fd9\u5f20\u8868\u5fc5\u987b\u662f\u4e00\u4e2a\u771f\u5e8f\u5217\uff0c\u6216\u662f\u62e5\u6709 __len \u5143\u65b9\u6cd5\u3002 \u6240\u6709\u7684\u51fd\u6570\u90fd\u5ffd\u7565\u4f20\u5165\u53c2\u6570\u7684\u90a3\u5f20\u8868\u4e2d\u7684\u975e\u6570\u5b57\u952e\u3002\n\n\n5.2.1 table.concat (list [, sep [, i [, j]]])\n\n\n\u63d0\u4f9b\u4e00\u4e2a\u5217\u8868\uff0c\u5176\u6240\u6709\u5143\u7d20\u90fd\u662f\u5b57\u7b26\u4e32\u6216\u6570\u5b57\uff0c\u8fd4\u56de\u5b57\u7b26\u4e32 list[i]..sep..list[i+1] \u00b7\u00b7\u00b7 sep..list[j]\u3002 sep \u7684\u9ed8\u8ba4\u503c\u662f\u7a7a\u4e32\uff0c i \u7684\u9ed8\u8ba4\u503c\u662f 1 \uff0c j \u7684\u9ed8\u8ba4\u503c\u662f #list \u3002 \u5982\u679c i \u6bd4 j \u5927\uff0c\u8fd4\u56de\u7a7a\u4e32\u3002\n\n\n5.2.2 table.insert (list, [pos,] value)\n\n\n\u5728 list \u7684\u4f4d\u7f6e pos \u5904\u63d2\u5165\u5143\u7d20 value \uff0c \u5e76\u540e\u79fb\u5143\u7d20 list[pos], list[pos+1], \u00b7\u00b7\u00b7, list[#list] \u3002 \npos \u7684\u9ed8\u8ba4\u503c\u4e3a #list+1 \uff0c \u56e0\u6b64\u8c03\u7528 table.insert(t,x) \u4f1a\u5c06 x \u63d2\u5728\u5217\u8868 t \u7684\u672b\u5c3e\u3002\n\n\n5.2.3 table.move (a1, f, e, t [,a2])\n\n\n\u5c06\u5143\u7d20\u4ece\u8868 a1 \u79fb\u5230\u8868 a2\n\u3002 \u8fd9\u4e2a\u51fd\u6570\u505a\u4e86\u6b21\u7b49\u4ef7\u4e8e\u540e\u9762\u8fd9\u4e2a\u591a\u91cd\u8d4b\u503c\u7684\u7b49\u4ef7\u64cd\u4f5c\uff1a a2[t],\u00b7\u00b7\u00b7 = a1[f],\u00b7\u00b7\u00b7,a1[e]\u3002 a2 \u7684\u9ed8\u8ba4\u503c\u4e3a a1\u3002 \u76ee\u6807\u533a\u95f4\u53ef\u4ee5\u548c\u6e90\u533a\u95f4\u91cd\u53e0\u3002 \u7d22\u5f15 f \u5fc5\u987b\u662f\u6b63\u6570\u3002\n\n\n5.2.4 table.pack (\u00b7\u00b7\u00b7)\n\n\n\u8fd4\u56de\u7528\u6240\u6709\u53c2\u6570\u4ee5\u952e 1,2, \u7b49\u586b\u5145\u7684\u65b0\u8868\uff0c \u5e76\u5c06 \"n\" \u8fd9\u4e2a\u57df\u8bbe\u4e3a\u53c2\u6570\u7684\u603b\u6570\u3002 \u6ce8\u610f\u8fd9\u5f20\u8fd4\u56de\u7684\u8868\u4e0d\u4e00\u5b9a\u662f\u4e00\u4e2a\u5e8f\u5217\u3002\n\n\n5.2.5 table.remove (list [, pos])\n\n\n\u79fb\u9664 list \u4e2d pos \u4f4d\u7f6e\u4e0a\u7684\u5143\u7d20\uff0c\u5e76\u8fd4\u56de\u8fd9\u4e2a\u88ab\u79fb\u9664\u7684\u503c\u3002\n \u5f53 pos \u662f\u5728 1 \u5230 #list \u4e4b\u95f4\u7684\u6574\u6570\u65f6\uff0c \u5b83\u5411\u524d\u79fb\u52a8\u5143\u7d20\u3000list[pos+1], list[pos+2], \u00b7\u00b7\u00b7, list[#list] \u5e76\u5220\u9664\u5143\u7d20 list[#list]\uff1b \u7d22\u5f15 pos \u53ef\u4ee5\u662f #list + 1 \uff0c\u6216\u5728 #list \u4e3a 0 \u65f6\u53ef\u4ee5\u662f 0 \uff1b \u5728\u8fd9\u4e9b\u60c5\u51b5\u4e0b\uff0c\u51fd\u6570\u5220\u9664\u5143\u7d20 list[pos]\u3002\n\n\npos \u9ed8\u8ba4\u4e3a #list\uff0c \u56e0\u6b64\u8c03\u7528 table.remove(t) \u5c06\u79fb\u9664\u8868t\u7684\u6700\u540e\u4e00\u4e2a\u5143\u7d20\u3002\n\n\n5.2.6 table.sort (list [, comp])\n\n\n\u5728\u8868\u5185\u4ece list[1] \u5230 list[#list] \u539f\u5730 \u5bf9\u5176\u95f4\u5143\u7d20\u6309\u6307\u5b9a\u6b21\u5e8f\u6392\u5e8f\u3002 \n\u5982\u679c\u63d0\u4f9b\u4e86 comp \uff0c \u5b83\u5fc5\u987b\u662f\u4e00\u4e2a\u53ef\u4ee5\u63a5\u6536\u4e24\u4e2a\u5217\u8868\u5185\u5143\u7d20\u4e3a\u53c2\u6570\u7684\u51fd\u6570\u3002\n\u5f53\u7b2c\u4e00\u4e2a\u5143\u7d20\u9700\u8981\u6392\u5728\u7b2c\u4e8c\u4e2a\u5143\u7d20\u4e4b\u524d\u65f6\uff0c\u8fd4\u56de\u771f \uff08\u56e0\u6b64 not comp(list[i+1],list[i]) \u5728\u6392\u5e8f\u7ed3\u675f\u540e\u5c06\u4e3a\u771f\uff09\u3002 \u5982\u679c\u6ca1\u6709\u63d0\u4f9b comp\uff0c \u5c06\u4f7f\u7528\u6807\u51c6 Lua \u64cd\u4f5c \n \u4f5c\u4e3a\u66ff\u4ee3\u54c1\u3002\n\n\n\u6392\u5e8f\u7b97\u6cd5\u5e76\u4e0d\u7a33\u5b9a\uff1b \u5373\u5f53\u4e24\u4e2a\u5143\u7d20\u6b21\u5e8f\u76f8\u7b49\u65f6\uff0c\u5b83\u4eec\u5728\u6392\u5e8f\u540e\u7684\u76f8\u5bf9\u4f4d\u7f6e\u53ef\u80fd\u4f1a\u6539\u53d8\u3002\n\n\n5.2.7 table.unpack (list [, i [, j]])\n\n\n\u8fd4\u56de\u5217\u8868\u4e2d\u7684\u5143\u7d20\u3002 \u8fd9\u4e2a\u51fd\u6570\u7b49\u4ef7\u4e8e\n\n\n return list[i], list[i+1], \u00b7\u00b7\u00b7, list[j]\n\n\n\ni \u9ed8\u8ba4\u4e3a 1 \uff0cj \u9ed8\u8ba4\u4e3a #list\u3002\n\n\n\u793a\u4f8b\u4ee3\u78011\uff1a\n\n\nlocal tb = {10, 20, 30}\n\ntable.insert(tb, 40) \nfor k, v in ipairs(tb) do\n    print(k..\" -\n \"..v) -- \u5728table\u7684\u6700\u540e\u63d2\u5165\uff0c\u7ed3\u679c\u4e3a\uff1a{10, 20, 30, 40}\nend\nprint(\"---\")\n\ntable.insert(tb, 2, 15) -- \u5728table\u7684\u4f4d\u7f6e2\u63d2\u5165\uff0c\u7ed3\u679c\u4e3a\uff1a{10, 15, 20, 30, 40}\nfor k, v in ipairs(tb) do\n    print(k..\" -\n \"..v)\nend\nprint(\"---\")\n\nprint(table.remove(tb))  \nfor k, v in ipairs(tb) do\n    print(k..\" -\n \"..v) -- \u5220\u9664\u6700\u540e\u4e00\u4e2a\u5143\u7d20\u5e76\u4e14\u8fd4\u56de40\uff0c\u7ed3\u679c\u4e3a\uff1a{10, 15, 20, 30}\nend\nprint(\"---\")\n\nprint(table.remove(tb, 1))  \nfor k, v in ipairs(tb) do\n    print(k..\" -\n \"..v) -- \u5220\u9664\u7b2c\u4e00\u4e2a\u5143\u7d20\u5e76\u8fd4\u56de10\uff0c\u7ed3\u679c\u4e3a\uff1a{15, 20, 30}\nend\n\n\n\n\u793a\u4f8b\u4ee3\u78012\uff1a\n\n\nlocal tb = {20, 10, 2, 3, 4, 89, 20, 33, 2, 3}\n\n-- \u9ed8\u8ba4\u662f\u5347\u5e8f\u6392\u5e8f\ntable.sort(tb)\nfor _, v in ipairs(tb) do\n    print(v)\nend\n\nprint(\"---\")\n\n-- \u4fee\u6539\u4e3a\u964d\u5e8f\u6392\u5e8f\ntable.sort(tb, function (a, b) if a \n b then return true end end)\nfor _, v in ipairs(tb) do\n    print(v)\nend\n\n\n\n\u8fd0\u884c\u7ed3\u679c\n\n\n2\n2\n3\n3\n4\n10\n20\n20\n33\n89\n---\n89\n33\n20\n20\n10\n4\n3\n3\n2\n2\n\n\n\n\u793a\u4f8b\u4ee3\u78013\uff1a\n\n\ntable.pack(\u00b7\u00b7\u00b7) - \u5c06\u6240\u6709\u53c2\u6570\u6253\u5305\u5230\u4e00\u4e2a\u8868\u4e2d\n\n\ntab = table.pack(\"hello\", \"world\", \"lua\", 1, 4)\nfor k,v in pairs(tab) do\n  print(k,v)\nend\n\n\n\n\u8fd0\u884c\u7ed3\u679c\uff1a\n\n\n1       hello\n2       world\n3       lua\n4       1\n5       4\nn       5\n\n\n\n\u63a5\u6536\u4efb\u610f\u591a\u4e2a\u53c2\u6570\uff0c\u5c06\u6240\u6709\u53c2\u6570\u6253\u5305\u5230\u4e00\u4e2a\u4e0b\u6807\u4ece1\u5f00\u59cb\u7684\u8868\u4e2d\uff0c\u50cf\u4e0a\u8fb9\uff0c\u6253\u5305\u5b8c\u540etab1 = {\"hello\", \"world\", \"lua\", 1, 4}\u4f46\u662f\u4e0d\u4e00\u5b9a\u6240\u6709\u53c2\u6570\u90fd\u662f\u987a\u5e8f\u6253\u5305\u7684\u3002\n\n\ntable.unpack (list [, i [, j]]) - \u8ddftable.pack\u76f8\u53cd\n\n\ntable.unpack \u793a\u4f8b\u4ee3\u7801\uff1a\n\n\ntab = {\"hello\", \"world\", \"lua\", 1, 4}\na, b, c, d, e = table.unpack(tab)\nprint(a) -- hello\nprint(b) -- world\nprint(c) -- lua\nprint(d) -- 1\nprint(e) -- 4\n\n\n\n5.3 \u6570\u5b66\u51fd\u6570\n\n\n\u8fd9\u4e2a\u5e93\u63d0\u4f9b\u4e86\u57fa\u672c\u7684\u6570\u5b66\u51fd\u6570\u3002 \u6240\u4ee5\u51fd\u6570\u90fd\u653e\u5728\u8868 math \u4e2d\u3002 \u6ce8\u89e3\u6709 \"integer/float\" \u7684\u51fd\u6570\u4f1a\u5bf9\u6574\u6570\u53c2\u6570\u8fd4\u56de\u6574\u6570\u7ed3\u679c\uff0c \u5bf9\u6d6e\u70b9\uff08\u6216\u6df7\u5408\uff09\u53c2\u6570\u8fd4\u56de\u6d6e\u70b9\u7ed3\u679c\u3002 \u5706\u6574\u51fd\u6570\uff08math.ceil, math.floor, math.modf\uff09 \u5728\u7ed3\u679c\u5728\u6574\u6570\u8303\u56f4\u5185\u65f6\u8fd4\u56de\u6574\u6570\uff0c\u5426\u5219\u8fd4\u56de\u6d6e\u70b9\u6570\u3002\n\n\n5.3.1 math.abs (x)\n\n\n\u8fd4\u56de x \u7684\u7edd\u5bf9\u503c\u3002(integer/float)\n\n\n5.3.2 math.acos (x)\n\n\n\u8fd4\u56de x \u7684\u53cd\u4f59\u5f26\u503c\uff08\u7528\u5f27\u5ea6\u8868\u793a\uff09\u3002\n\n\n5.3.3 math.asin (x)\n\n\n\u8fd4\u56de x \u7684\u53cd\u6b63\u5f26\u503c\uff08\u7528\u5f27\u5ea6\u8868\u793a\uff09\u3002\n\n\n5.3.4 math.atan (y [, x])\n\n\n\u8fd4\u56de y/x \u7684\u53cd\u6b63\u5207\u503c\uff08\u7528\u5f27\u5ea6\u8868\u793a\uff09\u3002 \u5b83\u4f1a\u4f7f\u7528\u4e24\u4e2a\u53c2\u6570\u7684\u7b26\u53f7\u6765\u627e\u5230\u7ed3\u679c\u843d\u5728\u54ea\u4e2a\u8c61\u9650\u4e2d\u3002 \uff08\u5373\u4f7f x \u4e3a\u96f6\u65f6\uff0c\u4e5f\u53ef\u4ee5\u6b63\u786e\u7684\u5904\u7406\u3002\uff09\n\n\n\u9ed8\u8ba4\u7684 x \u662f 1 \uff0c \u56e0\u6b64\u8c03\u7528 math.atan(y) \u5c06\u8fd4\u56de y \u7684\u53cd\u6b63\u5207\u503c\u3002\n\n\n5.3.5 math.ceil (x)\n\n\n\u8fd4\u56de\u4e0d\u5c0f\u4e8e x \u7684\u6700\u5c0f\u6574\u6570\u503c\u3002\n\n\n5.3.6 math.cos (x)\n\n\n\u8fd4\u56de x \u7684\u4f59\u5f26\uff08\u5047\u5b9a\u53c2\u6570\u662f\u5f27\u5ea6\uff09\u3002\n\n\n5.3.7 math.deg (x)\n\n\n\u5c06\u89d2 x \u4ece\u5f27\u5ea6\u8f6c\u6362\u4e3a\u89d2\u5ea6\u3002\n\n\n5.3.8 math.exp (x)\n\n\n\u8fd4\u56de ex \u7684\u503c \uff08e \u4e3a\u81ea\u7136\u5bf9\u6570\u7684\u5e95\uff09\u3002\n\n\n5.3.9 math.floor (x)\n\n\n\u8fd4\u56de\u4e0d\u5927\u4e8e x \u7684\u6700\u5927\u6574\u6570\u503c\u3002\n\n\n5.3.10 math.fmod (x, y)\n\n\n\u8fd4\u56de x \u9664\u4ee5 y\uff0c\u5c06\u5546\u5411\u96f6\u5706\u6574\u540e\u7684\u4f59\u6570\u3002 (integer/float)\n\n\n5.3.11 math.huge\n\n\n\u6d6e\u70b9\u6570 HUGE_VAL\uff0c \u8fd9\u4e2a\u6570\u6bd4\u4efb\u4f55\u6570\u5b57\u503c\u90fd\u5927\u3002\n\n\n5.3.12 math.log (x [, base])\n\n\n\u8fd4\u56de\u4ee5\u6307\u5b9a\u5e95\u7684 x \u7684\u5bf9\u6570\u3002 \u9ed8\u8ba4\u7684 base \u662f e \uff08\u56e0\u6b64\u6b64\u51fd\u6570\u8fd4\u56de x \u7684\u81ea\u7136\u5bf9\u6570\uff09\u3002\n\n\n5.3.13 math.max (x, \u00b7\u00b7\u00b7)\n\n\n\u8fd4\u56de\u53c2\u6570\u4e2d\u6700\u5927\u7684\u503c\uff0c \u5927\u5c0f\u7531 Lua \u64cd\u4f5c \n \u51b3\u5b9a\u3002 (integer/float)\n\n\n5.3.14 math.maxinteger\n\n\n\u6700\u5927\u503c\u7684\u6574\u6570\u3002\n\n\n5.3.15 math.min (x, \u00b7\u00b7\u00b7)\n\n\n\u8fd4\u56de\u53c2\u6570\u4e2d\u6700\u5c0f\u7684\u503c\uff0c \u5927\u5c0f\u7531 Lua \u64cd\u4f5c \n \u51b3\u5b9a\u3002 (integer/float)\n\n\n5.3.16 math.mininteger\n\n\n\u6700\u5c0f\u503c\u7684\u6574\u6570\u3002\n\n\n5.3.17 math.modf (x)\n\n\n\u8fd4\u56de x \u7684\u6574\u6570\u90e8\u5206\u548c\u5c0f\u6570\u90e8\u5206\u3002 \u7b2c\u4e8c\u4e2a\u7ed3\u679c\u4e00\u5b9a\u662f\u6d6e\u70b9\u6570\u3002\n\n\n5.3.18 math.pi\n\n\n\u03c0 \u7684\u503c\u3002\n\n\n5.3.19 math.rad (x)\n\n\n\u5c06\u89d2 x \u4ece\u89d2\u5ea6\u8f6c\u6362\u4e3a\u5f27\u5ea6\u3002\n\n\n5.3.20 math.random ([m [, n]])\n\n\n\u5f53\u4e0d\u5e26\u53c2\u6570\u8c03\u7528\u65f6\uff0c \u8fd4\u56de\u4e00\u4e2a [0,1) \u533a\u95f4\u5185\u4e00\u81f4\u5206\u5e03\u7684\u6d6e\u70b9\u4f2a\u968f\u673a\u6570\u3002\n \n\n\n\u5f53\u4ee5\u4e24\u4e2a\u6574\u6570 m \u4e0e n \u8c03\u7528\u65f6\uff0c math.random \u8fd4\u56de\u4e00\u4e2a [m, n] \u533a\u95f4 \u5185\u4e00\u81f4\u5206\u5e03\u7684\u6574\u6570\u4f2a\u968f\u673a\u6570\u3002 \uff08\u503c m-n \u4e0d\u80fd\u662f\u8d1f\u6570\uff0c\u4e14\u5fc5\u987b\u5728 Lua \u6574\u6570\u7684\u8868\u793a\u8303\u56f4\u5185\u3002\uff09 \u8c03\u7528 math.random(n) \u7b49\u4ef7\u4e8e math.random(1,n)\u3002\n\n\n\u8fd9\u4e2a\u51fd\u6570\u662f\u5bf9 C \u63d0\u4f9b\u7684\u4f4d\u968f\u673a\u6570\u51fd\u6570\u7684\u5c01\u88c5\u3002 \u5bf9\u5176\u7edf\u8ba1\u5c5e\u6027\u4e0d\u4f5c\u62c5\u4fdd\u3002\n\n\n5.3.21 math.randomseed (x)\n\n\n\u628a x \u8bbe\u4e3a\u4f2a\u968f\u673a\u6570\u53d1\u751f\u5668\u7684\u201c\u79cd\u5b50\u201d\uff1a \u76f8\u540c\u7684\u79cd\u5b50\u4ea7\u751f\u76f8\u540c\u7684\u968f\u673a\u6570\u5217\u3002\n\n\n5.3.22 math.sin (x)\n\n\n\u8fd4\u56de x \u7684\u6b63\u5f26\u503c\uff08\u5047\u5b9a\u53c2\u6570\u662f\u5f27\u5ea6\uff09\u3002\n\n\n5.3.23 math.sqrt (x)\n\n\n\u8fd4\u56de x \u7684\u5e73\u65b9\u6839\u3002 \uff08\u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528\u4e58\u65b9 x^0.5 \u6765\u8ba1\u7b97\u8fd9\u4e2a\u503c\u3002\uff09\n\n\n5.3.24 math.tan (x)\n\n\n\u8fd4\u56de x \u7684\u6b63\u5207\u503c\uff08\u5047\u5b9a\u53c2\u6570\u662f\u5f27\u5ea6\uff09\u3002\n\n\n5.3.25 math.tointeger (x)\n\n\n\u5982\u679c x \u53ef\u4ee5\u8f6c\u6362\u4e3a\u4e00\u4e2a\u6574\u6570\uff0c \u8fd4\u56de\u8be5\u6574\u6570\u3002 \u5426\u5219\u8fd4\u56de nil\u3002\n\n\n5.3.26 math.type (x)\n\n\n\u5982\u679c x \u662f\u6574\u6570\uff0c\u8fd4\u56de \"integer\"\uff0c \u5982\u679c\u5b83\u662f\u6d6e\u70b9\u6570\uff0c\u8fd4\u56de \"float\"\uff0c \u5982\u679c x \u4e0d\u662f\u6570\u5b57\uff0c\u8fd4\u56de nil\u3002\n\n\n5.3.27 math.ult (m, n)\n\n\n\u5982\u679c\u6574\u6570 m \u548c n \u4ee5\u65e0\u7b26\u53f7\u6574\u6570\u5f62\u5f0f\u6bd4\u8f83\uff0c m \u5728 n \u4e4b\u4e0b\uff0c\u8fd4\u56de\u5e03\u5c14\u771f\u5426\u5219\u8fd4\u56de\u5047\u3002\n\n\n\u793a\u4f8b\u4ee3\u7801\uff1a\n\n\nprint(math.sin(math.rad(30)))           -- 0.5\nprint(math.floor(5.6))                  -- 5\nprint(math.ceil(5.6))                   -- 6\nprint(math.max(2, 3, 2, 14, 2, 30, -3)) -- 30\nprint(math.min(2, 3, 2, 14, 2, 30, -3)) -- -3\n\n\n\n\u968f\u673a\u6570\uff1a\n\n\nprint(math.random())     -- \u8f93\u51fa\u4e00\u4e2a\u5927\u4e8e\u7b49\u4e8e0\uff0c\u5c0f\u4e8e1\u7684\u503c\nprint(math.random(2))    -- \u8f93\u51fa\u4e0d\u662f1\u5c31\u662f2\nprint(math.random(3, 4)) -- \u8f93\u51fa\u4e0d\u662f3\u5c31\u662f4\n\n\n\n\u8fd9\u91cc\u6bcf\u6b21\u8c03\u7528\u90fd\u662f\u4e00\u6837\u7684\u503c\n\n\n\u4f7f\u7528\u4e86\u65f6\u95f4\u79cd\u5b50\u7684\u968f\u673a\u6570\uff1a\n\n\nmath.randomseed(os.time())\nprint(math.random())     -- \u8f93\u51fa\u4e00\u4e2a\u5927\u4e8e\u7b49\u4e8e0\uff0c\u5c0f\u4e8e1\u7684\u503c\nprint(math.random(2))    -- \u8f93\u51fa\u4e0d\u662f1\u5c31\u662f2\nprint(math.random(3, 4)) -- \u8f93\u51fa\u4e0d\u662f3\u5c31\u662f4\n\n\n\n5.4 \u8f93\u5165\u8f93\u51fa\u5e93\n\n\nI/O \u5e93\u63d0\u4f9b\u4e86\u4e24\u5957\u4e0d\u540c\u98ce\u683c\u7684\u6587\u4ef6\u5904\u7406\u63a5\u53e3\u3002 \u7b2c\u4e00\u79cd\u98ce\u683c\u4f7f\u7528\n\u9690\u5f0f\u7684\u6587\u4ef6\u53e5\u67c4\n\uff1b \u5b83\u63d0\u4f9b\u8bbe\u7f6e\u9ed8\u8ba4\u8f93\u5165\u6587\u4ef6\u53ca\u9ed8\u8ba4\u8f93\u51fa\u6587\u4ef6\u7684\u64cd\u4f5c\uff0c \u6240\u6709\u7684\u8f93\u5165\u8f93\u51fa\u64cd\u4f5c\u90fd\u9488\u5bf9\u8fd9\u4e9b\u9ed8\u8ba4\u6587\u4ef6\u3002 \u7b2c\u4e8c\u79cd\u98ce\u683c\u4f7f\u7528\n\u663e\u5f0f\u7684\u6587\u4ef6\u53e5\u67c4\n\u3002\n\n\n\u5f53\u4f7f\u7528\u9690\u5f0f\u6587\u4ef6\u53e5\u67c4\u65f6\uff0c \u6240\u6709\u7684\u64cd\u4f5c\u90fd\u7531\u8868 io \u63d0\u4f9b\u3002 \u82e5\u4f7f\u7528\u663e\u5f0f\u6587\u4ef6\u53e5\u67c4\uff0c io.open \u4f1a\u8fd4\u56de\u4e00\u4e2a\u6587\u4ef6\u53e5\u67c4\uff0c\u4e14\u6240\u6709\u7684\u64cd\u4f5c\u90fd\u7531\u8be5\u6587\u4ef6\u53e5\u67c4\u7684\u65b9\u6cd5\u6765\u63d0\u4f9b\u3002\n\n\n\u8868 io \u4e2d\u4e5f\u63d0\u4f9b\u4e86\u4e09\u4e2a \u548c C \u4e2d\u542b\u4e49\u76f8\u540c\u7684\u9884\u5b9a\u4e49\u6587\u4ef6\u53e5\u67c4\uff1a io.stdin\uff0c io.stdout\uff0c \u4ee5\u53ca io.stderr\u3002 I/O \u5e93\u6c38\u8fdc\u4e0d\u4f1a\u5173\u95ed\u8fd9\u4e9b\u6587\u4ef6\u3002\n\n\n\u9664\u975e\u53e6\u6709\u8bf4\u660e\uff0c I/O \u51fd\u6570\u5728\u51fa\u9519\u65f6\u90fd\u8fd4\u56de nil \uff08\u7b2c\u4e8c\u4e2a\u8fd4\u56de\u503c\u4e3a\u9519\u8bef\u6d88\u606f\uff0c\u7b2c\u4e09\u4e2a\u8fd4\u56de\u503c\u4e3a\u7cfb\u7edf\u76f8\u5173\u7684\u9519\u8bef\u7801\uff09\u3002 \u6210\u529f\u65f6\u8fd4\u56de\u4e0e nil \u4e0d\u540c\u7684\u503c\u3002 \u5728\u975e POSIX \u7cfb\u7edf\u4e0a\uff0c \u6839\u636e\u9519\u8bef\u7801\u53d6\u51fa\u9519\u8bef\u6d88\u606f\u7684\u8fc7\u7a0b\u53ef\u80fd\u5e76\u975e\u7ebf\u7a0b\u5b89\u5168\u7684\uff0c \u56e0\u4e3a\u8fd9\u4f7f\u7528\u4e86 C \u7684\u5168\u5c40\u53d8\u91cf errno \u3002\n\n\n5.4.1 io.close ([file])\n\n\n\u7b49\u4ef7\u4e8e file:close()\u3002 \u4e0d\u7ed9\u51fa file \u65f6\u5c06\u5173\u95ed\u9ed8\u8ba4\u8f93\u51fa\u6587\u4ef6\u3002\n\n\n5.4.2 io.flush ()\n\n\n\u7b49\u4ef7\u4e8e io.output():flush()\u3002\n\n\n5.4.3 io.input ([file])\n\n\n\u7528\u6587\u4ef6\u540d\u8c03\u7528\u5b83\u65f6\uff0c\uff08\u4ee5\u6587\u672c\u6a21\u5f0f\uff09\u6765\u6253\u5f00\u8be5\u540d\u5b57\u7684\u6587\u4ef6\uff0c \u5e76\u5c06\u6587\u4ef6\u53e5\u67c4\u8bbe\u4e3a\u9ed8\u8ba4\u8f93\u5165\u6587\u4ef6\u3002 \u5982\u679c\u7528\u6587\u4ef6\u53e5\u67c4\u53bb\u8c03\u7528\u5b83\uff0c \u5c31\u7b80\u5355\u7684\u5c06\u8be5\u53e5\u67c4\u8bbe\u4e3a\u9ed8\u8ba4\u8f93\u5165\u6587\u4ef6\u3002 \u5982\u679c\u8c03\u7528\u65f6\u4e0d\u4f20\u53c2\u6570\uff0c\u5b83\u8fd4\u56de\u5f53\u524d\u7684\u9ed8\u8ba4\u8f93\u5165\u6587\u4ef6\u3002\n\n\n\u5728\u51fa\u9519\u7684\u60c5\u51b5\u4e0b\uff0c\u51fd\u6570\u629b\u51fa\u9519\u8bef\u800c\u4e0d\u662f\u8fd4\u56de\u9519\u8bef\u7801\u3002\n\n\n5.4.4 io.lines ([filename \u00b7\u00b7\u00b7])\n\n\n\u4ee5\u8bfb\u6a21\u5f0f\u6253\u5f00\u6307\u5b9a\u7684\u6587\u4ef6\u540d\u5e76\u8fd4\u56de\u4e00\u4e2a\u8fed\u4ee3\u51fd\u6570\u3002 \u6b64\u8fed\u4ee3\u51fd\u6570\u7684\u5de5\u4f5c\u65b9\u5f0f\u548c\u7528\u4e00\u4e2a\u5df2\u6253\u5f00\u7684\u6587\u4ef6\u53bb\u8c03\u7528 file:lines(\u00b7\u00b7\u00b7) \u5f97\u5230\u7684\u8fed\u4ee3\u5668\u76f8\u540c\u3002 \u5f53\u8fed\u4ee3\u51fd\u6570\u68c0\u6d4b\u5230\u6587\u4ef6\u7ed3\u675f\uff0c \u5b83\u4e0d\u8fd4\u56de\u503c\uff08\u8ba9\u5faa\u73af\u7ed3\u675f\uff09\u5e76\u81ea\u52a8\u5173\u95ed\u6587\u4ef6\u3002\n\n\n\u8c03\u7528 io.lines() \uff08\u4e0d\u4f20\u6587\u4ef6\u540d\uff09 \u7b49\u4ef7\u4e8e io.input():lines(\"*l\")\uff1b \u5373\uff0c\u5b83\u5c06\u6309\u884c\u8fed\u4ee3\u6807\u51c6\u8f93\u5165\u6587\u4ef6\u3002 \u5728\u6b64\u60c5\u51b5\u4e0b\uff0c\u5faa\u73af\u7ed3\u675f\u540e\u5b83\u4e0d\u4f1a\u5173\u95ed\u6587\u4ef6\u3002\n\n\n\u5728\u51fa\u9519\u7684\u60c5\u51b5\u4e0b\uff0c\u51fd\u6570\u629b\u51fa\u9519\u8bef\u800c\u4e0d\u662f\u8fd4\u56de\u9519\u8bef\u7801\u3002\n\n\n5.4.5 io.open (filename [, mode])\n\n\n\u8fd9\u4e2a\u51fd\u6570\u7528\u5b57\u7b26\u4e32 mode \u6307\u5b9a\u7684\u6a21\u5f0f\u6253\u5f00\u4e00\u4e2a\u6587\u4ef6\u3002 \u8fd4\u56de\u65b0\u7684\u6587\u4ef6\u53e5\u67c4\u3002 \u5f53\u51fa\u9519\u65f6\uff0c\u8fd4\u56de nil \u52a0\u9519\u8bef\u6d88\u606f\u3002\n\n\nmode \u5b57\u7b26\u4e32\u53ef\u4ee5\u662f\u4e0b\u5217\u4efb\u610f\u503c\uff1a\n\n\n\n\n\"r\": \u8bfb\u6a21\u5f0f\uff08\u9ed8\u8ba4\uff09\uff1b\n\n\n\"w\": \u5199\u6a21\u5f0f\uff1b\n\n\n\"a\": \u8ffd\u52a0\u6a21\u5f0f\uff1b\n\n\n\"r+\": \u66f4\u65b0\u6a21\u5f0f\uff0c\u6240\u6709\u4e4b\u524d\u7684\u6570\u636e\u90fd\u4fdd\u7559\uff1b\n\n\n\"w+\": \u66f4\u65b0\u6a21\u5f0f\uff0c\u6240\u6709\u4e4b\u524d\u7684\u6570\u636e\u90fd\u5220\u9664\uff1b\n\n\n\"a+\": \u8ffd\u52a0\u66f4\u65b0\u6a21\u5f0f\uff0c\u6240\u6709\u4e4b\u524d\u7684\u6570\u636e\u90fd\u4fdd\u7559\uff0c\u53ea\u5141\u8bb8\u5728\u6587\u4ef6\u5c3e\u90e8\u505a\u5199\u5165\u3002\n\n\n\n\nmode \u5b57\u7b26\u4e32\u53ef\u4ee5\u5728\u6700\u540e\u52a0\u4e00\u4e2a 'b' \uff0c \u8fd9\u4f1a\u5728\u67d0\u4e9b\u7cfb\u7edf\u4e0a\u4ee5\u4e8c\u8fdb\u5236\u65b9\u5f0f\u6253\u5f00\u6587\u4ef6\u3002\n\n\n5.4.6 io.output ([file])\n\n\n\u7c7b\u4f3c\u4e8e io.input\u3002 \u4e0d\u8fc7\u90fd\u9488\u5bf9\u9ed8\u8ba4\u8f93\u51fa\u6587\u4ef6\u64cd\u4f5c\u3002\n\n\n5.4.7 io.popen (prog [, mode])\n\n\n\u8fd9\u4e2a\u51fd\u6570\u548c\u7cfb\u7edf\u6709\u5173\uff0c\u4e0d\u662f\u6240\u6709\u7684\u5e73\u53f0\u90fd\u63d0\u4f9b\u3002\n\n\n\u7528\u4e00\u4e2a\u5206\u79bb\u8fdb\u7a0b\u5f00\u542f\u7a0b\u5e8f prog\uff0c \u8fd4\u56de\u7684\u6587\u4ef6\u53e5\u67c4\u53ef\u7528\u4e8e\u4ece\u8fd9\u4e2a\u7a0b\u5e8f\u4e2d\u8bfb\u53d6\u6570\u636e \uff08\u5982\u679c mode \u4e3a \"r\"\uff0c\u8fd9\u662f\u9ed8\u8ba4\u503c\uff09 \u6216\u662f\u5411\u8fd9\u4e2a\u7a0b\u5e8f\u5199\u5165\u8f93\u5165\uff08\u5f53 mode \u4e3a \"w\" \u65f6\uff09\u3002\n\n\n5.4.8 io.read (\u00b7\u00b7\u00b7)\n\n\n\u7b49\u4ef7\u4e8e io.input():read(\u00b7\u00b7\u00b7)\u3002\u4ece\u5f53\u524d\u8f93\u5165\u6587\u4ef6\u4e2d\u8bfb\u53d6\u5b57\u7b26\u4e32\uff0c\u5b83\u7684\u53c2\u6570\u51b3\u5b9a\u4e86\u8981\u8bfb\u53d6\u7684\u6570\u636e\uff1a\n\n\n\n\n\u201c*all\u201d    \u8bfb\u53d6\u6574\u4e2a\u6587\u4ef6\n\n\n\u201c*line\u201d   \u8bfb\u53d6\u4e0b\u4e00\u884c\n\n\n\u201c*number\u201d \u8bfb\u53d6\u4e00\u4e2a\u6570\u5b57\n\n\n     \u8bfb\u53d6\u4e00\u4e2a\u4e0d\u8d85\u8fc7\n\u4e2a\u5b57\u7b26\u7684\u5b57\u7b26\u4e32\n\n\n\n\n5.4.9 io.tmpfile ()\n\n\n\u8fd4\u56de\u4e00\u4e2a\u4e34\u65f6\u6587\u4ef6\u7684\u53e5\u67c4\u3002 \u8fd9\u4e2a\u6587\u4ef6\u4ee5\u66f4\u65b0\u6a21\u5f0f\u6253\u5f00\uff0c\u5728\u7a0b\u5e8f\u7ed3\u675f\u65f6\u4f1a\u81ea\u52a8\u5220\u9664\u3002\n\n\n5.4.10 io.type (obj)\n\n\n\u68c0\u67e5 obj \u662f\u5426\u662f\u5408\u6cd5\u7684\u6587\u4ef6\u53e5\u67c4\u3002 \u5982\u679c obj \u5b83\u662f\u4e00\u4e2a\u6253\u5f00\u7684\u6587\u4ef6\u53e5\u67c4\uff0c\u8fd4\u56de\u5b57\u7b26\u4e32 \"file\"\u3002 \u5982\u679c obj \u662f\u4e00\u4e2a\u5173\u95ed\u7684\u6587\u4ef6\u53e5\u67c4\uff0c\u8fd4\u56de\u5b57\u7b26\u4e32 \"closed file\"\u3002 \u5982\u679c obj \u4e0d\u662f\u6587\u4ef6\u53e5\u67c4\uff0c\u8fd4\u56de nil \u3002\n\n\n5.4.11 io.write (\u00b7\u00b7\u00b7)\n\n\n\u7b49\u4ef7\u4e8e io.output():write(\u00b7\u00b7\u00b7)\u3002\n\n\n5.4.12 file:close ()\n\n\n\u5173\u95ed file\u3002 \u6ce8\u610f\uff0c\u6587\u4ef6\u5728\u53e5\u67c4\u88ab\u5783\u573e\u56de\u6536\u65f6\u4f1a\u81ea\u52a8\u5173\u95ed\uff0c \u4f46\u662f\u591a\u4e45\u4ee5\u540e\u53d1\u751f\uff0c\u65f6\u95f4\u4e0d\u53ef\u9884\u671f\u7684\u3002\n\n\n\u5f53\u5173\u95ed\u7528 io.popen \u521b\u5efa\u51fa\u6765\u7684\u6587\u4ef6\u53e5\u67c4\u65f6\uff0c file:close \u8fd4\u56de os.execute \u4f1a\u8fd4\u56de\u7684\u4e00\u6837\u7684\u503c\u3002\n\n\n5.4.13 file:flush ()\n\n\n\u5c06\u5199\u5165\u7684\u6570\u636e\u4fdd\u5b58\u5230 file \u4e2d\u3002\n\n\n5.4.14 file:lines (\u00b7\u00b7\u00b7)\n\n\n\u8fd4\u56de\u4e00\u4e2a\u8fed\u4ee3\u5668\u51fd\u6570\uff0c \u6bcf\u6b21\u8c03\u7528\u8fed\u4ee3\u5668\u65f6\uff0c\u90fd\u4ece\u6587\u4ef6\u4e2d\u6309\u6307\u5b9a\u683c\u5f0f\u8bfb\u6570\u636e\u3002 \u5982\u679c\u6ca1\u6709\u6307\u5b9a\u683c\u5f0f\uff0c\u4f7f\u7528\u9ed8\u8ba4\u503c \"l\" \u3002 \u770b\u4e00\u4e2a\u4f8b\u5b50\n\n\n for c in file:lines(1) do body end\n\n\n\n\u4f1a\u4ece\u6587\u4ef6\u5f53\u524d\u4f4d\u7f6e\u5f00\u59cb\uff0c\u4e2d\u4e0d\u65ad\u8bfb\u51fa\u5b57\u7b26\u3002 \u548c io.lines \u4e0d\u540c\uff0c \u8fd9\u4e2a\u51fd\u6570\u5728\u5faa\u73af\u7ed3\u675f\u540e\u4e0d\u4f1a\u5173\u95ed\u6587\u4ef6\u3002\n\n\n\u5728\u51fa\u9519\u7684\u60c5\u51b5\u4e0b\uff0c\u51fd\u6570\u629b\u51fa\u9519\u8bef\u800c\u4e0d\u662f\u8fd4\u56de\u9519\u8bef\u7801\u3002\n\n\n5.4.15 file:read (\u00b7\u00b7\u00b7)\n\n\n\u8bfb\u6587\u4ef6 file\uff0c \u6307\u5b9a\u7684\u683c\u5f0f\u51b3\u5b9a\u4e86\u8981\u8bfb\u4ec0\u4e48\u3002 \u5bf9\u4e8e\u6bcf\u79cd\u683c\u5f0f\uff0c\u51fd\u6570\u8fd4\u56de\u8bfb\u51fa\u7684\u5b57\u7b26\u5bf9\u5e94\u7684\u5b57\u7b26\u4e32\u6216\u6570\u5b57\u3002 \u82e5\u4e0d\u80fd\u4ee5\u8be5\u683c\u5f0f\u5bf9\u5e94\u8bfb\u51fa\u6570\u636e\u5219\u8fd4\u56de nil\u3002 \uff08\u5bf9\u4e8e\u6700\u540e\u8fd9\u79cd\u60c5\u51b5\uff0c \u51fd\u6570\u4e0d\u4f1a\u8bfb\u51fa\u540e\u7eed\u7684\u683c\u5f0f\u3002\uff09 \u5f53\u8c03\u7528\u65f6\u4e0d\u4f20\u683c\u5f0f\uff0c\u5b83\u4f1a\u4f7f\u7528\u9ed8\u8ba4\u683c\u5f0f\u8bfb\u4e0b\u4e00\u884c\uff08\u89c1\u4e0b\u9762\u63cf\u8ff0\uff09\u3002\n\n\n\u63d0\u4f9b\u7684\u683c\u5f0f\u6709\n\n\n\n\n\"n\": \u8bfb\u53d6\u4e00\u4e2a\u6570\u5b57\uff0c\u6839\u636e Lua \u7684\u8f6c\u6362\u6587\u6cd5\uff0c\u53ef\u80fd\u8fd4\u56de\u6d6e\u70b9\u6570\u6216\u6574\u6570\u3002 \uff08\u6570\u5b57\u53ef\u4ee5\u6709\u524d\u7f6e\u6216\u540e\u7f6e\u7684\u7a7a\u683c\uff0c\u4ee5\u53ca\u7b26\u53f7\u3002\uff09 \u53ea\u8981\u80fd\u6784\u6210\u5408\u6cd5\u7684\u6570\u5b57\uff0c\u8fd9\u4e2a\u683c\u5f0f\u603b\u662f\u53bb\u8bfb\u5c3d\u91cf\u957f\u7684\u4e32\uff1b \u5982\u679c\u8bfb\u51fa\u6765\u7684\u524d\u7f00\u65e0\u6cd5\u6784\u6210\u5408\u6cd5\u7684\u6570\u5b57 \uff08\u6bd4\u5982\u7a7a\u4e32\uff0c\"0x\" \u6216 \"3.4e-\"\uff09\uff0c \u5c31\u4e2d\u6b62\u51fd\u6570\u8fd0\u884c\uff0c\u8fd4\u56de nil\u3002\n\n\n\"i\": \u8bfb\u53d6\u4e00\u4e2a\u6574\u6570\uff0c\u8fd4\u56de\u6574\u6570\u503c\u3002\n\n\n\"a\": \u4ece\u5f53\u524d\u4f4d\u7f6e\u5f00\u59cb\u8bfb\u53d6\u6574\u4e2a\u6587\u4ef6\u3002 \u5982\u679c\u5df2\u5728\u6587\u4ef6\u672b\u5c3e\uff0c\u8fd4\u56de\u7a7a\u4e32\u3002\n\n\n\"l\": \u8bfb\u53d6\u4e00\u884c\u5e76\u5ffd\u7565\u884c\u7ed3\u675f\u6807\u8bb0\u3002 \u5f53\u5728\u6587\u4ef6\u672b\u5c3e\u65f6\uff0c\u8fd4\u56de nil \u8fd9\u662f\u9ed8\u8ba4\u683c\u5f0f\u3002\n\n\n\"L\": \u8bfb\u53d6\u4e00\u884c\u5e76\u4fdd\u7559\u884c\u7ed3\u675f\u6807\u8bb0\uff08\u5982\u679c\u6709\u7684\u8bdd\uff09\uff0c \u5f53\u5728\u6587\u4ef6\u672b\u5c3e\u65f6\uff0c\u8fd4\u56de nil\u3002\n\n\nnumber: \u8bfb\u53d6\u4e00\u4e2a\u4e0d\u8d85\u8fc7\u8fd9\u4e2a\u6570\u91cf\u5b57\u8282\u6570\u7684\u5b57\u7b26\u4e32\u3002 \u5f53\u5728\u6587\u4ef6\u672b\u5c3e\u65f6\uff0c\u8fd4\u56de nil\u3002 \u5982\u679c number \u4e3a\u96f6\uff0c \u5b83\u4ec0\u4e48\u4e5f\u4e0d\u8bfb\uff0c\u8fd4\u56de\u4e00\u4e2a\u7a7a\u4e32\u3002 \u5f53\u5728\u6587\u4ef6\u672b\u5c3e\u65f6\uff0c\u8fd4\u56de nil\u3002\n\u683c\u5f0f \"l\" \u548c \"L\" \u53ea\u80fd\u7528\u4e8e\u6587\u672c\u6587\u4ef6\u3002\n\n\n\n\n5.4.16 file:seek ([whence [, offset]])\n\n\n\u8bbe\u7f6e\u53ca\u83b7\u53d6\u57fa\u4e8e\u6587\u4ef6\u5f00\u5934\u5904\u8ba1\u7b97\u51fa\u7684\u4f4d\u7f6e\u3002 \u8bbe\u7f6e\u7684\u4f4d\u7f6e\u7531 offset \u548c whence \u5b57\u7b26\u4e32 whence \u6307\u5b9a\u7684\u57fa\u70b9\u51b3\u5b9a\u3002\u57fa\u70b9\u53ef\u4ee5\u662f\uff1a\n\n\n\n\n\"set\": \u57fa\u70b9\u4e3a 0 \uff08\u6587\u4ef6\u5f00\u5934\uff09\uff1b\n\n\n\"cur\": \u57fa\u70b9\u4e3a\u5f53\u524d\u4f4d\u7f6e\u4e86\uff1b\n\n\n\"end\": \u57fa\u70b9\u4e3a\u6587\u4ef6\u5c3e\uff1b\n\n\n\n\n\u5f53 seek \u6210\u529f\u65f6\uff0c\u8fd4\u56de\u6700\u7ec8\u4ece\u6587\u4ef6\u5f00\u5934\u8ba1\u7b97\u8d77\u7684\u6587\u4ef6\u7684\u4f4d\u7f6e\u3002 \u5f53 seek \u5931\u8d25\u65f6\uff0c\u8fd4\u56de nil \u52a0\u4e0a\u4e00\u4e2a\u9519\u8bef\u63cf\u8ff0\u5b57\u7b26\u4e32\u3002\n\n\nwhence \u7684\u9ed8\u8ba4\u503c\u662f \"cur\"\uff0c offset \u9ed8\u8ba4\u4e3a 0 \u3002 \u56e0\u6b64\uff0c\u8c03\u7528 file:seek() \u53ef\u4ee5\u8fd4\u56de\u6587\u4ef6\u5f53\u524d\u4f4d\u7f6e\uff0c\u5e76\u4e0d\u6539\u53d8\u5b83\uff1b \u8c03\u7528 file:seek(\"set\") \u5c06\u4f4d\u7f6e\u8bbe\u4e3a\u6587\u4ef6\u5f00\u5934\uff08\u5e76\u8fd4\u56de 0\uff09\uff1b \u8c03\u7528 file:seek(\"end\") \u5c06\u4f4d\u7f6e\u8bbe\u5230\u6587\u4ef6\u672b\u5c3e\uff0c\u5e76\u8fd4\u56de\u6587\u4ef6\u5927\u5c0f\u3002\n\n\n5.4.17 file:setvbuf (mode [, size])\n\n\n\u8bbe\u7f6e\u8f93\u51fa\u6587\u4ef6\u7684\u7f13\u51b2\u6a21\u5f0f\u3002 \u6709\u4e09\u79cd\u6a21\u5f0f\uff1a\n\n\n\n\n\"no\": \u4e0d\u7f13\u51b2\uff1b\u8f93\u51fa\u64cd\u4f5c\u7acb\u523b\u751f\u6548\u3002\n\n\n\"full\": \u5b8c\u5168\u7f13\u51b2\uff1b\u53ea\u6709\u5728\u7f13\u5b58\u6ee1\u6216\u5f53\u4f60\u663e\u5f0f\u7684\u5bf9\u6587\u4ef6\u8c03\u7528 flush \u65f6\u624d\u771f\u6b63\u505a\u8f93\u51fa\u64cd\u4f5c\u3002\n\n\n\"line\": \u884c\u7f13\u51b2\uff1b \u8f93\u51fa\u5c06\u5230\u6bcf\u6b21\u6362\u884c\u524d\uff0c \u5bf9\u4e8e\u67d0\u4e9b\u7279\u6b8a\u6587\u4ef6\uff08\u4f8b\u5982\u7ec8\u7aef\u8bbe\u5907\uff09\u7f13\u51b2\u5230\u4efb\u4f55\u8f93\u5165\u524d\u3002\n\u5bf9\u4e8e\u540e\u4e24\u79cd\u60c5\u51b5\uff0csize \u4ee5\u5b57\u8282\u6570\u4e3a\u5355\u4f4d \u6307\u5b9a\u7f13\u51b2\u533a\u5927\u5c0f\u3002 \u9ed8\u8ba4\u4f1a\u6709\u4e00\u4e2a\u6070\u5f53\u7684\u5927\u5c0f\u3002\n\n\n\n\n5.4.18 file:write (\u00b7\u00b7\u00b7)\n\n\n\u5c06\u53c2\u6570\u7684\u503c\u9010\u4e2a\u5199\u5165 file\u3002 \u53c2\u6570\u5fc5\u987b\u662f\u5b57\u7b26\u4e32\u6216\u6570\u5b57\u3002\n\n\n\u6210\u529f\u65f6\uff0c\u51fd\u6570\u8fd4\u56de file\u3002 \u5426\u5219\u8fd4\u56de nil \u52a0\u9519\u8bef\u63cf\u8ff0\u5b57\u7b26\u4e32\u3002\n\n\n\u7b80\u5355 IO \u793a\u4f8b\u7a0b\u5e8f\uff1a\n\n\n\u6570\u636e\u5199\u5165\u6587\u4ef6\uff1a\n\n\nio.output(\"textfile\")  \nio.write(\"hello\", \"\\n\")\nio.write(\"lua\", \"\\n\")\n\n\n\n\u8bfb\u53d6\u6587\u4ef6\u5185\u5bb9\uff1a\n\n\nio.input(\"textfile\")   \nprint(io.read(\"*all\"))-- \u8bfb\u53d6\u6240\u6709\n\n\n\n\u4e00\u884c\u4e00\u884c\u8bfb\u53d6\u6570\u636e\uff1a\n\n\nio.input(\"textfile\")\n\nlocal mark = io.read(0)\nwhile mark do\n    print(io.read(\"*line\"))\n    mark = io.read(0)\n    if not mark then\n        print(\"File end.\")\n        break\n    end\nend\n\n\n\n\u5b8c\u6210 IO \u6a21\u578b\u793a\u4f8b\u7a0b\u5e8f\uff1a\n\n\nlocal textfile = io.open(\"textfile\", \"w+\")\nif textfile then\n    textfile:write(\"omg lua\\n\")\n    textfile:flush()    \n    textfile:close()\nend\n\nlocal textfile = io.open(\"textfile\", \"r\")\nif textfile then\n    print(textfile:read(\"*all\"))\n    textfile:close()\nend\n\n\n\n5.5 \u64cd\u4f5c\u7cfb\u7edf\u5e93\n\n\n\u8fd9\u4e2a\u5e93\u90fd\u901a\u8fc7\u8868 os \u5b9e\u73b0\u3002\n\n\n5.5.1 os.clock ()\n\n\n\u8fd4\u56de\u7a0b\u5e8f\u4f7f\u7528\u7684\u6309\u79d2\u8ba1 CPU \u65f6\u95f4\u7684\u8fd1\u4f3c\u503c\u3002\n\n\n5.5.2 os.date ([format [, time]])\n\n\n\u8fd4\u56de\u4e00\u4e2a\u5305\u542b\u65e5\u671f\u53ca\u65f6\u523b\u7684\u5b57\u7b26\u4e32\u6216\u8868\u3002 \u683c\u5f0f\u5316\u65b9\u6cd5\u53d6\u51b3\u4e8e\u6240\u7ed9\u5b57\u7b26\u4e32 format\u3002\n\n\n\u5982\u679c\u63d0\u4f9b\u4e86 time \u53c2\u6570\uff0c \u683c\u5f0f\u5316\u8fd9\u4e2a\u65f6\u95f4 \uff08\u8fd9\u4e2a\u503c\u7684\u542b\u4e49\u53c2\u89c1 os.time \u51fd\u6570\uff09\u3002 \u5426\u5219\uff0cdate \u683c\u5f0f\u5316\u5f53\u524d\u65f6\u95f4\u3002\n\n\n\u5982\u679c format \u4ee5 '!' \u6253\u5934\uff0c \u65e5\u671f\u4ee5\u534f\u8c03\u4e16\u754c\u65f6\u683c\u5f0f\u5316\u3002 \u5728\u8fd9\u4e2a\u53ef\u9009\u5b57\u7b26\u9879\u4e4b\u540e\uff0c\n\n\n\u5982\u679c format \u4e3a\u5b57\u7b26\u4e32\n \"*t\"\uff0c \ndate \u8fd4\u56de\u6709\u540e\u7eed\u57df\u7684\u8868\uff1a year \uff08\u56db\u4f4d\u6570\u5b57\uff09\uff0cmonth \uff081\u201312\uff09\uff0cday \uff081\u201331\uff09\uff0c hour \uff080\u201323\uff09\uff0cmin \uff080\u201359\uff09\uff0csec \uff080\u201361\uff09\uff0c wday \uff08\u661f\u671f\u51e0\uff0c\u661f\u671f\u5929\u4e3a 1 \uff09\uff0c yday \uff08\u5f53\u5e74\u7684\u7b2c\u51e0\u5929\uff09\uff0c \u4ee5\u53ca isdst \uff08\u590f\u4ee4\u65f6\u6807\u8bb0\uff0c\u4e00\u4e2a\u5e03\u5c14\u91cf\uff09\u3002\n \u5bf9\u4e8e\u6700\u540e\u4e00\u4e2a\u57df\uff0c\u5982\u679c\u8be5\u4fe1\u606f\u4e0d\u63d0\u4f9b\u7684\u8bdd\u5c31\u4e0d\u5b58\u5728\u3002\n\n\n\u5982\u679c format \u5e76\u975e \"*t\"\uff0c date \u4ee5\u5b57\u7b26\u4e32\u5f62\u5f0f\u8fd4\u56de\uff0c \u683c\u5f0f\u5316\u65b9\u6cd5\u9075\u5faa ISO C \u51fd\u6570 strftime \u7684\u89c4\u5219\u3002\n\n\n\u5982\u679c\u4e0d\u4f20\u53c2\u6570\u8c03\u7528\uff0c date \u8fd4\u56de\u4e00\u4e2a\u5408\u7406\u7684\u65e5\u671f\u65f6\u95f4\u4e32\uff0c \u683c\u5f0f\u53d6\u51b3\u4e8e\u5bbf\u4e3b\u7a0b\u5e8f\u4ee5\u53ca\u5f53\u524d\u7684\u533a\u57df\u8bbe\u7f6e \uff08\u5373\uff0cos.date() \u7b49\u4ef7\u4e8e os.date(\"%c\")\uff09\u3002\n\n\n\u5728\u975e POSIX \u7cfb\u7edf\u4e0a\uff0c \u7531\u4e8e\u8fd9\u4e2a\u51fd\u6570\u4f9d\u8d56 C \u51fd\u6570 gmtime \u548c localtime\uff0c \u5b83\u53ef\u80fd\u5e76\u975e\u7ebf\u7a0b\u5b89\u5168\u7684\u3002\n\n\n5.5.3 os.difftime (t2, t1)\n\n\n\u8fd4\u56de\u4ee5\u79d2\u8ba1\u7b97\u7684\u65f6\u523b t1 \u5230 t2 \u7684\u5dee\u503c\u3002 \uff08\u8fd9\u91cc\u7684\u65f6\u523b\u662f\u7531 os.time \u8fd4\u56de\u7684\u503c\uff09\u3002 \u5728 POSIX\uff0cWindows\uff0c\u548c\u5176\u5b83\u4e00\u4e9b\u7cfb\u7edf\u4e2d\uff0c\u8fd9\u4e2a\u503c\u5c31\u7b49\u4e8e t2-t1\u3002\n\n\n5.5.4 os.execute ([command])\n\n\n\u8fd9\u4e2a\u51fd\u6570\u7b49\u4ef7\u4e8e ISO C \u51fd\u6570 \nsystem\n\u3002 \u5b83\u8c03\u7528\u7cfb\u7edf\u89e3\u91ca\u5668\u6267\u884c command\u3002 \u5982\u679c\u547d\u4ee4\u6210\u529f\u8fd0\u884c\u5b8c\u6bd5\uff0c\u7b2c\u4e00\u4e2a\u8fd4\u56de\u503c\u5c31\u662f true\uff0c \u5426\u5219\u662f nil otherwise\u3002 \u5728\u7b2c\u4e00\u4e2a\u8fd4\u56de\u503c\u4e4b\u540e\uff0c\u51fd\u6570\u8fd4\u56de\u4e00\u4e2a\u5b57\u7b26\u4e32\u52a0\u4e00\u4e2a\u6570\u5b57\u3002\u5982\u4e0b\uff1a\n\n\n\"exit\": \u547d\u4ee4\u6b63\u5e38\u7ed3\u675f\uff1b \u63a5\u4e0b\u6765\u7684\u6570\u5b57\u662f\u547d\u4ee4\u7684\u9000\u51fa\u72b6\u6001\u7801\u3002\n\"signal\": \u547d\u4ee4\u88ab\u4fe1\u53f7\u6253\u65ad\uff1b \u63a5\u4e0b\u6765\u7684\u6570\u5b57\u662f\u6253\u65ad\u8be5\u547d\u4ee4\u7684\u4fe1\u53f7\u3002\n\u5982\u679c\u4e0d\u5e26\u53c2\u6570\u8c03\u7528\uff0c os.execute \u5728\u7cfb\u7edf\u89e3\u91ca\u5668\u5b58\u5728\u7684\u65f6\u5019\u8fd4\u56de\u771f\u3002\n\n\n5.5.5 os.exit ([code [, close]])\n\n\n\u8c03\u7528 ISO C \u51fd\u6570 exit \u7ec8\u6b62\u5bbf\u4e3b\u7a0b\u5e8f\u3002 \u5982\u679c code \u4e3a true\uff0c \u8fd4\u56de\u7684\u72b6\u6001\u7801\u662f EXIT_SUCCESS\uff1b \u5982\u679c code \u4e3a false\uff0c \u8fd4\u56de\u7684\u72b6\u6001\u7801\u662f EXIT_FAILURE\uff1b \u5982\u679c code \u662f\u4e00\u4e2a\u6570\u5b57\uff0c \u8fd4\u56de\u7684\u72b6\u6001\u7801\u5c31\u662f\u8fd9\u4e2a\u6570\u5b57\u3002 code \u7684\u9ed8\u8ba4\u503c\u4e3a true\u3002\n\n\n\u5982\u679c\u7b2c\u4e8c\u4e2a\u53ef\u9009\u53c2\u6570 close \u4e3a\u771f\uff0c \u5728\u9000\u51fa\u524d\u5173\u95ed Lua \u72b6\u6001\u673a\u3002\n\n\n5.5.6 os.getenv (varname)\n\n\n\u8fd4\u56de\u8fdb\u7a0b\u73af\u5883\u53d8\u91cf varname \u7684\u503c\uff0c \u5982\u679c\u8be5\u53d8\u91cf\u672a\u5b9a\u4e49\uff0c\u8fd4\u56de nil \u3002\n\n\n5.5.7 os.remove (filename)\n\n\n\u5220\u9664\u6307\u5b9a\u540d\u5b57\u7684\u6587\u4ef6\uff08\u5728 POSIX \u7cfb\u7edf\u4e0a\u53ef\u4ee5\u662f\u4e00\u4e2a\u7a7a\u76ee\u5f55\uff09 \u5982\u679c\u51fd\u6570\u5931\u8d25\uff0c\u8fd4\u56de nil \u52a0\u4e00\u4e2a\u9519\u8bef\u63cf\u8ff0\u4e32\u53ca\u51fa\u9519\u7801\u3002\n\n\n5.5.8 os.rename (oldname, newname)\n\n\n\u5c06\u540d\u5b57\u4e3a oldname \u7684\u6587\u4ef6\u6216\u76ee\u5f55\u66f4\u540d\u4e3a newname\u3002\n \u5982\u679c\u51fd\u6570\u5931\u8d25\uff0c\u8fd4\u56de nil \u52a0\u4e00\u4e2a\u9519\u8bef\u63cf\u8ff0\u4e32\u53ca\u51fa\u9519\u7801\u3002\n\n\n5.5.9 os.setlocale (locale [, category])\n\n\n\u8bbe\u7f6e\u7a0b\u5e8f\u7684\u5f53\u524d\u533a\u57df\u3002\n locale \u662f\u4e00\u4e2a\u533a\u57df\u8bbe\u7f6e\u7684\u7cfb\u7edf\u76f8\u5173\u5b57\u7b26\u4e32\uff1b category \u662f\u4e00\u4e2a\u63cf\u8ff0\u6709\u6539\u53d8\u54ea\u4e2a\u5206\u7c7b\u7684\u53ef\u9009\u5b57\u7b26\u4e32\uff1a \"all\"\uff0c\"collate\"\uff0c \"ctype\"\uff0c \"monetary\"\uff0c \"numeric\"\uff0c \u6216 \"time\"\uff1b \u9ed8\u8ba4\u7684\u5206\u7c7b\u4e3a \"all\"\u3002 \u6b64\u51fd\u6570\u8fd4\u56de\u65b0\u533a\u57df\u7684\u540d\u5b57\u3002 \u5982\u679c\u8bf7\u6c42\u672a\u88ab\u83b7\u51c6\uff0c\u8fd4\u56de nil \u3002\n\n\n\u5f53 locale \u662f\u4e00\u4e2a\u7a7a\u4e32\uff0c \u5f53\u524d\u533a\u57df\u88ab\u8bbe\u7f6e\u4e3a\u4e00\u4e2a\u5728\u5b9e\u73b0\u4e2d\u5b9a\u4e49\u597d\u7684\u672c\u5730\u533a\u57df\u3002 \u5f53 locale \u4e3a\u5b57\u7b26\u4e32 \"C\"\uff0c \u5f53\u524d\u533a\u57df\u88ab\u8bbe\u7f6e\u4e3a\u6807\u51c6 C \u533a\u57df\u3002\n\n\n\u5f53\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a nil \u65f6\uff0c \u6b64\u51fd\u6570\u4ec5\u8fd4\u56de\u5f53\u524d\u533a\u57df\u6307\u5b9a\u5206\u7c7b\u7684\u540d\u5b57\u3002\n\n\n\u7531\u4e8e\u8fd9\u4e2a\u51fd\u6570\u4f9d\u8d56 C \u51fd\u6570 setlocale\uff0c \u5b83\u53ef\u80fd\u5e76\u975e\u7ebf\u7a0b\u5b89\u5168\u7684\u3002\n\n\n5.5.10 os.time ([table])\n\n\n\u5f53\u4e0d\u4f20\u53c2\u6570\u65f6\uff0c\u8fd4\u56de\u5f53\u524d\u65f6\u523b\u3002 \u5982\u679c\u4f20\u5165\u4e00\u5f20\u8868\uff0c\u5c31\u8fd4\u56de\u7531\u8fd9\u5f20\u8868\u8868\u793a\u7684\u65f6\u523b\u3002 \u8fd9\u5f20\u8868\u5fc5\u987b\u5305\u542b\u57df year\uff0cmonth\uff0c\u53ca day\uff1b \u53ef\u4ee5\u5305\u542b\u6709\u3000hour \uff08\u9ed8\u8ba4\u4e3a 12 \uff09\uff0c min \uff08\u9ed8\u8ba4\u4e3a 0\uff09\uff0c sec \uff08\u9ed8\u8ba4\u4e3a 0\uff09\uff0c\u4ee5\u53ca isdst \uff08\u9ed8\u8ba4\u4e3a nil\uff09\u3002 \u5173\u4e8e\u8fd9\u4e9b\u57df\u7684\u8be6\u7ec6\u63cf\u8ff0\uff0c\u53c2\u89c1 os.date \u51fd\u6570\u3002\n\n\n\u8fd4\u56de\u503c\u662f\u4e00\u4e2a\u542b\u4e49\u7531\u4f60\u7684\u7cfb\u7edf\u51b3\u5b9a\u7684\u6570\u5b57\u3002 \u5728 POSIX\uff0cWindows\uff0c\u548c\u5176\u5b83\u4e00\u4e9b\u7cfb\u7edf\u4e2d\uff0c \u8fd9\u4e2a\u6570\u5b57\u7edf\u8ba1\u4e86\u4ece\u6307\u5b9a\u65f6\u95f4\uff08\"epoch\"\uff09\u5f00\u59cb\u7ecf\u5386\u7684\u79d2\u6570\u3002 \u5bf9\u4e8e\u53e6\u5916\u7684\u7cfb\u7edf\uff0c\u5176\u542b\u4e49\u672a\u5b9a\u4e49\uff0c \u4f60\u53ea\u80fd\u628a time \u7684\u8fd4\u56de\u6570\u5b57\u7528\u4e8e os.date \u548c os.difftime \u7684\u53c2\u6570\u3002\n\n\n5.5.11 os.tmpname ()\n\n\n\u8fd4\u56de\u4e00\u4e2a\u53ef\u7528\u4e8e\u4e34\u65f6\u6587\u4ef6\u7684\u6587\u4ef6\u540d\u5b57\u7b26\u4e32\u3002 \u8fd9\u4e2a\u6587\u4ef6\u5728\u4f7f\u7528\u524d\u5fc5\u987b\u663e\u5f0f\u6253\u5f00\uff0c\u4e0d\u518d\u4f7f\u7528\u65f6\u9700\u8981\u663e\u5f0f\u5220\u9664\u3002\n\n\n\u5728 POSIX \u7cfb\u7edf\u4e0a\uff0c \u8fd9\u4e2a\u51fd\u6570\u4f1a\u4ee5\u6b64\u6587\u4ef6\u540d\u521b\u5efa\u4e00\u4e2a\u6587\u4ef6\u4ee5\u56de\u907f\u5b89\u5168\u98ce\u9669\u3002 \uff08\u522b\u4eba\u53ef\u80fd\u672a\u7ecf\u5141\u8bb8\u5728\u83b7\u53d6\u5230\u8fd9\u4e2a\u6587\u4ef6\u540d\u5230\u521b\u5efa\u8be5\u6587\u4ef6\u4e4b\u95f4\u7684\u65f6\u523b\u521b\u5efa\u6b64\u6587\u4ef6\u3002\uff09 \u4f60\u4f9d\u65e7\u9700\u8981\u5728\u4f7f\u7528\u5b83\u7684\u65f6\u5019\u5148\u6253\u5f00\uff0c\u5e76\u6700\u540e\u5220\u9664\uff08\u5373\u4f7f\u4f60\u6ca1\u4f7f\u7528\u5230\uff09\u3002\n\n\n\u53ea\u6709\u6709\u53ef\u80fd\uff0c\u4f60\u66f4\u5e94\u8be5\u4f7f\u7528 io.tmpfile\uff0c \u56e0\u4e3a\u8be5\u6587\u4ef6\u53ef\u4ee5\u5728\u7a0b\u5e8f\u7ed3\u675f\u65f6\u81ea\u52a8\u5220\u9664\u3002\n\n\n\u793a\u4f8b1\uff1a\n\n\nos.execute(\"ls\")\n\n\n\n\u793a\u4f8b2 \u83b7\u53d6\u5f53\u524d\u65f6\u95f4:\n\n\nlocal tb = os.date(\"*t\", os.time());\nfor i, v in pairs(tb) do\n      print(i, v);\nend\n\n\n\n\u8fd0\u884c\u7ed3\u679c\uff1a\n\n\nday     20\nmin     4\nhour    23\nsec     51\nwday    2\nisdst   true\nmonth   4\nyday    110\nyear    2015\n\n\n\n\u5bf9\u4e8e\u5176\u5b83\u7684\u683c\u5f0f\u5b57\u7b26\u4e32\uff0cos.date\u4f1a\u5c06\u65e5\u671f\u683c\u5f0f\u5316\u4e3a\u4e00\u4e2a\u5b57\u7b26\u4e32\n\n\n\u793a\u4f8b\uff1a\n\n\nprint(os.date(\"today is %A, in %B\"))      --\ntoday is Monday, in April\nprint(os.date(\"%x\", 906000490))           --\n09/16/1998\n\n\n\n\u6240\u6709\u683c\u5f0f\u5316\u5b57\u7b26\u4e32\u5982\u4e0b\uff1a\n\n\n\n\n%a      \u4e00\u661f\u671f\u4e2d\u5929\u6570\u7684\u7b80\u5199                      \uff08Wed\uff09\n\n\n%A      \u4e00\u661f\u671f\u4e2d\u5929\u6570\u7684\u5168\u79f0                      \uff08Wednesday\uff09\n\n\n%b      \u6708\u4efd\u7684\u7b80\u5199                                  \uff08Sep\uff09\n\n\n%B      \u6708\u4efd\u7684\u5168\u79f0                                  \uff08September\uff09\n\n\n%c      \u65e5\u671f\u548c\u65f6\u95f4                                   \uff0809/16/98 23:48:10\uff09\n\n\n%d      \u4e00\u4e2a\u6708\u4e2d\u7684\u7b2c\u51e0\u5929                          \uff0816\uff09[0 ~ 31]\n\n\n%H      24\u5c0f\u65f6\u5236\u4e2d\u7684\u5c0f\u65f6\u6570                      \uff0823\uff09[00 ~ 23]\n\n\n%I      12\u5c0f\u65f6\u5236\u4e2d\u7684\u5c0f\u65f6\u6570                       \uff0811\uff09[01 ~ 12]\n\n\n%j      \u4e00\u5e74\u4e2d\u7684\u7b2c\u51e0\u5929                             \uff08259\uff09[01 ~ 366]\n\n\n%M      \u5206\u949f\u6570                                       \uff0848\uff09[00 ~ 59]\n\n\n%m      \u6708\u4efd\u6570                                       \uff0809\uff09[01 ~ 12]     \n\n\n%P      \"\u4e0a\u5348(am)\" \u6216 \"\u4e0b\u5348(pm)\"               (pm)\n\n\n%S      \u79d2\u6570                                          \uff0810\uff09[00 ~ 59]\n\n\n%w      \u4e00\u661f\u671f\u4e2d\u7684\u7b2c\u51e0\u5929                         \uff083\uff09[0 ~ 6 = \u661f\u671f\u5929 ~ \u661f\u671f\u516d]\n\n\n%W\u3000\u3000\u4e00\u5e74\u4e2d\u7684\u7b2c\u51e0\u4e2a\u661f\u671f\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u30000 ~ 52\n%x      \u65e5\u671f                                          \uff0809/16/98\uff09\n%X      \u65f6\u95f4                                          \uff0823:48:10\uff09\n%y      \u4e24\u4f4d\u6570\u7684\u5e74\u4efd                               \uff0890\uff09[00 ~ 99]\n%Y      \u5b8c\u6574\u7684\u5e74\u4efd                                 \uff082009\uff09\n%%      \u5b57\u7b26\u4e32'%'\n\n\n\n\n5.6 \u8c03\u8bd5\u5e93\n\n\n\u8fd9\u4e2a\u5e93\u63d0\u4f9b\u4e86 Lua \u7a0b\u5e8f\u8c03\u8bd5\u63a5\u53e3\u7684\u529f\u80fd\u3002 \u5176\u4e2d\u4e00\u4e9b\u51fd\u6570\u8fdd\u53cd\u4e86 Lua \u4ee3\u7801\u7684\u57fa\u672c\u5047\u5b9a \uff08\u4f8b\u5982\uff0c\u4e0d\u4f1a\u4ece\u51fd\u6570\u4e4b\u5916\u8bbf\u95ee\u51fd\u6570\u7684\u5c40\u90e8\u53d8\u91cf\uff1b \u7528\u6237\u6570\u636e\u7684\u5143\u8868\u4e0d\u4f1a\u88ab Lua \u4ee3\u7801\u4fee\u6539\uff1b Lua \u7a0b\u5e8f\u4e0d\u4f1a\u5d29\u6e83\uff09\uff0c \u56e0\u6b64\u5b83\u4eec\u6709\u53ef\u80fd\u5371\u5bb3\u5230\u5176\u5b83\u4ee3\u7801\u7684\u5b89\u5168\u6027\u3002 \u6b64\u5916\uff0c\u5e93\u91cc\u7684\u4e00\u4e9b\u51fd\u6570\u53ef\u80fd\u8fd0\u884c\u7684\u5f88\u6162\u3002\n\n\n\u8fd9\u4e2a\u5e93\u91cc\u7684\u6240\u6709\u51fd\u6570\u90fd\u63d0\u4f9b\u5728\u8868 debug \u5185\u3002 \u6240\u6709\u64cd\u4f5c\u7ebf\u7a0b\u7684\u51fd\u6570\uff0c\u53ef\u9009\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u90fd\u662f\u9488\u5bf9\u7684\u7ebf\u7a0b\u3002 \u9ed8\u8ba4\u503c\u6c38\u8fdc\u662f\u5f53\u524d\u7ebf\u7a0b\u3002\n\n\n5.6.1 debug.debug ()\n\n\n\u8fdb\u5165\u4e00\u4e2a\u7528\u6237\u4ea4\u4e92\u6a21\u5f0f\uff0c\u8fd0\u884c\u7528\u6237\u8f93\u5165\u7684\u6bcf\u4e2a\u5b57\u7b26\u4e32\u3002 \u4f7f\u7528\u7b80\u5355\u7684\u547d\u4ee4\u4ee5\u53ca\u5176\u5b83\u8c03\u8bd5\u8bbe\u7f6e\uff0c\u7528\u6237\u53ef\u4ee5\u68c0\u9605\u5168\u5c40\u53d8\u91cf\u548c\u5c40\u90e8\u53d8\u91cf\uff0c \u6539\u53d8\u53d8\u91cf\u7684\u503c\uff0c\u8ba1\u7b97\u4e00\u4e9b\u8868\u8fbe\u5f0f\uff0c\u7b49\u7b49\u3002 \u8f93\u5165\u4e00\u884c\u4ec5\u5305\u542b cont \u7684\u5b57\u7b26\u4e32\u5c06\u7ed3\u675f\u8fd9\u4e2a\u51fd\u6570\uff0c \u8fd9\u6837\u8c03\u7528\u8005\u5c31\u53ef\u4ee5\u7ee7\u7eed\u5411\u4e0b\u8fd0\u884c\u3002\n\n\n\u6ce8\u610f\uff0cdebug.debug \u8f93\u5165\u7684\u547d\u4ee4\u5728\u6587\u6cd5\u4e0a\u5e76\u6ca1\u6709\u5185\u5d4c\u5230\u4efb\u4f55\u51fd\u6570\u4e2d\uff0c \u56e0\u6b64\u4e0d\u80fd\u76f4\u63a5\u53bb\u8bbf\u95ee\u5c40\u90e8\u53d8\u91cf\u3002\n\n\n5.6.2 debug.gethook ([thread])\n\n\n\u8fd4\u56de\u4e09\u4e2a\u8868\u793a\u7ebf\u7a0b\u94a9\u5b50\u8bbe\u7f6e\u7684\u503c\uff1a \u5f53\u524d\u94a9\u5b50\u51fd\u6570\uff0c\u5f53\u524d\u94a9\u5b50\u63a9\u7801\uff0c\u5f53\u524d\u94a9\u5b50\u8ba1\u6570 \uff08debug.sethook \u8bbe\u7f6e\u7684\u90a3\u4e9b\uff09\u3002\n\n\n5.6.3 debug.getinfo ([thread,] f [, what])\n\n\n\u8fd4\u56de\u5173\u4e8e\u4e00\u4e2a\u51fd\u6570\u4fe1\u606f\u7684\u8868\u3002 \u4f60\u53ef\u4ee5\u76f4\u63a5\u63d0\u4f9b\u8be5\u51fd\u6570\uff0c \u4e5f\u53ef\u4ee5\u7528\u4e00\u4e2a\u6570\u5b57 f \u8868\u793a\u8be5\u51fd\u6570\u3002 \u6570\u5b57 f \u8868\u793a\u8fd0\u884c\u5728\u6307\u5b9a\u7ebf\u7a0b\u7684\u8c03\u7528\u6808\u5bf9\u5e94\u5c42\u6b21\u4e0a\u7684\u51fd\u6570\uff1a 0 \u5c42\u8868\u793a\u5f53\u524d\u51fd\u6570\uff08getinfo \u81ea\u8eab\uff09\uff1b 1 \u5c42\u8868\u793a\u8c03\u7528 getinfo \u7684\u51fd\u6570 \uff08\u9664\u975e\u662f\u5c3e\u8c03\u7528\uff0c\u8fd9\u79cd\u60c5\u51b5\u4e0d\u8ba1\u5165\u6808\uff09\uff1b\u7b49\u7b49\u3002 \u5982\u679c f \u662f\u4e00\u4e2a\u6bd4\u6d3b\u52a8\u51fd\u6570\u6570\u91cf\u8fd8\u5927\u7684\u6570\u5b57\uff0c getinfo \u8fd4\u56de nil\u3002\n\n\n\u53ea\u6709\u5b57\u7b26\u4e32 what \u4e2d\u6709\u63cf\u8ff0\u8981\u586b\u5145\u54ea\u4e9b\u9879\uff0c \u8fd4\u56de\u7684\u8868\u53ef\u4ee5\u5305\u542b lua_getinfo \u80fd\u8fd4\u56de\u7684\u6240\u6709\u9879\u3002 what \u9ed8\u8ba4\u662f\u8fd4\u56de\u63d0\u4f9b\u7684\u9664\u5408\u6cd5\u884c\u53f7\u8868\u5916\u7684\u6240\u6709\u4fe1\u606f\u3002 \u5bf9\u4e8e\u9009\u9879 'f' \uff0c\u4f1a\u5728\u53ef\u80fd\u7684\u60c5\u51b5\u4e0b\uff0c\u589e\u52a0 func \u57df\u4fdd\u5b58\u51fd\u6570\u81ea\u8eab\u3002 \u5bf9\u4e8e\u9009\u9879 'L' \uff0c\u4f1a\u5728\u53ef\u80fd\u7684\u60c5\u51b5\u4e0b\uff0c\u589e\u52a0 activelines \u57df\u4fdd\u5b58\u5408\u6cd5\u884c\u53f7\u8868\u3002\n\n\n\u4f8b\u5982,\u8868\u8fbe\u5f0f debug.getinfo(1,\"n\") \u8fd4\u56de\u5e26\u6709\u5f53\u524d\u51fd\u6570\u540d\u5b57\u4fe1\u606f\u7684\u8868\uff08\u5982\u679c\u627e\u7684\u5230\u540d\u5b57\u7684\u8bdd\uff09\uff0c \u8868\u8fbe\u5f0f debug.getinfo(print) \u8fd4\u56de\u5173\u4e8e print \u51fd\u6570\u7684 \u5305\u542b\u6709\u6240\u6709\u80fd\u63d0\u4f9b\u4fe1\u606f\u7684\u8868\u3002\n\n\n5.6.4 debug.getlocal ([thread,] f, local)\n\n\n\u6b64\u51fd\u6570\u8fd4\u56de\u5728\u6808\u7684 f \u5c42\u5904\u51fd\u6570\u7684\u7d22\u5f15\u4e3a local \u7684\u5c40\u90e8\u53d8\u91cf \u7684\u540d\u5b57\u548c\u503c\u3002 \u8fd9\u4e2a\u51fd\u6570\u4e0d\u4ec5\u7528\u4e8e\u8bbf\u95ee\u663e\u5f0f\u5b9a\u4e49\u7684\u5c40\u90e8\u53d8\u91cf\uff0c\u4e5f\u5305\u62ec\u5f62\u53c2\u3001\u4e34\u65f6\u53d8\u91cf\u7b49\u3002\n\n\n\u7b2c\u4e00\u4e2a\u5f62\u53c2\u6216\u662f\u5b9a\u4e49\u7684\u7b2c\u4e00\u4e2a\u5c40\u90e8\u53d8\u91cf\u7684\u7d22\u5f15\u4e3a 1 \uff0c \u7136\u540e\u9075\u5faa\u5728\u4ee3\u7801\u4e2d\u5b9a\u4e49\u6b21\u5e8f\uff0c\u4ee5\u6b21\u7c7b\u63a8\u3002 \u5176\u4e2d\u53ea\u8ba1\u7b97\u51fd\u6570\u5f53\u524d\u4f5c\u7528\u57df\u7684\u6d3b\u52a8\u53d8\u91cf\u3002 \u8d1f\u7d22\u5f15\u6307\u53ef\u53d8\u53c2\u6570\uff1b -1 \u6307\u7b2c\u4e00\u4e2a\u53ef\u53d8\u53c2\u6570\u3002 \u5982\u679c\u8be5\u7d22\u5f15\u5904\u6ca1\u6709\u53d8\u91cf\uff0c\u51fd\u6570\u8fd4\u56de nil\u3002 \u82e5\u6307\u5b9a\u7684\u5c42\u6b21\u8d8a\u754c\uff0c\u629b\u51fa\u9519\u8bef\u3002 \uff08\u4f60\u53ef\u4ee5\u8c03\u7528 debug.getinfo \u6765\u68c0\u67e5\u5c42\u6b21\u662f\u5426\u5408\u6cd5\u3002\uff09\n\n\n\u4ee5 '(' \uff08\u5f00\u62ec\u53f7\uff09\u6253\u5934\u7684\u53d8\u91cf\u540d\u8868\u793a\u6ca1\u6709\u540d\u5b57\u7684\u53d8\u91cf \uff08\u6bd4\u5982\u662f\u5faa\u73af\u63a7\u5236\u7528\u5230\u7684\u63a7\u5236\u53d8\u91cf\uff0c \u6216\u662f\u53bb\u9664\u4e86\u8c03\u8bd5\u4fe1\u606f\u7684\u4ee3\u7801\u5757\uff09\u3002\n\n\n\u53c2\u6570 f \u4e5f\u53ef\u4ee5\u662f\u4e00\u4e2a\u51fd\u6570\u3002 \u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0cgetlocal \u4ec5\u8fd4\u56de\u51fd\u6570\u5f62\u53c2\u7684\u540d\u5b57\u3002\n\n\n5.6.5 debug.getmetatable (value)\n\n\n\u8fd4\u56de\u7ed9\u5b9a value \u7684\u5143\u8868\u3002 \u82e5\u5176\u6ca1\u6709\u5143\u8868\u5219\u8fd4\u56de nil \u3002\n\n\ndebug.getregistry ()\n\n\n\u8fd4\u56de\u6ce8\u518c\u8868\u3002\n\n\n5.6.6 debug.getupvalue (f, up)\n\n\n\u6b64\u51fd\u6570\u8fd4\u56de\u51fd\u6570 f \u7684\u7b2c up \u4e2a\u4e0a\u503c\u7684\u540d\u5b57\u548c\u503c\u3002 \u5982\u679c\u8be5\u51fd\u6570\u6ca1\u6709\u90a3\u4e2a\u4e0a\u503c\uff0c\u8fd4\u56de nil \u3002\n\n\n\u4ee5 '(' \uff08\u5f00\u62ec\u53f7\uff09\u6253\u5934\u7684\u53d8\u91cf\u540d\u8868\u793a\u6ca1\u6709\u540d\u5b57\u7684\u53d8\u91cf \uff08\u53bb\u9664\u4e86\u8c03\u8bd5\u4fe1\u606f\u7684\u4ee3\u7801\u5757\uff09\u3002\n\n\n5.6.7 debug.getuservalue (u)\n\n\n\u8fd4\u56de\u5173\u8054\u5728 u \u4e0a\u7684 Lua \u503c\u3002 \u5982\u679c u \u5e76\u975e\u7528\u6237\u6570\u636e\uff0c\u8fd4\u56de nil\u3002\n\n\n5.6.8 debug.sethook ([thread,] hook, mask [, count])\n\n\n\u5c06\u4e00\u4e2a\u51fd\u6570\u4f5c\u4e3a\u94a9\u5b50\u51fd\u6570\u8bbe\u5165\u3002 \u5b57\u7b26\u4e32 mask \u4ee5\u53ca\u6570\u5b57 count \u51b3\u5b9a\u4e86\u94a9\u5b50\u5c06\u5728\u4f55\u65f6\u8c03\u7528\u3002 \u63a9\u7801\u662f\u7531\u4e0b\u5217\u5b57\u7b26\u7ec4\u5408\u6210\u7684\u5b57\u7b26\u4e32\uff0c\u6bcf\u4e2a\u5b57\u7b26\u6709\u5176\u542b\u4e49\uff1a\n\n\n'c': \u6bcf\u5f53 Lua \u8c03\u7528\u4e00\u4e2a\u51fd\u6570\u65f6\uff0c\u8c03\u7528\u94a9\u5b50\uff1b\n'r': \u6bcf\u5f53 Lua \u4ece\u4e00\u4e2a\u51fd\u6570\u5185\u8fd4\u56de\u65f6\uff0c\u8c03\u7528\u94a9\u5b50\uff1b\n'l': \u6bcf\u5f53 Lua \u8fdb\u5165\u65b0\u7684\u4e00\u884c\u65f6\uff0c\u8c03\u7528\u94a9\u5b50\u3002\n\u6b64\u5916\uff0c \u4f20\u5165\u4e00\u4e2a\u4e0d\u4e3a\u96f6\u7684 count \uff0c \u94a9\u5b50\u5c06\u5728\u6bcf\u8fd0\u884c count \u6761\u6307\u4ee4\u65f6\u8c03\u7528\u3002\n\n\n\u5982\u679c\u4e0d\u4f20\u5165\u53c2\u6570\uff0c debug.sethook \u5173\u95ed\u94a9\u5b50\u3002\n\n\n\u5f53\u94a9\u5b50\u88ab\u8c03\u7528\u65f6\uff0c \u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u89e6\u53d1\u8fd9\u6b21\u8c03\u7528\u7684\u4e8b\u4ef6\uff1a \"call\" \uff08\u6216 \"tail call\"\uff09\uff0c \"return\"\uff0c \"line\"\uff0c \"count\"\u3002 \u5bf9\u4e8e\u884c\u4e8b\u4ef6\uff0c \u94a9\u5b50\u7684\u7b2c\u4e8c\u4e2a\u53c2\u6570\u662f\u65b0\u7684\u884c\u53f7\u3002 \u5728\u94a9\u5b50\u5185\uff0c\u4f60\u53ef\u4ee5\u8c03\u7528 getinfo \uff0c\u6307\u5b9a\u7b2c 2 \u5c42\uff0c \u6765\u83b7\u5f97\u6b63\u5728\u8fd0\u884c\u7684\u51fd\u6570\u7684\u8be6\u7ec6\u4fe1\u606f \uff080 \u5c42\u6307 getinfo \u51fd\u6570\uff0c 1 \u5c42\u6307\u94a9\u5b50\u51fd\u6570\uff09\u3002\n\n\n5.6.9 debug.setlocal ([thread,] level, local, value)\n\n\n\u8fd9\u4e2a\u51fd\u6570\u5c06 value \u8d4b\u7ed9 \u6808\u4e0a\u7b2c level \u5c42\u51fd\u6570\u7684\u7b2c local \u4e2a\u5c40\u90e8\u53d8\u91cf\u3002 \u5982\u679c\u6ca1\u6709\u90a3\u4e2a\u53d8\u91cf\uff0c\u51fd\u6570\u8fd4\u56de nil \u3002 \u5982\u679c level \u8d8a\u754c\uff0c\u629b\u51fa\u4e00\u4e2a\u9519\u8bef\u3002 \uff08\u4f60\u53ef\u4ee5\u8c03\u7528 debug.getinfo \u6765\u68c0\u67e5\u5c42\u6b21\u662f\u5426\u5408\u6cd5\u3002\uff09 \u5426\u5219\uff0c\u5b83\u8fd4\u56de\u5c40\u90e8\u53d8\u91cf\u7684\u540d\u5b57\u3002\n\n\n\u5173\u4e8e\u53d8\u91cf\u7d22\u5f15\u548c\u540d\u5b57\uff0c\u53c2\u89c1 debug.getlocal\u3002\n\n\n5.6.10 debug.setmetatable (value, table)\n\n\n\u5c06 value \u7684\u5143\u8868\u8bbe\u4e3a table \uff08\u53ef\u4ee5\u662f nil\uff09\u3002 \u8fd4\u56de value\u3002\n\n\n5.6.11 debug.setupvalue (f, up, value)\n\n\n\u8fd9\u4e2a\u51fd\u6570\u5c06 value \u8bbe\u4e3a\u51fd\u6570 f \u7684\u7b2c up \u4e2a\u4e0a\u503c\u3002 \u5982\u679c\u51fd\u6570\u6ca1\u6709\u90a3\u4e2a\u4e0a\u503c\uff0c\u8fd4\u56de nil \u5426\u5219\uff0c\u8fd4\u56de\u8be5\u4e0a\u503c\u7684\u540d\u5b57\u3002\n\n\n5.6.12 debug.setuservalue (udata, value)\n\n\n\u5c06 value \u8bbe\u4e3a udata \u7684\u5173\u8054\u503c\u3002 udata \u5fc5\u987b\u662f\u4e00\u4e2a\u5b8c\u5168\u7528\u6237\u6570\u636e\u3002\n\n\n\u8fd4\u56de udata\u3002\n\n\n5.6.13 debug.traceback ([thread,] [message [, level]])\n\n\n\u5982\u679c message \u6709\uff0c\u4e14\u4e0d\u662f\u5b57\u7b26\u4e32\u6216 nil\uff0c \u51fd\u6570\u4e0d\u505a\u4efb\u4f55\u5904\u7406\u76f4\u63a5\u8fd4\u56de message\u3002 \u5426\u5219\uff0c\u5b83\u8fd4\u56de\u8c03\u7528\u6808\u7684\u6808\u56de\u6eaf\u4fe1\u606f\u3002 \u5b57\u7b26\u4e32\u53ef\u9009\u9879 message \u88ab\u6dfb\u52a0\u5728\u6808\u56de\u6eaf\u4fe1\u606f\u7684\u5f00\u5934\u3002 \u6570\u5b57\u53ef\u9009\u9879 level \u6307\u660e\u4ece\u6808\u7684\u54ea\u4e00\u5c42\u5f00\u59cb\u56de\u6eaf \uff08\u9ed8\u8ba4\u4e3a 1 \uff0c\u5373\u8c03\u7528 traceback \u7684\u90a3\u91cc\uff09\u3002\n\n\n5.6.14 debug.upvalueid (f, n)\n\n\n\u8fd4\u56de\u6307\u5b9a\u51fd\u6570\u7b2c n \u4e2a\u4e0a\u503c\u7684\u552f\u4e00\u6807\u8bc6\u7b26\uff08\u4e00\u4e2a\u8f7b\u91cf\u7528\u6237\u6570\u636e\uff09\u3002\n\n\n\u8fd9\u4e2a\u552f\u4e00\u6807\u8bc6\u7b26\u53ef\u4ee5\u8ba9\u7a0b\u5e8f\u68c0\u67e5\u4e24\u4e2a\u4e0d\u540c\u7684\u95ed\u5305\u662f\u5426\u5171\u4eab\u4e86\u4e0a\u503c\u3002 \u82e5 Lua \u95ed\u5305\u4e4b\u95f4\u5171\u4eab\u7684\u662f\u540c\u4e00\u4e2a\u4e0a\u503c \uff08\u5373\u6307\u5411\u4e00\u4e2a\u5916\u90e8\u5c40\u90e8\u53d8\u91cf\uff09\uff0c\u4f1a\u8fd4\u56de\u76f8\u540c\u7684\u6807\u8bc6\u7b26\u3002\n\n\n5.6.15 debug.upvaluejoin (f1, n1, f2, n2)\n\n\n\u8ba9 Lua \u95ed\u5305 f1 \u7684\u7b2c n1 \u4e2a\u4e0a\u503c \u5f15\u7528 Lua \u95ed\u5305 f2 \u7684\u7b2c n2 \u4e2a\u4e0a\u503c\u3002", 
            "title": "05"
        }, 
        {
            "location": "/luamd/05/#51-utf-8", 
            "text": "\u8fd9\u4e2a\u5e93\u63d0\u4f9b\u4e86\u5bf9 UTF-8 \u7f16\u7801\u7684\u57fa\u7840\u652f\u6301\u3002 \u6240\u6709\u7684\u51fd\u6570\u90fd\u653e\u5728\u8868 utf8 \u4e2d\u3002 \u6b64\u5e93\u4e0d\u63d0\u4f9b\u9664\u7f16\u7801\u5904\u7406\u4e4b\u5916\u7684\u4efb\u4f55 Unicode \u652f\u6301\u3002 \u6240\u6709\u9700\u8981\u4e86\u89e3\u5b57\u7b26\u542b\u4e49\u7684\u64cd\u4f5c\uff0c\u6bd4\u5982\u5b57\u7b26\u5206\u7c7b\uff0c\u90fd\u4e0d\u5728\u6b64\u8303\u7574\u3002  \u9664\u975e\u53e6\u6709\u8bf4\u660e\uff0c \u5f53\u4e00\u4e2a\u51fd\u6570\u9700\u8981\u4e00\u4e2a\u5b57\u8282\u4f4d\u7f6e\u7684\u53c2\u6570\u65f6\uff0c \u90fd\u5047\u5b9a\u8fd9\u4e2a\u4f4d\u7f6e\u8981\u4e48\u4ece\u5b57\u8282\u5e8f\u5217\u7684\u5f00\u59cb\u8ba1\u7b97\uff0c \u8981\u4e48\u4ece\u5b57\u7b26\u4e32\u957f\u5ea6\u52a0\u4e00\u7684\u4f4d\u7f6e\u7b97\u3002 \u548c\u5b57\u7b26\u4e32\u5e93\u4e00\u6837\uff0c\u8d1f\u7684\u7d22\u5f15\u4ece\u5b57\u7b26\u4e32\u672b\u5c3e\u8ba1\u8d77\u3002  5.1.1 utf8.char (\u00b7\u00b7\u00b7)  \u63a5\u6536\u96f6\u6216\u591a\u4e2a\u6574\u6570\uff0c \u5c06\u6bcf\u4e2a\u6574\u6570\u8f6c\u6362\u6210\u5bf9\u5e94\u7684 UTF-8 \u5b57\u8282\u5e8f\u5217\uff0c\u5e76\u8fd4\u56de\u8fd9\u4e9b\u5e8f\u5217\u8fde\u63a5\u5230\u4e00\u8d77\u7684\u5b57\u7b26\u4e32\u3002  5.1.2 utf8.charpattern  \u7528\u4e8e\u7cbe\u786e\u5339\u914d\u5230\u4e00\u4e2a UTF-8 \u5b57\u8282\u5e8f\u5217\u7684\u6a21\u5f0f\uff08\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u5e76\u975e\u51fd\u6570\uff09\"[\\0-\\x7F\\xC2-\\xF4][\\x80-\\xBF]*\"\u3002 \u5b83\u5047\u5b9a\u5904\u7406\u7684\u5bf9\u8c61\u662f\u4e00\u4e2a\u5408\u6cd5\u7684 UTF-8 \u5b57\u7b26\u4e32\u3002  5.1.3 utf8.codes (s)  \u8fd4\u56de\u4e00\u7cfb\u5217\u7684\u503c\uff0c\u53ef\u4ee5\u8ba9   for p, c in utf8.codes(s) do body end  \u8fed\u4ee3\u51fa\u5b57\u7b26\u4e32 s \u4e2d\u6240\u6709\u7684\u5b57\u7b26\u3002 \u8fd9\u91cc\u7684 p \u662f\u4f4d\u7f6e\uff08\u6309\u5b57\u8282\u6570\uff09\u800c c \u662f\u6bcf\u4e2a\u5b57\u7b26\u7684\u7f16\u53f7\u3002 \u5982\u679c\u5904\u7406\u5230\u4e00\u4e2a\u4e0d\u5408\u6cd5\u7684\u5b57\u8282\u5e8f\u5217\uff0c\u5c06\u629b\u51fa\u4e00\u4e2a\u9519\u8bef\u3002  5.1.4 utf8.codepoint (s [, i [, j]])  \u4e00\u6574\u6570\u5f62\u5f0f\u8fd4\u56de s \u4e2d \u4ece\u4f4d\u7f6e i \u5230 j \u95f4\uff08\u5305\u62ec\u4e24\u7aef\uff09 \u6240\u6709\u5b57\u7b26\u7684\u7f16\u53f7\u3002 \u9ed8\u8ba4\u7684 i \u4e3a 1 \uff0c\u9ed8\u8ba4\u7684 j \u4e3a i\u3002 \u5982\u679c\u78b0\u4e0a\u4e0d\u5408\u6cd5\u7684\u5b57\u8282\u5e8f\u5217\uff0c\u629b\u51fa\u4e00\u4e2a\u9519\u8bef\u3002  5.1.5 utf8.len (s [, i [, j]])  \u8fd4\u56de\u5b57\u7b26\u4e32 s \u4e2d \u4ece\u4f4d\u7f6e i \u5230 j \u95f4 \uff08\u5305\u62ec\u4e24\u7aef\uff09 UTF-8 \u5b57\u7b26\u7684\u4e2a\u6570\u3002 \u9ed8\u8ba4\u7684 i \u4e3a 1 \uff0c\u9ed8\u8ba4\u7684 j \u4e3a -1 \u3002 \u5982\u679c\u5b83\u627e\u5230\u4efb\u4f55\u4e0d\u5408\u6cd5\u7684\u5b57\u8282\u5e8f\u5217\uff0c \u8fd4\u56de\u5047\u503c\u52a0\u4e0a\u7b2c\u4e00\u4e2a\u4e0d\u5408\u6cd5\u5b57\u8282\u7684\u4f4d\u7f6e\u3002  5.1.6 utf8.offset (s, n [, i])  \u8fd4\u56de\u7f16\u7801\u5728 s \u4e2d\u7684\u7b2c n \u4e2a\u5b57\u7b26\u7684\u5f00\u59cb\u4f4d\u7f6e\uff08\u6309\u5b57\u8282\u6570\uff09 \uff08\u4ece\u4f4d\u7f6e i \u5904\u5f00\u59cb\u7edf\u8ba1\uff09\u3002 \u8d1f n \u5219\u53d6\u5728\u4f4d\u7f6e i \u524d\u7684\u5b57\u7b26\u3002 \u5f53 n \u662f\u975e\u8d1f\u6570\u65f6\uff0c\u9ed8\u8ba4\u7684 i \u662f 1\uff0c \u5426\u5219\u9ed8\u8ba4\u4e3a #s + 1\u3002 \u56e0\u6b64\uff0cutf8.offset(s, -n) \u53d6\u5b57\u7b26\u4e32\u7684\u5012\u6570\u7b2c n \u4e2a\u5b57\u7b26\u7684\u4f4d\u7f6e\u3002 \u5982\u679c\u6307\u5b9a\u7684\u5b57\u7b26\u4e0d\u5728\u5176\u4e2d\u6216\u5728\u7ed3\u675f\u70b9\u4e4b\u540e\uff0c\u51fd\u6570\u8fd4\u56de nil\u3002\n\u4f5c\u4e3a\u7279\u4f8b\uff0c\u5f53 n \u7b49\u4e8e 0 \u65f6\uff0c \u6b64\u51fd\u6570\u8fd4\u56de\u542b\u6709 s \u7b2c i \u5b57\u8282\u7684\u90a3\u4e2a\u5b57\u7b26\u7684\u5f00\u59cb\u4f4d\u7f6e\u3002  \u8fd9\u4e2a\u51fd\u6570\u5047\u5b9a s \u662f\u4e00\u4e2a\u5408\u6cd5\u7684 UTF-8 \u5b57\u7b26\u4e32\u3002", 
            "title": "5.1 UTF-8 \u652f\u6301"
        }, 
        {
            "location": "/luamd/05/#52", 
            "text": "\u8fd9\u4e2a\u5e93\u63d0\u4f9b\u4e86\u8868\u5904\u7406\u7684\u901a\u7528\u51fd\u6570\u3002 \u6240\u6709\u51fd\u6570\u90fd\u653e\u5728\u8868 table \u4e2d\u3002  \u8bb0\u4f4f\uff0c\u65e0\u8bba\u4f55\u65f6\uff0c\u82e5\u4e00\u4e2a\u64cd\u4f5c\u9700\u8981\u53d6\u8868\u7684\u957f\u5ea6\uff0c \u8fd9\u5f20\u8868\u5fc5\u987b\u662f\u4e00\u4e2a\u771f\u5e8f\u5217\uff0c\u6216\u662f\u62e5\u6709 __len \u5143\u65b9\u6cd5\u3002 \u6240\u6709\u7684\u51fd\u6570\u90fd\u5ffd\u7565\u4f20\u5165\u53c2\u6570\u7684\u90a3\u5f20\u8868\u4e2d\u7684\u975e\u6570\u5b57\u952e\u3002  5.2.1 table.concat (list [, sep [, i [, j]]])  \u63d0\u4f9b\u4e00\u4e2a\u5217\u8868\uff0c\u5176\u6240\u6709\u5143\u7d20\u90fd\u662f\u5b57\u7b26\u4e32\u6216\u6570\u5b57\uff0c\u8fd4\u56de\u5b57\u7b26\u4e32 list[i]..sep..list[i+1] \u00b7\u00b7\u00b7 sep..list[j]\u3002 sep \u7684\u9ed8\u8ba4\u503c\u662f\u7a7a\u4e32\uff0c i \u7684\u9ed8\u8ba4\u503c\u662f 1 \uff0c j \u7684\u9ed8\u8ba4\u503c\u662f #list \u3002 \u5982\u679c i \u6bd4 j \u5927\uff0c\u8fd4\u56de\u7a7a\u4e32\u3002  5.2.2 table.insert (list, [pos,] value)  \u5728 list \u7684\u4f4d\u7f6e pos \u5904\u63d2\u5165\u5143\u7d20 value \uff0c \u5e76\u540e\u79fb\u5143\u7d20 list[pos], list[pos+1], \u00b7\u00b7\u00b7, list[#list] \u3002  pos \u7684\u9ed8\u8ba4\u503c\u4e3a #list+1 \uff0c \u56e0\u6b64\u8c03\u7528 table.insert(t,x) \u4f1a\u5c06 x \u63d2\u5728\u5217\u8868 t \u7684\u672b\u5c3e\u3002  5.2.3 table.move (a1, f, e, t [,a2])  \u5c06\u5143\u7d20\u4ece\u8868 a1 \u79fb\u5230\u8868 a2 \u3002 \u8fd9\u4e2a\u51fd\u6570\u505a\u4e86\u6b21\u7b49\u4ef7\u4e8e\u540e\u9762\u8fd9\u4e2a\u591a\u91cd\u8d4b\u503c\u7684\u7b49\u4ef7\u64cd\u4f5c\uff1a a2[t],\u00b7\u00b7\u00b7 = a1[f],\u00b7\u00b7\u00b7,a1[e]\u3002 a2 \u7684\u9ed8\u8ba4\u503c\u4e3a a1\u3002 \u76ee\u6807\u533a\u95f4\u53ef\u4ee5\u548c\u6e90\u533a\u95f4\u91cd\u53e0\u3002 \u7d22\u5f15 f \u5fc5\u987b\u662f\u6b63\u6570\u3002  5.2.4 table.pack (\u00b7\u00b7\u00b7)  \u8fd4\u56de\u7528\u6240\u6709\u53c2\u6570\u4ee5\u952e 1,2, \u7b49\u586b\u5145\u7684\u65b0\u8868\uff0c \u5e76\u5c06 \"n\" \u8fd9\u4e2a\u57df\u8bbe\u4e3a\u53c2\u6570\u7684\u603b\u6570\u3002 \u6ce8\u610f\u8fd9\u5f20\u8fd4\u56de\u7684\u8868\u4e0d\u4e00\u5b9a\u662f\u4e00\u4e2a\u5e8f\u5217\u3002  5.2.5 table.remove (list [, pos])  \u79fb\u9664 list \u4e2d pos \u4f4d\u7f6e\u4e0a\u7684\u5143\u7d20\uff0c\u5e76\u8fd4\u56de\u8fd9\u4e2a\u88ab\u79fb\u9664\u7684\u503c\u3002  \u5f53 pos \u662f\u5728 1 \u5230 #list \u4e4b\u95f4\u7684\u6574\u6570\u65f6\uff0c \u5b83\u5411\u524d\u79fb\u52a8\u5143\u7d20\u3000list[pos+1], list[pos+2], \u00b7\u00b7\u00b7, list[#list] \u5e76\u5220\u9664\u5143\u7d20 list[#list]\uff1b \u7d22\u5f15 pos \u53ef\u4ee5\u662f #list + 1 \uff0c\u6216\u5728 #list \u4e3a 0 \u65f6\u53ef\u4ee5\u662f 0 \uff1b \u5728\u8fd9\u4e9b\u60c5\u51b5\u4e0b\uff0c\u51fd\u6570\u5220\u9664\u5143\u7d20 list[pos]\u3002  pos \u9ed8\u8ba4\u4e3a #list\uff0c \u56e0\u6b64\u8c03\u7528 table.remove(t) \u5c06\u79fb\u9664\u8868t\u7684\u6700\u540e\u4e00\u4e2a\u5143\u7d20\u3002  5.2.6 table.sort (list [, comp])  \u5728\u8868\u5185\u4ece list[1] \u5230 list[#list] \u539f\u5730 \u5bf9\u5176\u95f4\u5143\u7d20\u6309\u6307\u5b9a\u6b21\u5e8f\u6392\u5e8f\u3002  \u5982\u679c\u63d0\u4f9b\u4e86 comp \uff0c \u5b83\u5fc5\u987b\u662f\u4e00\u4e2a\u53ef\u4ee5\u63a5\u6536\u4e24\u4e2a\u5217\u8868\u5185\u5143\u7d20\u4e3a\u53c2\u6570\u7684\u51fd\u6570\u3002 \u5f53\u7b2c\u4e00\u4e2a\u5143\u7d20\u9700\u8981\u6392\u5728\u7b2c\u4e8c\u4e2a\u5143\u7d20\u4e4b\u524d\u65f6\uff0c\u8fd4\u56de\u771f \uff08\u56e0\u6b64 not comp(list[i+1],list[i]) \u5728\u6392\u5e8f\u7ed3\u675f\u540e\u5c06\u4e3a\u771f\uff09\u3002 \u5982\u679c\u6ca1\u6709\u63d0\u4f9b comp\uff0c \u5c06\u4f7f\u7528\u6807\u51c6 Lua \u64cd\u4f5c   \u4f5c\u4e3a\u66ff\u4ee3\u54c1\u3002  \u6392\u5e8f\u7b97\u6cd5\u5e76\u4e0d\u7a33\u5b9a\uff1b \u5373\u5f53\u4e24\u4e2a\u5143\u7d20\u6b21\u5e8f\u76f8\u7b49\u65f6\uff0c\u5b83\u4eec\u5728\u6392\u5e8f\u540e\u7684\u76f8\u5bf9\u4f4d\u7f6e\u53ef\u80fd\u4f1a\u6539\u53d8\u3002  5.2.7 table.unpack (list [, i [, j]])  \u8fd4\u56de\u5217\u8868\u4e2d\u7684\u5143\u7d20\u3002 \u8fd9\u4e2a\u51fd\u6570\u7b49\u4ef7\u4e8e   return list[i], list[i+1], \u00b7\u00b7\u00b7, list[j]  i \u9ed8\u8ba4\u4e3a 1 \uff0cj \u9ed8\u8ba4\u4e3a #list\u3002  \u793a\u4f8b\u4ee3\u78011\uff1a  local tb = {10, 20, 30}\n\ntable.insert(tb, 40) \nfor k, v in ipairs(tb) do\n    print(k..\" -  \"..v) -- \u5728table\u7684\u6700\u540e\u63d2\u5165\uff0c\u7ed3\u679c\u4e3a\uff1a{10, 20, 30, 40}\nend\nprint(\"---\")\n\ntable.insert(tb, 2, 15) -- \u5728table\u7684\u4f4d\u7f6e2\u63d2\u5165\uff0c\u7ed3\u679c\u4e3a\uff1a{10, 15, 20, 30, 40}\nfor k, v in ipairs(tb) do\n    print(k..\" -  \"..v)\nend\nprint(\"---\")\n\nprint(table.remove(tb))  \nfor k, v in ipairs(tb) do\n    print(k..\" -  \"..v) -- \u5220\u9664\u6700\u540e\u4e00\u4e2a\u5143\u7d20\u5e76\u4e14\u8fd4\u56de40\uff0c\u7ed3\u679c\u4e3a\uff1a{10, 15, 20, 30}\nend\nprint(\"---\")\n\nprint(table.remove(tb, 1))  \nfor k, v in ipairs(tb) do\n    print(k..\" -  \"..v) -- \u5220\u9664\u7b2c\u4e00\u4e2a\u5143\u7d20\u5e76\u8fd4\u56de10\uff0c\u7ed3\u679c\u4e3a\uff1a{15, 20, 30}\nend  \u793a\u4f8b\u4ee3\u78012\uff1a  local tb = {20, 10, 2, 3, 4, 89, 20, 33, 2, 3}\n\n-- \u9ed8\u8ba4\u662f\u5347\u5e8f\u6392\u5e8f\ntable.sort(tb)\nfor _, v in ipairs(tb) do\n    print(v)\nend\n\nprint(\"---\")\n\n-- \u4fee\u6539\u4e3a\u964d\u5e8f\u6392\u5e8f\ntable.sort(tb, function (a, b) if a   b then return true end end)\nfor _, v in ipairs(tb) do\n    print(v)\nend  \u8fd0\u884c\u7ed3\u679c  2\n2\n3\n3\n4\n10\n20\n20\n33\n89\n---\n89\n33\n20\n20\n10\n4\n3\n3\n2\n2  \u793a\u4f8b\u4ee3\u78013\uff1a  table.pack(\u00b7\u00b7\u00b7) - \u5c06\u6240\u6709\u53c2\u6570\u6253\u5305\u5230\u4e00\u4e2a\u8868\u4e2d  tab = table.pack(\"hello\", \"world\", \"lua\", 1, 4)\nfor k,v in pairs(tab) do\n  print(k,v)\nend  \u8fd0\u884c\u7ed3\u679c\uff1a  1       hello\n2       world\n3       lua\n4       1\n5       4\nn       5  \u63a5\u6536\u4efb\u610f\u591a\u4e2a\u53c2\u6570\uff0c\u5c06\u6240\u6709\u53c2\u6570\u6253\u5305\u5230\u4e00\u4e2a\u4e0b\u6807\u4ece1\u5f00\u59cb\u7684\u8868\u4e2d\uff0c\u50cf\u4e0a\u8fb9\uff0c\u6253\u5305\u5b8c\u540etab1 = {\"hello\", \"world\", \"lua\", 1, 4}\u4f46\u662f\u4e0d\u4e00\u5b9a\u6240\u6709\u53c2\u6570\u90fd\u662f\u987a\u5e8f\u6253\u5305\u7684\u3002  table.unpack (list [, i [, j]]) - \u8ddftable.pack\u76f8\u53cd  table.unpack \u793a\u4f8b\u4ee3\u7801\uff1a  tab = {\"hello\", \"world\", \"lua\", 1, 4}\na, b, c, d, e = table.unpack(tab)\nprint(a) -- hello\nprint(b) -- world\nprint(c) -- lua\nprint(d) -- 1\nprint(e) -- 4", 
            "title": "5.2 \u8868\u5904\u7406"
        }, 
        {
            "location": "/luamd/05/#53", 
            "text": "\u8fd9\u4e2a\u5e93\u63d0\u4f9b\u4e86\u57fa\u672c\u7684\u6570\u5b66\u51fd\u6570\u3002 \u6240\u4ee5\u51fd\u6570\u90fd\u653e\u5728\u8868 math \u4e2d\u3002 \u6ce8\u89e3\u6709 \"integer/float\" \u7684\u51fd\u6570\u4f1a\u5bf9\u6574\u6570\u53c2\u6570\u8fd4\u56de\u6574\u6570\u7ed3\u679c\uff0c \u5bf9\u6d6e\u70b9\uff08\u6216\u6df7\u5408\uff09\u53c2\u6570\u8fd4\u56de\u6d6e\u70b9\u7ed3\u679c\u3002 \u5706\u6574\u51fd\u6570\uff08math.ceil, math.floor, math.modf\uff09 \u5728\u7ed3\u679c\u5728\u6574\u6570\u8303\u56f4\u5185\u65f6\u8fd4\u56de\u6574\u6570\uff0c\u5426\u5219\u8fd4\u56de\u6d6e\u70b9\u6570\u3002  5.3.1 math.abs (x)  \u8fd4\u56de x \u7684\u7edd\u5bf9\u503c\u3002(integer/float)  5.3.2 math.acos (x)  \u8fd4\u56de x \u7684\u53cd\u4f59\u5f26\u503c\uff08\u7528\u5f27\u5ea6\u8868\u793a\uff09\u3002  5.3.3 math.asin (x)  \u8fd4\u56de x \u7684\u53cd\u6b63\u5f26\u503c\uff08\u7528\u5f27\u5ea6\u8868\u793a\uff09\u3002  5.3.4 math.atan (y [, x])  \u8fd4\u56de y/x \u7684\u53cd\u6b63\u5207\u503c\uff08\u7528\u5f27\u5ea6\u8868\u793a\uff09\u3002 \u5b83\u4f1a\u4f7f\u7528\u4e24\u4e2a\u53c2\u6570\u7684\u7b26\u53f7\u6765\u627e\u5230\u7ed3\u679c\u843d\u5728\u54ea\u4e2a\u8c61\u9650\u4e2d\u3002 \uff08\u5373\u4f7f x \u4e3a\u96f6\u65f6\uff0c\u4e5f\u53ef\u4ee5\u6b63\u786e\u7684\u5904\u7406\u3002\uff09  \u9ed8\u8ba4\u7684 x \u662f 1 \uff0c \u56e0\u6b64\u8c03\u7528 math.atan(y) \u5c06\u8fd4\u56de y \u7684\u53cd\u6b63\u5207\u503c\u3002  5.3.5 math.ceil (x)  \u8fd4\u56de\u4e0d\u5c0f\u4e8e x \u7684\u6700\u5c0f\u6574\u6570\u503c\u3002  5.3.6 math.cos (x)  \u8fd4\u56de x \u7684\u4f59\u5f26\uff08\u5047\u5b9a\u53c2\u6570\u662f\u5f27\u5ea6\uff09\u3002  5.3.7 math.deg (x)  \u5c06\u89d2 x \u4ece\u5f27\u5ea6\u8f6c\u6362\u4e3a\u89d2\u5ea6\u3002  5.3.8 math.exp (x)  \u8fd4\u56de ex \u7684\u503c \uff08e \u4e3a\u81ea\u7136\u5bf9\u6570\u7684\u5e95\uff09\u3002  5.3.9 math.floor (x)  \u8fd4\u56de\u4e0d\u5927\u4e8e x \u7684\u6700\u5927\u6574\u6570\u503c\u3002  5.3.10 math.fmod (x, y)  \u8fd4\u56de x \u9664\u4ee5 y\uff0c\u5c06\u5546\u5411\u96f6\u5706\u6574\u540e\u7684\u4f59\u6570\u3002 (integer/float)  5.3.11 math.huge  \u6d6e\u70b9\u6570 HUGE_VAL\uff0c \u8fd9\u4e2a\u6570\u6bd4\u4efb\u4f55\u6570\u5b57\u503c\u90fd\u5927\u3002  5.3.12 math.log (x [, base])  \u8fd4\u56de\u4ee5\u6307\u5b9a\u5e95\u7684 x \u7684\u5bf9\u6570\u3002 \u9ed8\u8ba4\u7684 base \u662f e \uff08\u56e0\u6b64\u6b64\u51fd\u6570\u8fd4\u56de x \u7684\u81ea\u7136\u5bf9\u6570\uff09\u3002  5.3.13 math.max (x, \u00b7\u00b7\u00b7)  \u8fd4\u56de\u53c2\u6570\u4e2d\u6700\u5927\u7684\u503c\uff0c \u5927\u5c0f\u7531 Lua \u64cd\u4f5c   \u51b3\u5b9a\u3002 (integer/float)  5.3.14 math.maxinteger  \u6700\u5927\u503c\u7684\u6574\u6570\u3002  5.3.15 math.min (x, \u00b7\u00b7\u00b7)  \u8fd4\u56de\u53c2\u6570\u4e2d\u6700\u5c0f\u7684\u503c\uff0c \u5927\u5c0f\u7531 Lua \u64cd\u4f5c   \u51b3\u5b9a\u3002 (integer/float)  5.3.16 math.mininteger  \u6700\u5c0f\u503c\u7684\u6574\u6570\u3002  5.3.17 math.modf (x)  \u8fd4\u56de x \u7684\u6574\u6570\u90e8\u5206\u548c\u5c0f\u6570\u90e8\u5206\u3002 \u7b2c\u4e8c\u4e2a\u7ed3\u679c\u4e00\u5b9a\u662f\u6d6e\u70b9\u6570\u3002  5.3.18 math.pi  \u03c0 \u7684\u503c\u3002  5.3.19 math.rad (x)  \u5c06\u89d2 x \u4ece\u89d2\u5ea6\u8f6c\u6362\u4e3a\u5f27\u5ea6\u3002  5.3.20 math.random ([m [, n]])  \u5f53\u4e0d\u5e26\u53c2\u6570\u8c03\u7528\u65f6\uff0c \u8fd4\u56de\u4e00\u4e2a [0,1) \u533a\u95f4\u5185\u4e00\u81f4\u5206\u5e03\u7684\u6d6e\u70b9\u4f2a\u968f\u673a\u6570\u3002    \u5f53\u4ee5\u4e24\u4e2a\u6574\u6570 m \u4e0e n \u8c03\u7528\u65f6\uff0c math.random \u8fd4\u56de\u4e00\u4e2a [m, n] \u533a\u95f4 \u5185\u4e00\u81f4\u5206\u5e03\u7684\u6574\u6570\u4f2a\u968f\u673a\u6570\u3002 \uff08\u503c m-n \u4e0d\u80fd\u662f\u8d1f\u6570\uff0c\u4e14\u5fc5\u987b\u5728 Lua \u6574\u6570\u7684\u8868\u793a\u8303\u56f4\u5185\u3002\uff09 \u8c03\u7528 math.random(n) \u7b49\u4ef7\u4e8e math.random(1,n)\u3002  \u8fd9\u4e2a\u51fd\u6570\u662f\u5bf9 C \u63d0\u4f9b\u7684\u4f4d\u968f\u673a\u6570\u51fd\u6570\u7684\u5c01\u88c5\u3002 \u5bf9\u5176\u7edf\u8ba1\u5c5e\u6027\u4e0d\u4f5c\u62c5\u4fdd\u3002  5.3.21 math.randomseed (x)  \u628a x \u8bbe\u4e3a\u4f2a\u968f\u673a\u6570\u53d1\u751f\u5668\u7684\u201c\u79cd\u5b50\u201d\uff1a \u76f8\u540c\u7684\u79cd\u5b50\u4ea7\u751f\u76f8\u540c\u7684\u968f\u673a\u6570\u5217\u3002  5.3.22 math.sin (x)  \u8fd4\u56de x \u7684\u6b63\u5f26\u503c\uff08\u5047\u5b9a\u53c2\u6570\u662f\u5f27\u5ea6\uff09\u3002  5.3.23 math.sqrt (x)  \u8fd4\u56de x \u7684\u5e73\u65b9\u6839\u3002 \uff08\u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528\u4e58\u65b9 x^0.5 \u6765\u8ba1\u7b97\u8fd9\u4e2a\u503c\u3002\uff09  5.3.24 math.tan (x)  \u8fd4\u56de x \u7684\u6b63\u5207\u503c\uff08\u5047\u5b9a\u53c2\u6570\u662f\u5f27\u5ea6\uff09\u3002  5.3.25 math.tointeger (x)  \u5982\u679c x \u53ef\u4ee5\u8f6c\u6362\u4e3a\u4e00\u4e2a\u6574\u6570\uff0c \u8fd4\u56de\u8be5\u6574\u6570\u3002 \u5426\u5219\u8fd4\u56de nil\u3002  5.3.26 math.type (x)  \u5982\u679c x \u662f\u6574\u6570\uff0c\u8fd4\u56de \"integer\"\uff0c \u5982\u679c\u5b83\u662f\u6d6e\u70b9\u6570\uff0c\u8fd4\u56de \"float\"\uff0c \u5982\u679c x \u4e0d\u662f\u6570\u5b57\uff0c\u8fd4\u56de nil\u3002  5.3.27 math.ult (m, n)  \u5982\u679c\u6574\u6570 m \u548c n \u4ee5\u65e0\u7b26\u53f7\u6574\u6570\u5f62\u5f0f\u6bd4\u8f83\uff0c m \u5728 n \u4e4b\u4e0b\uff0c\u8fd4\u56de\u5e03\u5c14\u771f\u5426\u5219\u8fd4\u56de\u5047\u3002  \u793a\u4f8b\u4ee3\u7801\uff1a  print(math.sin(math.rad(30)))           -- 0.5\nprint(math.floor(5.6))                  -- 5\nprint(math.ceil(5.6))                   -- 6\nprint(math.max(2, 3, 2, 14, 2, 30, -3)) -- 30\nprint(math.min(2, 3, 2, 14, 2, 30, -3)) -- -3  \u968f\u673a\u6570\uff1a  print(math.random())     -- \u8f93\u51fa\u4e00\u4e2a\u5927\u4e8e\u7b49\u4e8e0\uff0c\u5c0f\u4e8e1\u7684\u503c\nprint(math.random(2))    -- \u8f93\u51fa\u4e0d\u662f1\u5c31\u662f2\nprint(math.random(3, 4)) -- \u8f93\u51fa\u4e0d\u662f3\u5c31\u662f4  \u8fd9\u91cc\u6bcf\u6b21\u8c03\u7528\u90fd\u662f\u4e00\u6837\u7684\u503c  \u4f7f\u7528\u4e86\u65f6\u95f4\u79cd\u5b50\u7684\u968f\u673a\u6570\uff1a  math.randomseed(os.time())\nprint(math.random())     -- \u8f93\u51fa\u4e00\u4e2a\u5927\u4e8e\u7b49\u4e8e0\uff0c\u5c0f\u4e8e1\u7684\u503c\nprint(math.random(2))    -- \u8f93\u51fa\u4e0d\u662f1\u5c31\u662f2\nprint(math.random(3, 4)) -- \u8f93\u51fa\u4e0d\u662f3\u5c31\u662f4", 
            "title": "5.3 \u6570\u5b66\u51fd\u6570"
        }, 
        {
            "location": "/luamd/05/#54", 
            "text": "I/O \u5e93\u63d0\u4f9b\u4e86\u4e24\u5957\u4e0d\u540c\u98ce\u683c\u7684\u6587\u4ef6\u5904\u7406\u63a5\u53e3\u3002 \u7b2c\u4e00\u79cd\u98ce\u683c\u4f7f\u7528 \u9690\u5f0f\u7684\u6587\u4ef6\u53e5\u67c4 \uff1b \u5b83\u63d0\u4f9b\u8bbe\u7f6e\u9ed8\u8ba4\u8f93\u5165\u6587\u4ef6\u53ca\u9ed8\u8ba4\u8f93\u51fa\u6587\u4ef6\u7684\u64cd\u4f5c\uff0c \u6240\u6709\u7684\u8f93\u5165\u8f93\u51fa\u64cd\u4f5c\u90fd\u9488\u5bf9\u8fd9\u4e9b\u9ed8\u8ba4\u6587\u4ef6\u3002 \u7b2c\u4e8c\u79cd\u98ce\u683c\u4f7f\u7528 \u663e\u5f0f\u7684\u6587\u4ef6\u53e5\u67c4 \u3002  \u5f53\u4f7f\u7528\u9690\u5f0f\u6587\u4ef6\u53e5\u67c4\u65f6\uff0c \u6240\u6709\u7684\u64cd\u4f5c\u90fd\u7531\u8868 io \u63d0\u4f9b\u3002 \u82e5\u4f7f\u7528\u663e\u5f0f\u6587\u4ef6\u53e5\u67c4\uff0c io.open \u4f1a\u8fd4\u56de\u4e00\u4e2a\u6587\u4ef6\u53e5\u67c4\uff0c\u4e14\u6240\u6709\u7684\u64cd\u4f5c\u90fd\u7531\u8be5\u6587\u4ef6\u53e5\u67c4\u7684\u65b9\u6cd5\u6765\u63d0\u4f9b\u3002  \u8868 io \u4e2d\u4e5f\u63d0\u4f9b\u4e86\u4e09\u4e2a \u548c C \u4e2d\u542b\u4e49\u76f8\u540c\u7684\u9884\u5b9a\u4e49\u6587\u4ef6\u53e5\u67c4\uff1a io.stdin\uff0c io.stdout\uff0c \u4ee5\u53ca io.stderr\u3002 I/O \u5e93\u6c38\u8fdc\u4e0d\u4f1a\u5173\u95ed\u8fd9\u4e9b\u6587\u4ef6\u3002  \u9664\u975e\u53e6\u6709\u8bf4\u660e\uff0c I/O \u51fd\u6570\u5728\u51fa\u9519\u65f6\u90fd\u8fd4\u56de nil \uff08\u7b2c\u4e8c\u4e2a\u8fd4\u56de\u503c\u4e3a\u9519\u8bef\u6d88\u606f\uff0c\u7b2c\u4e09\u4e2a\u8fd4\u56de\u503c\u4e3a\u7cfb\u7edf\u76f8\u5173\u7684\u9519\u8bef\u7801\uff09\u3002 \u6210\u529f\u65f6\u8fd4\u56de\u4e0e nil \u4e0d\u540c\u7684\u503c\u3002 \u5728\u975e POSIX \u7cfb\u7edf\u4e0a\uff0c \u6839\u636e\u9519\u8bef\u7801\u53d6\u51fa\u9519\u8bef\u6d88\u606f\u7684\u8fc7\u7a0b\u53ef\u80fd\u5e76\u975e\u7ebf\u7a0b\u5b89\u5168\u7684\uff0c \u56e0\u4e3a\u8fd9\u4f7f\u7528\u4e86 C \u7684\u5168\u5c40\u53d8\u91cf errno \u3002  5.4.1 io.close ([file])  \u7b49\u4ef7\u4e8e file:close()\u3002 \u4e0d\u7ed9\u51fa file \u65f6\u5c06\u5173\u95ed\u9ed8\u8ba4\u8f93\u51fa\u6587\u4ef6\u3002  5.4.2 io.flush ()  \u7b49\u4ef7\u4e8e io.output():flush()\u3002  5.4.3 io.input ([file])  \u7528\u6587\u4ef6\u540d\u8c03\u7528\u5b83\u65f6\uff0c\uff08\u4ee5\u6587\u672c\u6a21\u5f0f\uff09\u6765\u6253\u5f00\u8be5\u540d\u5b57\u7684\u6587\u4ef6\uff0c \u5e76\u5c06\u6587\u4ef6\u53e5\u67c4\u8bbe\u4e3a\u9ed8\u8ba4\u8f93\u5165\u6587\u4ef6\u3002 \u5982\u679c\u7528\u6587\u4ef6\u53e5\u67c4\u53bb\u8c03\u7528\u5b83\uff0c \u5c31\u7b80\u5355\u7684\u5c06\u8be5\u53e5\u67c4\u8bbe\u4e3a\u9ed8\u8ba4\u8f93\u5165\u6587\u4ef6\u3002 \u5982\u679c\u8c03\u7528\u65f6\u4e0d\u4f20\u53c2\u6570\uff0c\u5b83\u8fd4\u56de\u5f53\u524d\u7684\u9ed8\u8ba4\u8f93\u5165\u6587\u4ef6\u3002  \u5728\u51fa\u9519\u7684\u60c5\u51b5\u4e0b\uff0c\u51fd\u6570\u629b\u51fa\u9519\u8bef\u800c\u4e0d\u662f\u8fd4\u56de\u9519\u8bef\u7801\u3002  5.4.4 io.lines ([filename \u00b7\u00b7\u00b7])  \u4ee5\u8bfb\u6a21\u5f0f\u6253\u5f00\u6307\u5b9a\u7684\u6587\u4ef6\u540d\u5e76\u8fd4\u56de\u4e00\u4e2a\u8fed\u4ee3\u51fd\u6570\u3002 \u6b64\u8fed\u4ee3\u51fd\u6570\u7684\u5de5\u4f5c\u65b9\u5f0f\u548c\u7528\u4e00\u4e2a\u5df2\u6253\u5f00\u7684\u6587\u4ef6\u53bb\u8c03\u7528 file:lines(\u00b7\u00b7\u00b7) \u5f97\u5230\u7684\u8fed\u4ee3\u5668\u76f8\u540c\u3002 \u5f53\u8fed\u4ee3\u51fd\u6570\u68c0\u6d4b\u5230\u6587\u4ef6\u7ed3\u675f\uff0c \u5b83\u4e0d\u8fd4\u56de\u503c\uff08\u8ba9\u5faa\u73af\u7ed3\u675f\uff09\u5e76\u81ea\u52a8\u5173\u95ed\u6587\u4ef6\u3002  \u8c03\u7528 io.lines() \uff08\u4e0d\u4f20\u6587\u4ef6\u540d\uff09 \u7b49\u4ef7\u4e8e io.input():lines(\"*l\")\uff1b \u5373\uff0c\u5b83\u5c06\u6309\u884c\u8fed\u4ee3\u6807\u51c6\u8f93\u5165\u6587\u4ef6\u3002 \u5728\u6b64\u60c5\u51b5\u4e0b\uff0c\u5faa\u73af\u7ed3\u675f\u540e\u5b83\u4e0d\u4f1a\u5173\u95ed\u6587\u4ef6\u3002  \u5728\u51fa\u9519\u7684\u60c5\u51b5\u4e0b\uff0c\u51fd\u6570\u629b\u51fa\u9519\u8bef\u800c\u4e0d\u662f\u8fd4\u56de\u9519\u8bef\u7801\u3002  5.4.5 io.open (filename [, mode])  \u8fd9\u4e2a\u51fd\u6570\u7528\u5b57\u7b26\u4e32 mode \u6307\u5b9a\u7684\u6a21\u5f0f\u6253\u5f00\u4e00\u4e2a\u6587\u4ef6\u3002 \u8fd4\u56de\u65b0\u7684\u6587\u4ef6\u53e5\u67c4\u3002 \u5f53\u51fa\u9519\u65f6\uff0c\u8fd4\u56de nil \u52a0\u9519\u8bef\u6d88\u606f\u3002  mode \u5b57\u7b26\u4e32\u53ef\u4ee5\u662f\u4e0b\u5217\u4efb\u610f\u503c\uff1a   \"r\": \u8bfb\u6a21\u5f0f\uff08\u9ed8\u8ba4\uff09\uff1b  \"w\": \u5199\u6a21\u5f0f\uff1b  \"a\": \u8ffd\u52a0\u6a21\u5f0f\uff1b  \"r+\": \u66f4\u65b0\u6a21\u5f0f\uff0c\u6240\u6709\u4e4b\u524d\u7684\u6570\u636e\u90fd\u4fdd\u7559\uff1b  \"w+\": \u66f4\u65b0\u6a21\u5f0f\uff0c\u6240\u6709\u4e4b\u524d\u7684\u6570\u636e\u90fd\u5220\u9664\uff1b  \"a+\": \u8ffd\u52a0\u66f4\u65b0\u6a21\u5f0f\uff0c\u6240\u6709\u4e4b\u524d\u7684\u6570\u636e\u90fd\u4fdd\u7559\uff0c\u53ea\u5141\u8bb8\u5728\u6587\u4ef6\u5c3e\u90e8\u505a\u5199\u5165\u3002   mode \u5b57\u7b26\u4e32\u53ef\u4ee5\u5728\u6700\u540e\u52a0\u4e00\u4e2a 'b' \uff0c \u8fd9\u4f1a\u5728\u67d0\u4e9b\u7cfb\u7edf\u4e0a\u4ee5\u4e8c\u8fdb\u5236\u65b9\u5f0f\u6253\u5f00\u6587\u4ef6\u3002  5.4.6 io.output ([file])  \u7c7b\u4f3c\u4e8e io.input\u3002 \u4e0d\u8fc7\u90fd\u9488\u5bf9\u9ed8\u8ba4\u8f93\u51fa\u6587\u4ef6\u64cd\u4f5c\u3002  5.4.7 io.popen (prog [, mode])  \u8fd9\u4e2a\u51fd\u6570\u548c\u7cfb\u7edf\u6709\u5173\uff0c\u4e0d\u662f\u6240\u6709\u7684\u5e73\u53f0\u90fd\u63d0\u4f9b\u3002  \u7528\u4e00\u4e2a\u5206\u79bb\u8fdb\u7a0b\u5f00\u542f\u7a0b\u5e8f prog\uff0c \u8fd4\u56de\u7684\u6587\u4ef6\u53e5\u67c4\u53ef\u7528\u4e8e\u4ece\u8fd9\u4e2a\u7a0b\u5e8f\u4e2d\u8bfb\u53d6\u6570\u636e \uff08\u5982\u679c mode \u4e3a \"r\"\uff0c\u8fd9\u662f\u9ed8\u8ba4\u503c\uff09 \u6216\u662f\u5411\u8fd9\u4e2a\u7a0b\u5e8f\u5199\u5165\u8f93\u5165\uff08\u5f53 mode \u4e3a \"w\" \u65f6\uff09\u3002  5.4.8 io.read (\u00b7\u00b7\u00b7)  \u7b49\u4ef7\u4e8e io.input():read(\u00b7\u00b7\u00b7)\u3002\u4ece\u5f53\u524d\u8f93\u5165\u6587\u4ef6\u4e2d\u8bfb\u53d6\u5b57\u7b26\u4e32\uff0c\u5b83\u7684\u53c2\u6570\u51b3\u5b9a\u4e86\u8981\u8bfb\u53d6\u7684\u6570\u636e\uff1a   \u201c*all\u201d    \u8bfb\u53d6\u6574\u4e2a\u6587\u4ef6  \u201c*line\u201d   \u8bfb\u53d6\u4e0b\u4e00\u884c  \u201c*number\u201d \u8bfb\u53d6\u4e00\u4e2a\u6570\u5b57       \u8bfb\u53d6\u4e00\u4e2a\u4e0d\u8d85\u8fc7 \u4e2a\u5b57\u7b26\u7684\u5b57\u7b26\u4e32   5.4.9 io.tmpfile ()  \u8fd4\u56de\u4e00\u4e2a\u4e34\u65f6\u6587\u4ef6\u7684\u53e5\u67c4\u3002 \u8fd9\u4e2a\u6587\u4ef6\u4ee5\u66f4\u65b0\u6a21\u5f0f\u6253\u5f00\uff0c\u5728\u7a0b\u5e8f\u7ed3\u675f\u65f6\u4f1a\u81ea\u52a8\u5220\u9664\u3002  5.4.10 io.type (obj)  \u68c0\u67e5 obj \u662f\u5426\u662f\u5408\u6cd5\u7684\u6587\u4ef6\u53e5\u67c4\u3002 \u5982\u679c obj \u5b83\u662f\u4e00\u4e2a\u6253\u5f00\u7684\u6587\u4ef6\u53e5\u67c4\uff0c\u8fd4\u56de\u5b57\u7b26\u4e32 \"file\"\u3002 \u5982\u679c obj \u662f\u4e00\u4e2a\u5173\u95ed\u7684\u6587\u4ef6\u53e5\u67c4\uff0c\u8fd4\u56de\u5b57\u7b26\u4e32 \"closed file\"\u3002 \u5982\u679c obj \u4e0d\u662f\u6587\u4ef6\u53e5\u67c4\uff0c\u8fd4\u56de nil \u3002  5.4.11 io.write (\u00b7\u00b7\u00b7)  \u7b49\u4ef7\u4e8e io.output():write(\u00b7\u00b7\u00b7)\u3002  5.4.12 file:close ()  \u5173\u95ed file\u3002 \u6ce8\u610f\uff0c\u6587\u4ef6\u5728\u53e5\u67c4\u88ab\u5783\u573e\u56de\u6536\u65f6\u4f1a\u81ea\u52a8\u5173\u95ed\uff0c \u4f46\u662f\u591a\u4e45\u4ee5\u540e\u53d1\u751f\uff0c\u65f6\u95f4\u4e0d\u53ef\u9884\u671f\u7684\u3002  \u5f53\u5173\u95ed\u7528 io.popen \u521b\u5efa\u51fa\u6765\u7684\u6587\u4ef6\u53e5\u67c4\u65f6\uff0c file:close \u8fd4\u56de os.execute \u4f1a\u8fd4\u56de\u7684\u4e00\u6837\u7684\u503c\u3002  5.4.13 file:flush ()  \u5c06\u5199\u5165\u7684\u6570\u636e\u4fdd\u5b58\u5230 file \u4e2d\u3002  5.4.14 file:lines (\u00b7\u00b7\u00b7)  \u8fd4\u56de\u4e00\u4e2a\u8fed\u4ee3\u5668\u51fd\u6570\uff0c \u6bcf\u6b21\u8c03\u7528\u8fed\u4ee3\u5668\u65f6\uff0c\u90fd\u4ece\u6587\u4ef6\u4e2d\u6309\u6307\u5b9a\u683c\u5f0f\u8bfb\u6570\u636e\u3002 \u5982\u679c\u6ca1\u6709\u6307\u5b9a\u683c\u5f0f\uff0c\u4f7f\u7528\u9ed8\u8ba4\u503c \"l\" \u3002 \u770b\u4e00\u4e2a\u4f8b\u5b50   for c in file:lines(1) do body end  \u4f1a\u4ece\u6587\u4ef6\u5f53\u524d\u4f4d\u7f6e\u5f00\u59cb\uff0c\u4e2d\u4e0d\u65ad\u8bfb\u51fa\u5b57\u7b26\u3002 \u548c io.lines \u4e0d\u540c\uff0c \u8fd9\u4e2a\u51fd\u6570\u5728\u5faa\u73af\u7ed3\u675f\u540e\u4e0d\u4f1a\u5173\u95ed\u6587\u4ef6\u3002  \u5728\u51fa\u9519\u7684\u60c5\u51b5\u4e0b\uff0c\u51fd\u6570\u629b\u51fa\u9519\u8bef\u800c\u4e0d\u662f\u8fd4\u56de\u9519\u8bef\u7801\u3002  5.4.15 file:read (\u00b7\u00b7\u00b7)  \u8bfb\u6587\u4ef6 file\uff0c \u6307\u5b9a\u7684\u683c\u5f0f\u51b3\u5b9a\u4e86\u8981\u8bfb\u4ec0\u4e48\u3002 \u5bf9\u4e8e\u6bcf\u79cd\u683c\u5f0f\uff0c\u51fd\u6570\u8fd4\u56de\u8bfb\u51fa\u7684\u5b57\u7b26\u5bf9\u5e94\u7684\u5b57\u7b26\u4e32\u6216\u6570\u5b57\u3002 \u82e5\u4e0d\u80fd\u4ee5\u8be5\u683c\u5f0f\u5bf9\u5e94\u8bfb\u51fa\u6570\u636e\u5219\u8fd4\u56de nil\u3002 \uff08\u5bf9\u4e8e\u6700\u540e\u8fd9\u79cd\u60c5\u51b5\uff0c \u51fd\u6570\u4e0d\u4f1a\u8bfb\u51fa\u540e\u7eed\u7684\u683c\u5f0f\u3002\uff09 \u5f53\u8c03\u7528\u65f6\u4e0d\u4f20\u683c\u5f0f\uff0c\u5b83\u4f1a\u4f7f\u7528\u9ed8\u8ba4\u683c\u5f0f\u8bfb\u4e0b\u4e00\u884c\uff08\u89c1\u4e0b\u9762\u63cf\u8ff0\uff09\u3002  \u63d0\u4f9b\u7684\u683c\u5f0f\u6709   \"n\": \u8bfb\u53d6\u4e00\u4e2a\u6570\u5b57\uff0c\u6839\u636e Lua \u7684\u8f6c\u6362\u6587\u6cd5\uff0c\u53ef\u80fd\u8fd4\u56de\u6d6e\u70b9\u6570\u6216\u6574\u6570\u3002 \uff08\u6570\u5b57\u53ef\u4ee5\u6709\u524d\u7f6e\u6216\u540e\u7f6e\u7684\u7a7a\u683c\uff0c\u4ee5\u53ca\u7b26\u53f7\u3002\uff09 \u53ea\u8981\u80fd\u6784\u6210\u5408\u6cd5\u7684\u6570\u5b57\uff0c\u8fd9\u4e2a\u683c\u5f0f\u603b\u662f\u53bb\u8bfb\u5c3d\u91cf\u957f\u7684\u4e32\uff1b \u5982\u679c\u8bfb\u51fa\u6765\u7684\u524d\u7f00\u65e0\u6cd5\u6784\u6210\u5408\u6cd5\u7684\u6570\u5b57 \uff08\u6bd4\u5982\u7a7a\u4e32\uff0c\"0x\" \u6216 \"3.4e-\"\uff09\uff0c \u5c31\u4e2d\u6b62\u51fd\u6570\u8fd0\u884c\uff0c\u8fd4\u56de nil\u3002  \"i\": \u8bfb\u53d6\u4e00\u4e2a\u6574\u6570\uff0c\u8fd4\u56de\u6574\u6570\u503c\u3002  \"a\": \u4ece\u5f53\u524d\u4f4d\u7f6e\u5f00\u59cb\u8bfb\u53d6\u6574\u4e2a\u6587\u4ef6\u3002 \u5982\u679c\u5df2\u5728\u6587\u4ef6\u672b\u5c3e\uff0c\u8fd4\u56de\u7a7a\u4e32\u3002  \"l\": \u8bfb\u53d6\u4e00\u884c\u5e76\u5ffd\u7565\u884c\u7ed3\u675f\u6807\u8bb0\u3002 \u5f53\u5728\u6587\u4ef6\u672b\u5c3e\u65f6\uff0c\u8fd4\u56de nil \u8fd9\u662f\u9ed8\u8ba4\u683c\u5f0f\u3002  \"L\": \u8bfb\u53d6\u4e00\u884c\u5e76\u4fdd\u7559\u884c\u7ed3\u675f\u6807\u8bb0\uff08\u5982\u679c\u6709\u7684\u8bdd\uff09\uff0c \u5f53\u5728\u6587\u4ef6\u672b\u5c3e\u65f6\uff0c\u8fd4\u56de nil\u3002  number: \u8bfb\u53d6\u4e00\u4e2a\u4e0d\u8d85\u8fc7\u8fd9\u4e2a\u6570\u91cf\u5b57\u8282\u6570\u7684\u5b57\u7b26\u4e32\u3002 \u5f53\u5728\u6587\u4ef6\u672b\u5c3e\u65f6\uff0c\u8fd4\u56de nil\u3002 \u5982\u679c number \u4e3a\u96f6\uff0c \u5b83\u4ec0\u4e48\u4e5f\u4e0d\u8bfb\uff0c\u8fd4\u56de\u4e00\u4e2a\u7a7a\u4e32\u3002 \u5f53\u5728\u6587\u4ef6\u672b\u5c3e\u65f6\uff0c\u8fd4\u56de nil\u3002\n\u683c\u5f0f \"l\" \u548c \"L\" \u53ea\u80fd\u7528\u4e8e\u6587\u672c\u6587\u4ef6\u3002   5.4.16 file:seek ([whence [, offset]])  \u8bbe\u7f6e\u53ca\u83b7\u53d6\u57fa\u4e8e\u6587\u4ef6\u5f00\u5934\u5904\u8ba1\u7b97\u51fa\u7684\u4f4d\u7f6e\u3002 \u8bbe\u7f6e\u7684\u4f4d\u7f6e\u7531 offset \u548c whence \u5b57\u7b26\u4e32 whence \u6307\u5b9a\u7684\u57fa\u70b9\u51b3\u5b9a\u3002\u57fa\u70b9\u53ef\u4ee5\u662f\uff1a   \"set\": \u57fa\u70b9\u4e3a 0 \uff08\u6587\u4ef6\u5f00\u5934\uff09\uff1b  \"cur\": \u57fa\u70b9\u4e3a\u5f53\u524d\u4f4d\u7f6e\u4e86\uff1b  \"end\": \u57fa\u70b9\u4e3a\u6587\u4ef6\u5c3e\uff1b   \u5f53 seek \u6210\u529f\u65f6\uff0c\u8fd4\u56de\u6700\u7ec8\u4ece\u6587\u4ef6\u5f00\u5934\u8ba1\u7b97\u8d77\u7684\u6587\u4ef6\u7684\u4f4d\u7f6e\u3002 \u5f53 seek \u5931\u8d25\u65f6\uff0c\u8fd4\u56de nil \u52a0\u4e0a\u4e00\u4e2a\u9519\u8bef\u63cf\u8ff0\u5b57\u7b26\u4e32\u3002  whence \u7684\u9ed8\u8ba4\u503c\u662f \"cur\"\uff0c offset \u9ed8\u8ba4\u4e3a 0 \u3002 \u56e0\u6b64\uff0c\u8c03\u7528 file:seek() \u53ef\u4ee5\u8fd4\u56de\u6587\u4ef6\u5f53\u524d\u4f4d\u7f6e\uff0c\u5e76\u4e0d\u6539\u53d8\u5b83\uff1b \u8c03\u7528 file:seek(\"set\") \u5c06\u4f4d\u7f6e\u8bbe\u4e3a\u6587\u4ef6\u5f00\u5934\uff08\u5e76\u8fd4\u56de 0\uff09\uff1b \u8c03\u7528 file:seek(\"end\") \u5c06\u4f4d\u7f6e\u8bbe\u5230\u6587\u4ef6\u672b\u5c3e\uff0c\u5e76\u8fd4\u56de\u6587\u4ef6\u5927\u5c0f\u3002  5.4.17 file:setvbuf (mode [, size])  \u8bbe\u7f6e\u8f93\u51fa\u6587\u4ef6\u7684\u7f13\u51b2\u6a21\u5f0f\u3002 \u6709\u4e09\u79cd\u6a21\u5f0f\uff1a   \"no\": \u4e0d\u7f13\u51b2\uff1b\u8f93\u51fa\u64cd\u4f5c\u7acb\u523b\u751f\u6548\u3002  \"full\": \u5b8c\u5168\u7f13\u51b2\uff1b\u53ea\u6709\u5728\u7f13\u5b58\u6ee1\u6216\u5f53\u4f60\u663e\u5f0f\u7684\u5bf9\u6587\u4ef6\u8c03\u7528 flush \u65f6\u624d\u771f\u6b63\u505a\u8f93\u51fa\u64cd\u4f5c\u3002  \"line\": \u884c\u7f13\u51b2\uff1b \u8f93\u51fa\u5c06\u5230\u6bcf\u6b21\u6362\u884c\u524d\uff0c \u5bf9\u4e8e\u67d0\u4e9b\u7279\u6b8a\u6587\u4ef6\uff08\u4f8b\u5982\u7ec8\u7aef\u8bbe\u5907\uff09\u7f13\u51b2\u5230\u4efb\u4f55\u8f93\u5165\u524d\u3002\n\u5bf9\u4e8e\u540e\u4e24\u79cd\u60c5\u51b5\uff0csize \u4ee5\u5b57\u8282\u6570\u4e3a\u5355\u4f4d \u6307\u5b9a\u7f13\u51b2\u533a\u5927\u5c0f\u3002 \u9ed8\u8ba4\u4f1a\u6709\u4e00\u4e2a\u6070\u5f53\u7684\u5927\u5c0f\u3002   5.4.18 file:write (\u00b7\u00b7\u00b7)  \u5c06\u53c2\u6570\u7684\u503c\u9010\u4e2a\u5199\u5165 file\u3002 \u53c2\u6570\u5fc5\u987b\u662f\u5b57\u7b26\u4e32\u6216\u6570\u5b57\u3002  \u6210\u529f\u65f6\uff0c\u51fd\u6570\u8fd4\u56de file\u3002 \u5426\u5219\u8fd4\u56de nil \u52a0\u9519\u8bef\u63cf\u8ff0\u5b57\u7b26\u4e32\u3002  \u7b80\u5355 IO \u793a\u4f8b\u7a0b\u5e8f\uff1a  \u6570\u636e\u5199\u5165\u6587\u4ef6\uff1a  io.output(\"textfile\")  \nio.write(\"hello\", \"\\n\")\nio.write(\"lua\", \"\\n\")  \u8bfb\u53d6\u6587\u4ef6\u5185\u5bb9\uff1a  io.input(\"textfile\")   \nprint(io.read(\"*all\"))-- \u8bfb\u53d6\u6240\u6709  \u4e00\u884c\u4e00\u884c\u8bfb\u53d6\u6570\u636e\uff1a  io.input(\"textfile\")\n\nlocal mark = io.read(0)\nwhile mark do\n    print(io.read(\"*line\"))\n    mark = io.read(0)\n    if not mark then\n        print(\"File end.\")\n        break\n    end\nend  \u5b8c\u6210 IO \u6a21\u578b\u793a\u4f8b\u7a0b\u5e8f\uff1a  local textfile = io.open(\"textfile\", \"w+\")\nif textfile then\n    textfile:write(\"omg lua\\n\")\n    textfile:flush()    \n    textfile:close()\nend\n\nlocal textfile = io.open(\"textfile\", \"r\")\nif textfile then\n    print(textfile:read(\"*all\"))\n    textfile:close()\nend", 
            "title": "5.4 \u8f93\u5165\u8f93\u51fa\u5e93"
        }, 
        {
            "location": "/luamd/05/#55", 
            "text": "\u8fd9\u4e2a\u5e93\u90fd\u901a\u8fc7\u8868 os \u5b9e\u73b0\u3002  5.5.1 os.clock ()  \u8fd4\u56de\u7a0b\u5e8f\u4f7f\u7528\u7684\u6309\u79d2\u8ba1 CPU \u65f6\u95f4\u7684\u8fd1\u4f3c\u503c\u3002  5.5.2 os.date ([format [, time]])  \u8fd4\u56de\u4e00\u4e2a\u5305\u542b\u65e5\u671f\u53ca\u65f6\u523b\u7684\u5b57\u7b26\u4e32\u6216\u8868\u3002 \u683c\u5f0f\u5316\u65b9\u6cd5\u53d6\u51b3\u4e8e\u6240\u7ed9\u5b57\u7b26\u4e32 format\u3002  \u5982\u679c\u63d0\u4f9b\u4e86 time \u53c2\u6570\uff0c \u683c\u5f0f\u5316\u8fd9\u4e2a\u65f6\u95f4 \uff08\u8fd9\u4e2a\u503c\u7684\u542b\u4e49\u53c2\u89c1 os.time \u51fd\u6570\uff09\u3002 \u5426\u5219\uff0cdate \u683c\u5f0f\u5316\u5f53\u524d\u65f6\u95f4\u3002  \u5982\u679c format \u4ee5 '!' \u6253\u5934\uff0c \u65e5\u671f\u4ee5\u534f\u8c03\u4e16\u754c\u65f6\u683c\u5f0f\u5316\u3002 \u5728\u8fd9\u4e2a\u53ef\u9009\u5b57\u7b26\u9879\u4e4b\u540e\uff0c  \u5982\u679c format \u4e3a\u5b57\u7b26\u4e32  \"*t\"\uff0c  date \u8fd4\u56de\u6709\u540e\u7eed\u57df\u7684\u8868\uff1a year \uff08\u56db\u4f4d\u6570\u5b57\uff09\uff0cmonth \uff081\u201312\uff09\uff0cday \uff081\u201331\uff09\uff0c hour \uff080\u201323\uff09\uff0cmin \uff080\u201359\uff09\uff0csec \uff080\u201361\uff09\uff0c wday \uff08\u661f\u671f\u51e0\uff0c\u661f\u671f\u5929\u4e3a 1 \uff09\uff0c yday \uff08\u5f53\u5e74\u7684\u7b2c\u51e0\u5929\uff09\uff0c \u4ee5\u53ca isdst \uff08\u590f\u4ee4\u65f6\u6807\u8bb0\uff0c\u4e00\u4e2a\u5e03\u5c14\u91cf\uff09\u3002  \u5bf9\u4e8e\u6700\u540e\u4e00\u4e2a\u57df\uff0c\u5982\u679c\u8be5\u4fe1\u606f\u4e0d\u63d0\u4f9b\u7684\u8bdd\u5c31\u4e0d\u5b58\u5728\u3002  \u5982\u679c format \u5e76\u975e \"*t\"\uff0c date \u4ee5\u5b57\u7b26\u4e32\u5f62\u5f0f\u8fd4\u56de\uff0c \u683c\u5f0f\u5316\u65b9\u6cd5\u9075\u5faa ISO C \u51fd\u6570 strftime \u7684\u89c4\u5219\u3002  \u5982\u679c\u4e0d\u4f20\u53c2\u6570\u8c03\u7528\uff0c date \u8fd4\u56de\u4e00\u4e2a\u5408\u7406\u7684\u65e5\u671f\u65f6\u95f4\u4e32\uff0c \u683c\u5f0f\u53d6\u51b3\u4e8e\u5bbf\u4e3b\u7a0b\u5e8f\u4ee5\u53ca\u5f53\u524d\u7684\u533a\u57df\u8bbe\u7f6e \uff08\u5373\uff0cos.date() \u7b49\u4ef7\u4e8e os.date(\"%c\")\uff09\u3002  \u5728\u975e POSIX \u7cfb\u7edf\u4e0a\uff0c \u7531\u4e8e\u8fd9\u4e2a\u51fd\u6570\u4f9d\u8d56 C \u51fd\u6570 gmtime \u548c localtime\uff0c \u5b83\u53ef\u80fd\u5e76\u975e\u7ebf\u7a0b\u5b89\u5168\u7684\u3002  5.5.3 os.difftime (t2, t1)  \u8fd4\u56de\u4ee5\u79d2\u8ba1\u7b97\u7684\u65f6\u523b t1 \u5230 t2 \u7684\u5dee\u503c\u3002 \uff08\u8fd9\u91cc\u7684\u65f6\u523b\u662f\u7531 os.time \u8fd4\u56de\u7684\u503c\uff09\u3002 \u5728 POSIX\uff0cWindows\uff0c\u548c\u5176\u5b83\u4e00\u4e9b\u7cfb\u7edf\u4e2d\uff0c\u8fd9\u4e2a\u503c\u5c31\u7b49\u4e8e t2-t1\u3002  5.5.4 os.execute ([command])  \u8fd9\u4e2a\u51fd\u6570\u7b49\u4ef7\u4e8e ISO C \u51fd\u6570  system \u3002 \u5b83\u8c03\u7528\u7cfb\u7edf\u89e3\u91ca\u5668\u6267\u884c command\u3002 \u5982\u679c\u547d\u4ee4\u6210\u529f\u8fd0\u884c\u5b8c\u6bd5\uff0c\u7b2c\u4e00\u4e2a\u8fd4\u56de\u503c\u5c31\u662f true\uff0c \u5426\u5219\u662f nil otherwise\u3002 \u5728\u7b2c\u4e00\u4e2a\u8fd4\u56de\u503c\u4e4b\u540e\uff0c\u51fd\u6570\u8fd4\u56de\u4e00\u4e2a\u5b57\u7b26\u4e32\u52a0\u4e00\u4e2a\u6570\u5b57\u3002\u5982\u4e0b\uff1a  \"exit\": \u547d\u4ee4\u6b63\u5e38\u7ed3\u675f\uff1b \u63a5\u4e0b\u6765\u7684\u6570\u5b57\u662f\u547d\u4ee4\u7684\u9000\u51fa\u72b6\u6001\u7801\u3002\n\"signal\": \u547d\u4ee4\u88ab\u4fe1\u53f7\u6253\u65ad\uff1b \u63a5\u4e0b\u6765\u7684\u6570\u5b57\u662f\u6253\u65ad\u8be5\u547d\u4ee4\u7684\u4fe1\u53f7\u3002\n\u5982\u679c\u4e0d\u5e26\u53c2\u6570\u8c03\u7528\uff0c os.execute \u5728\u7cfb\u7edf\u89e3\u91ca\u5668\u5b58\u5728\u7684\u65f6\u5019\u8fd4\u56de\u771f\u3002  5.5.5 os.exit ([code [, close]])  \u8c03\u7528 ISO C \u51fd\u6570 exit \u7ec8\u6b62\u5bbf\u4e3b\u7a0b\u5e8f\u3002 \u5982\u679c code \u4e3a true\uff0c \u8fd4\u56de\u7684\u72b6\u6001\u7801\u662f EXIT_SUCCESS\uff1b \u5982\u679c code \u4e3a false\uff0c \u8fd4\u56de\u7684\u72b6\u6001\u7801\u662f EXIT_FAILURE\uff1b \u5982\u679c code \u662f\u4e00\u4e2a\u6570\u5b57\uff0c \u8fd4\u56de\u7684\u72b6\u6001\u7801\u5c31\u662f\u8fd9\u4e2a\u6570\u5b57\u3002 code \u7684\u9ed8\u8ba4\u503c\u4e3a true\u3002  \u5982\u679c\u7b2c\u4e8c\u4e2a\u53ef\u9009\u53c2\u6570 close \u4e3a\u771f\uff0c \u5728\u9000\u51fa\u524d\u5173\u95ed Lua \u72b6\u6001\u673a\u3002  5.5.6 os.getenv (varname)  \u8fd4\u56de\u8fdb\u7a0b\u73af\u5883\u53d8\u91cf varname \u7684\u503c\uff0c \u5982\u679c\u8be5\u53d8\u91cf\u672a\u5b9a\u4e49\uff0c\u8fd4\u56de nil \u3002  5.5.7 os.remove (filename)  \u5220\u9664\u6307\u5b9a\u540d\u5b57\u7684\u6587\u4ef6\uff08\u5728 POSIX \u7cfb\u7edf\u4e0a\u53ef\u4ee5\u662f\u4e00\u4e2a\u7a7a\u76ee\u5f55\uff09 \u5982\u679c\u51fd\u6570\u5931\u8d25\uff0c\u8fd4\u56de nil \u52a0\u4e00\u4e2a\u9519\u8bef\u63cf\u8ff0\u4e32\u53ca\u51fa\u9519\u7801\u3002  5.5.8 os.rename (oldname, newname)  \u5c06\u540d\u5b57\u4e3a oldname \u7684\u6587\u4ef6\u6216\u76ee\u5f55\u66f4\u540d\u4e3a newname\u3002  \u5982\u679c\u51fd\u6570\u5931\u8d25\uff0c\u8fd4\u56de nil \u52a0\u4e00\u4e2a\u9519\u8bef\u63cf\u8ff0\u4e32\u53ca\u51fa\u9519\u7801\u3002  5.5.9 os.setlocale (locale [, category])  \u8bbe\u7f6e\u7a0b\u5e8f\u7684\u5f53\u524d\u533a\u57df\u3002  locale \u662f\u4e00\u4e2a\u533a\u57df\u8bbe\u7f6e\u7684\u7cfb\u7edf\u76f8\u5173\u5b57\u7b26\u4e32\uff1b category \u662f\u4e00\u4e2a\u63cf\u8ff0\u6709\u6539\u53d8\u54ea\u4e2a\u5206\u7c7b\u7684\u53ef\u9009\u5b57\u7b26\u4e32\uff1a \"all\"\uff0c\"collate\"\uff0c \"ctype\"\uff0c \"monetary\"\uff0c \"numeric\"\uff0c \u6216 \"time\"\uff1b \u9ed8\u8ba4\u7684\u5206\u7c7b\u4e3a \"all\"\u3002 \u6b64\u51fd\u6570\u8fd4\u56de\u65b0\u533a\u57df\u7684\u540d\u5b57\u3002 \u5982\u679c\u8bf7\u6c42\u672a\u88ab\u83b7\u51c6\uff0c\u8fd4\u56de nil \u3002  \u5f53 locale \u662f\u4e00\u4e2a\u7a7a\u4e32\uff0c \u5f53\u524d\u533a\u57df\u88ab\u8bbe\u7f6e\u4e3a\u4e00\u4e2a\u5728\u5b9e\u73b0\u4e2d\u5b9a\u4e49\u597d\u7684\u672c\u5730\u533a\u57df\u3002 \u5f53 locale \u4e3a\u5b57\u7b26\u4e32 \"C\"\uff0c \u5f53\u524d\u533a\u57df\u88ab\u8bbe\u7f6e\u4e3a\u6807\u51c6 C \u533a\u57df\u3002  \u5f53\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a nil \u65f6\uff0c \u6b64\u51fd\u6570\u4ec5\u8fd4\u56de\u5f53\u524d\u533a\u57df\u6307\u5b9a\u5206\u7c7b\u7684\u540d\u5b57\u3002  \u7531\u4e8e\u8fd9\u4e2a\u51fd\u6570\u4f9d\u8d56 C \u51fd\u6570 setlocale\uff0c \u5b83\u53ef\u80fd\u5e76\u975e\u7ebf\u7a0b\u5b89\u5168\u7684\u3002  5.5.10 os.time ([table])  \u5f53\u4e0d\u4f20\u53c2\u6570\u65f6\uff0c\u8fd4\u56de\u5f53\u524d\u65f6\u523b\u3002 \u5982\u679c\u4f20\u5165\u4e00\u5f20\u8868\uff0c\u5c31\u8fd4\u56de\u7531\u8fd9\u5f20\u8868\u8868\u793a\u7684\u65f6\u523b\u3002 \u8fd9\u5f20\u8868\u5fc5\u987b\u5305\u542b\u57df year\uff0cmonth\uff0c\u53ca day\uff1b \u53ef\u4ee5\u5305\u542b\u6709\u3000hour \uff08\u9ed8\u8ba4\u4e3a 12 \uff09\uff0c min \uff08\u9ed8\u8ba4\u4e3a 0\uff09\uff0c sec \uff08\u9ed8\u8ba4\u4e3a 0\uff09\uff0c\u4ee5\u53ca isdst \uff08\u9ed8\u8ba4\u4e3a nil\uff09\u3002 \u5173\u4e8e\u8fd9\u4e9b\u57df\u7684\u8be6\u7ec6\u63cf\u8ff0\uff0c\u53c2\u89c1 os.date \u51fd\u6570\u3002  \u8fd4\u56de\u503c\u662f\u4e00\u4e2a\u542b\u4e49\u7531\u4f60\u7684\u7cfb\u7edf\u51b3\u5b9a\u7684\u6570\u5b57\u3002 \u5728 POSIX\uff0cWindows\uff0c\u548c\u5176\u5b83\u4e00\u4e9b\u7cfb\u7edf\u4e2d\uff0c \u8fd9\u4e2a\u6570\u5b57\u7edf\u8ba1\u4e86\u4ece\u6307\u5b9a\u65f6\u95f4\uff08\"epoch\"\uff09\u5f00\u59cb\u7ecf\u5386\u7684\u79d2\u6570\u3002 \u5bf9\u4e8e\u53e6\u5916\u7684\u7cfb\u7edf\uff0c\u5176\u542b\u4e49\u672a\u5b9a\u4e49\uff0c \u4f60\u53ea\u80fd\u628a time \u7684\u8fd4\u56de\u6570\u5b57\u7528\u4e8e os.date \u548c os.difftime \u7684\u53c2\u6570\u3002  5.5.11 os.tmpname ()  \u8fd4\u56de\u4e00\u4e2a\u53ef\u7528\u4e8e\u4e34\u65f6\u6587\u4ef6\u7684\u6587\u4ef6\u540d\u5b57\u7b26\u4e32\u3002 \u8fd9\u4e2a\u6587\u4ef6\u5728\u4f7f\u7528\u524d\u5fc5\u987b\u663e\u5f0f\u6253\u5f00\uff0c\u4e0d\u518d\u4f7f\u7528\u65f6\u9700\u8981\u663e\u5f0f\u5220\u9664\u3002  \u5728 POSIX \u7cfb\u7edf\u4e0a\uff0c \u8fd9\u4e2a\u51fd\u6570\u4f1a\u4ee5\u6b64\u6587\u4ef6\u540d\u521b\u5efa\u4e00\u4e2a\u6587\u4ef6\u4ee5\u56de\u907f\u5b89\u5168\u98ce\u9669\u3002 \uff08\u522b\u4eba\u53ef\u80fd\u672a\u7ecf\u5141\u8bb8\u5728\u83b7\u53d6\u5230\u8fd9\u4e2a\u6587\u4ef6\u540d\u5230\u521b\u5efa\u8be5\u6587\u4ef6\u4e4b\u95f4\u7684\u65f6\u523b\u521b\u5efa\u6b64\u6587\u4ef6\u3002\uff09 \u4f60\u4f9d\u65e7\u9700\u8981\u5728\u4f7f\u7528\u5b83\u7684\u65f6\u5019\u5148\u6253\u5f00\uff0c\u5e76\u6700\u540e\u5220\u9664\uff08\u5373\u4f7f\u4f60\u6ca1\u4f7f\u7528\u5230\uff09\u3002  \u53ea\u6709\u6709\u53ef\u80fd\uff0c\u4f60\u66f4\u5e94\u8be5\u4f7f\u7528 io.tmpfile\uff0c \u56e0\u4e3a\u8be5\u6587\u4ef6\u53ef\u4ee5\u5728\u7a0b\u5e8f\u7ed3\u675f\u65f6\u81ea\u52a8\u5220\u9664\u3002  \u793a\u4f8b1\uff1a  os.execute(\"ls\")  \u793a\u4f8b2 \u83b7\u53d6\u5f53\u524d\u65f6\u95f4:  local tb = os.date(\"*t\", os.time());\nfor i, v in pairs(tb) do\n      print(i, v);\nend  \u8fd0\u884c\u7ed3\u679c\uff1a  day     20\nmin     4\nhour    23\nsec     51\nwday    2\nisdst   true\nmonth   4\nyday    110\nyear    2015  \u5bf9\u4e8e\u5176\u5b83\u7684\u683c\u5f0f\u5b57\u7b26\u4e32\uff0cos.date\u4f1a\u5c06\u65e5\u671f\u683c\u5f0f\u5316\u4e3a\u4e00\u4e2a\u5b57\u7b26\u4e32  \u793a\u4f8b\uff1a  print(os.date(\"today is %A, in %B\"))      -- today is Monday, in April\nprint(os.date(\"%x\", 906000490))           -- 09/16/1998  \u6240\u6709\u683c\u5f0f\u5316\u5b57\u7b26\u4e32\u5982\u4e0b\uff1a   %a      \u4e00\u661f\u671f\u4e2d\u5929\u6570\u7684\u7b80\u5199                      \uff08Wed\uff09  %A      \u4e00\u661f\u671f\u4e2d\u5929\u6570\u7684\u5168\u79f0                      \uff08Wednesday\uff09  %b      \u6708\u4efd\u7684\u7b80\u5199                                  \uff08Sep\uff09  %B      \u6708\u4efd\u7684\u5168\u79f0                                  \uff08September\uff09  %c      \u65e5\u671f\u548c\u65f6\u95f4                                   \uff0809/16/98 23:48:10\uff09  %d      \u4e00\u4e2a\u6708\u4e2d\u7684\u7b2c\u51e0\u5929                          \uff0816\uff09[0 ~ 31]  %H      24\u5c0f\u65f6\u5236\u4e2d\u7684\u5c0f\u65f6\u6570                      \uff0823\uff09[00 ~ 23]  %I      12\u5c0f\u65f6\u5236\u4e2d\u7684\u5c0f\u65f6\u6570                       \uff0811\uff09[01 ~ 12]  %j      \u4e00\u5e74\u4e2d\u7684\u7b2c\u51e0\u5929                             \uff08259\uff09[01 ~ 366]  %M      \u5206\u949f\u6570                                       \uff0848\uff09[00 ~ 59]  %m      \u6708\u4efd\u6570                                       \uff0809\uff09[01 ~ 12]       %P      \"\u4e0a\u5348(am)\" \u6216 \"\u4e0b\u5348(pm)\"               (pm)  %S      \u79d2\u6570                                          \uff0810\uff09[00 ~ 59]  %w      \u4e00\u661f\u671f\u4e2d\u7684\u7b2c\u51e0\u5929                         \uff083\uff09[0 ~ 6 = \u661f\u671f\u5929 ~ \u661f\u671f\u516d]  %W\u3000\u3000\u4e00\u5e74\u4e2d\u7684\u7b2c\u51e0\u4e2a\u661f\u671f\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u30000 ~ 52\n%x      \u65e5\u671f                                          \uff0809/16/98\uff09\n%X      \u65f6\u95f4                                          \uff0823:48:10\uff09\n%y      \u4e24\u4f4d\u6570\u7684\u5e74\u4efd                               \uff0890\uff09[00 ~ 99]\n%Y      \u5b8c\u6574\u7684\u5e74\u4efd                                 \uff082009\uff09\n%%      \u5b57\u7b26\u4e32'%'", 
            "title": "5.5 \u64cd\u4f5c\u7cfb\u7edf\u5e93"
        }, 
        {
            "location": "/luamd/05/#56", 
            "text": "\u8fd9\u4e2a\u5e93\u63d0\u4f9b\u4e86 Lua \u7a0b\u5e8f\u8c03\u8bd5\u63a5\u53e3\u7684\u529f\u80fd\u3002 \u5176\u4e2d\u4e00\u4e9b\u51fd\u6570\u8fdd\u53cd\u4e86 Lua \u4ee3\u7801\u7684\u57fa\u672c\u5047\u5b9a \uff08\u4f8b\u5982\uff0c\u4e0d\u4f1a\u4ece\u51fd\u6570\u4e4b\u5916\u8bbf\u95ee\u51fd\u6570\u7684\u5c40\u90e8\u53d8\u91cf\uff1b \u7528\u6237\u6570\u636e\u7684\u5143\u8868\u4e0d\u4f1a\u88ab Lua \u4ee3\u7801\u4fee\u6539\uff1b Lua \u7a0b\u5e8f\u4e0d\u4f1a\u5d29\u6e83\uff09\uff0c \u56e0\u6b64\u5b83\u4eec\u6709\u53ef\u80fd\u5371\u5bb3\u5230\u5176\u5b83\u4ee3\u7801\u7684\u5b89\u5168\u6027\u3002 \u6b64\u5916\uff0c\u5e93\u91cc\u7684\u4e00\u4e9b\u51fd\u6570\u53ef\u80fd\u8fd0\u884c\u7684\u5f88\u6162\u3002  \u8fd9\u4e2a\u5e93\u91cc\u7684\u6240\u6709\u51fd\u6570\u90fd\u63d0\u4f9b\u5728\u8868 debug \u5185\u3002 \u6240\u6709\u64cd\u4f5c\u7ebf\u7a0b\u7684\u51fd\u6570\uff0c\u53ef\u9009\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u90fd\u662f\u9488\u5bf9\u7684\u7ebf\u7a0b\u3002 \u9ed8\u8ba4\u503c\u6c38\u8fdc\u662f\u5f53\u524d\u7ebf\u7a0b\u3002  5.6.1 debug.debug ()  \u8fdb\u5165\u4e00\u4e2a\u7528\u6237\u4ea4\u4e92\u6a21\u5f0f\uff0c\u8fd0\u884c\u7528\u6237\u8f93\u5165\u7684\u6bcf\u4e2a\u5b57\u7b26\u4e32\u3002 \u4f7f\u7528\u7b80\u5355\u7684\u547d\u4ee4\u4ee5\u53ca\u5176\u5b83\u8c03\u8bd5\u8bbe\u7f6e\uff0c\u7528\u6237\u53ef\u4ee5\u68c0\u9605\u5168\u5c40\u53d8\u91cf\u548c\u5c40\u90e8\u53d8\u91cf\uff0c \u6539\u53d8\u53d8\u91cf\u7684\u503c\uff0c\u8ba1\u7b97\u4e00\u4e9b\u8868\u8fbe\u5f0f\uff0c\u7b49\u7b49\u3002 \u8f93\u5165\u4e00\u884c\u4ec5\u5305\u542b cont \u7684\u5b57\u7b26\u4e32\u5c06\u7ed3\u675f\u8fd9\u4e2a\u51fd\u6570\uff0c \u8fd9\u6837\u8c03\u7528\u8005\u5c31\u53ef\u4ee5\u7ee7\u7eed\u5411\u4e0b\u8fd0\u884c\u3002  \u6ce8\u610f\uff0cdebug.debug \u8f93\u5165\u7684\u547d\u4ee4\u5728\u6587\u6cd5\u4e0a\u5e76\u6ca1\u6709\u5185\u5d4c\u5230\u4efb\u4f55\u51fd\u6570\u4e2d\uff0c \u56e0\u6b64\u4e0d\u80fd\u76f4\u63a5\u53bb\u8bbf\u95ee\u5c40\u90e8\u53d8\u91cf\u3002  5.6.2 debug.gethook ([thread])  \u8fd4\u56de\u4e09\u4e2a\u8868\u793a\u7ebf\u7a0b\u94a9\u5b50\u8bbe\u7f6e\u7684\u503c\uff1a \u5f53\u524d\u94a9\u5b50\u51fd\u6570\uff0c\u5f53\u524d\u94a9\u5b50\u63a9\u7801\uff0c\u5f53\u524d\u94a9\u5b50\u8ba1\u6570 \uff08debug.sethook \u8bbe\u7f6e\u7684\u90a3\u4e9b\uff09\u3002  5.6.3 debug.getinfo ([thread,] f [, what])  \u8fd4\u56de\u5173\u4e8e\u4e00\u4e2a\u51fd\u6570\u4fe1\u606f\u7684\u8868\u3002 \u4f60\u53ef\u4ee5\u76f4\u63a5\u63d0\u4f9b\u8be5\u51fd\u6570\uff0c \u4e5f\u53ef\u4ee5\u7528\u4e00\u4e2a\u6570\u5b57 f \u8868\u793a\u8be5\u51fd\u6570\u3002 \u6570\u5b57 f \u8868\u793a\u8fd0\u884c\u5728\u6307\u5b9a\u7ebf\u7a0b\u7684\u8c03\u7528\u6808\u5bf9\u5e94\u5c42\u6b21\u4e0a\u7684\u51fd\u6570\uff1a 0 \u5c42\u8868\u793a\u5f53\u524d\u51fd\u6570\uff08getinfo \u81ea\u8eab\uff09\uff1b 1 \u5c42\u8868\u793a\u8c03\u7528 getinfo \u7684\u51fd\u6570 \uff08\u9664\u975e\u662f\u5c3e\u8c03\u7528\uff0c\u8fd9\u79cd\u60c5\u51b5\u4e0d\u8ba1\u5165\u6808\uff09\uff1b\u7b49\u7b49\u3002 \u5982\u679c f \u662f\u4e00\u4e2a\u6bd4\u6d3b\u52a8\u51fd\u6570\u6570\u91cf\u8fd8\u5927\u7684\u6570\u5b57\uff0c getinfo \u8fd4\u56de nil\u3002  \u53ea\u6709\u5b57\u7b26\u4e32 what \u4e2d\u6709\u63cf\u8ff0\u8981\u586b\u5145\u54ea\u4e9b\u9879\uff0c \u8fd4\u56de\u7684\u8868\u53ef\u4ee5\u5305\u542b lua_getinfo \u80fd\u8fd4\u56de\u7684\u6240\u6709\u9879\u3002 what \u9ed8\u8ba4\u662f\u8fd4\u56de\u63d0\u4f9b\u7684\u9664\u5408\u6cd5\u884c\u53f7\u8868\u5916\u7684\u6240\u6709\u4fe1\u606f\u3002 \u5bf9\u4e8e\u9009\u9879 'f' \uff0c\u4f1a\u5728\u53ef\u80fd\u7684\u60c5\u51b5\u4e0b\uff0c\u589e\u52a0 func \u57df\u4fdd\u5b58\u51fd\u6570\u81ea\u8eab\u3002 \u5bf9\u4e8e\u9009\u9879 'L' \uff0c\u4f1a\u5728\u53ef\u80fd\u7684\u60c5\u51b5\u4e0b\uff0c\u589e\u52a0 activelines \u57df\u4fdd\u5b58\u5408\u6cd5\u884c\u53f7\u8868\u3002  \u4f8b\u5982,\u8868\u8fbe\u5f0f debug.getinfo(1,\"n\") \u8fd4\u56de\u5e26\u6709\u5f53\u524d\u51fd\u6570\u540d\u5b57\u4fe1\u606f\u7684\u8868\uff08\u5982\u679c\u627e\u7684\u5230\u540d\u5b57\u7684\u8bdd\uff09\uff0c \u8868\u8fbe\u5f0f debug.getinfo(print) \u8fd4\u56de\u5173\u4e8e print \u51fd\u6570\u7684 \u5305\u542b\u6709\u6240\u6709\u80fd\u63d0\u4f9b\u4fe1\u606f\u7684\u8868\u3002  5.6.4 debug.getlocal ([thread,] f, local)  \u6b64\u51fd\u6570\u8fd4\u56de\u5728\u6808\u7684 f \u5c42\u5904\u51fd\u6570\u7684\u7d22\u5f15\u4e3a local \u7684\u5c40\u90e8\u53d8\u91cf \u7684\u540d\u5b57\u548c\u503c\u3002 \u8fd9\u4e2a\u51fd\u6570\u4e0d\u4ec5\u7528\u4e8e\u8bbf\u95ee\u663e\u5f0f\u5b9a\u4e49\u7684\u5c40\u90e8\u53d8\u91cf\uff0c\u4e5f\u5305\u62ec\u5f62\u53c2\u3001\u4e34\u65f6\u53d8\u91cf\u7b49\u3002  \u7b2c\u4e00\u4e2a\u5f62\u53c2\u6216\u662f\u5b9a\u4e49\u7684\u7b2c\u4e00\u4e2a\u5c40\u90e8\u53d8\u91cf\u7684\u7d22\u5f15\u4e3a 1 \uff0c \u7136\u540e\u9075\u5faa\u5728\u4ee3\u7801\u4e2d\u5b9a\u4e49\u6b21\u5e8f\uff0c\u4ee5\u6b21\u7c7b\u63a8\u3002 \u5176\u4e2d\u53ea\u8ba1\u7b97\u51fd\u6570\u5f53\u524d\u4f5c\u7528\u57df\u7684\u6d3b\u52a8\u53d8\u91cf\u3002 \u8d1f\u7d22\u5f15\u6307\u53ef\u53d8\u53c2\u6570\uff1b -1 \u6307\u7b2c\u4e00\u4e2a\u53ef\u53d8\u53c2\u6570\u3002 \u5982\u679c\u8be5\u7d22\u5f15\u5904\u6ca1\u6709\u53d8\u91cf\uff0c\u51fd\u6570\u8fd4\u56de nil\u3002 \u82e5\u6307\u5b9a\u7684\u5c42\u6b21\u8d8a\u754c\uff0c\u629b\u51fa\u9519\u8bef\u3002 \uff08\u4f60\u53ef\u4ee5\u8c03\u7528 debug.getinfo \u6765\u68c0\u67e5\u5c42\u6b21\u662f\u5426\u5408\u6cd5\u3002\uff09  \u4ee5 '(' \uff08\u5f00\u62ec\u53f7\uff09\u6253\u5934\u7684\u53d8\u91cf\u540d\u8868\u793a\u6ca1\u6709\u540d\u5b57\u7684\u53d8\u91cf \uff08\u6bd4\u5982\u662f\u5faa\u73af\u63a7\u5236\u7528\u5230\u7684\u63a7\u5236\u53d8\u91cf\uff0c \u6216\u662f\u53bb\u9664\u4e86\u8c03\u8bd5\u4fe1\u606f\u7684\u4ee3\u7801\u5757\uff09\u3002  \u53c2\u6570 f \u4e5f\u53ef\u4ee5\u662f\u4e00\u4e2a\u51fd\u6570\u3002 \u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0cgetlocal \u4ec5\u8fd4\u56de\u51fd\u6570\u5f62\u53c2\u7684\u540d\u5b57\u3002  5.6.5 debug.getmetatable (value)  \u8fd4\u56de\u7ed9\u5b9a value \u7684\u5143\u8868\u3002 \u82e5\u5176\u6ca1\u6709\u5143\u8868\u5219\u8fd4\u56de nil \u3002  debug.getregistry ()  \u8fd4\u56de\u6ce8\u518c\u8868\u3002  5.6.6 debug.getupvalue (f, up)  \u6b64\u51fd\u6570\u8fd4\u56de\u51fd\u6570 f \u7684\u7b2c up \u4e2a\u4e0a\u503c\u7684\u540d\u5b57\u548c\u503c\u3002 \u5982\u679c\u8be5\u51fd\u6570\u6ca1\u6709\u90a3\u4e2a\u4e0a\u503c\uff0c\u8fd4\u56de nil \u3002  \u4ee5 '(' \uff08\u5f00\u62ec\u53f7\uff09\u6253\u5934\u7684\u53d8\u91cf\u540d\u8868\u793a\u6ca1\u6709\u540d\u5b57\u7684\u53d8\u91cf \uff08\u53bb\u9664\u4e86\u8c03\u8bd5\u4fe1\u606f\u7684\u4ee3\u7801\u5757\uff09\u3002  5.6.7 debug.getuservalue (u)  \u8fd4\u56de\u5173\u8054\u5728 u \u4e0a\u7684 Lua \u503c\u3002 \u5982\u679c u \u5e76\u975e\u7528\u6237\u6570\u636e\uff0c\u8fd4\u56de nil\u3002  5.6.8 debug.sethook ([thread,] hook, mask [, count])  \u5c06\u4e00\u4e2a\u51fd\u6570\u4f5c\u4e3a\u94a9\u5b50\u51fd\u6570\u8bbe\u5165\u3002 \u5b57\u7b26\u4e32 mask \u4ee5\u53ca\u6570\u5b57 count \u51b3\u5b9a\u4e86\u94a9\u5b50\u5c06\u5728\u4f55\u65f6\u8c03\u7528\u3002 \u63a9\u7801\u662f\u7531\u4e0b\u5217\u5b57\u7b26\u7ec4\u5408\u6210\u7684\u5b57\u7b26\u4e32\uff0c\u6bcf\u4e2a\u5b57\u7b26\u6709\u5176\u542b\u4e49\uff1a  'c': \u6bcf\u5f53 Lua \u8c03\u7528\u4e00\u4e2a\u51fd\u6570\u65f6\uff0c\u8c03\u7528\u94a9\u5b50\uff1b\n'r': \u6bcf\u5f53 Lua \u4ece\u4e00\u4e2a\u51fd\u6570\u5185\u8fd4\u56de\u65f6\uff0c\u8c03\u7528\u94a9\u5b50\uff1b\n'l': \u6bcf\u5f53 Lua \u8fdb\u5165\u65b0\u7684\u4e00\u884c\u65f6\uff0c\u8c03\u7528\u94a9\u5b50\u3002\n\u6b64\u5916\uff0c \u4f20\u5165\u4e00\u4e2a\u4e0d\u4e3a\u96f6\u7684 count \uff0c \u94a9\u5b50\u5c06\u5728\u6bcf\u8fd0\u884c count \u6761\u6307\u4ee4\u65f6\u8c03\u7528\u3002  \u5982\u679c\u4e0d\u4f20\u5165\u53c2\u6570\uff0c debug.sethook \u5173\u95ed\u94a9\u5b50\u3002  \u5f53\u94a9\u5b50\u88ab\u8c03\u7528\u65f6\uff0c \u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u89e6\u53d1\u8fd9\u6b21\u8c03\u7528\u7684\u4e8b\u4ef6\uff1a \"call\" \uff08\u6216 \"tail call\"\uff09\uff0c \"return\"\uff0c \"line\"\uff0c \"count\"\u3002 \u5bf9\u4e8e\u884c\u4e8b\u4ef6\uff0c \u94a9\u5b50\u7684\u7b2c\u4e8c\u4e2a\u53c2\u6570\u662f\u65b0\u7684\u884c\u53f7\u3002 \u5728\u94a9\u5b50\u5185\uff0c\u4f60\u53ef\u4ee5\u8c03\u7528 getinfo \uff0c\u6307\u5b9a\u7b2c 2 \u5c42\uff0c \u6765\u83b7\u5f97\u6b63\u5728\u8fd0\u884c\u7684\u51fd\u6570\u7684\u8be6\u7ec6\u4fe1\u606f \uff080 \u5c42\u6307 getinfo \u51fd\u6570\uff0c 1 \u5c42\u6307\u94a9\u5b50\u51fd\u6570\uff09\u3002  5.6.9 debug.setlocal ([thread,] level, local, value)  \u8fd9\u4e2a\u51fd\u6570\u5c06 value \u8d4b\u7ed9 \u6808\u4e0a\u7b2c level \u5c42\u51fd\u6570\u7684\u7b2c local \u4e2a\u5c40\u90e8\u53d8\u91cf\u3002 \u5982\u679c\u6ca1\u6709\u90a3\u4e2a\u53d8\u91cf\uff0c\u51fd\u6570\u8fd4\u56de nil \u3002 \u5982\u679c level \u8d8a\u754c\uff0c\u629b\u51fa\u4e00\u4e2a\u9519\u8bef\u3002 \uff08\u4f60\u53ef\u4ee5\u8c03\u7528 debug.getinfo \u6765\u68c0\u67e5\u5c42\u6b21\u662f\u5426\u5408\u6cd5\u3002\uff09 \u5426\u5219\uff0c\u5b83\u8fd4\u56de\u5c40\u90e8\u53d8\u91cf\u7684\u540d\u5b57\u3002  \u5173\u4e8e\u53d8\u91cf\u7d22\u5f15\u548c\u540d\u5b57\uff0c\u53c2\u89c1 debug.getlocal\u3002  5.6.10 debug.setmetatable (value, table)  \u5c06 value \u7684\u5143\u8868\u8bbe\u4e3a table \uff08\u53ef\u4ee5\u662f nil\uff09\u3002 \u8fd4\u56de value\u3002  5.6.11 debug.setupvalue (f, up, value)  \u8fd9\u4e2a\u51fd\u6570\u5c06 value \u8bbe\u4e3a\u51fd\u6570 f \u7684\u7b2c up \u4e2a\u4e0a\u503c\u3002 \u5982\u679c\u51fd\u6570\u6ca1\u6709\u90a3\u4e2a\u4e0a\u503c\uff0c\u8fd4\u56de nil \u5426\u5219\uff0c\u8fd4\u56de\u8be5\u4e0a\u503c\u7684\u540d\u5b57\u3002  5.6.12 debug.setuservalue (udata, value)  \u5c06 value \u8bbe\u4e3a udata \u7684\u5173\u8054\u503c\u3002 udata \u5fc5\u987b\u662f\u4e00\u4e2a\u5b8c\u5168\u7528\u6237\u6570\u636e\u3002  \u8fd4\u56de udata\u3002  5.6.13 debug.traceback ([thread,] [message [, level]])  \u5982\u679c message \u6709\uff0c\u4e14\u4e0d\u662f\u5b57\u7b26\u4e32\u6216 nil\uff0c \u51fd\u6570\u4e0d\u505a\u4efb\u4f55\u5904\u7406\u76f4\u63a5\u8fd4\u56de message\u3002 \u5426\u5219\uff0c\u5b83\u8fd4\u56de\u8c03\u7528\u6808\u7684\u6808\u56de\u6eaf\u4fe1\u606f\u3002 \u5b57\u7b26\u4e32\u53ef\u9009\u9879 message \u88ab\u6dfb\u52a0\u5728\u6808\u56de\u6eaf\u4fe1\u606f\u7684\u5f00\u5934\u3002 \u6570\u5b57\u53ef\u9009\u9879 level \u6307\u660e\u4ece\u6808\u7684\u54ea\u4e00\u5c42\u5f00\u59cb\u56de\u6eaf \uff08\u9ed8\u8ba4\u4e3a 1 \uff0c\u5373\u8c03\u7528 traceback \u7684\u90a3\u91cc\uff09\u3002  5.6.14 debug.upvalueid (f, n)  \u8fd4\u56de\u6307\u5b9a\u51fd\u6570\u7b2c n \u4e2a\u4e0a\u503c\u7684\u552f\u4e00\u6807\u8bc6\u7b26\uff08\u4e00\u4e2a\u8f7b\u91cf\u7528\u6237\u6570\u636e\uff09\u3002  \u8fd9\u4e2a\u552f\u4e00\u6807\u8bc6\u7b26\u53ef\u4ee5\u8ba9\u7a0b\u5e8f\u68c0\u67e5\u4e24\u4e2a\u4e0d\u540c\u7684\u95ed\u5305\u662f\u5426\u5171\u4eab\u4e86\u4e0a\u503c\u3002 \u82e5 Lua \u95ed\u5305\u4e4b\u95f4\u5171\u4eab\u7684\u662f\u540c\u4e00\u4e2a\u4e0a\u503c \uff08\u5373\u6307\u5411\u4e00\u4e2a\u5916\u90e8\u5c40\u90e8\u53d8\u91cf\uff09\uff0c\u4f1a\u8fd4\u56de\u76f8\u540c\u7684\u6807\u8bc6\u7b26\u3002  5.6.15 debug.upvaluejoin (f1, n1, f2, n2)  \u8ba9 Lua \u95ed\u5305 f1 \u7684\u7b2c n1 \u4e2a\u4e0a\u503c \u5f15\u7528 Lua \u95ed\u5305 f2 \u7684\u7b2c n2 \u4e2a\u4e0a\u503c\u3002", 
            "title": "5.6 \u8c03\u8bd5\u5e93"
        }, 
        {
            "location": "/luamd/06/", 
            "text": "\u8fd9\u4e2a\u90e8\u5206\u63cf\u8ff0\u4e86 Lua \u7684 C API \uff0c \u4e5f\u5c31\u662f\u5bbf\u4e3b\u7a0b\u5e8f\u8ddf Lua \u901a\u8baf\u7528\u7684\u4e00\u7ec4 C \u51fd\u6570\u3002 \u6240\u6709\u7684 API \u51fd\u6570\u6309\u76f8\u5173\u7684\u7c7b\u578b\u4ee5\u53ca\u5e38\u91cf\u90fd\u58f0\u660e\u5728\u5934\u6587\u4ef6 lua.h \u4e2d\u3002\n\n\n\u867d\u7136\u6211\u4eec\u8bf4\u7684\u662f\u201c\u51fd\u6570\u201d\uff0c \u4f46\u4e00\u90e8\u5206\u7b80\u5355\u7684 API \u662f\u4ee5\u5b8f\u7684\u5f62\u5f0f\u63d0\u4f9b\u7684\u3002 \u9664\u975e\u53e6\u6709\u8bf4\u660e\uff0c \u6240\u6709\u7684\u8fd9\u4e9b\u5b8f\u90fd\u53ea\u4f7f\u7528\u5b83\u4eec\u7684\u53c2\u6570\u4e00\u6b21 \uff08\u9664\u4e86\u7b2c\u4e00\u4e2a\u53c2\u6570\uff0c\u90a3\u4e00\u5b9a\u662f Lua \u72b6\u6001\uff09\uff0c \u56e0\u6b64\u4f60\u4e0d\u9700\u62c5\u5fc3\u8fd9\u4e9b\u5b8f\u7684\u5c55\u5f00\u4f1a\u5f15\u8d77\u4e00\u4e9b\u526f\u4f5c\u7528\u3002\n\n\nC \u5e93\u4e2d\u6240\u6709\u7684 Lua API \u51fd\u6570\u90fd\u4e0d\u53bb\u68c0\u67e5\u53c2\u6570\u662f\u5426\u76f8\u5bb9\u53ca\u6709\u6548\u3002 \u7136\u800c\uff0c\u4f60\u53ef\u4ee5\u5728\u7f16\u8bd1 Lua \u65f6\u52a0\u4e0a\u6253\u5f00\u4e00\u4e2a\u5b8f\u5f00\u5173 LUA_USE_APICHECK \u6765\u6539\u53d8\u8fd9\u4e2a\u884c\u4e3a\u3002\n\n\n6.1 \u6808\n\n\nLua \u4f7f\u7528\u4e00\u4e2a \u865a\u62df\u6808 \u6765\u548c C \u4e92\u4f20\u503c\u3002\u6808\u4e0a\u7684\u7684\u6bcf\u4e2a\u5143\u7d20\u90fd\u662f\u4e00\u4e2a Lua \u503c \uff08nil\uff0c\u6570\u5b57\uff0c\u5b57\u7b26\u4e32\uff0c\u7b49\u7b49\uff09\u3002\n\n\n\u65e0\u8bba\u4f55\u65f6 Lua \u8c03\u7528 C\uff0c\u88ab\u8c03\u7528\u7684\u51fd\u6570\u90fd\u5f97\u5230\u4e00\u4e2a\u65b0\u7684\u6808\uff0c \u8fd9\u4e2a\u6808\u72ec\u7acb\u4e8e C \u51fd\u6570\u672c\u8eab\u7684\u6808\uff0c\u4e5f\u72ec\u7acb\u4e8e\u4e4b\u524d\u7684 Lua \u6808\u3002 \u5b83\u91cc\u9762\u5305\u542b\u4e86 Lua \u4f20\u9012\u7ed9 C \u51fd\u6570\u7684\u6240\u6709\u53c2\u6570\uff0c \u800c C \u51fd\u6570\u5219\u628a\u8981\u8fd4\u56de\u7684\u7ed3\u679c\u653e\u5165\u8fd9\u4e2a\u6808\u4ee5\u8fd4\u56de\u7ed9\u8c03\u7528\u8005 \uff08\u53c2\u89c1 lua_CFunction\uff09\u3002\n\n\n\u65b9\u4fbf\u8d77\u89c1\uff0c \u6240\u6709\u9488\u5bf9\u6808\u7684 API \u67e5\u8be2\u64cd\u4f5c\u90fd\u4e0d\u4e25\u683c\u9075\u5faa\u6808\u7684\u64cd\u4f5c\u89c4\u5219\u3002 \n\u800c\u662f\u53ef\u4ee5\u7528\u4e00\u4e2a \u7d22\u5f15 \u6765\u6307\u5411\u6808\u4e0a\u7684\u4efb\u4f55\u5143\u7d20\uff1a \u6b63\u7684\u7d22\u5f15\u6307\u7684\u662f\u6808\u4e0a\u7684\u7edd\u5bf9\u4f4d\u7f6e\uff08\u4ece1\u5f00\u59cb\uff09\uff1b \u8d1f\u7684\u7d22\u5f15\u5219\u6307\u4ece\u6808\u9876\u5f00\u59cb\u7684\u504f\u79fb\u91cf\u3002\n \u5c55\u5f00\u6765\u8bf4\uff0c\u5982\u679c\u5806\u6808\u6709 n \u4e2a\u5143\u7d20\uff0c \u90a3\u4e48\u7d22\u5f15 1 \u8868\u793a\u7b2c\u4e00\u4e2a\u5143\u7d20 \uff08\u4e5f\u5c31\u662f\u6700\u5148\u88ab\u538b\u6808\u7684\u5143\u7d20\uff09 \u800c\u7d22\u5f15 n \u5219\u6307\u6700\u540e\u4e00\u4e2a\u5143\u7d20\uff1b \u7d22\u5f15 -1 \u4e5f\u662f\u6307\u6700\u540e\u4e00\u4e2a\u5143\u7d20 \uff08\u5373\u6808\u9876\u7684\u5143\u7d20\uff09\uff0c \u7d22\u5f15 -n \u662f\u6307\u7b2c\u4e00\u4e2a\u5143\u7d20\u3002\n\n\n6.2 \u6808\u5927\u5c0f\n\n\n\u5f53\u4f60\u4f7f\u7528 Lua API \u65f6\uff0c \u5c31\u6709\u8d23\u4efb\u4fdd\u8bc1\u505a\u6070\u5f53\u7684\u8c03\u7528\u3002 \u7279\u522b\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c \u4f60\u6709\u8d23\u4efb\u63a7\u5236\u4e0d\u8981\u5806\u6808\u6ea2\u51fa\u3002 \u4f60\u53ef\u4ee5\n\u4f7f\u7528 lua_checkstack \u8fd9\u4e2a\u51fd\u6570\u6765\u6269\u5927\u53ef\u7528\u5806\u6808\u7684\u5c3a\u5bf8\u3002\n\n\n\u65e0\u8bba\u4f55\u65f6 Lua \u8c03\u7528 C \uff0c \u5b83\u90fd\u53ea\u4fdd\u8bc1\u81f3\u5c11\u6709 LUA_MINSTACK \u8fd9\u4e48\u591a\u7684\u5806\u6808\u7a7a\u95f4\u53ef\u4ee5\u4f7f\u7528\u3002 \nLUA_MINSTACK \u4e00\u822c\u88ab\u5b9a\u4e49\u4e3a 20 \n\uff0c \u56e0\u6b64\uff0c\u53ea\u8981\u4f60\u4e0d\u662f\u4e0d\u65ad\u7684\u628a\u6570\u636e\u538b\u6808\uff0c \u901a\u5e38\u4f60\u4e0d\u7528\u5173\u5fc3\u5806\u6808\u5927\u5c0f\u3002\n\n\n\u5f53\u4f60\u8c03\u7528\u4e00\u4e2a Lua \u51fd\u6570\u5374\u6ca1\u6709\u6307\u5b9a\u8981\u63a5\u6536\u591a\u5c11\u4e2a\u8fd4\u56de\u503c\u65f6 \uff08\u53c2\u89c1 lua_call\uff09\uff0clua \u53ef\u4ee5\u4fdd\u8bc1\u6808\u4e00\u5b9a\u6709\u8db3\u591f\u7684\u7a7a\u95f4\u6765\u63a5\u6536\u6240\u6709\u7684\u8fd4\u56de\u503c\uff0c \u4f46\u4e0d\u4fdd\u8bc1\u6b64\u5916\u7559\u6709\u989d\u5916\u7684\u7a7a\u95f4\u3002 \u56e0\u6b64\uff0c\u5728\u505a\u4e86\u4e00\u6b21\u8fd9\u6837\u7684\u8c03\u7528\u540e\uff0c\u5982\u679c\u4f60\u9700\u8981\u7ee7\u7eed\u538b\u6808\uff0c \u5219\u9700\u8981\u4f7f\u7528 lua_checkstack\u3002\n\n\n6.3 \u6709\u6548\u7d22\u5f15\u4e0e\u53ef\u63a5\u53d7\u7d22\u5f15\n\n\nAPI \u4e2d\u7684\u51fd\u6570\u82e5\u9700\u8981\u4f20\u5165\u6808\u7d22\u5f15\uff0c\u8fd9\u4e2a\u7d22\u5f15\u5fc5\u987b\u662f \u6709\u6548\u7d22\u5f15 \u6216\u662f \u53ef\u63a5\u53d7\u7d22\u5f15\u3002\n\n\n\u6709\u6548\u7d22\u5f15 \u6307\u5f15\u7528\u6808\u5185\u771f\u5b9e\u4f4d\u7f6e\u7684\u7d22\u5f15\uff1b \u5373\u5728 1 \u5230\u6808\u9876\u4e4b\u95f4\u7684\u4f4d\u7f6e \uff081 \u2264 abs(index) \u2264 top\uff09\u3002\n \u901a\u5e38\uff0c\u4e00\u4e2a\u53ef\u80fd\u4fee\u6539\u8be5\u4f4d\u7f6e\u7684\u503c\u7684\u51fd\u6570\u9700\u8981\u4f20\u5165\u6709\u6548\u7d22\u5f15\u3002\n\n\n\u9664\u975e\u53e6\u6709\u8bf4\u660e\uff0c \u4efb\u4f55\u53ef\u4ee5\u63a5\u53d7\u6709\u6548\u7d22\u5f15\u7684\u51fd\u6570\u540c\u65f6\u4e5f\u63a5\u53d7 \u4f2a\u7d22\u5f15\u3002 \u4f2a\u7d22\u5f15\u6307\u4ee3\u4e00\u4e9b\u53ef\u4ee5\u88ab C code \u8bbf\u95ee\u5f97\u5230 Lua \u503c\uff0c\u800c\u5b83\u4eec\u53c8\u4e0d\u5728\u6808\u5185\u3002 \u8fd9\u7528\u4e8e\u8bbf\u95ee\u6ce8\u518c\u8868\u4ee5\u53ca C \u51fd\u6570\u7684\u4e0a\u503c\uff08\u53c2\u89c1 \u00a76.4\uff09\u3002\n\n\n\u5bf9\u4e8e\u90a3\u4e9b\u53ea\u662f\u9700\u8981\u6808\u4e2d\u7684\u503c\uff08\u4f8b\u5982\u67e5\u8be2\u51fd\u6570\uff09 \u800c\u4e0d\u9700\u8981\u6307\u5b9a\u4e00\u4e2a\u6808\u4f4d\u7f6e\u7684\u51fd\u6570\uff0c \u53ef\u4ee5\u7528\u4e00\u4e2a\u53ef\u63a5\u53d7\u7684\u7d22\u5f15\u53bb\u8c03\u7528\u5b83\u4eec\u3002 \u53ef\u63a5\u53d7\u7d22\u5f15 \u4e0d\u4ec5\u53ef\u4ee5\u662f\u4efb\u4f55\u5305\u62ec\u4f2a\u7d22\u5f15\u5728\u5185\u7684\u6709\u6548\u7d22\u5f15\uff0c \u8fd8\u53ef\u4ee5\u662f\u4efb\u4f55\u8d85\u8fc7\u6808\u9876\u4f46\u843d\u5728\u4e3a\u6808\u5206\u914d\u51fa\u6765\u7684\u7a7a\u95f4\u5185\u7684\u6b63\u7d22\u5f15\u3002 \uff08\u6ce8\u610f 0 \u6c38\u8fdc\u90fd\u4e0d\u662f\u4e00\u4e2a\u53ef\u63a5\u53d7\u7d22\u5f15\u3002\uff09 \u9664\u975e\u53e6\u6709\u8bf4\u660e\uff0cAPI \u91cc\u7684\u51fd\u6570\u90fd\u63a5\u53d7\u53ef\u63a5\u53d7\u7d22\u5f15\u3002\n\n\n\u5141\u8bb8\u53ef\u63a5\u53d7\u7d22\u5f15\u662f\u4e3a\u4e86\u907f\u514d\u5bf9\u6808\u9876\u4ee5\u5916\u7684\u67e5\u8be2\u65f6\u505a\u989d\u5916\u7684\u68c0\u67e5\u3002 \u4f8b\u5982\uff0cC \u51fd\u6570\u53ef\u4ee5\u76f4\u63a5\u67e5\u8be2\u4f20\u7ed9\u5b83\u7684\u7b2c\u4e09\u4e2a\u53c2\u6570\uff0c \u800c\u4e0d\u7528\u5148\u68c0\u67e5\u662f\u4e0d\u662f\u6709\u7b2c\u4e09\u4e2a\u53c2\u6570\uff0c \u5373\u4e0d\u9700\u8981\u68c0\u67e5 3 \u662f\u4e0d\u662f\u4e00\u4e2a\u6709\u6548\u7d22\u5f15\u3002\n\n\n\u5bf9\u4e8e\u90a3\u4e9b\u4ee5\u53ef\u63a5\u53d7\u7d22\u5f15\u8c03\u7528\u7684\u51fd\u6570\uff0c \u65e0\u6548\u7d22\u5f15\u88ab\u770b\u4f5c\u5305\u542b\u4e86\u4e00\u4e2a\u865a\u62df\u7c7b\u578b LUA_TNONE \u7684\u503c\uff0c \u8fd9\u4e2a\u503c\u7684\u884c\u4e3a\u548c nil \u4e00\u81f4\u3002\n\n\n6.4 C \u95ed\u5305\n\n\n\u5f53 C \u51fd\u6570\u88ab\u521b\u5efa\u51fa\u6765\uff0c \u6211\u4eec\u6709\u53ef\u80fd\u4f1a\u628a\u4e00\u4e9b\u503c\u5173\u8054\u5728\u4e00\u8d77\uff0c \u4e5f\u5c31\u662f\u521b\u5efa\u4e00\u4e2a C \u95ed\u5305\n \uff08\u53c2\u89c1 lua_pushcclosure\uff09\uff1b \u8fd9\u4e9b\u88ab\u5173\u8054\u8d77\u6765\u7684\u503c\u88ab\u53eb\u505a \u4e0a\u503c \uff0c \u5b83\u4eec\u53ef\u4ee5\u5728\u51fd\u6570\u88ab\u8c03\u7528\u7684\u65f6\u5019\u8bbf\u95ee\u7684\u5230\u3002\n\n\n\u65e0\u8bba\u4f55\u65f6\u53bb\u8c03\u7528 C \u51fd\u6570\uff0c \u51fd\u6570\u7684\u4e0a\u503c\u90fd\u53ef\u4ee5\u7528\u4f2a\u7d22\u5f15\u5b9a\u4f4d\u3002 \u6211\u4eec\u53ef\u4ee5\u7528 lua_upvalueindex \u8fd9\u4e2a\u5b8f\u6765\u751f\u6210\u8fd9\u4e9b\u4f2a\u7d22\u5f15\u3002 \u7b2c\u4e00\u4e2a\u5173\u8054\u5230\u51fd\u6570\u7684\u503c\u653e\u5728 lua_upvalueindex(1) \u4f4d\u7f6e\u5904\uff0c\u4f9d\u6b64\u7c7b\u63a8\u3002 \u4f7f\u7528 lua_upvalueindex(n) \u65f6\uff0c \u82e5 n \u5927\u4e8e\u5f53\u524d\u51fd\u6570\u7684\u603b\u4e0a\u503c\u4e2a\u6570 \uff08\u4f46\u4e0d\u53ef\u4ee5\u5927\u4e8e 256\uff09\u4f1a\u4ea7\u751f\u4e00\u4e2a\u53ef\u63a5\u53d7\u7684\u4f46\u65e0\u6548\u7684\u7d22\u5f15\u3002\n\n\n6.5 lua C\u63a5\u53e3\n\n\nlua\u63d0\u4f9b\u4e86\u4e00\u4e9b\u7cfb\u5217C\u51fd\u6570\u6765\u548cC\u8bed\u8a00\u4ea4\u4e92(\u901a\u8fc7\u865a\u62df\u6808\u6765\u4ea4\u4e92)\u3002\u4e0b\u6587\u5217\u51fa\u4e86\u90e8\u5206\u51fd\u6570\uff0c\u66f4\u591a\u51fd\u6570\u548c\u8bf4\u660e\u8bf7\u53c2\u8003\n\u5b98\u65b9\u6587\u6863\u4e2d\u6587\u7248\n\u3002\n\n\n6.5.1 lua_checkstack\n\n\n[-0, +0, \u2013]\nint lua_checkstack (lua_State *L, int n);\n\u786e\u4fdd\u5806\u6808\u4e0a\u81f3\u5c11\u6709 n \u4e2a\u989d\u5916\u7a7a\u4f4d\u3002 \u5982\u679c\u4e0d\u80fd\u628a\u5806\u6808\u6269\u5c55\u5230\u76f8\u5e94\u7684\u5c3a\u5bf8\uff0c\u51fd\u6570\u8fd4\u56de\u5047\u3002 \u5931\u8d25\u7684\u539f\u56e0\u5305\u62ec\u5c06\u628a\u6808\u6269\u5c55\u5230\u6bd4\u56fa\u5b9a\u6700\u5927\u5c3a\u5bf8\u8fd8\u5927 \uff08\u81f3\u5c11\u662f\u51e0\u5343\u4e2a\u5143\u7d20\uff09\u6216\u5206\u914d\u5185\u5b58\u5931\u8d25\u3002 \u8fd9\u4e2a\u51fd\u6570\u6c38\u8fdc\u4e0d\u4f1a\u7f29\u5c0f\u5806\u6808\uff1b \u5982\u679c\u5806\u6808\u5df2\u7ecf\u6bd4\u9700\u8981\u7684\u5927\u4e86\uff0c\u90a3\u4e48\u5c31\u4fdd\u6301\u539f\u6837\u3002\n\n\n6.5.2 lua_close\n\n\n[-0, +0, \u2013]\nvoid lua_close (lua_State *L);\n\u9500\u6bc1\u6307\u5b9a Lua \u72b6\u6001\u673a\u4e2d\u7684\u6240\u6709\u5bf9\u8c61 \uff08\u5982\u679c\u6709\u5783\u573e\u6536\u96c6\u76f8\u5173\u7684\u5143\u65b9\u6cd5\u7684\u8bdd\uff0c\u4f1a\u8c03\u7528\u5b83\u4eec\uff09\uff0c \u5e76\u4e14\u91ca\u653e\u72b6\u6001\u673a\u4e2d\u4f7f\u7528\u7684\u6240\u6709\u52a8\u6001\u5185\u5b58\u3002 \u5728\u4e00\u4e9b\u5e73\u53f0\u4e0a\uff0c\u4f60\u53ef\u4ee5\u4e0d\u5fc5\u8c03\u7528\u8fd9\u4e2a\u51fd\u6570\uff0c \u56e0\u4e3a\u5f53\u5bbf\u4e3b\u7a0b\u5e8f\u7ed3\u675f\u7684\u65f6\u5019\uff0c\u6240\u6709\u7684\u8d44\u6e90\u5c31\u81ea\u7136\u88ab\u91ca\u653e\u6389\u4e86\u3002 \u53e6\u4e00\u65b9\u9762\uff0c\u957f\u671f\u8fd0\u884c\u7684\u7a0b\u5e8f\uff0c\u6bd4\u5982\u4e00\u4e2a\u540e\u53f0\u7a0b\u5e8f\u6216\u662f\u4e00\u4e2a\u7f51\u7ad9\u670d\u52a1\u5668\uff0c \u4f1a\u521b\u5efa\u51fa\u591a\u4e2a Lua \u72b6\u6001\u673a\u3002\u90a3\u4e48\u5c31\u5e94\u8be5\u5728\u4e0d\u9700\u8981\u65f6\u8d76\u7d27\u5173\u95ed\u5b83\u4eec\u3002\n\n\n6.5.3 lua_getglobal\n\n\n[-0, +1, e]\nint lua_getglobal (lua_State \nL, const char \nname);\n\u628a\u5168\u5c40\u53d8\u91cf name \u91cc\u7684\u503c\u538b\u6808\uff0c\u8fd4\u56de\u8be5\u503c\u7684\u7c7b\u578b\u3002\n\n\n6.5.4 lua_isnumber\n\n\n[-0, +0, \u2013]\nint lua_isnumber (lua_State *L, int index);\n\u5f53\u7ed9\u5b9a\u7d22\u5f15\u7684\u503c\u662f\u4e00\u4e2a\u6570\u5b57\uff0c\u6216\u662f\u4e00\u4e2a\u53ef\u8f6c\u6362\u4e3a\u6570\u5b57\u7684\u5b57\u7b26\u4e32\u65f6\uff0c\u8fd4\u56de 1 \uff0c\u5426\u5219\u8fd4\u56de 0 \u3002\n\n\n6.5.5 lua_isstring\n\n\n[-0, +0, \u2013]\nint lua_isstring (lua_State *L, int index);\n\u5f53\u7ed9\u5b9a\u7d22\u5f15\u7684\u503c\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\u6216\u662f\u4e00\u4e2a\u6570\u5b57 \uff08\u6570\u5b57\u603b\u80fd\u8f6c\u6362\u6210\u5b57\u7b26\u4e32\uff09\u65f6\uff0c\u8fd4\u56de 1 \uff0c\u5426\u5219\u8fd4\u56de 0 \u3002\n\n\n6.5.6 lua_newstate\n\n\n[-0, +0, \u2013]\nlua_State \nlua_newstate (lua_Alloc f, void \nud);\n\u521b\u5efa\u4e00\u4e2a\u8fd0\u884c\u5728\u65b0\u7684\u72ec\u7acb\u7684\u72b6\u6001\u673a\u4e2d\u7684\u7ebf\u7a0b\u3002 \u5982\u679c\u65e0\u6cd5\u521b\u5efa\u7ebf\u7a0b\u6216\u72b6\u6001\u673a\uff08\u7531\u4e8e\u5185\u5b58\u6709\u9650\uff09\u5219\u8fd4\u56de NULL\u3002 \u53c2\u6570 f \u662f\u4e00\u4e2a\u5206\u914d\u5668\u51fd\u6570\uff1b Lua \u5c06\u901a\u8fc7\u8fd9\u4e2a\u51fd\u6570\u505a\u72b6\u6001\u673a\u5185\u6240\u6709\u7684\u5185\u5b58\u5206\u914d\u64cd\u4f5c\u3002 \u7b2c\u4e8c\u4e2a\u53c2\u6570 ud \uff0c\u8fd9\u4e2a\u6307\u9488\u5c06\u5728\u6bcf\u6b21\u8c03\u7528\u5206\u914d\u5668\u65f6\u88ab\u8f6c\u5165\u3002\n\n\n6.5.7 lua_newtable\n\n\n[-0, +1, e]\nvoid lua_newtable (lua_State *L);\n\u521b\u5efa\u4e00\u5f20\u7a7a\u8868\uff0c\u5e76\u5c06\u5176\u538b\u6808\u3002 \u5b83\u7b49\u4ef7\u4e8e lua_createtable(L, 0, 0) \u3002\n\n\n6.6 \u8f85\u52a9\u5e93\n\n\n\u8f85\u52a9\u5e93\u63d0\u4f9b\u4e86\u4e00\u4e9b\u4fbf\u6377\u51fd\u6570\uff0c\u65b9\u4fbf\u5728 C \u4e2d\u4e3a Lua \u7f16\u7a0b\u3002 \u57fa\u7840 API \u63d0\u4f9b\u4e86 C \u548c Lua \u4ea4\u4e92\u7528\u7684\u4e3b\u8981\u51fd\u6570\uff0c \u800c\u8f85\u52a9\u5e93\u5219\u4e3a\u4e00\u4e9b\u5e38\u89c1\u7684\u4efb\u52a1\u63d0\u4f9b\u4e86\u9ad8\u9636\u51fd\u6570\u3002\n\n\n\u6240\u6709\u8f85\u52a9\u5e93\u4e2d\u7684\u51fd\u6570\u548c\u7c7b\u578b\u90fd\u5b9a\u4e49\u5728\u5934\u6587\u4ef6 lauxlib.h \u4e2d\uff0c \u5b83\u4eec\u5747\u5e26\u6709\u524d\u7f00 luaL_\u3002\n\n\n\u8f85\u52a9\u5e93\u4e2d\u7684\u6240\u6709\u51fd\u6570\u90fd\u57fa\u4e8e\u57fa\u7840 API \u5b9e\u73b0\u3002 \u6545\u800c\u5b83\u4eec\u5e76\u6ca1\u6709\u63d0\u4f9b\u4efb\u4f55\u57fa\u7840 API \u5b9e\u73b0\u4e0d\u4e86\u7684\u529f\u80fd\u3002 \u867d\u7136\u5982\u6b64\uff0c\u4f7f\u7528\u8f85\u52a9\u5e93\u53ef\u4ee5\u8ba9\u4f60\u7684\u4ee3\u7801\n\u66f4\u4e3a\u5065\u58ee\n\u3002\n\n\n\u4e00\u4e9b\u8f85\u52a9\u5e93\u51fd\u6570\u4f1a\u5728\u5185\u90e8\u4f7f\u7528\u4e00\u4e9b\u989d\u5916\u7684\u6808\u7a7a\u95f4\u3002 \u5f53\u8f85\u52a9\u5e93\u4f7f\u7528\u7684\u6808\u7a7a\u95f4\u5c11\u4e8e\u4e94\u4e2a\u65f6\uff0c \u5b83\u4eec\u4e0d\u53bb\u68c0\u67e5\u6808\u5927\u5c0f\uff1b\u800c\u662f\u7b80\u5355\u7684\u5047\u8bbe\u6808\u591f\u7528\u3002\n\n\n\u4e00\u4e9b\u8f85\u52a9\u5e93\u4e2d\u7684\u51fd\u6570\u7528\u4e8e\u68c0\u67e5 C \u51fd\u6570\u7684\u53c2\u6570\u3002 \u56e0\u4e3a\u9519\u8bef\u4fe1\u606f\u683c\u5f0f\u5316\u4e3a\u6307\u4ee3\u53c2\u6570 \uff08\u4f8b\u5982\uff0c\"bad argument #1\"\uff09\uff0c \u4f60\u5c31\u4e0d\u8981\u628a\u8fd9\u4e9b\u51fd\u6570\u7528\u4e8e\u53c2\u6570\u4e4b\u5916\u7684\u503c\u4e86\u3002\n\n\n\u5982\u679c\u68c0\u67e5\u65e0\u6cd5\u901a\u8fc7\uff0c luaL_check* \u8fd9\u4e9b\u51fd\u6570\u4e00\u5b9a\u4f1a\u629b\u51fa\u9519\u8bef\u3002\n\n\n\u4e0b\u6587\u5217\u51fa\u4e86\u90e8\u5206\u8f85\u52a9\u5e93\u51fd\u6570\uff0c\u66f4\u591a\u51fd\u6570\u548c\u8bf4\u660e\u8bf7\u53c2\u8003\n\u5b98\u65b9\u6587\u6863\u4e2d\u6587\u7248\n\n\n6.6.1 luaL_checknumber\n\n\n[-0, +0, v]\nlua_Number luaL_checknumber (lua_State *L, int arg);\n\u68c0\u67e5\u51fd\u6570\u7684\u7b2c arg \u4e2a\u53c2\u6570\u662f\u5426\u662f\u4e00\u4e2a \u6570\u5b57\uff0c\u5e76\u8fd4\u56de\u8fd9\u4e2a\u6570\u5b57\u3002\n\n\n6.6.2 luaL_openlibs\n\n\n[-0, +0, e]\nvoid luaL_openlibs (lua_State *L);\n\u6253\u5f00\u6307\u5b9a\u72b6\u6001\u673a\u4e2d\u7684\u6240\u6709 Lua \u6807\u51c6\u5e93\u3002\n\n\n6.6.3 luaL_Reg\n\n\ntypedef struct luaL_Reg {\n  const char *name;\n  lua_CFunction func;\n} luaL_Reg;\n\u7528\u4e8e luaL_setfuncs \u6ce8\u518c\u51fd\u6570\u7684\u6570\u7ec4\u7c7b\u578b\u3002 name \u6307\u51fd\u6570\u540d\uff0cfunc \u662f\u51fd\u6570\u6307\u9488\u3002 \u4efb\u4f55 luaL_Reg \u6570\u7ec4\u5fc5\u987b\u4ee5\u4e00\u5bf9 name \u4e0e func \u7686\u4e3a NULL \u7ed3\u675f\u3002\n\n\n6.7 C\u8c03\u7528lua\u7684\u4f8b\u5b50\n\n\n\u539f\u6587\n\n\nconf.lua\n\n\nwidth = 200\nheight = 300\n\n\n\nparse_lua.c\n\n\n#include \nstdio.h\n\n#include \nstring.h\n\n#include \nlua.h\n\n#include \nlauxlib.h\n\n#include \nlualib.h\n\n\nvoid load(lua_State* L, const char* fname, int* w, int* h) {\n    if (luaL_loadfile(L,fname) || lua_pcall(L,0,0,0)) {\n        printf(\"Error Msg is %s.\\n\",lua_tostring(L,-1));\n        return;\n    }\n\n    lua_getglobal(L,\"width\");  // \u5148\u538b\u5165\u6808\n    lua_getglobal(L,\"height\"); // \u518d\u538b\u5165\u6808\n\n    if (!lua_isnumber(L,-2)) {\n        printf(\"'width' should be a number\\n\" );\n        return;\n    }\n\n    if (!lua_isnumber(L,-1)) {\n        printf(\"'height' should be a number\\n\" );\n        return;\n    }\n\n    *w = lua_tointeger(L,-2); // \u4ece\u6808\u9876\u5f39\u51fa\u6570\u636e\n    *h = lua_tointeger(L,-1);\n}\n\nint main()\n{\n    lua_State* L = luaL_newstate(); // \u521b\u5efalua\u72b6\u6001\u673a\n    int w,h;\n\n    load(L,\"conf.lua\",\nw,\nh);\n    printf(\"width = %d, height = %d\\n\",w,h);\n\n    lua_close(L); // \u9500\u6bc1lua\u72b6\u6001\u673a\n\n return 0;\n}\n\n\n\n\u7f16\u8bd1\uff1a\n\n\ngcc parse_lua.c -o parse_lua -llua -lm -ldl\n\n\n\n\u8fd0\u884c\uff1a\n\n\n ./parse_lua \nwidth = 200, height = 300\n\n\n\n\u8fd9\u4e2a\u7b80\u5355\u7684\u4f8b\u5b50\u6f14\u793a\u4e86\u5728C\u8bed\u8a00\u4e2d\u5982\u4f55\u901a\u8fc7lua\u63d0\u4f9b\u7684\u865a\u62df\u6808\u6765\u548clua\u4ea4\u4e92\u3002\n\n\n6.8 lua\u8c03\u7528C\u7684\u4f8b\u5b50\n\n\n\u4ee3\u7801Github\u5730\u5740\n\n\nlcal.c\n\n\n#include \nlua.h\n\n#include \nlauxlib.h\n\n#include \nstring.h\n\n#include \nstdlib.h\n\n\nstatic int l_add(lua_State *L){\n    double d1 = luaL_checknumber(L, 1); // \u8fd9\u4e2a1\u4ee3\u8868\u4e86\u4ece\u5de6\u5230\u53f3lua\u8c03\u7528\u8fd9\u4e2a\u51fd\u6570\u65f6\u4f20\u5165\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570 lua\u53ea\u6709double\n    double d2 = luaL_checknumber(L, 2);\n\n    lua_pushnumber(L, d1 + d2);         // \u8fd4\u56de\u503c\u538b\u5165lua\u6808\n    return 1;\n}\n\nstatic int l_sub(lua_State *L){\n    double d1 = luaL_checknumber(L, 1);   \n    double d2 = luaL_checknumber(L, 2);\n\n    lua_pushnumber(L, d1 - d2);\n    return 1;\n}\n\nint luaopen_calc(lua_State *L){\n    luaL_checkversion(L); // \u9632\u6b62\u94fe\u63a5\u591a\u5206lua\u5e93\n\n    luaL_Reg l[] = {\n        {\"add\", l_add},     \n        {\"sub\", l_sub},\n        {NULL, NULL}\n    };\n\n    luaL_newlib(L, l); // Creates a new table and registers there the functions in list l. \n    return 1;\n}\n\n\n\ncalc_test.lua\n\n\n-- \u6ce8\u610f\u8fd9\u91cc\u4e0d\u80fd\u4f7f\u7528calc.lua\u6765\u547d\u540d \u8fd9\u6837\u4f1a\u4f7f\u5f97require\u5728\u67e5\u627ecalc\u65f6\u51fa\u73b0\u6b7b\u5faa\u73af\n\nlocal calc = require \"calc\"\n\nprint(calc.add(20, 40))\nprint(calc.sub(20, 40))\n\n\n\nMakefile\n\n\ncalc.so : lcalc.c\n    gcc -g -o $@ --shared $^  -I/usr/local/include -L/usr/local/bin -llua\n\n\n\n\u8fd0\u884c\u7ed3\u679c\uff1a\n\n\nmake\n\nlua calc_test.lua \n60.0\n-20.0\n\n\n\n\u5728\u8fd9\u662f\u4f8b\u5b50\u4e2d\u6211\u4eec\u7528C\u8bed\u8a00\u7f16\u5199\u4e86\u4e00\u4e2a.so\u6587\u4ef6(\u52a8\u6001\u5e93)\uff0c\u6f14\u793a\u4e86lua\u4f7f\u7528\u865a\u62df\u6808\u6765\u548cC\u4ea4\u4e92\u3002\n\n\n6.9 fflua\n\n\nfflua\u7528\u4e8eC++\u5d4c\u5165lua\u6216\u8005\u662f\u7528C++\u6269\u5c55lua\u3002\n\n\nlua\u82e5\u8981\u64cd\u4f5cC++\u4e2d\u7684\u5bf9\u8c61\u6216\u51fd\u6570\uff0c\u90a3\u4e48\u5fc5\u987b\u5148\u628aC++\u5bf9\u5e94\u7684\u63a5\u53e3\u6ce8\u518c\u90fdlua\u4e2d\u3002Lua C API\u63d0\u4f9b\u4e86\u4e00\u7cfb\u5217\u7684\u63a5\u53e3\u62e5\u6709\u5b8c\u6210\u6b64\u64cd\u4f5c\uff0clua\u901a\u8fc7\u865a\u62df\u6808\u6765\u5b9e\u73b0\u5bf9C\u51fd\u6570\u7684\u8c03\u7528\u3002\u4f46\u662f\u5173\u4e8e\u5806\u6808\u7684\u64cd\u4f5c\u603b\u662f\u4f1a\u7a0d\u663e\u5934\u75bc\uff0cfflua\u6781\u5927\u7684\u7b80\u5316\u4e86\u6ce8\u518cC++\u5bf9\u8c61\u548c\u63a5\u53e3\u7684\u64cd\u4f5c\u3002\n\n\nfflua github\u5730\u5740\n\u5b98\u65b9\u7684\u6587\u6863\u8be6\u7ec6\u8bf4\u660e\u4e86\u600e\u4e48\u4f7f\u7528\u548c\u4f7f\u7528\u4e2d\u7684\u4e00\u4e9b\u95ee\u9898\u7b49\u3002\n\n\n\u5b98\u65b9examples\n\n\n\u6211\u4e3amain.cpp\u6587\u4ef6\u4e2d\u6dfb\u52a0\u4e86\u66f4\u52a0\u8be6\u7ec6\u7684\u6ce8\u91ca\uff0c\u4e3b\u8981\u662f\u8bf4\u660e\u4e86main()\u51fd\u6570\u8fd0\u884c\u7684\u65f6\u5019\u662f\u600e\u4e48\u4e00\u6b65\u4e00\u6b65\u6253\u5370\u51fa\u6700\u540e\u7684\u7ed3\u679c\u7684\uff0c\u53ef\u4ee5\u6839\u636e\u6ce8\u91ca\u4e00\u6b65\u4e00\u6b65\u4e86\u89e3lua\u548cC++\u662f\u600e\u4e48\u76f8\u4e92\u8c03\u7528\u7684\u3002\n\n\nmain.cpp\n\n\n#include \niostream\n\n#include \nstring\n\n#include \nassert.h\n\nusing namespace std;\n\n#include \"lua/fflua.h\"\n\nusing namespace ff;\n\nclass base_t\n{\npublic:\n    base_t():v(789){}\n    void dump()\n    {\n        printf(\"in %s a:%d\\n\", __FUNCTION__, v);\n    }\n    int v;\n};\nclass foo_t: public base_t\n{\npublic:\n    foo_t(int b):a(b)\n    {\n        printf(\"in %s b:%d this=%p\\n\", __FUNCTION__, b, this);\n    }\n    ~foo_t()\n    {\n        printf(\"in %s\\n\", __FUNCTION__);\n    }\n    void print(int64_t a, base_t* p) const\n    {\n        printf(\"in foo_t::print a:%ld p:%p\\n\", (long)a, p);\n    }\n\n    static void dumy()\n    {\n        printf(\"in %s\\n\", __FUNCTION__);\n    }\n    int a;\n};\n\n//! lua talbe \u53ef\u4ee5\u81ea\u52a8\u8f6c\u6362\u4e3astl \u5bf9\u8c61\nvoid dumy(map\nstring, string\n ret, vector\nint\n a, list\nstring\n b, set\nint64_t\n c)\n{\n    printf(\"in %s begin ------------\\n\", __FUNCTION__);\n    for (map\nstring, string\n::iterator it =  ret.begin(); it != ret.end(); ++it)\n    {\n        printf(\"map:%s, val:%s:\\n\", it-\nfirst.c_str(), it-\nsecond.c_str());\n    }\n    printf(\"in %s end ------------\\n\", __FUNCTION__);\n}\n\nclass clazz{\npublic:\n    static void static_func(){\n        printf(\"in clazz::%s end ------------\\n\", __FUNCTION__);\n    }\n};\n\nstatic void lua_reg(lua_State* ls)\n{\n    //! \u6ce8\u518c\u57fa\u7c7b\u51fd\u6570, ctor() \u4e3a\u6784\u9020\u51fd\u6570\u7684\u7c7b\u578b\n    fflua_register_t\nbase_t, ctor()\n(ls, \"base_t\")  //! \u6ce8\u518c\u6784\u9020\u51fd\u6570\n                    .def(\nbase_t::dump, \"dump\")     //! \u6ce8\u518c\u57fa\u7c7b\u7684\u51fd\u6570\n                    .def(\nbase_t::v, \"v\");          //! \u6ce8\u518c\u57fa\u7c7b\u7684\u5c5e\u6027\n\n    //! \u6ce8\u518c\u5b50\u7c7b\uff0cctor(int) \u4e3a\u6784\u9020\u51fd\u6570\uff0c foo_t\u4e3a\u7c7b\u578b\u540d\u79f0\uff0c base_t\u4e3a\u7ee7\u627f\u7684\u57fa\u7c7b\u540d\u79f0\n    fflua_register_t\nfoo_t, ctor(int)\n(ls, \"foo_t\", \"base_t\")\n                .def(\nfoo_t::print, \"print\")        //! \u5b50\u7c7b\u7684\u51fd\u6570\n                .def(\nfoo_t::a, \"a\");               //! \u5b50\u7c7b\u7684\u5b57\u6bb5\n\n    fflua_register_t\n(ls)\n                .def(\ndumy, \"dumy\");                //! \u6ce8\u518c\u9759\u6001\u51fd\u6570\n\n\n    fflua_register_t\nclazz, ctor()\n(ls, \"clazz\")\n                .def(\nclazz::static_func, \"static_func\");\n\n}\n\nint main(int argc, char* argv[])\n{\n\n    fflua_t fflua;\n    try \n    {\n        //! \u6ce8\u518cC++ \u5bf9\u8c61\u5230lua\u4e2d\n        fflua.reg(lua_reg);\n\n        //! \u8f7d\u5165lua\u6587\u4ef6\n        fflua.add_package_path(\"./\");\n#ifdef _WIN32\n        fflua.load_file(\"../test.lua\");\n#else\n        fflua.load_file(\"test.lua\"); // lua\u6587\u4ef6\u91cc\u9762\u8c03\u7528\u4e86 clazz:static_func() \u6253\u5370\u51fa in clazz::static_func end ------------\n#endif\n        //! \u83b7\u53d6\u5168\u5c40\u53d8\u91cf\n        int var = 0;\n        assert(0 == fflua.get_global_variable(\"test_var\", var));\n        //! \u8bbe\u7f6e\u5168\u5c40\u53d8\u91cf\n        assert(0 == fflua.set_global_variable(\"test_var\", ++var));\n\n        //! \u6267\u884clua \u8bed\u53e5 \u6253\u5370\u51fa exe run_string!!\n        fflua.run_string(\"print(\\\"exe run_string!!\\\")\");\n\n        //! \u8c03\u7528lua test_func\u51fd\u6570, \u57fa\u672c\u7c7b\u578b\u4f5c\u4e3a\u53c2\u6570 \u6253\u5370\u51fa in test_func:   1.0     2.0     3.0     4\n        // lua test_func\u51fd\u6570\u91cc\u9762\u8c03\u7528cpp\u7684dumy\u51fd\u6570\u6253\u5370\u51fa \n        // in dumy begin ------------\n        // map:k, val:v:\n        // in dumy end ------------\n        int32_t arg1 = 1;\n        float   arg2 = 2;\n        double  arg3 = 3;\n        string  arg4 = \"4\";\n        fflua.call\nbool\n(\"test_func\", arg1, arg2, arg3,  arg4);\n\n        //! \u8c03\u7528lua test_stl()\u51fd\u6570\uff0cstl\u7c7b\u578b\u4f5c\u4e3a\u53c2\u6570\uff0c \u81ea\u52a8\u8f6c\u6362\u4e3alua talbe \u6253\u5370\u51fa\uff1a\n        // --------------dump_table begin ----------------\n        // vec     1       100.0\n        // lt      1       99.98999786377\n        // st      1       OhNIce\n        // mp      key     200.0\n        // --------------dump_table end ----------------\n        vector\nint\n vec;        vec.push_back(100);\n        list\nfloat\n lt;         lt.push_back((float)99.99);\n        set\nstring\n st;         st.insert(\"OhNIce\");\n        map\nstring, int\n mp;    mp[\"key\"] = 200;\n        fflua.call\nstring\n(\"test_stl\", vec, lt, st,  mp);\n\n        //! \u8c03\u7528lua \u51fd\u6570\u8fd4\u56de talbe\uff0c\u81ea\u52a8\u8f6c\u6362\u4e3astl\u7ed3\u6784\n        vec = fflua.call\nvector\nint\n \n(\"test_return_stl_vector\");\n        lt  = fflua.call\nlist\nfloat\n \n(\"test_return_stl_list\");\n        st  = fflua.call\nset\nstring\n \n(\"test_return_stl_set\");\n        mp  = fflua.call\nmap\nstring, int\n \n(\"test_return_stl_map\");\n\n        //! \u8c03\u7528lua\u51fd\u6570\uff0cc++ \u5bf9\u8c61\u4f5c\u4e3a\u53c2\u6570, foo_t \u5fc5\u987b\u88ab\u6ce8\u518c\u8fc7\n        // new ffo_t(456) \u6253\u5370\u51fa\uff1a in foo_t b:456 this=0x82cf468\n        // \u8c03\u7528lua\u7684test_object\u51fd\u6570 \u6253\u5370\u51fa\uff1a base ptr:       137158880\n        // test_object\u51fd\u6570\u5185\u8c03\u7528 foo_obj:print \u6253\u5370\u51fa\uff1a in foo_t::print a:12333 p:0x82ce0e0\n        // test_object\u51fd\u6570\u5185\u8c03\u7528 foo_obj:dump() \u6253\u5370\u51fa\uff1ain dump a:789\n        // test_object\u51fd\u6570\u5185 \u6253\u5370\u51fa\uff1a foo property    456.0\n        // test_object\u51fd\u6570\u5185 \u6253\u5370\u51fa\uff1a  base property   789.0\n        foo_t* foo_ptr = new foo_t(456);\n        fflua.call\nvoid\n(\"test_object\", foo_ptr);\n\n        //! \u8c03\u7528lua\u51fd\u6570\uff0cc++ \u5bf9\u8c61\u4f5c\u4e3a\u8fd4\u56de\u503c, foo_t \u5fc5\u987b\u88ab\u6ce8\u518c\u8fc7 \n        assert(foo_ptr == fflua.call\nfoo_t*\n(\"test_ret_object\", foo_ptr));\n        //! \u8c03\u7528lua\u51fd\u6570\uff0cc++ \u5bf9\u8c61\u4f5c\u4e3a\u8fd4\u56de\u503c, \u81ea\u52a8\u8f6c\u6362\u4e3a\u57fa\u7c7b\n        base_t* base_ptr = fflua.call\nbase_t*\n(\"test_ret_base_object\", foo_ptr);\n        assert(base_ptr == foo_ptr);\n\n    }\n    catch (exception\n e)\n    {\n        printf(\"exception:%s\\n\", e.what());\n\n\n    }\n#ifdef _WIN32\n    system(\"pause\");\n#endif\n    return 0;\n}\n\n\n\ntest.lua \n\n\ntest_var = 99\n\nfunction dump_table(tb, str)\n    if nil == str then str = \"\" end\n    for k, v in pairs(tb)\n    do\n        print(str, k, v)\n    end\nend\n\n-- \u6d4b\u8bd5\u8c03\u7528lua\nfunction test_func(arg1, arg2, arg3, arg4)\n    print(\"in test_func:\", arg1, arg2, arg3, arg4)\n    mp = {[\"k\"] = \"v\"}\n    vc = {1,2,3}\n    lt = {4,5,6}\n    st = {7,8,9}\n    dumy(mp, vc, lt, st)\nend\n\n-- \u63a5\u53d7stl\u53c2\u6570\nfunction test_stl(vec, lt, st, mp)\n    print(\"--------------dump_table begin ----------------\")\n    dump_table(vec, \"vec\")\n    dump_table(lt, \"lt\")\n    dump_table(st, \"st\")\n    dump_table(mp, \"mp\")\n    print(\"--------------dump_table end ----------------\")\n    return \"ok\"\nend\n\n-- \u8fd4\u56destl \u53c2\u6570\nfunction test_return_stl_vector()\n    return {1,2,3,4}\nend\nfunction test_return_stl_list()\n    return {1,2,3,4}\nend\nfunction test_return_stl_set()\n    return {1,2,3,4}\nend\nfunction test_return_stl_map()\n    return {\n        [\"key\"] = 124\n    }\nend\n-- \u6d4b\u8bd5\u63a5\u53d7C++\u5bf9\u8c61\nfunction test_object(foo_obj)\n    --\u6d4b\u8bd5\u6784\u9020\n    base = base_t:new()\n    -- \u6bcf\u4e2a\u5bf9\u8c61\u90fd\u6709\u4e00\u4e2aget_pointer\u83b7\u53d6\u6307\u9488\n    print(\"base ptr:\", base:get_pointer())\n    -- \u6d4b\u8bd5C++\u5bf9\u8c61\u51fd\u6570\n    foo_obj:print(12333, base)\n    base:delete()\n    --\u57fa\u7c7b\u7684\u51fd\u6570\n    foo_obj:dump()\n    -- \u6d4b\u8bd5C++ \u5bf9\u8c61\u5c5e\u6027\n    print(\"foo property\", foo_obj.a)\n    print(\"base property\", foo_obj.v)\nend\n\n-- \u6d4b\u8bd5\u8fd4\u56deC++\u5bf9\u8c61\nfunction test_ret_object(foo_obj)\n    return foo_obj\nend\n\n-- \u6d4b\u8bd5\u8fd4\u56deC++\u5bf9\u8c61\nfunction test_ret_base_object(foo_obj)\n    return foo_obj\nend\n\n\nclazz:static_func()\n\n\n\n\u7f16\u8bd1\u8fd0\u884c\uff1a\n\n\n git clone https://github.com/fanchy/fflua\n\n cd fflua/example/\n\n make\n\n ./app_lua\n\n\n\n\u8fd0\u884c\u7ed3\u679c\uff1a\n\n\nin clazz::static_func end ------------\nexe run_string!!\nin test_func:   1.0     2.0     3.0     4\nin dumy begin ------------\nmap:k, val:v:\nin dumy end ------------\n--------------dump_table begin ----------------\nvec     1       100.0\nlt      1       99.98999786377\nst      1       OhNIce\nmp      key     200.0\n--------------dump_table end ----------------\nin foo_t b:456 this=0x82cf468\nbase ptr:       137158880\nin foo_t::print a:12333 p:0x82ce0e0\nin dump a:789\nfoo property    456.0\nbase property   789.0\n\n\n\n6.10 lua cjson\u5e93\n\n\njson\u5b98\u7f51\u5217\u51fa\u6765\u5f88\u591a\u5f00\u6e90\u7684\nlua json\u5e93\n\uff0c\u7528\u4e8elua table\u5bf9\u8c61\u548cjson\u6570\u636e\u683c\u5f0f\u7684\u76f8\u4e92\u8f6c\u6362\u3002\u8fd9\u91cc\u7b80\u5355\u4ecb\u7ecdcjson\u5e93\u7684\u4f7f\u7528\u3002\n\n\n\u83b7\u53d6\u4ee3\u7801\u5e76\u8fd0\u884c\u6d4b\u8bd5\u5b9e\u4f8b\n\n\n git clone https://github.com/peimin/lua_cjson\n\n cd lua_cjson/\n\n make\n\n lua json_test.lua\n\n\n\n\u8fd0\u884c\u7ed3\u679c\uff1a\n\n\nusr_encode: {\"name\":\"name5566boy\",\"usr_xx\":{\"2\":33,\"3\":44,\"1\":22},\"age\":72}\nname: name5566boy\nage : 72.0\nusr_xx...\n2       33.0\n3       44.0\n1       22.0\n\n\n\njson.lua\n\n\n\u5bf9cjson\u63a5\u53e3\u7684\u7b80\u5355\u5c01\u88c5\uff0c\u4ee5\u4fdd\u62a4\u6a21\u5f0f\u8c03\u7528cjson\u63d0\u4f9b\u7684json\u89e3\u5305 \u538b\u5305\u51fd\u6570\u3002\n\n\nlocal json = {}\nlocal cjson = require(\"cjson\")\n\nfunction json.encode(var)\n    local status, result = pcall(cjson.encode, var)\n    if status then \n        return result \n    end\nend\n\nfunction json.decode(text)\n    local status, result = pcall(cjson.decode, text)\n    if status then \n        return result \n    end\nend\n\nreturn json\n\n\n\njson_test.lua\n\n\nlocal json = require \"json\"\n\nlocal usr_xx ={}\nusr_xx[\"1\"] = 22\nusr_xx[\"2\"] = 33\nusr_xx[\"3\"] = 44\n\nlocal usr = {}\nusr[\"name\"]   = \"name5566boy\"\nusr[\"age\"]    = 72\nusr[\"usr_xx\"] = usr_xx\n\nlocal usr_encode = json.encode(usr)     -- \u5c06lua table\u5bf9\u8c61\u8f6c\u6362\u6210json\u5b57\u7b26\u4e32\nif usr_encode then\n    print(\"usr_encode: \"..usr_encode)   -- {\"usr_xx\":{\"2\":33,\"3\":44,\"1\":22},\"age\":72,\"name\":\"name5566boy\"}\nend\n\nlocal usr_msg = json.decode(usr_encode) -- \u5c06json\u5b57\u7b26\u4e32\u8f6c\u6362\u6210lua table\u5bf9\u8c61 \nif usr_msg then\n    print(\"name: \"..usr_msg[\"name\"])\n    print(\"age : \"..usr_msg[\"age\"])\n    local usr_xx = usr_msg[\"usr_xx\"]\n\n    print(\"usr_xx...\")\n    for k, v in pairs (usr_xx) do\n      print (k, v)\n    end \nend", 
            "title": "06"
        }, 
        {
            "location": "/luamd/06/#61", 
            "text": "Lua \u4f7f\u7528\u4e00\u4e2a \u865a\u62df\u6808 \u6765\u548c C \u4e92\u4f20\u503c\u3002\u6808\u4e0a\u7684\u7684\u6bcf\u4e2a\u5143\u7d20\u90fd\u662f\u4e00\u4e2a Lua \u503c \uff08nil\uff0c\u6570\u5b57\uff0c\u5b57\u7b26\u4e32\uff0c\u7b49\u7b49\uff09\u3002  \u65e0\u8bba\u4f55\u65f6 Lua \u8c03\u7528 C\uff0c\u88ab\u8c03\u7528\u7684\u51fd\u6570\u90fd\u5f97\u5230\u4e00\u4e2a\u65b0\u7684\u6808\uff0c \u8fd9\u4e2a\u6808\u72ec\u7acb\u4e8e C \u51fd\u6570\u672c\u8eab\u7684\u6808\uff0c\u4e5f\u72ec\u7acb\u4e8e\u4e4b\u524d\u7684 Lua \u6808\u3002 \u5b83\u91cc\u9762\u5305\u542b\u4e86 Lua \u4f20\u9012\u7ed9 C \u51fd\u6570\u7684\u6240\u6709\u53c2\u6570\uff0c \u800c C \u51fd\u6570\u5219\u628a\u8981\u8fd4\u56de\u7684\u7ed3\u679c\u653e\u5165\u8fd9\u4e2a\u6808\u4ee5\u8fd4\u56de\u7ed9\u8c03\u7528\u8005 \uff08\u53c2\u89c1 lua_CFunction\uff09\u3002  \u65b9\u4fbf\u8d77\u89c1\uff0c \u6240\u6709\u9488\u5bf9\u6808\u7684 API \u67e5\u8be2\u64cd\u4f5c\u90fd\u4e0d\u4e25\u683c\u9075\u5faa\u6808\u7684\u64cd\u4f5c\u89c4\u5219\u3002  \u800c\u662f\u53ef\u4ee5\u7528\u4e00\u4e2a \u7d22\u5f15 \u6765\u6307\u5411\u6808\u4e0a\u7684\u4efb\u4f55\u5143\u7d20\uff1a \u6b63\u7684\u7d22\u5f15\u6307\u7684\u662f\u6808\u4e0a\u7684\u7edd\u5bf9\u4f4d\u7f6e\uff08\u4ece1\u5f00\u59cb\uff09\uff1b \u8d1f\u7684\u7d22\u5f15\u5219\u6307\u4ece\u6808\u9876\u5f00\u59cb\u7684\u504f\u79fb\u91cf\u3002  \u5c55\u5f00\u6765\u8bf4\uff0c\u5982\u679c\u5806\u6808\u6709 n \u4e2a\u5143\u7d20\uff0c \u90a3\u4e48\u7d22\u5f15 1 \u8868\u793a\u7b2c\u4e00\u4e2a\u5143\u7d20 \uff08\u4e5f\u5c31\u662f\u6700\u5148\u88ab\u538b\u6808\u7684\u5143\u7d20\uff09 \u800c\u7d22\u5f15 n \u5219\u6307\u6700\u540e\u4e00\u4e2a\u5143\u7d20\uff1b \u7d22\u5f15 -1 \u4e5f\u662f\u6307\u6700\u540e\u4e00\u4e2a\u5143\u7d20 \uff08\u5373\u6808\u9876\u7684\u5143\u7d20\uff09\uff0c \u7d22\u5f15 -n \u662f\u6307\u7b2c\u4e00\u4e2a\u5143\u7d20\u3002", 
            "title": "6.1 \u6808"
        }, 
        {
            "location": "/luamd/06/#62", 
            "text": "\u5f53\u4f60\u4f7f\u7528 Lua API \u65f6\uff0c \u5c31\u6709\u8d23\u4efb\u4fdd\u8bc1\u505a\u6070\u5f53\u7684\u8c03\u7528\u3002 \u7279\u522b\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c \u4f60\u6709\u8d23\u4efb\u63a7\u5236\u4e0d\u8981\u5806\u6808\u6ea2\u51fa\u3002 \u4f60\u53ef\u4ee5 \u4f7f\u7528 lua_checkstack \u8fd9\u4e2a\u51fd\u6570\u6765\u6269\u5927\u53ef\u7528\u5806\u6808\u7684\u5c3a\u5bf8\u3002  \u65e0\u8bba\u4f55\u65f6 Lua \u8c03\u7528 C \uff0c \u5b83\u90fd\u53ea\u4fdd\u8bc1\u81f3\u5c11\u6709 LUA_MINSTACK \u8fd9\u4e48\u591a\u7684\u5806\u6808\u7a7a\u95f4\u53ef\u4ee5\u4f7f\u7528\u3002  LUA_MINSTACK \u4e00\u822c\u88ab\u5b9a\u4e49\u4e3a 20  \uff0c \u56e0\u6b64\uff0c\u53ea\u8981\u4f60\u4e0d\u662f\u4e0d\u65ad\u7684\u628a\u6570\u636e\u538b\u6808\uff0c \u901a\u5e38\u4f60\u4e0d\u7528\u5173\u5fc3\u5806\u6808\u5927\u5c0f\u3002  \u5f53\u4f60\u8c03\u7528\u4e00\u4e2a Lua \u51fd\u6570\u5374\u6ca1\u6709\u6307\u5b9a\u8981\u63a5\u6536\u591a\u5c11\u4e2a\u8fd4\u56de\u503c\u65f6 \uff08\u53c2\u89c1 lua_call\uff09\uff0clua \u53ef\u4ee5\u4fdd\u8bc1\u6808\u4e00\u5b9a\u6709\u8db3\u591f\u7684\u7a7a\u95f4\u6765\u63a5\u6536\u6240\u6709\u7684\u8fd4\u56de\u503c\uff0c \u4f46\u4e0d\u4fdd\u8bc1\u6b64\u5916\u7559\u6709\u989d\u5916\u7684\u7a7a\u95f4\u3002 \u56e0\u6b64\uff0c\u5728\u505a\u4e86\u4e00\u6b21\u8fd9\u6837\u7684\u8c03\u7528\u540e\uff0c\u5982\u679c\u4f60\u9700\u8981\u7ee7\u7eed\u538b\u6808\uff0c \u5219\u9700\u8981\u4f7f\u7528 lua_checkstack\u3002", 
            "title": "6.2 \u6808\u5927\u5c0f"
        }, 
        {
            "location": "/luamd/06/#63", 
            "text": "API \u4e2d\u7684\u51fd\u6570\u82e5\u9700\u8981\u4f20\u5165\u6808\u7d22\u5f15\uff0c\u8fd9\u4e2a\u7d22\u5f15\u5fc5\u987b\u662f \u6709\u6548\u7d22\u5f15 \u6216\u662f \u53ef\u63a5\u53d7\u7d22\u5f15\u3002  \u6709\u6548\u7d22\u5f15 \u6307\u5f15\u7528\u6808\u5185\u771f\u5b9e\u4f4d\u7f6e\u7684\u7d22\u5f15\uff1b \u5373\u5728 1 \u5230\u6808\u9876\u4e4b\u95f4\u7684\u4f4d\u7f6e \uff081 \u2264 abs(index) \u2264 top\uff09\u3002  \u901a\u5e38\uff0c\u4e00\u4e2a\u53ef\u80fd\u4fee\u6539\u8be5\u4f4d\u7f6e\u7684\u503c\u7684\u51fd\u6570\u9700\u8981\u4f20\u5165\u6709\u6548\u7d22\u5f15\u3002  \u9664\u975e\u53e6\u6709\u8bf4\u660e\uff0c \u4efb\u4f55\u53ef\u4ee5\u63a5\u53d7\u6709\u6548\u7d22\u5f15\u7684\u51fd\u6570\u540c\u65f6\u4e5f\u63a5\u53d7 \u4f2a\u7d22\u5f15\u3002 \u4f2a\u7d22\u5f15\u6307\u4ee3\u4e00\u4e9b\u53ef\u4ee5\u88ab C code \u8bbf\u95ee\u5f97\u5230 Lua \u503c\uff0c\u800c\u5b83\u4eec\u53c8\u4e0d\u5728\u6808\u5185\u3002 \u8fd9\u7528\u4e8e\u8bbf\u95ee\u6ce8\u518c\u8868\u4ee5\u53ca C \u51fd\u6570\u7684\u4e0a\u503c\uff08\u53c2\u89c1 \u00a76.4\uff09\u3002  \u5bf9\u4e8e\u90a3\u4e9b\u53ea\u662f\u9700\u8981\u6808\u4e2d\u7684\u503c\uff08\u4f8b\u5982\u67e5\u8be2\u51fd\u6570\uff09 \u800c\u4e0d\u9700\u8981\u6307\u5b9a\u4e00\u4e2a\u6808\u4f4d\u7f6e\u7684\u51fd\u6570\uff0c \u53ef\u4ee5\u7528\u4e00\u4e2a\u53ef\u63a5\u53d7\u7684\u7d22\u5f15\u53bb\u8c03\u7528\u5b83\u4eec\u3002 \u53ef\u63a5\u53d7\u7d22\u5f15 \u4e0d\u4ec5\u53ef\u4ee5\u662f\u4efb\u4f55\u5305\u62ec\u4f2a\u7d22\u5f15\u5728\u5185\u7684\u6709\u6548\u7d22\u5f15\uff0c \u8fd8\u53ef\u4ee5\u662f\u4efb\u4f55\u8d85\u8fc7\u6808\u9876\u4f46\u843d\u5728\u4e3a\u6808\u5206\u914d\u51fa\u6765\u7684\u7a7a\u95f4\u5185\u7684\u6b63\u7d22\u5f15\u3002 \uff08\u6ce8\u610f 0 \u6c38\u8fdc\u90fd\u4e0d\u662f\u4e00\u4e2a\u53ef\u63a5\u53d7\u7d22\u5f15\u3002\uff09 \u9664\u975e\u53e6\u6709\u8bf4\u660e\uff0cAPI \u91cc\u7684\u51fd\u6570\u90fd\u63a5\u53d7\u53ef\u63a5\u53d7\u7d22\u5f15\u3002  \u5141\u8bb8\u53ef\u63a5\u53d7\u7d22\u5f15\u662f\u4e3a\u4e86\u907f\u514d\u5bf9\u6808\u9876\u4ee5\u5916\u7684\u67e5\u8be2\u65f6\u505a\u989d\u5916\u7684\u68c0\u67e5\u3002 \u4f8b\u5982\uff0cC \u51fd\u6570\u53ef\u4ee5\u76f4\u63a5\u67e5\u8be2\u4f20\u7ed9\u5b83\u7684\u7b2c\u4e09\u4e2a\u53c2\u6570\uff0c \u800c\u4e0d\u7528\u5148\u68c0\u67e5\u662f\u4e0d\u662f\u6709\u7b2c\u4e09\u4e2a\u53c2\u6570\uff0c \u5373\u4e0d\u9700\u8981\u68c0\u67e5 3 \u662f\u4e0d\u662f\u4e00\u4e2a\u6709\u6548\u7d22\u5f15\u3002  \u5bf9\u4e8e\u90a3\u4e9b\u4ee5\u53ef\u63a5\u53d7\u7d22\u5f15\u8c03\u7528\u7684\u51fd\u6570\uff0c \u65e0\u6548\u7d22\u5f15\u88ab\u770b\u4f5c\u5305\u542b\u4e86\u4e00\u4e2a\u865a\u62df\u7c7b\u578b LUA_TNONE \u7684\u503c\uff0c \u8fd9\u4e2a\u503c\u7684\u884c\u4e3a\u548c nil \u4e00\u81f4\u3002", 
            "title": "6.3 \u6709\u6548\u7d22\u5f15\u4e0e\u53ef\u63a5\u53d7\u7d22\u5f15"
        }, 
        {
            "location": "/luamd/06/#64-c", 
            "text": "\u5f53 C \u51fd\u6570\u88ab\u521b\u5efa\u51fa\u6765\uff0c \u6211\u4eec\u6709\u53ef\u80fd\u4f1a\u628a\u4e00\u4e9b\u503c\u5173\u8054\u5728\u4e00\u8d77\uff0c \u4e5f\u5c31\u662f\u521b\u5efa\u4e00\u4e2a C \u95ed\u5305  \uff08\u53c2\u89c1 lua_pushcclosure\uff09\uff1b \u8fd9\u4e9b\u88ab\u5173\u8054\u8d77\u6765\u7684\u503c\u88ab\u53eb\u505a \u4e0a\u503c \uff0c \u5b83\u4eec\u53ef\u4ee5\u5728\u51fd\u6570\u88ab\u8c03\u7528\u7684\u65f6\u5019\u8bbf\u95ee\u7684\u5230\u3002  \u65e0\u8bba\u4f55\u65f6\u53bb\u8c03\u7528 C \u51fd\u6570\uff0c \u51fd\u6570\u7684\u4e0a\u503c\u90fd\u53ef\u4ee5\u7528\u4f2a\u7d22\u5f15\u5b9a\u4f4d\u3002 \u6211\u4eec\u53ef\u4ee5\u7528 lua_upvalueindex \u8fd9\u4e2a\u5b8f\u6765\u751f\u6210\u8fd9\u4e9b\u4f2a\u7d22\u5f15\u3002 \u7b2c\u4e00\u4e2a\u5173\u8054\u5230\u51fd\u6570\u7684\u503c\u653e\u5728 lua_upvalueindex(1) \u4f4d\u7f6e\u5904\uff0c\u4f9d\u6b64\u7c7b\u63a8\u3002 \u4f7f\u7528 lua_upvalueindex(n) \u65f6\uff0c \u82e5 n \u5927\u4e8e\u5f53\u524d\u51fd\u6570\u7684\u603b\u4e0a\u503c\u4e2a\u6570 \uff08\u4f46\u4e0d\u53ef\u4ee5\u5927\u4e8e 256\uff09\u4f1a\u4ea7\u751f\u4e00\u4e2a\u53ef\u63a5\u53d7\u7684\u4f46\u65e0\u6548\u7684\u7d22\u5f15\u3002", 
            "title": "6.4 C \u95ed\u5305"
        }, 
        {
            "location": "/luamd/06/#65-lua-c", 
            "text": "lua\u63d0\u4f9b\u4e86\u4e00\u4e9b\u7cfb\u5217C\u51fd\u6570\u6765\u548cC\u8bed\u8a00\u4ea4\u4e92(\u901a\u8fc7\u865a\u62df\u6808\u6765\u4ea4\u4e92)\u3002\u4e0b\u6587\u5217\u51fa\u4e86\u90e8\u5206\u51fd\u6570\uff0c\u66f4\u591a\u51fd\u6570\u548c\u8bf4\u660e\u8bf7\u53c2\u8003 \u5b98\u65b9\u6587\u6863\u4e2d\u6587\u7248 \u3002  6.5.1 lua_checkstack  [-0, +0, \u2013]\nint lua_checkstack (lua_State *L, int n);\n\u786e\u4fdd\u5806\u6808\u4e0a\u81f3\u5c11\u6709 n \u4e2a\u989d\u5916\u7a7a\u4f4d\u3002 \u5982\u679c\u4e0d\u80fd\u628a\u5806\u6808\u6269\u5c55\u5230\u76f8\u5e94\u7684\u5c3a\u5bf8\uff0c\u51fd\u6570\u8fd4\u56de\u5047\u3002 \u5931\u8d25\u7684\u539f\u56e0\u5305\u62ec\u5c06\u628a\u6808\u6269\u5c55\u5230\u6bd4\u56fa\u5b9a\u6700\u5927\u5c3a\u5bf8\u8fd8\u5927 \uff08\u81f3\u5c11\u662f\u51e0\u5343\u4e2a\u5143\u7d20\uff09\u6216\u5206\u914d\u5185\u5b58\u5931\u8d25\u3002 \u8fd9\u4e2a\u51fd\u6570\u6c38\u8fdc\u4e0d\u4f1a\u7f29\u5c0f\u5806\u6808\uff1b \u5982\u679c\u5806\u6808\u5df2\u7ecf\u6bd4\u9700\u8981\u7684\u5927\u4e86\uff0c\u90a3\u4e48\u5c31\u4fdd\u6301\u539f\u6837\u3002  6.5.2 lua_close  [-0, +0, \u2013]\nvoid lua_close (lua_State *L);\n\u9500\u6bc1\u6307\u5b9a Lua \u72b6\u6001\u673a\u4e2d\u7684\u6240\u6709\u5bf9\u8c61 \uff08\u5982\u679c\u6709\u5783\u573e\u6536\u96c6\u76f8\u5173\u7684\u5143\u65b9\u6cd5\u7684\u8bdd\uff0c\u4f1a\u8c03\u7528\u5b83\u4eec\uff09\uff0c \u5e76\u4e14\u91ca\u653e\u72b6\u6001\u673a\u4e2d\u4f7f\u7528\u7684\u6240\u6709\u52a8\u6001\u5185\u5b58\u3002 \u5728\u4e00\u4e9b\u5e73\u53f0\u4e0a\uff0c\u4f60\u53ef\u4ee5\u4e0d\u5fc5\u8c03\u7528\u8fd9\u4e2a\u51fd\u6570\uff0c \u56e0\u4e3a\u5f53\u5bbf\u4e3b\u7a0b\u5e8f\u7ed3\u675f\u7684\u65f6\u5019\uff0c\u6240\u6709\u7684\u8d44\u6e90\u5c31\u81ea\u7136\u88ab\u91ca\u653e\u6389\u4e86\u3002 \u53e6\u4e00\u65b9\u9762\uff0c\u957f\u671f\u8fd0\u884c\u7684\u7a0b\u5e8f\uff0c\u6bd4\u5982\u4e00\u4e2a\u540e\u53f0\u7a0b\u5e8f\u6216\u662f\u4e00\u4e2a\u7f51\u7ad9\u670d\u52a1\u5668\uff0c \u4f1a\u521b\u5efa\u51fa\u591a\u4e2a Lua \u72b6\u6001\u673a\u3002\u90a3\u4e48\u5c31\u5e94\u8be5\u5728\u4e0d\u9700\u8981\u65f6\u8d76\u7d27\u5173\u95ed\u5b83\u4eec\u3002  6.5.3 lua_getglobal  [-0, +1, e]\nint lua_getglobal (lua_State  L, const char  name);\n\u628a\u5168\u5c40\u53d8\u91cf name \u91cc\u7684\u503c\u538b\u6808\uff0c\u8fd4\u56de\u8be5\u503c\u7684\u7c7b\u578b\u3002  6.5.4 lua_isnumber  [-0, +0, \u2013]\nint lua_isnumber (lua_State *L, int index);\n\u5f53\u7ed9\u5b9a\u7d22\u5f15\u7684\u503c\u662f\u4e00\u4e2a\u6570\u5b57\uff0c\u6216\u662f\u4e00\u4e2a\u53ef\u8f6c\u6362\u4e3a\u6570\u5b57\u7684\u5b57\u7b26\u4e32\u65f6\uff0c\u8fd4\u56de 1 \uff0c\u5426\u5219\u8fd4\u56de 0 \u3002  6.5.5 lua_isstring  [-0, +0, \u2013]\nint lua_isstring (lua_State *L, int index);\n\u5f53\u7ed9\u5b9a\u7d22\u5f15\u7684\u503c\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\u6216\u662f\u4e00\u4e2a\u6570\u5b57 \uff08\u6570\u5b57\u603b\u80fd\u8f6c\u6362\u6210\u5b57\u7b26\u4e32\uff09\u65f6\uff0c\u8fd4\u56de 1 \uff0c\u5426\u5219\u8fd4\u56de 0 \u3002  6.5.6 lua_newstate  [-0, +0, \u2013]\nlua_State  lua_newstate (lua_Alloc f, void  ud);\n\u521b\u5efa\u4e00\u4e2a\u8fd0\u884c\u5728\u65b0\u7684\u72ec\u7acb\u7684\u72b6\u6001\u673a\u4e2d\u7684\u7ebf\u7a0b\u3002 \u5982\u679c\u65e0\u6cd5\u521b\u5efa\u7ebf\u7a0b\u6216\u72b6\u6001\u673a\uff08\u7531\u4e8e\u5185\u5b58\u6709\u9650\uff09\u5219\u8fd4\u56de NULL\u3002 \u53c2\u6570 f \u662f\u4e00\u4e2a\u5206\u914d\u5668\u51fd\u6570\uff1b Lua \u5c06\u901a\u8fc7\u8fd9\u4e2a\u51fd\u6570\u505a\u72b6\u6001\u673a\u5185\u6240\u6709\u7684\u5185\u5b58\u5206\u914d\u64cd\u4f5c\u3002 \u7b2c\u4e8c\u4e2a\u53c2\u6570 ud \uff0c\u8fd9\u4e2a\u6307\u9488\u5c06\u5728\u6bcf\u6b21\u8c03\u7528\u5206\u914d\u5668\u65f6\u88ab\u8f6c\u5165\u3002  6.5.7 lua_newtable  [-0, +1, e]\nvoid lua_newtable (lua_State *L);\n\u521b\u5efa\u4e00\u5f20\u7a7a\u8868\uff0c\u5e76\u5c06\u5176\u538b\u6808\u3002 \u5b83\u7b49\u4ef7\u4e8e lua_createtable(L, 0, 0) \u3002", 
            "title": "6.5 lua C\u63a5\u53e3"
        }, 
        {
            "location": "/luamd/06/#66", 
            "text": "\u8f85\u52a9\u5e93\u63d0\u4f9b\u4e86\u4e00\u4e9b\u4fbf\u6377\u51fd\u6570\uff0c\u65b9\u4fbf\u5728 C \u4e2d\u4e3a Lua \u7f16\u7a0b\u3002 \u57fa\u7840 API \u63d0\u4f9b\u4e86 C \u548c Lua \u4ea4\u4e92\u7528\u7684\u4e3b\u8981\u51fd\u6570\uff0c \u800c\u8f85\u52a9\u5e93\u5219\u4e3a\u4e00\u4e9b\u5e38\u89c1\u7684\u4efb\u52a1\u63d0\u4f9b\u4e86\u9ad8\u9636\u51fd\u6570\u3002  \u6240\u6709\u8f85\u52a9\u5e93\u4e2d\u7684\u51fd\u6570\u548c\u7c7b\u578b\u90fd\u5b9a\u4e49\u5728\u5934\u6587\u4ef6 lauxlib.h \u4e2d\uff0c \u5b83\u4eec\u5747\u5e26\u6709\u524d\u7f00 luaL_\u3002  \u8f85\u52a9\u5e93\u4e2d\u7684\u6240\u6709\u51fd\u6570\u90fd\u57fa\u4e8e\u57fa\u7840 API \u5b9e\u73b0\u3002 \u6545\u800c\u5b83\u4eec\u5e76\u6ca1\u6709\u63d0\u4f9b\u4efb\u4f55\u57fa\u7840 API \u5b9e\u73b0\u4e0d\u4e86\u7684\u529f\u80fd\u3002 \u867d\u7136\u5982\u6b64\uff0c\u4f7f\u7528\u8f85\u52a9\u5e93\u53ef\u4ee5\u8ba9\u4f60\u7684\u4ee3\u7801 \u66f4\u4e3a\u5065\u58ee \u3002  \u4e00\u4e9b\u8f85\u52a9\u5e93\u51fd\u6570\u4f1a\u5728\u5185\u90e8\u4f7f\u7528\u4e00\u4e9b\u989d\u5916\u7684\u6808\u7a7a\u95f4\u3002 \u5f53\u8f85\u52a9\u5e93\u4f7f\u7528\u7684\u6808\u7a7a\u95f4\u5c11\u4e8e\u4e94\u4e2a\u65f6\uff0c \u5b83\u4eec\u4e0d\u53bb\u68c0\u67e5\u6808\u5927\u5c0f\uff1b\u800c\u662f\u7b80\u5355\u7684\u5047\u8bbe\u6808\u591f\u7528\u3002  \u4e00\u4e9b\u8f85\u52a9\u5e93\u4e2d\u7684\u51fd\u6570\u7528\u4e8e\u68c0\u67e5 C \u51fd\u6570\u7684\u53c2\u6570\u3002 \u56e0\u4e3a\u9519\u8bef\u4fe1\u606f\u683c\u5f0f\u5316\u4e3a\u6307\u4ee3\u53c2\u6570 \uff08\u4f8b\u5982\uff0c\"bad argument #1\"\uff09\uff0c \u4f60\u5c31\u4e0d\u8981\u628a\u8fd9\u4e9b\u51fd\u6570\u7528\u4e8e\u53c2\u6570\u4e4b\u5916\u7684\u503c\u4e86\u3002  \u5982\u679c\u68c0\u67e5\u65e0\u6cd5\u901a\u8fc7\uff0c luaL_check* \u8fd9\u4e9b\u51fd\u6570\u4e00\u5b9a\u4f1a\u629b\u51fa\u9519\u8bef\u3002  \u4e0b\u6587\u5217\u51fa\u4e86\u90e8\u5206\u8f85\u52a9\u5e93\u51fd\u6570\uff0c\u66f4\u591a\u51fd\u6570\u548c\u8bf4\u660e\u8bf7\u53c2\u8003 \u5b98\u65b9\u6587\u6863\u4e2d\u6587\u7248  6.6.1 luaL_checknumber  [-0, +0, v]\nlua_Number luaL_checknumber (lua_State *L, int arg);\n\u68c0\u67e5\u51fd\u6570\u7684\u7b2c arg \u4e2a\u53c2\u6570\u662f\u5426\u662f\u4e00\u4e2a \u6570\u5b57\uff0c\u5e76\u8fd4\u56de\u8fd9\u4e2a\u6570\u5b57\u3002  6.6.2 luaL_openlibs  [-0, +0, e]\nvoid luaL_openlibs (lua_State *L);\n\u6253\u5f00\u6307\u5b9a\u72b6\u6001\u673a\u4e2d\u7684\u6240\u6709 Lua \u6807\u51c6\u5e93\u3002  6.6.3 luaL_Reg  typedef struct luaL_Reg {\n  const char *name;\n  lua_CFunction func;\n} luaL_Reg;\n\u7528\u4e8e luaL_setfuncs \u6ce8\u518c\u51fd\u6570\u7684\u6570\u7ec4\u7c7b\u578b\u3002 name \u6307\u51fd\u6570\u540d\uff0cfunc \u662f\u51fd\u6570\u6307\u9488\u3002 \u4efb\u4f55 luaL_Reg \u6570\u7ec4\u5fc5\u987b\u4ee5\u4e00\u5bf9 name \u4e0e func \u7686\u4e3a NULL \u7ed3\u675f\u3002", 
            "title": "6.6 \u8f85\u52a9\u5e93"
        }, 
        {
            "location": "/luamd/06/#67-clua", 
            "text": "\u539f\u6587  conf.lua  width = 200\nheight = 300  parse_lua.c  #include  stdio.h \n#include  string.h \n#include  lua.h \n#include  lauxlib.h \n#include  lualib.h \n\nvoid load(lua_State* L, const char* fname, int* w, int* h) {\n    if (luaL_loadfile(L,fname) || lua_pcall(L,0,0,0)) {\n        printf(\"Error Msg is %s.\\n\",lua_tostring(L,-1));\n        return;\n    }\n\n    lua_getglobal(L,\"width\");  // \u5148\u538b\u5165\u6808\n    lua_getglobal(L,\"height\"); // \u518d\u538b\u5165\u6808\n\n    if (!lua_isnumber(L,-2)) {\n        printf(\"'width' should be a number\\n\" );\n        return;\n    }\n\n    if (!lua_isnumber(L,-1)) {\n        printf(\"'height' should be a number\\n\" );\n        return;\n    }\n\n    *w = lua_tointeger(L,-2); // \u4ece\u6808\u9876\u5f39\u51fa\u6570\u636e\n    *h = lua_tointeger(L,-1);\n}\n\nint main()\n{\n    lua_State* L = luaL_newstate(); // \u521b\u5efalua\u72b6\u6001\u673a\n    int w,h;\n\n    load(L,\"conf.lua\", w, h);\n    printf(\"width = %d, height = %d\\n\",w,h);\n\n    lua_close(L); // \u9500\u6bc1lua\u72b6\u6001\u673a\n\n return 0;\n}  \u7f16\u8bd1\uff1a  gcc parse_lua.c -o parse_lua -llua -lm -ldl  \u8fd0\u884c\uff1a   ./parse_lua \nwidth = 200, height = 300  \u8fd9\u4e2a\u7b80\u5355\u7684\u4f8b\u5b50\u6f14\u793a\u4e86\u5728C\u8bed\u8a00\u4e2d\u5982\u4f55\u901a\u8fc7lua\u63d0\u4f9b\u7684\u865a\u62df\u6808\u6765\u548clua\u4ea4\u4e92\u3002", 
            "title": "6.7 C\u8c03\u7528lua\u7684\u4f8b\u5b50"
        }, 
        {
            "location": "/luamd/06/#68-luac", 
            "text": "\u4ee3\u7801Github\u5730\u5740  lcal.c  #include  lua.h \n#include  lauxlib.h \n#include  string.h \n#include  stdlib.h \n\nstatic int l_add(lua_State *L){\n    double d1 = luaL_checknumber(L, 1); // \u8fd9\u4e2a1\u4ee3\u8868\u4e86\u4ece\u5de6\u5230\u53f3lua\u8c03\u7528\u8fd9\u4e2a\u51fd\u6570\u65f6\u4f20\u5165\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570 lua\u53ea\u6709double\n    double d2 = luaL_checknumber(L, 2);\n\n    lua_pushnumber(L, d1 + d2);         // \u8fd4\u56de\u503c\u538b\u5165lua\u6808\n    return 1;\n}\n\nstatic int l_sub(lua_State *L){\n    double d1 = luaL_checknumber(L, 1);   \n    double d2 = luaL_checknumber(L, 2);\n\n    lua_pushnumber(L, d1 - d2);\n    return 1;\n}\n\nint luaopen_calc(lua_State *L){\n    luaL_checkversion(L); // \u9632\u6b62\u94fe\u63a5\u591a\u5206lua\u5e93\n\n    luaL_Reg l[] = {\n        {\"add\", l_add},     \n        {\"sub\", l_sub},\n        {NULL, NULL}\n    };\n\n    luaL_newlib(L, l); // Creates a new table and registers there the functions in list l. \n    return 1;\n}  calc_test.lua  -- \u6ce8\u610f\u8fd9\u91cc\u4e0d\u80fd\u4f7f\u7528calc.lua\u6765\u547d\u540d \u8fd9\u6837\u4f1a\u4f7f\u5f97require\u5728\u67e5\u627ecalc\u65f6\u51fa\u73b0\u6b7b\u5faa\u73af\n\nlocal calc = require \"calc\"\n\nprint(calc.add(20, 40))\nprint(calc.sub(20, 40))  Makefile  calc.so : lcalc.c\n    gcc -g -o $@ --shared $^  -I/usr/local/include -L/usr/local/bin -llua  \u8fd0\u884c\u7ed3\u679c\uff1a  make lua calc_test.lua \n60.0\n-20.0  \u5728\u8fd9\u662f\u4f8b\u5b50\u4e2d\u6211\u4eec\u7528C\u8bed\u8a00\u7f16\u5199\u4e86\u4e00\u4e2a.so\u6587\u4ef6(\u52a8\u6001\u5e93)\uff0c\u6f14\u793a\u4e86lua\u4f7f\u7528\u865a\u62df\u6808\u6765\u548cC\u4ea4\u4e92\u3002", 
            "title": "6.8 lua\u8c03\u7528C\u7684\u4f8b\u5b50"
        }, 
        {
            "location": "/luamd/06/#69-fflua", 
            "text": "fflua\u7528\u4e8eC++\u5d4c\u5165lua\u6216\u8005\u662f\u7528C++\u6269\u5c55lua\u3002  lua\u82e5\u8981\u64cd\u4f5cC++\u4e2d\u7684\u5bf9\u8c61\u6216\u51fd\u6570\uff0c\u90a3\u4e48\u5fc5\u987b\u5148\u628aC++\u5bf9\u5e94\u7684\u63a5\u53e3\u6ce8\u518c\u90fdlua\u4e2d\u3002Lua C API\u63d0\u4f9b\u4e86\u4e00\u7cfb\u5217\u7684\u63a5\u53e3\u62e5\u6709\u5b8c\u6210\u6b64\u64cd\u4f5c\uff0clua\u901a\u8fc7\u865a\u62df\u6808\u6765\u5b9e\u73b0\u5bf9C\u51fd\u6570\u7684\u8c03\u7528\u3002\u4f46\u662f\u5173\u4e8e\u5806\u6808\u7684\u64cd\u4f5c\u603b\u662f\u4f1a\u7a0d\u663e\u5934\u75bc\uff0cfflua\u6781\u5927\u7684\u7b80\u5316\u4e86\u6ce8\u518cC++\u5bf9\u8c61\u548c\u63a5\u53e3\u7684\u64cd\u4f5c\u3002  fflua github\u5730\u5740 \u5b98\u65b9\u7684\u6587\u6863\u8be6\u7ec6\u8bf4\u660e\u4e86\u600e\u4e48\u4f7f\u7528\u548c\u4f7f\u7528\u4e2d\u7684\u4e00\u4e9b\u95ee\u9898\u7b49\u3002  \u5b98\u65b9examples  \u6211\u4e3amain.cpp\u6587\u4ef6\u4e2d\u6dfb\u52a0\u4e86\u66f4\u52a0\u8be6\u7ec6\u7684\u6ce8\u91ca\uff0c\u4e3b\u8981\u662f\u8bf4\u660e\u4e86main()\u51fd\u6570\u8fd0\u884c\u7684\u65f6\u5019\u662f\u600e\u4e48\u4e00\u6b65\u4e00\u6b65\u6253\u5370\u51fa\u6700\u540e\u7684\u7ed3\u679c\u7684\uff0c\u53ef\u4ee5\u6839\u636e\u6ce8\u91ca\u4e00\u6b65\u4e00\u6b65\u4e86\u89e3lua\u548cC++\u662f\u600e\u4e48\u76f8\u4e92\u8c03\u7528\u7684\u3002  main.cpp  #include  iostream \n#include  string \n#include  assert.h \nusing namespace std;\n\n#include \"lua/fflua.h\"\n\nusing namespace ff;\n\nclass base_t\n{\npublic:\n    base_t():v(789){}\n    void dump()\n    {\n        printf(\"in %s a:%d\\n\", __FUNCTION__, v);\n    }\n    int v;\n};\nclass foo_t: public base_t\n{\npublic:\n    foo_t(int b):a(b)\n    {\n        printf(\"in %s b:%d this=%p\\n\", __FUNCTION__, b, this);\n    }\n    ~foo_t()\n    {\n        printf(\"in %s\\n\", __FUNCTION__);\n    }\n    void print(int64_t a, base_t* p) const\n    {\n        printf(\"in foo_t::print a:%ld p:%p\\n\", (long)a, p);\n    }\n\n    static void dumy()\n    {\n        printf(\"in %s\\n\", __FUNCTION__);\n    }\n    int a;\n};\n\n//! lua talbe \u53ef\u4ee5\u81ea\u52a8\u8f6c\u6362\u4e3astl \u5bf9\u8c61\nvoid dumy(map string, string  ret, vector int  a, list string  b, set int64_t  c)\n{\n    printf(\"in %s begin ------------\\n\", __FUNCTION__);\n    for (map string, string ::iterator it =  ret.begin(); it != ret.end(); ++it)\n    {\n        printf(\"map:%s, val:%s:\\n\", it- first.c_str(), it- second.c_str());\n    }\n    printf(\"in %s end ------------\\n\", __FUNCTION__);\n}\n\nclass clazz{\npublic:\n    static void static_func(){\n        printf(\"in clazz::%s end ------------\\n\", __FUNCTION__);\n    }\n};\n\nstatic void lua_reg(lua_State* ls)\n{\n    //! \u6ce8\u518c\u57fa\u7c7b\u51fd\u6570, ctor() \u4e3a\u6784\u9020\u51fd\u6570\u7684\u7c7b\u578b\n    fflua_register_t base_t, ctor() (ls, \"base_t\")  //! \u6ce8\u518c\u6784\u9020\u51fd\u6570\n                    .def( base_t::dump, \"dump\")     //! \u6ce8\u518c\u57fa\u7c7b\u7684\u51fd\u6570\n                    .def( base_t::v, \"v\");          //! \u6ce8\u518c\u57fa\u7c7b\u7684\u5c5e\u6027\n\n    //! \u6ce8\u518c\u5b50\u7c7b\uff0cctor(int) \u4e3a\u6784\u9020\u51fd\u6570\uff0c foo_t\u4e3a\u7c7b\u578b\u540d\u79f0\uff0c base_t\u4e3a\u7ee7\u627f\u7684\u57fa\u7c7b\u540d\u79f0\n    fflua_register_t foo_t, ctor(int) (ls, \"foo_t\", \"base_t\")\n                .def( foo_t::print, \"print\")        //! \u5b50\u7c7b\u7684\u51fd\u6570\n                .def( foo_t::a, \"a\");               //! \u5b50\u7c7b\u7684\u5b57\u6bb5\n\n    fflua_register_t (ls)\n                .def( dumy, \"dumy\");                //! \u6ce8\u518c\u9759\u6001\u51fd\u6570\n\n\n    fflua_register_t clazz, ctor() (ls, \"clazz\")\n                .def( clazz::static_func, \"static_func\");\n\n}\n\nint main(int argc, char* argv[])\n{\n\n    fflua_t fflua;\n    try \n    {\n        //! \u6ce8\u518cC++ \u5bf9\u8c61\u5230lua\u4e2d\n        fflua.reg(lua_reg);\n\n        //! \u8f7d\u5165lua\u6587\u4ef6\n        fflua.add_package_path(\"./\");\n#ifdef _WIN32\n        fflua.load_file(\"../test.lua\");\n#else\n        fflua.load_file(\"test.lua\"); // lua\u6587\u4ef6\u91cc\u9762\u8c03\u7528\u4e86 clazz:static_func() \u6253\u5370\u51fa in clazz::static_func end ------------\n#endif\n        //! \u83b7\u53d6\u5168\u5c40\u53d8\u91cf\n        int var = 0;\n        assert(0 == fflua.get_global_variable(\"test_var\", var));\n        //! \u8bbe\u7f6e\u5168\u5c40\u53d8\u91cf\n        assert(0 == fflua.set_global_variable(\"test_var\", ++var));\n\n        //! \u6267\u884clua \u8bed\u53e5 \u6253\u5370\u51fa exe run_string!!\n        fflua.run_string(\"print(\\\"exe run_string!!\\\")\");\n\n        //! \u8c03\u7528lua test_func\u51fd\u6570, \u57fa\u672c\u7c7b\u578b\u4f5c\u4e3a\u53c2\u6570 \u6253\u5370\u51fa in test_func:   1.0     2.0     3.0     4\n        // lua test_func\u51fd\u6570\u91cc\u9762\u8c03\u7528cpp\u7684dumy\u51fd\u6570\u6253\u5370\u51fa \n        // in dumy begin ------------\n        // map:k, val:v:\n        // in dumy end ------------\n        int32_t arg1 = 1;\n        float   arg2 = 2;\n        double  arg3 = 3;\n        string  arg4 = \"4\";\n        fflua.call bool (\"test_func\", arg1, arg2, arg3,  arg4);\n\n        //! \u8c03\u7528lua test_stl()\u51fd\u6570\uff0cstl\u7c7b\u578b\u4f5c\u4e3a\u53c2\u6570\uff0c \u81ea\u52a8\u8f6c\u6362\u4e3alua talbe \u6253\u5370\u51fa\uff1a\n        // --------------dump_table begin ----------------\n        // vec     1       100.0\n        // lt      1       99.98999786377\n        // st      1       OhNIce\n        // mp      key     200.0\n        // --------------dump_table end ----------------\n        vector int  vec;        vec.push_back(100);\n        list float  lt;         lt.push_back((float)99.99);\n        set string  st;         st.insert(\"OhNIce\");\n        map string, int  mp;    mp[\"key\"] = 200;\n        fflua.call string (\"test_stl\", vec, lt, st,  mp);\n\n        //! \u8c03\u7528lua \u51fd\u6570\u8fd4\u56de talbe\uff0c\u81ea\u52a8\u8f6c\u6362\u4e3astl\u7ed3\u6784\n        vec = fflua.call vector int   (\"test_return_stl_vector\");\n        lt  = fflua.call list float   (\"test_return_stl_list\");\n        st  = fflua.call set string   (\"test_return_stl_set\");\n        mp  = fflua.call map string, int   (\"test_return_stl_map\");\n\n        //! \u8c03\u7528lua\u51fd\u6570\uff0cc++ \u5bf9\u8c61\u4f5c\u4e3a\u53c2\u6570, foo_t \u5fc5\u987b\u88ab\u6ce8\u518c\u8fc7\n        // new ffo_t(456) \u6253\u5370\u51fa\uff1a in foo_t b:456 this=0x82cf468\n        // \u8c03\u7528lua\u7684test_object\u51fd\u6570 \u6253\u5370\u51fa\uff1a base ptr:       137158880\n        // test_object\u51fd\u6570\u5185\u8c03\u7528 foo_obj:print \u6253\u5370\u51fa\uff1a in foo_t::print a:12333 p:0x82ce0e0\n        // test_object\u51fd\u6570\u5185\u8c03\u7528 foo_obj:dump() \u6253\u5370\u51fa\uff1ain dump a:789\n        // test_object\u51fd\u6570\u5185 \u6253\u5370\u51fa\uff1a foo property    456.0\n        // test_object\u51fd\u6570\u5185 \u6253\u5370\u51fa\uff1a  base property   789.0\n        foo_t* foo_ptr = new foo_t(456);\n        fflua.call void (\"test_object\", foo_ptr);\n\n        //! \u8c03\u7528lua\u51fd\u6570\uff0cc++ \u5bf9\u8c61\u4f5c\u4e3a\u8fd4\u56de\u503c, foo_t \u5fc5\u987b\u88ab\u6ce8\u518c\u8fc7 \n        assert(foo_ptr == fflua.call foo_t* (\"test_ret_object\", foo_ptr));\n        //! \u8c03\u7528lua\u51fd\u6570\uff0cc++ \u5bf9\u8c61\u4f5c\u4e3a\u8fd4\u56de\u503c, \u81ea\u52a8\u8f6c\u6362\u4e3a\u57fa\u7c7b\n        base_t* base_ptr = fflua.call base_t* (\"test_ret_base_object\", foo_ptr);\n        assert(base_ptr == foo_ptr);\n\n    }\n    catch (exception  e)\n    {\n        printf(\"exception:%s\\n\", e.what());\n\n\n    }\n#ifdef _WIN32\n    system(\"pause\");\n#endif\n    return 0;\n}  test.lua   test_var = 99\n\nfunction dump_table(tb, str)\n    if nil == str then str = \"\" end\n    for k, v in pairs(tb)\n    do\n        print(str, k, v)\n    end\nend\n\n-- \u6d4b\u8bd5\u8c03\u7528lua\nfunction test_func(arg1, arg2, arg3, arg4)\n    print(\"in test_func:\", arg1, arg2, arg3, arg4)\n    mp = {[\"k\"] = \"v\"}\n    vc = {1,2,3}\n    lt = {4,5,6}\n    st = {7,8,9}\n    dumy(mp, vc, lt, st)\nend\n\n-- \u63a5\u53d7stl\u53c2\u6570\nfunction test_stl(vec, lt, st, mp)\n    print(\"--------------dump_table begin ----------------\")\n    dump_table(vec, \"vec\")\n    dump_table(lt, \"lt\")\n    dump_table(st, \"st\")\n    dump_table(mp, \"mp\")\n    print(\"--------------dump_table end ----------------\")\n    return \"ok\"\nend\n\n-- \u8fd4\u56destl \u53c2\u6570\nfunction test_return_stl_vector()\n    return {1,2,3,4}\nend\nfunction test_return_stl_list()\n    return {1,2,3,4}\nend\nfunction test_return_stl_set()\n    return {1,2,3,4}\nend\nfunction test_return_stl_map()\n    return {\n        [\"key\"] = 124\n    }\nend\n-- \u6d4b\u8bd5\u63a5\u53d7C++\u5bf9\u8c61\nfunction test_object(foo_obj)\n    --\u6d4b\u8bd5\u6784\u9020\n    base = base_t:new()\n    -- \u6bcf\u4e2a\u5bf9\u8c61\u90fd\u6709\u4e00\u4e2aget_pointer\u83b7\u53d6\u6307\u9488\n    print(\"base ptr:\", base:get_pointer())\n    -- \u6d4b\u8bd5C++\u5bf9\u8c61\u51fd\u6570\n    foo_obj:print(12333, base)\n    base:delete()\n    --\u57fa\u7c7b\u7684\u51fd\u6570\n    foo_obj:dump()\n    -- \u6d4b\u8bd5C++ \u5bf9\u8c61\u5c5e\u6027\n    print(\"foo property\", foo_obj.a)\n    print(\"base property\", foo_obj.v)\nend\n\n-- \u6d4b\u8bd5\u8fd4\u56deC++\u5bf9\u8c61\nfunction test_ret_object(foo_obj)\n    return foo_obj\nend\n\n-- \u6d4b\u8bd5\u8fd4\u56deC++\u5bf9\u8c61\nfunction test_ret_base_object(foo_obj)\n    return foo_obj\nend\n\n\nclazz:static_func()  \u7f16\u8bd1\u8fd0\u884c\uff1a   git clone https://github.com/fanchy/fflua  cd fflua/example/  make  ./app_lua  \u8fd0\u884c\u7ed3\u679c\uff1a  in clazz::static_func end ------------\nexe run_string!!\nin test_func:   1.0     2.0     3.0     4\nin dumy begin ------------\nmap:k, val:v:\nin dumy end ------------\n--------------dump_table begin ----------------\nvec     1       100.0\nlt      1       99.98999786377\nst      1       OhNIce\nmp      key     200.0\n--------------dump_table end ----------------\nin foo_t b:456 this=0x82cf468\nbase ptr:       137158880\nin foo_t::print a:12333 p:0x82ce0e0\nin dump a:789\nfoo property    456.0\nbase property   789.0", 
            "title": "6.9 fflua"
        }, 
        {
            "location": "/luamd/06/#610-lua-cjson", 
            "text": "json\u5b98\u7f51\u5217\u51fa\u6765\u5f88\u591a\u5f00\u6e90\u7684 lua json\u5e93 \uff0c\u7528\u4e8elua table\u5bf9\u8c61\u548cjson\u6570\u636e\u683c\u5f0f\u7684\u76f8\u4e92\u8f6c\u6362\u3002\u8fd9\u91cc\u7b80\u5355\u4ecb\u7ecdcjson\u5e93\u7684\u4f7f\u7528\u3002  \u83b7\u53d6\u4ee3\u7801\u5e76\u8fd0\u884c\u6d4b\u8bd5\u5b9e\u4f8b   git clone https://github.com/peimin/lua_cjson  cd lua_cjson/  make  lua json_test.lua  \u8fd0\u884c\u7ed3\u679c\uff1a  usr_encode: {\"name\":\"name5566boy\",\"usr_xx\":{\"2\":33,\"3\":44,\"1\":22},\"age\":72}\nname: name5566boy\nage : 72.0\nusr_xx...\n2       33.0\n3       44.0\n1       22.0  json.lua  \u5bf9cjson\u63a5\u53e3\u7684\u7b80\u5355\u5c01\u88c5\uff0c\u4ee5\u4fdd\u62a4\u6a21\u5f0f\u8c03\u7528cjson\u63d0\u4f9b\u7684json\u89e3\u5305 \u538b\u5305\u51fd\u6570\u3002  local json = {}\nlocal cjson = require(\"cjson\")\n\nfunction json.encode(var)\n    local status, result = pcall(cjson.encode, var)\n    if status then \n        return result \n    end\nend\n\nfunction json.decode(text)\n    local status, result = pcall(cjson.decode, text)\n    if status then \n        return result \n    end\nend\n\nreturn json  json_test.lua  local json = require \"json\"\n\nlocal usr_xx ={}\nusr_xx[\"1\"] = 22\nusr_xx[\"2\"] = 33\nusr_xx[\"3\"] = 44\n\nlocal usr = {}\nusr[\"name\"]   = \"name5566boy\"\nusr[\"age\"]    = 72\nusr[\"usr_xx\"] = usr_xx\n\nlocal usr_encode = json.encode(usr)     -- \u5c06lua table\u5bf9\u8c61\u8f6c\u6362\u6210json\u5b57\u7b26\u4e32\nif usr_encode then\n    print(\"usr_encode: \"..usr_encode)   -- {\"usr_xx\":{\"2\":33,\"3\":44,\"1\":22},\"age\":72,\"name\":\"name5566boy\"}\nend\n\nlocal usr_msg = json.decode(usr_encode) -- \u5c06json\u5b57\u7b26\u4e32\u8f6c\u6362\u6210lua table\u5bf9\u8c61 \nif usr_msg then\n    print(\"name: \"..usr_msg[\"name\"])\n    print(\"age : \"..usr_msg[\"age\"])\n    local usr_xx = usr_msg[\"usr_xx\"]\n\n    print(\"usr_xx...\")\n    for k, v in pairs (usr_xx) do\n      print (k, v)\n    end \nend", 
            "title": "6.10 lua cjson\u5e93"
        }, 
        {
            "location": "/luamd/07/", 
            "text": "lua 5.1.4 gc \u6e90\u7801\u5256\u6790\n\n\nlua 5.1.4 gc \u6e90\u7801\u5256\u6790 (1)\n\n\nlua 5.1.4 gc \u6e90\u7801\u5256\u6790 (2)\n\n\nlua 5.1.4 gc \u6e90\u7801\u5256\u6790 (3)\n\n\nlua 5.1.4 gc \u6e90\u7801\u5256\u6790 (4)\n\n\nlua 5.1.4 gc \u6e90\u7801\u5256\u6790 (5)\n\n\nlua \u6e90\u7801\u8d4f\u6790 - \u4e91\u98ce\n\n\nhttp://www.codingnow.com/temp/readinglua.pdf\n\n\nlua 5.2 \u5185\u90e8\u5b9e\u73b0\n\n\nhttp://blog.csdn.net/yuanlin2008/article/category/1307277\n\n\n\u4e91\u98ce\u7684BLOG 120\u7bc7 lua \u4e0e\u865a\u62df\u673a\n\n\nhttp://blog.codingnow.com/eo/luaoeeeaeau/", 
            "title": "07"
        }, 
        {
            "location": "/luamd/07/#lua-514-gc", 
            "text": "lua 5.1.4 gc \u6e90\u7801\u5256\u6790 (1)  lua 5.1.4 gc \u6e90\u7801\u5256\u6790 (2)  lua 5.1.4 gc \u6e90\u7801\u5256\u6790 (3)  lua 5.1.4 gc \u6e90\u7801\u5256\u6790 (4)  lua 5.1.4 gc \u6e90\u7801\u5256\u6790 (5)", 
            "title": "lua 5.1.4 gc \u6e90\u7801\u5256\u6790"
        }, 
        {
            "location": "/luamd/07/#lua-", 
            "text": "http://www.codingnow.com/temp/readinglua.pdf", 
            "title": "lua \u6e90\u7801\u8d4f\u6790 - \u4e91\u98ce"
        }, 
        {
            "location": "/luamd/07/#lua-52", 
            "text": "http://blog.csdn.net/yuanlin2008/article/category/1307277", 
            "title": "lua 5.2 \u5185\u90e8\u5b9e\u73b0"
        }, 
        {
            "location": "/luamd/07/#blog-120-lua", 
            "text": "http://blog.codingnow.com/eo/luaoeeeaeau/", 
            "title": "\u4e91\u98ce\u7684BLOG 120\u7bc7 lua \u4e0e\u865a\u62df\u673a"
        }
    ]
}